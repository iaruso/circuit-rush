var lL=Object.defineProperty;var cL=(i,e,t)=>e in i?lL(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var my=(i,e,t)=>(cL(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var Da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Db(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var l5={exports:{}},Jb={},c5={exports:{}},ln={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fp=Symbol.for("react.element"),IL=Symbol.for("react.portal"),uL=Symbol.for("react.fragment"),CL=Symbol.for("react.strict_mode"),dL=Symbol.for("react.profiler"),hL=Symbol.for("react.provider"),AL=Symbol.for("react.context"),pL=Symbol.for("react.forward_ref"),fL=Symbol.for("react.suspense"),mL=Symbol.for("react.memo"),bL=Symbol.for("react.lazy"),IS=Symbol.iterator;function GL(i){return i===null||typeof i!="object"?null:(i=IS&&i[IS]||i["@@iterator"],typeof i=="function"?i:null)}var I5={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},u5=Object.assign,C5={};function Ed(i,e,t){this.props=i,this.context=e,this.refs=C5,this.updater=t||I5}Ed.prototype.isReactComponent={};Ed.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};Ed.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function d5(){}d5.prototype=Ed.prototype;function g1(i,e,t){this.props=i,this.context=e,this.refs=C5,this.updater=t||I5}var a1=g1.prototype=new d5;a1.constructor=g1;u5(a1,Ed.prototype);a1.isPureReactComponent=!0;var uS=Array.isArray,h5=Object.prototype.hasOwnProperty,l1={current:null},A5={key:!0,ref:!0,__self:!0,__source:!0};function p5(i,e,t){var n,s={},r=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)h5.call(e,n)&&!A5.hasOwnProperty(n)&&(s[n]=e[n]);var g=arguments.length-2;if(g===1)s.children=t;else if(1<g){for(var a=Array(g),l=0;l<g;l++)a[l]=arguments[l+2];s.children=a}if(i&&i.defaultProps)for(n in g=i.defaultProps,g)s[n]===void 0&&(s[n]=g[n]);return{$$typeof:Fp,type:i,key:r,ref:o,props:s,_owner:l1.current}}function yL(i,e){return{$$typeof:Fp,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function c1(i){return typeof i=="object"&&i!==null&&i.$$typeof===Fp}function BL(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var CS=/\/+/g;function by(i,e){return typeof i=="object"&&i!==null&&i.key!=null?BL(""+i.key):e.toString(36)}function F0(i,e,t,n,s){var r=typeof i;(r==="undefined"||r==="boolean")&&(i=null);var o=!1;if(i===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(i.$$typeof){case Fp:case IL:o=!0}}if(o)return o=i,s=s(o),i=n===""?"."+by(o,0):n,uS(s)?(t="",i!=null&&(t=i.replace(CS,"$&/")+"/"),F0(s,e,t,"",function(l){return l})):s!=null&&(c1(s)&&(s=yL(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(CS,"$&/")+"/")+i)),e.push(s)),1;if(o=0,n=n===""?".":n+":",uS(i))for(var g=0;g<i.length;g++){r=i[g];var a=n+by(r,g);o+=F0(r,e,t,a,s)}else if(a=GL(i),typeof a=="function")for(i=a.call(i),g=0;!(r=i.next()).done;)r=r.value,a=n+by(r,g++),o+=F0(r,e,t,a,s);else if(r==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function bm(i,e,t){if(i==null)return i;var n=[],s=0;return F0(i,n,"","",function(r){return e.call(t,r,s++)}),n}function vL(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var gr={current:null},N0={transition:null},ZL={ReactCurrentDispatcher:gr,ReactCurrentBatchConfig:N0,ReactCurrentOwner:l1};ln.Children={map:bm,forEach:function(i,e,t){bm(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return bm(i,function(){e++}),e},toArray:function(i){return bm(i,function(e){return e})||[]},only:function(i){if(!c1(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};ln.Component=Ed;ln.Fragment=uL;ln.Profiler=dL;ln.PureComponent=g1;ln.StrictMode=CL;ln.Suspense=fL;ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZL;ln.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var n=u5({},i.props),s=i.key,r=i.ref,o=i._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=l1.current),e.key!==void 0&&(s=""+e.key),i.type&&i.type.defaultProps)var g=i.type.defaultProps;for(a in e)h5.call(e,a)&&!A5.hasOwnProperty(a)&&(n[a]=e[a]===void 0&&g!==void 0?g[a]:e[a])}var a=arguments.length-2;if(a===1)n.children=t;else if(1<a){g=Array(a);for(var l=0;l<a;l++)g[l]=arguments[l+2];n.children=g}return{$$typeof:Fp,type:i.type,key:s,ref:r,props:n,_owner:o}};ln.createContext=function(i){return i={$$typeof:AL,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:hL,_context:i},i.Consumer=i};ln.createElement=p5;ln.createFactory=function(i){var e=p5.bind(null,i);return e.type=i,e};ln.createRef=function(){return{current:null}};ln.forwardRef=function(i){return{$$typeof:pL,render:i}};ln.isValidElement=c1;ln.lazy=function(i){return{$$typeof:bL,_payload:{_status:-1,_result:i},_init:vL}};ln.memo=function(i,e){return{$$typeof:mL,type:i,compare:e===void 0?null:e}};ln.startTransition=function(i){var e=N0.transition;N0.transition={};try{i()}finally{N0.transition=e}};ln.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ln.useCallback=function(i,e){return gr.current.useCallback(i,e)};ln.useContext=function(i){return gr.current.useContext(i)};ln.useDebugValue=function(){};ln.useDeferredValue=function(i){return gr.current.useDeferredValue(i)};ln.useEffect=function(i,e){return gr.current.useEffect(i,e)};ln.useId=function(){return gr.current.useId()};ln.useImperativeHandle=function(i,e,t){return gr.current.useImperativeHandle(i,e,t)};ln.useInsertionEffect=function(i,e){return gr.current.useInsertionEffect(i,e)};ln.useLayoutEffect=function(i,e){return gr.current.useLayoutEffect(i,e)};ln.useMemo=function(i,e){return gr.current.useMemo(i,e)};ln.useReducer=function(i,e,t){return gr.current.useReducer(i,e,t)};ln.useRef=function(i){return gr.current.useRef(i)};ln.useState=function(i){return gr.current.useState(i)};ln.useSyncExternalStore=function(i,e,t){return gr.current.useSyncExternalStore(i,e,t)};ln.useTransition=function(){return gr.current.useTransition()};ln.version="18.2.0";c5.exports=ln;var T=c5.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wL=T,SL=Symbol.for("react.element"),RL=Symbol.for("react.fragment"),WL=Object.prototype.hasOwnProperty,xL=wL.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,VL={key:!0,ref:!0,__self:!0,__source:!0};function f5(i,e,t){var n,s={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)WL.call(e,n)&&!VL.hasOwnProperty(n)&&(s[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:SL,type:i,key:r,ref:o,props:s,_owner:xL.current}}Jb.Fragment=RL;Jb.jsx=f5;Jb.jsxs=f5;l5.exports=Jb;var I1=l5.exports;const Sr=I1.Fragment,D=I1.jsx,$e=I1.jsxs;var m5={exports:{}},Ao={},b5={exports:{}},G5={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(_,ne){var te=_.length;_.push(ne);e:for(;0<te;){var q=te-1>>>1,se=_[q];if(0<s(se,ne))_[q]=ne,_[te]=se,te=q;else break e}}function t(_){return _.length===0?null:_[0]}function n(_){if(_.length===0)return null;var ne=_[0],te=_.pop();if(te!==ne){_[0]=te;e:for(var q=0,se=_.length,ue=se>>>1;q<ue;){var Ae=2*(q+1)-1,We=_[Ae],me=Ae+1,tt=_[me];if(0>s(We,te))me<se&&0>s(tt,We)?(_[q]=tt,_[me]=te,q=me):(_[q]=We,_[Ae]=te,q=Ae);else if(me<se&&0>s(tt,te))_[q]=tt,_[me]=te,q=me;else break e}}return ne}function s(_,ne){var te=_.sortIndex-ne.sortIndex;return te!==0?te:_.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var o=Date,g=o.now();i.unstable_now=function(){return o.now()-g}}var a=[],l=[],c=1,C=null,h=3,p=!1,m=!1,f=!1,b=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(_){for(var ne=t(l);ne!==null;){if(ne.callback===null)n(l);else if(ne.startTime<=_)n(l),ne.sortIndex=ne.expirationTime,e(a,ne);else break;ne=t(l)}}function w(_){if(f=!1,G(_),!m)if(t(a)!==null)m=!0,he(W);else{var ne=t(l);ne!==null&&le(w,ne.startTime-_)}}function W(_,ne){m=!1,f&&(f=!1,y(R),R=-1),p=!0;var te=h;try{for(G(ne),C=t(a);C!==null&&(!(C.expirationTime>ne)||_&&!L());){var q=C.callback;if(typeof q=="function"){C.callback=null,h=C.priorityLevel;var se=q(C.expirationTime<=ne);ne=i.unstable_now(),typeof se=="function"?C.callback=se:C===t(a)&&n(a),G(ne)}else n(a);C=t(a)}if(C!==null)var ue=!0;else{var Ae=t(l);Ae!==null&&le(w,Ae.startTime-ne),ue=!1}return ue}finally{C=null,h=te,p=!1}}var V=!1,X=null,R=-1,Y=5,M=-1;function L(){return!(i.unstable_now()-M<Y)}function re(){if(X!==null){var _=i.unstable_now();M=_;var ne=!0;try{ne=X(!0,_)}finally{ne?j():(V=!1,X=null)}}else V=!1}var j;if(typeof v=="function")j=function(){v(re)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,ie=$.port2;$.port1.onmessage=re,j=function(){ie.postMessage(null)}}else j=function(){b(re,0)};function he(_){X=_,V||(V=!0,j())}function le(_,ne){R=b(function(){_(i.unstable_now())},ne)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(_){_.callback=null},i.unstable_continueExecution=function(){m||p||(m=!0,he(W))},i.unstable_forceFrameRate=function(_){0>_||125<_?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<_?Math.floor(1e3/_):5},i.unstable_getCurrentPriorityLevel=function(){return h},i.unstable_getFirstCallbackNode=function(){return t(a)},i.unstable_next=function(_){switch(h){case 1:case 2:case 3:var ne=3;break;default:ne=h}var te=h;h=ne;try{return _()}finally{h=te}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(_,ne){switch(_){case 1:case 2:case 3:case 4:case 5:break;default:_=3}var te=h;h=_;try{return ne()}finally{h=te}},i.unstable_scheduleCallback=function(_,ne,te){var q=i.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?q+te:q):te=q,_){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=te+se,_={id:c++,callback:ne,priorityLevel:_,startTime:te,expirationTime:se,sortIndex:-1},te>q?(_.sortIndex=te,e(l,_),t(a)===null&&_===t(l)&&(f?(y(R),R=-1):f=!0,le(w,te-q))):(_.sortIndex=se,e(a,_),m||p||(m=!0,he(W))),_},i.unstable_shouldYield=L,i.unstable_wrapCallback=function(_){var ne=h;return function(){var te=h;h=ne;try{return _.apply(this,arguments)}finally{h=te}}}})(G5);b5.exports=G5;var HL=b5.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y5=T,uo=HL;function Ue(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var B5=new Set,ep={};function wu(i,e){Bd(i,e),Bd(i+"Capture",e)}function Bd(i,e){for(ep[i]=e,i=0;i<e.length;i++)B5.add(e[i])}var tl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),r2=Object.prototype.hasOwnProperty,XL=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,dS={},hS={};function YL(i){return r2.call(hS,i)?!0:r2.call(dS,i)?!1:XL.test(i)?hS[i]=!0:(dS[i]=!0,!1)}function FL(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function NL(i,e,t,n){if(e===null||typeof e>"u"||FL(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ar(i,e,t,n,s,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Gs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Gs[i]=new ar(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];Gs[e]=new ar(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Gs[i]=new ar(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Gs[i]=new ar(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Gs[i]=new ar(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Gs[i]=new ar(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Gs[i]=new ar(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Gs[i]=new ar(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Gs[i]=new ar(i,5,!1,i.toLowerCase(),null,!1,!1)});var u1=/[\-:]([a-z])/g;function C1(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(u1,C1);Gs[e]=new ar(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(u1,C1);Gs[e]=new ar(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(u1,C1);Gs[e]=new ar(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Gs[i]=new ar(i,1,!1,i.toLowerCase(),null,!1,!1)});Gs.xlinkHref=new ar("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Gs[i]=new ar(i,1,!1,i.toLowerCase(),null,!0,!0)});function d1(i,e,t,n){var s=Gs.hasOwnProperty(e)?Gs[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(NL(e,t,s,n)&&(t=null),n||s===null?YL(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):s.mustUseProperty?i[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,n=s.attributeNamespace,t===null?i.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var ul=y5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Gm=Symbol.for("react.element"),EC=Symbol.for("react.portal"),DC=Symbol.for("react.fragment"),h1=Symbol.for("react.strict_mode"),o2=Symbol.for("react.profiler"),v5=Symbol.for("react.provider"),Z5=Symbol.for("react.context"),A1=Symbol.for("react.forward_ref"),g2=Symbol.for("react.suspense"),a2=Symbol.for("react.suspense_list"),p1=Symbol.for("react.memo"),ic=Symbol.for("react.lazy"),w5=Symbol.for("react.offscreen"),AS=Symbol.iterator;function Qh(i){return i===null||typeof i!="object"?null:(i=AS&&i[AS]||i["@@iterator"],typeof i=="function"?i:null)}var ci=Object.assign,Gy;function WA(i){if(Gy===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Gy=e&&e[1]||""}return`
`+Gy+i}var yy=!1;function By(i,e){if(!i||yy)return"";yy=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(i,[],e)}else{try{e.call()}catch(l){n=l}i.call(e.prototype)}else{try{throw Error()}catch(l){n=l}i()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var s=l.stack.split(`
`),r=n.stack.split(`
`),o=s.length-1,g=r.length-1;1<=o&&0<=g&&s[o]!==r[g];)g--;for(;1<=o&&0<=g;o--,g--)if(s[o]!==r[g]){if(o!==1||g!==1)do if(o--,g--,0>g||s[o]!==r[g]){var a=`
`+s[o].replace(" at new "," at ");return i.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",i.displayName)),a}while(1<=o&&0<=g);break}}}finally{yy=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?WA(i):""}function ML(i){switch(i.tag){case 5:return WA(i.type);case 16:return WA("Lazy");case 13:return WA("Suspense");case 19:return WA("SuspenseList");case 0:case 2:case 15:return i=By(i.type,!1),i;case 11:return i=By(i.type.render,!1),i;case 1:return i=By(i.type,!0),i;default:return""}}function l2(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case DC:return"Fragment";case EC:return"Portal";case o2:return"Profiler";case h1:return"StrictMode";case g2:return"Suspense";case a2:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Z5:return(i.displayName||"Context")+".Consumer";case v5:return(i._context.displayName||"Context")+".Provider";case A1:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case p1:return e=i.displayName||null,e!==null?e:l2(i.type)||"Memo";case ic:e=i._payload,i=i._init;try{return l2(i(e))}catch{}}return null}function KL(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return l2(e);case 8:return e===h1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Wc(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function S5(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function LL(i){var e=S5(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,r=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){n=""+o,r.call(this,o)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function ym(i){i._valueTracker||(i._valueTracker=LL(i))}function R5(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=S5(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function gb(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function c2(i,e){var t=e.checked;return ci({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function pS(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Wc(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function W5(i,e){e=e.checked,e!=null&&d1(i,"checked",e,!1)}function I2(i,e){W5(i,e);var t=Wc(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?u2(i,e.type,t):e.hasOwnProperty("defaultValue")&&u2(i,e.type,Wc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function fS(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function u2(i,e,t){(e!=="number"||gb(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var xA=Array.isArray;function ld(i,e,t,n){if(i=i.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<i.length;t++)s=e.hasOwnProperty("$"+i[t].value),i[t].selected!==s&&(i[t].selected=s),s&&n&&(i[t].defaultSelected=!0)}else{for(t=""+Wc(t),e=null,s=0;s<i.length;s++){if(i[s].value===t){i[s].selected=!0,n&&(i[s].defaultSelected=!0);return}e!==null||i[s].disabled||(e=i[s])}e!==null&&(e.selected=!0)}}function C2(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ue(91));return ci({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function mS(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ue(92));if(xA(t)){if(1<t.length)throw Error(Ue(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:Wc(t)}}function x5(i,e){var t=Wc(e.value),n=Wc(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function bS(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function V5(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function d2(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?V5(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Bm,H5=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,s)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(Bm=Bm||document.createElement("div"),Bm.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Bm.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function tp(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var KA={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zL=["Webkit","ms","Moz","O"];Object.keys(KA).forEach(function(i){zL.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),KA[e]=KA[i]})});function X5(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||KA.hasOwnProperty(i)&&KA[i]?(""+e).trim():e+"px"}function Y5(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,s=X5(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,s):i[t]=s}}var _L=ci({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function h2(i,e){if(e){if(_L[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ue(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ue(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ue(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ue(62))}}function A2(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var p2=null;function f1(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var f2=null,cd=null,Id=null;function GS(i){if(i=Kp(i)){if(typeof f2!="function")throw Error(Ue(280));var e=i.stateNode;e&&(e=jb(e),f2(i.stateNode,i.type,e))}}function F5(i){cd?Id?Id.push(i):Id=[i]:cd=i}function N5(){if(cd){var i=cd,e=Id;if(Id=cd=null,GS(i),e)for(i=0;i<e.length;i++)GS(e[i])}}function M5(i,e){return i(e)}function K5(){}var vy=!1;function L5(i,e,t){if(vy)return i(e,t);vy=!0;try{return M5(i,e,t)}finally{vy=!1,(cd!==null||Id!==null)&&(K5(),N5())}}function np(i,e){var t=i.stateNode;if(t===null)return null;var n=jb(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(Ue(231,e,typeof t));return t}var m2=!1;if(tl)try{var jh={};Object.defineProperty(jh,"passive",{get:function(){m2=!0}}),window.addEventListener("test",jh,jh),window.removeEventListener("test",jh,jh)}catch{m2=!1}function kL(i,e,t,n,s,r,o,g,a){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(c){this.onError(c)}}var LA=!1,ab=null,lb=!1,b2=null,TL={onError:function(i){LA=!0,ab=i}};function EL(i,e,t,n,s,r,o,g,a){LA=!1,ab=null,kL.apply(TL,arguments)}function DL(i,e,t,n,s,r,o,g,a){if(EL.apply(this,arguments),LA){if(LA){var l=ab;LA=!1,ab=null}else throw Error(Ue(198));lb||(lb=!0,b2=l)}}function Su(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function z5(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function yS(i){if(Su(i)!==i)throw Error(Ue(188))}function JL(i){var e=i.alternate;if(!e){if(e=Su(i),e===null)throw Error(Ue(188));return e!==i?null:i}for(var t=i,n=e;;){var s=t.return;if(s===null)break;var r=s.alternate;if(r===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===t)return yS(s),i;if(r===n)return yS(s),e;r=r.sibling}throw Error(Ue(188))}if(t.return!==n.return)t=s,n=r;else{for(var o=!1,g=s.child;g;){if(g===t){o=!0,t=s,n=r;break}if(g===n){o=!0,n=s,t=r;break}g=g.sibling}if(!o){for(g=r.child;g;){if(g===t){o=!0,t=r,n=s;break}if(g===n){o=!0,n=r,t=s;break}g=g.sibling}if(!o)throw Error(Ue(189))}}if(t.alternate!==n)throw Error(Ue(190))}if(t.tag!==3)throw Error(Ue(188));return t.stateNode.current===t?i:e}function _5(i){return i=JL(i),i!==null?k5(i):null}function k5(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=k5(i);if(e!==null)return e;i=i.sibling}return null}var T5=uo.unstable_scheduleCallback,BS=uo.unstable_cancelCallback,UL=uo.unstable_shouldYield,PL=uo.unstable_requestPaint,xi=uo.unstable_now,OL=uo.unstable_getCurrentPriorityLevel,m1=uo.unstable_ImmediatePriority,E5=uo.unstable_UserBlockingPriority,cb=uo.unstable_NormalPriority,QL=uo.unstable_LowPriority,D5=uo.unstable_IdlePriority,Ub=null,aa=null;function jL(i){if(aa&&typeof aa.onCommitFiberRoot=="function")try{aa.onCommitFiberRoot(Ub,i,void 0,(i.current.flags&128)===128)}catch{}}var Sg=Math.clz32?Math.clz32:ez,qL=Math.log,$L=Math.LN2;function ez(i){return i>>>=0,i===0?32:31-(qL(i)/$L|0)|0}var vm=64,Zm=4194304;function VA(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Ib(i,e){var t=i.pendingLanes;if(t===0)return 0;var n=0,s=i.suspendedLanes,r=i.pingedLanes,o=t&268435455;if(o!==0){var g=o&~s;g!==0?n=VA(g):(r&=o,r!==0&&(n=VA(r)))}else o=t&~s,o!==0?n=VA(o):r!==0&&(n=VA(r));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,r=e&-e,s>=r||s===16&&(r&4194240)!==0))return e;if(n&4&&(n|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-Sg(e),s=1<<t,n|=i[t],e&=~s;return n}function tz(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nz(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,s=i.expirationTimes,r=i.pendingLanes;0<r;){var o=31-Sg(r),g=1<<o,a=s[o];a===-1?(!(g&t)||g&n)&&(s[o]=tz(g,e)):a<=e&&(i.expiredLanes|=g),r&=~g}}function G2(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function J5(){var i=vm;return vm<<=1,!(vm&4194240)&&(vm=64),i}function Zy(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function Np(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-Sg(e),i[e]=t}function iz(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var n=i.eventTimes;for(i=i.expirationTimes;0<t;){var s=31-Sg(t),r=1<<s;e[s]=0,n[s]=-1,i[s]=-1,t&=~r}}function b1(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-Sg(t),s=1<<n;s&e|i[n]&e&&(i[n]|=e),t&=~s}}var Sn=0;function U5(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var P5,G1,O5,Q5,j5,y2=!1,wm=[],pc=null,fc=null,mc=null,ip=new Map,sp=new Map,lc=[],sz="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vS(i,e){switch(i){case"focusin":case"focusout":pc=null;break;case"dragenter":case"dragleave":fc=null;break;case"mouseover":case"mouseout":mc=null;break;case"pointerover":case"pointerout":ip.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":sp.delete(e.pointerId)}}function qh(i,e,t,n,s,r){return i===null||i.nativeEvent!==r?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:r,targetContainers:[s]},e!==null&&(e=Kp(e),e!==null&&G1(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),i)}function rz(i,e,t,n,s){switch(e){case"focusin":return pc=qh(pc,i,e,t,n,s),!0;case"dragenter":return fc=qh(fc,i,e,t,n,s),!0;case"mouseover":return mc=qh(mc,i,e,t,n,s),!0;case"pointerover":var r=s.pointerId;return ip.set(r,qh(ip.get(r)||null,i,e,t,n,s)),!0;case"gotpointercapture":return r=s.pointerId,sp.set(r,qh(sp.get(r)||null,i,e,t,n,s)),!0}return!1}function q5(i){var e=UI(i.target);if(e!==null){var t=Su(e);if(t!==null){if(e=t.tag,e===13){if(e=z5(t),e!==null){i.blockedOn=e,j5(i.priority,function(){O5(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function M0(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=B2(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);p2=n,t.target.dispatchEvent(n),p2=null}else return e=Kp(t),e!==null&&G1(e),i.blockedOn=t,!1;e.shift()}return!0}function ZS(i,e,t){M0(i)&&t.delete(e)}function oz(){y2=!1,pc!==null&&M0(pc)&&(pc=null),fc!==null&&M0(fc)&&(fc=null),mc!==null&&M0(mc)&&(mc=null),ip.forEach(ZS),sp.forEach(ZS)}function $h(i,e){i.blockedOn===e&&(i.blockedOn=null,y2||(y2=!0,uo.unstable_scheduleCallback(uo.unstable_NormalPriority,oz)))}function rp(i){function e(s){return $h(s,i)}if(0<wm.length){$h(wm[0],i);for(var t=1;t<wm.length;t++){var n=wm[t];n.blockedOn===i&&(n.blockedOn=null)}}for(pc!==null&&$h(pc,i),fc!==null&&$h(fc,i),mc!==null&&$h(mc,i),ip.forEach(e),sp.forEach(e),t=0;t<lc.length;t++)n=lc[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<lc.length&&(t=lc[0],t.blockedOn===null);)q5(t),t.blockedOn===null&&lc.shift()}var ud=ul.ReactCurrentBatchConfig,ub=!0;function gz(i,e,t,n){var s=Sn,r=ud.transition;ud.transition=null;try{Sn=1,y1(i,e,t,n)}finally{Sn=s,ud.transition=r}}function az(i,e,t,n){var s=Sn,r=ud.transition;ud.transition=null;try{Sn=4,y1(i,e,t,n)}finally{Sn=s,ud.transition=r}}function y1(i,e,t,n){if(ub){var s=B2(i,e,t,n);if(s===null)Fy(i,e,n,Cb,t),vS(i,n);else if(rz(s,i,e,t,n))n.stopPropagation();else if(vS(i,n),e&4&&-1<sz.indexOf(i)){for(;s!==null;){var r=Kp(s);if(r!==null&&P5(r),r=B2(i,e,t,n),r===null&&Fy(i,e,n,Cb,t),r===s)break;s=r}s!==null&&n.stopPropagation()}else Fy(i,e,n,null,t)}}var Cb=null;function B2(i,e,t,n){if(Cb=null,i=f1(n),i=UI(i),i!==null)if(e=Su(i),e===null)i=null;else if(t=e.tag,t===13){if(i=z5(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return Cb=i,null}function $5(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(OL()){case m1:return 1;case E5:return 4;case cb:case QL:return 16;case D5:return 536870912;default:return 16}default:return 16}}var Ic=null,B1=null,K0=null;function e9(){if(K0)return K0;var i,e=B1,t=e.length,n,s="value"in Ic?Ic.value:Ic.textContent,r=s.length;for(i=0;i<t&&e[i]===s[i];i++);var o=t-i;for(n=1;n<=o&&e[t-n]===s[r-n];n++);return K0=s.slice(i,1<n?1-n:void 0)}function L0(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function Sm(){return!0}function wS(){return!1}function po(i){function e(t,n,s,r,o){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var g in i)i.hasOwnProperty(g)&&(t=i[g],this[g]=t?t(r):r[g]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?Sm:wS,this.isPropagationStopped=wS,this}return ci(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Sm)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Sm)},persist:function(){},isPersistent:Sm}),e}var Dd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},v1=po(Dd),Mp=ci({},Dd,{view:0,detail:0}),lz=po(Mp),wy,Sy,eA,Pb=ci({},Mp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Z1,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==eA&&(eA&&i.type==="mousemove"?(wy=i.screenX-eA.screenX,Sy=i.screenY-eA.screenY):Sy=wy=0,eA=i),wy)},movementY:function(i){return"movementY"in i?i.movementY:Sy}}),SS=po(Pb),cz=ci({},Pb,{dataTransfer:0}),Iz=po(cz),uz=ci({},Mp,{relatedTarget:0}),Ry=po(uz),Cz=ci({},Dd,{animationName:0,elapsedTime:0,pseudoElement:0}),dz=po(Cz),hz=ci({},Dd,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Az=po(hz),pz=ci({},Dd,{data:0}),RS=po(pz),fz={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mz={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bz={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gz(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=bz[i])?!!e[i]:!1}function Z1(){return Gz}var yz=ci({},Mp,{key:function(i){if(i.key){var e=fz[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=L0(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?mz[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Z1,charCode:function(i){return i.type==="keypress"?L0(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?L0(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Bz=po(yz),vz=ci({},Pb,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),WS=po(vz),Zz=ci({},Mp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Z1}),wz=po(Zz),Sz=ci({},Dd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Rz=po(Sz),Wz=ci({},Pb,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),xz=po(Wz),Vz=[9,13,27,32],w1=tl&&"CompositionEvent"in window,zA=null;tl&&"documentMode"in document&&(zA=document.documentMode);var Hz=tl&&"TextEvent"in window&&!zA,t9=tl&&(!w1||zA&&8<zA&&11>=zA),xS=String.fromCharCode(32),VS=!1;function n9(i,e){switch(i){case"keyup":return Vz.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function i9(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var JC=!1;function Xz(i,e){switch(i){case"compositionend":return i9(e);case"keypress":return e.which!==32?null:(VS=!0,xS);case"textInput":return i=e.data,i===xS&&VS?null:i;default:return null}}function Yz(i,e){if(JC)return i==="compositionend"||!w1&&n9(i,e)?(i=e9(),K0=B1=Ic=null,JC=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return t9&&e.locale!=="ko"?null:e.data;default:return null}}var Fz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function HS(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!Fz[i.type]:e==="textarea"}function s9(i,e,t,n){F5(n),e=db(e,"onChange"),0<e.length&&(t=new v1("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var _A=null,op=null;function Nz(i){h9(i,0)}function Ob(i){var e=OC(i);if(R5(e))return i}function Mz(i,e){if(i==="change")return e}var r9=!1;if(tl){var Wy;if(tl){var xy="oninput"in document;if(!xy){var XS=document.createElement("div");XS.setAttribute("oninput","return;"),xy=typeof XS.oninput=="function"}Wy=xy}else Wy=!1;r9=Wy&&(!document.documentMode||9<document.documentMode)}function YS(){_A&&(_A.detachEvent("onpropertychange",o9),op=_A=null)}function o9(i){if(i.propertyName==="value"&&Ob(op)){var e=[];s9(e,op,i,f1(i)),L5(Nz,e)}}function Kz(i,e,t){i==="focusin"?(YS(),_A=e,op=t,_A.attachEvent("onpropertychange",o9)):i==="focusout"&&YS()}function Lz(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Ob(op)}function zz(i,e){if(i==="click")return Ob(e)}function _z(i,e){if(i==="input"||i==="change")return Ob(e)}function kz(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var Vg=typeof Object.is=="function"?Object.is:kz;function gp(i,e){if(Vg(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!r2.call(e,s)||!Vg(i[s],e[s]))return!1}return!0}function FS(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function NS(i,e){var t=FS(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=FS(t)}}function g9(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?g9(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function a9(){for(var i=window,e=gb();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=gb(i.document)}return e}function S1(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function Tz(i){var e=a9(),t=i.focusedElem,n=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&g9(t.ownerDocument.documentElement,t)){if(n!==null&&S1(t)){if(e=n.start,i=n.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var s=t.textContent.length,r=Math.min(n.start,s);n=n.end===void 0?r:Math.min(n.end,s),!i.extend&&r>n&&(s=n,n=r,r=s),s=NS(t,r);var o=NS(t,n);s&&o&&(i.rangeCount!==1||i.anchorNode!==s.node||i.anchorOffset!==s.offset||i.focusNode!==o.node||i.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),i.removeAllRanges(),r>n?(i.addRange(e),i.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var Ez=tl&&"documentMode"in document&&11>=document.documentMode,UC=null,v2=null,kA=null,Z2=!1;function MS(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Z2||UC==null||UC!==gb(n)||(n=UC,"selectionStart"in n&&S1(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),kA&&gp(kA,n)||(kA=n,n=db(v2,"onSelect"),0<n.length&&(e=new v1("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=UC)))}function Rm(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var PC={animationend:Rm("Animation","AnimationEnd"),animationiteration:Rm("Animation","AnimationIteration"),animationstart:Rm("Animation","AnimationStart"),transitionend:Rm("Transition","TransitionEnd")},Vy={},l9={};tl&&(l9=document.createElement("div").style,"AnimationEvent"in window||(delete PC.animationend.animation,delete PC.animationiteration.animation,delete PC.animationstart.animation),"TransitionEvent"in window||delete PC.transitionend.transition);function Qb(i){if(Vy[i])return Vy[i];if(!PC[i])return i;var e=PC[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in l9)return Vy[i]=e[t];return i}var c9=Qb("animationend"),I9=Qb("animationiteration"),u9=Qb("animationstart"),C9=Qb("transitionend"),d9=new Map,KS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Nc(i,e){d9.set(i,e),wu(e,[i])}for(var Hy=0;Hy<KS.length;Hy++){var Xy=KS[Hy],Dz=Xy.toLowerCase(),Jz=Xy[0].toUpperCase()+Xy.slice(1);Nc(Dz,"on"+Jz)}Nc(c9,"onAnimationEnd");Nc(I9,"onAnimationIteration");Nc(u9,"onAnimationStart");Nc("dblclick","onDoubleClick");Nc("focusin","onFocus");Nc("focusout","onBlur");Nc(C9,"onTransitionEnd");Bd("onMouseEnter",["mouseout","mouseover"]);Bd("onMouseLeave",["mouseout","mouseover"]);Bd("onPointerEnter",["pointerout","pointerover"]);Bd("onPointerLeave",["pointerout","pointerover"]);wu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));wu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));wu("onBeforeInput",["compositionend","keypress","textInput","paste"]);wu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));wu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));wu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var HA="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Uz=new Set("cancel close invalid load scroll toggle".split(" ").concat(HA));function LS(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,DL(n,e,void 0,i),i.currentTarget=null}function h9(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],s=n.event;n=n.listeners;e:{var r=void 0;if(e)for(var o=n.length-1;0<=o;o--){var g=n[o],a=g.instance,l=g.currentTarget;if(g=g.listener,a!==r&&s.isPropagationStopped())break e;LS(s,g,l),r=a}else for(o=0;o<n.length;o++){if(g=n[o],a=g.instance,l=g.currentTarget,g=g.listener,a!==r&&s.isPropagationStopped())break e;LS(s,g,l),r=a}}}if(lb)throw i=b2,lb=!1,b2=null,i}function Tn(i,e){var t=e[x2];t===void 0&&(t=e[x2]=new Set);var n=i+"__bubble";t.has(n)||(A9(e,i,2,!1),t.add(n))}function Yy(i,e,t){var n=0;e&&(n|=4),A9(t,i,n,e)}var Wm="_reactListening"+Math.random().toString(36).slice(2);function ap(i){if(!i[Wm]){i[Wm]=!0,B5.forEach(function(t){t!=="selectionchange"&&(Uz.has(t)||Yy(t,!1,i),Yy(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[Wm]||(e[Wm]=!0,Yy("selectionchange",!1,e))}}function A9(i,e,t,n){switch($5(e)){case 1:var s=gz;break;case 4:s=az;break;default:s=y1}t=s.bind(null,e,t,i),s=void 0,!m2||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?i.addEventListener(e,t,{capture:!0,passive:s}):i.addEventListener(e,t,!0):s!==void 0?i.addEventListener(e,t,{passive:s}):i.addEventListener(e,t,!1)}function Fy(i,e,t,n,s){var r=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var g=n.stateNode.containerInfo;if(g===s||g.nodeType===8&&g.parentNode===s)break;if(o===4)for(o=n.return;o!==null;){var a=o.tag;if((a===3||a===4)&&(a=o.stateNode.containerInfo,a===s||a.nodeType===8&&a.parentNode===s))return;o=o.return}for(;g!==null;){if(o=UI(g),o===null)return;if(a=o.tag,a===5||a===6){n=r=o;continue e}g=g.parentNode}}n=n.return}L5(function(){var l=r,c=f1(t),C=[];e:{var h=d9.get(i);if(h!==void 0){var p=v1,m=i;switch(i){case"keypress":if(L0(t)===0)break e;case"keydown":case"keyup":p=Bz;break;case"focusin":m="focus",p=Ry;break;case"focusout":m="blur",p=Ry;break;case"beforeblur":case"afterblur":p=Ry;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=SS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Iz;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=wz;break;case c9:case I9:case u9:p=dz;break;case C9:p=Rz;break;case"scroll":p=lz;break;case"wheel":p=xz;break;case"copy":case"cut":case"paste":p=Az;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=WS}var f=(e&4)!==0,b=!f&&i==="scroll",y=f?h!==null?h+"Capture":null:h;f=[];for(var v=l,G;v!==null;){G=v;var w=G.stateNode;if(G.tag===5&&w!==null&&(G=w,y!==null&&(w=np(v,y),w!=null&&f.push(lp(v,w,G)))),b)break;v=v.return}0<f.length&&(h=new p(h,m,null,t,c),C.push({event:h,listeners:f}))}}if(!(e&7)){e:{if(h=i==="mouseover"||i==="pointerover",p=i==="mouseout"||i==="pointerout",h&&t!==p2&&(m=t.relatedTarget||t.fromElement)&&(UI(m)||m[nl]))break e;if((p||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,p?(m=t.relatedTarget||t.toElement,p=l,m=m?UI(m):null,m!==null&&(b=Su(m),m!==b||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=l),p!==m)){if(f=SS,w="onMouseLeave",y="onMouseEnter",v="mouse",(i==="pointerout"||i==="pointerover")&&(f=WS,w="onPointerLeave",y="onPointerEnter",v="pointer"),b=p==null?h:OC(p),G=m==null?h:OC(m),h=new f(w,v+"leave",p,t,c),h.target=b,h.relatedTarget=G,w=null,UI(c)===l&&(f=new f(y,v+"enter",m,t,c),f.target=G,f.relatedTarget=b,w=f),b=w,p&&m)t:{for(f=p,y=m,v=0,G=f;G;G=bC(G))v++;for(G=0,w=y;w;w=bC(w))G++;for(;0<v-G;)f=bC(f),v--;for(;0<G-v;)y=bC(y),G--;for(;v--;){if(f===y||y!==null&&f===y.alternate)break t;f=bC(f),y=bC(y)}f=null}else f=null;p!==null&&zS(C,h,p,f,!1),m!==null&&b!==null&&zS(C,b,m,f,!0)}}e:{if(h=l?OC(l):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var W=Mz;else if(HS(h))if(r9)W=_z;else{W=Lz;var V=Kz}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(W=zz);if(W&&(W=W(i,l))){s9(C,W,t,c);break e}V&&V(i,h,l),i==="focusout"&&(V=h._wrapperState)&&V.controlled&&h.type==="number"&&u2(h,"number",h.value)}switch(V=l?OC(l):window,i){case"focusin":(HS(V)||V.contentEditable==="true")&&(UC=V,v2=l,kA=null);break;case"focusout":kA=v2=UC=null;break;case"mousedown":Z2=!0;break;case"contextmenu":case"mouseup":case"dragend":Z2=!1,MS(C,t,c);break;case"selectionchange":if(Ez)break;case"keydown":case"keyup":MS(C,t,c)}var X;if(w1)e:{switch(i){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else JC?n9(i,t)&&(R="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(t9&&t.locale!=="ko"&&(JC||R!=="onCompositionStart"?R==="onCompositionEnd"&&JC&&(X=e9()):(Ic=c,B1="value"in Ic?Ic.value:Ic.textContent,JC=!0)),V=db(l,R),0<V.length&&(R=new RS(R,i,null,t,c),C.push({event:R,listeners:V}),X?R.data=X:(X=i9(t),X!==null&&(R.data=X)))),(X=Hz?Xz(i,t):Yz(i,t))&&(l=db(l,"onBeforeInput"),0<l.length&&(c=new RS("onBeforeInput","beforeinput",null,t,c),C.push({event:c,listeners:l}),c.data=X))}h9(C,e)})}function lp(i,e,t){return{instance:i,listener:e,currentTarget:t}}function db(i,e){for(var t=e+"Capture",n=[];i!==null;){var s=i,r=s.stateNode;s.tag===5&&r!==null&&(s=r,r=np(i,t),r!=null&&n.unshift(lp(i,r,s)),r=np(i,e),r!=null&&n.push(lp(i,r,s))),i=i.return}return n}function bC(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function zS(i,e,t,n,s){for(var r=e._reactName,o=[];t!==null&&t!==n;){var g=t,a=g.alternate,l=g.stateNode;if(a!==null&&a===n)break;g.tag===5&&l!==null&&(g=l,s?(a=np(t,r),a!=null&&o.unshift(lp(t,a,g))):s||(a=np(t,r),a!=null&&o.push(lp(t,a,g)))),t=t.return}o.length!==0&&i.push({event:e,listeners:o})}var Pz=/\r\n?/g,Oz=/\u0000|\uFFFD/g;function _S(i){return(typeof i=="string"?i:""+i).replace(Pz,`
`).replace(Oz,"")}function xm(i,e,t){if(e=_S(e),_S(i)!==e&&t)throw Error(Ue(425))}function hb(){}var w2=null,S2=null;function R2(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var W2=typeof setTimeout=="function"?setTimeout:void 0,Qz=typeof clearTimeout=="function"?clearTimeout:void 0,kS=typeof Promise=="function"?Promise:void 0,jz=typeof queueMicrotask=="function"?queueMicrotask:typeof kS<"u"?function(i){return kS.resolve(null).then(i).catch(qz)}:W2;function qz(i){setTimeout(function(){throw i})}function Ny(i,e){var t=e,n=0;do{var s=t.nextSibling;if(i.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(n===0){i.removeChild(s),rp(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=s}while(t);rp(e)}function bc(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function TS(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var Jd=Math.random().toString(36).slice(2),ra="__reactFiber$"+Jd,cp="__reactProps$"+Jd,nl="__reactContainer$"+Jd,x2="__reactEvents$"+Jd,$z="__reactListeners$"+Jd,e_="__reactHandles$"+Jd;function UI(i){var e=i[ra];if(e)return e;for(var t=i.parentNode;t;){if(e=t[nl]||t[ra]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=TS(i);i!==null;){if(t=i[ra])return t;i=TS(i)}return e}i=t,t=i.parentNode}return null}function Kp(i){return i=i[ra]||i[nl],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function OC(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Ue(33))}function jb(i){return i[cp]||null}var V2=[],QC=-1;function Mc(i){return{current:i}}function Jn(i){0>QC||(i.current=V2[QC],V2[QC]=null,QC--)}function _n(i,e){QC++,V2[QC]=i.current,i.current=e}var xc={},Ts=Mc(xc),Wr=Mc(!1),du=xc;function vd(i,e){var t=i.type.contextTypes;if(!t)return xc;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},r;for(r in t)s[r]=e[r];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=s),s}function xr(i){return i=i.childContextTypes,i!=null}function Ab(){Jn(Wr),Jn(Ts)}function ES(i,e,t){if(Ts.current!==xc)throw Error(Ue(168));_n(Ts,e),_n(Wr,t)}function p9(i,e,t){var n=i.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(Ue(108,KL(i)||"Unknown",s));return ci({},t,n)}function pb(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||xc,du=Ts.current,_n(Ts,i),_n(Wr,Wr.current),!0}function DS(i,e,t){var n=i.stateNode;if(!n)throw Error(Ue(169));t?(i=p9(i,e,du),n.__reactInternalMemoizedMergedChildContext=i,Jn(Wr),Jn(Ts),_n(Ts,i)):Jn(Wr),_n(Wr,t)}var Ta=null,qb=!1,My=!1;function f9(i){Ta===null?Ta=[i]:Ta.push(i)}function t_(i){qb=!0,f9(i)}function Kc(){if(!My&&Ta!==null){My=!0;var i=0,e=Sn;try{var t=Ta;for(Sn=1;i<t.length;i++){var n=t[i];do n=n(!0);while(n!==null)}Ta=null,qb=!1}catch(s){throw Ta!==null&&(Ta=Ta.slice(i+1)),T5(m1,Kc),s}finally{Sn=e,My=!1}}return null}var jC=[],qC=0,fb=null,mb=0,_o=[],ko=0,hu=null,Pa=1,Oa="";function MI(i,e){jC[qC++]=mb,jC[qC++]=fb,fb=i,mb=e}function m9(i,e,t){_o[ko++]=Pa,_o[ko++]=Oa,_o[ko++]=hu,hu=i;var n=Pa;i=Oa;var s=32-Sg(n)-1;n&=~(1<<s),t+=1;var r=32-Sg(e)+s;if(30<r){var o=s-s%5;r=(n&(1<<o)-1).toString(32),n>>=o,s-=o,Pa=1<<32-Sg(e)+s|t<<s|n,Oa=r+i}else Pa=1<<r|t<<s|n,Oa=i}function R1(i){i.return!==null&&(MI(i,1),m9(i,1,0))}function W1(i){for(;i===fb;)fb=jC[--qC],jC[qC]=null,mb=jC[--qC],jC[qC]=null;for(;i===hu;)hu=_o[--ko],_o[ko]=null,Oa=_o[--ko],_o[ko]=null,Pa=_o[--ko],_o[ko]=null}var go=null,ro=null,Qn=!1,Zg=null;function b9(i,e){var t=Eo(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function JS(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,go=i,ro=bc(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,go=i,ro=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=hu!==null?{id:Pa,overflow:Oa}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Eo(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,go=i,ro=null,!0):!1;default:return!1}}function H2(i){return(i.mode&1)!==0&&(i.flags&128)===0}function X2(i){if(Qn){var e=ro;if(e){var t=e;if(!JS(i,e)){if(H2(i))throw Error(Ue(418));e=bc(t.nextSibling);var n=go;e&&JS(i,e)?b9(n,t):(i.flags=i.flags&-4097|2,Qn=!1,go=i)}}else{if(H2(i))throw Error(Ue(418));i.flags=i.flags&-4097|2,Qn=!1,go=i}}}function US(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;go=i}function Vm(i){if(i!==go)return!1;if(!Qn)return US(i),Qn=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!R2(i.type,i.memoizedProps)),e&&(e=ro)){if(H2(i))throw G9(),Error(Ue(418));for(;e;)b9(i,e),e=bc(e.nextSibling)}if(US(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ue(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){ro=bc(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}ro=null}}else ro=go?bc(i.stateNode.nextSibling):null;return!0}function G9(){for(var i=ro;i;)i=bc(i.nextSibling)}function Zd(){ro=go=null,Qn=!1}function x1(i){Zg===null?Zg=[i]:Zg.push(i)}var n_=ul.ReactCurrentBatchConfig;function yg(i,e){if(i&&i.defaultProps){e=ci({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}var bb=Mc(null),Gb=null,$C=null,V1=null;function H1(){V1=$C=Gb=null}function X1(i){var e=bb.current;Jn(bb),i._currentValue=e}function Y2(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function Cd(i,e){Gb=i,V1=$C=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(Rr=!0),i.firstContext=null)}function qo(i){var e=i._currentValue;if(V1!==i)if(i={context:i,memoizedValue:e,next:null},$C===null){if(Gb===null)throw Error(Ue(308));$C=i,Gb.dependencies={lanes:0,firstContext:i}}else $C=$C.next=i;return e}var PI=null;function Y1(i){PI===null?PI=[i]:PI.push(i)}function y9(i,e,t,n){var s=e.interleaved;return s===null?(t.next=t,Y1(e)):(t.next=s.next,s.next=t),e.interleaved=t,il(i,n)}function il(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var sc=!1;function F1(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function B9(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function $a(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function Gc(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,mn&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,il(i,t)}return s=n.interleaved,s===null?(e.next=e,Y1(n)):(e.next=s.next,s.next=e),n.interleaved=e,il(i,t)}function z0(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,b1(i,t)}}function PS(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?s=r=o:r=r.next=o,t=t.next}while(t!==null);r===null?s=r=e:r=r.next=e}else s=r=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function yb(i,e,t,n){var s=i.updateQueue;sc=!1;var r=s.firstBaseUpdate,o=s.lastBaseUpdate,g=s.shared.pending;if(g!==null){s.shared.pending=null;var a=g,l=a.next;a.next=null,o===null?r=l:o.next=l,o=a;var c=i.alternate;c!==null&&(c=c.updateQueue,g=c.lastBaseUpdate,g!==o&&(g===null?c.firstBaseUpdate=l:g.next=l,c.lastBaseUpdate=a))}if(r!==null){var C=s.baseState;o=0,c=l=a=null,g=r;do{var h=g.lane,p=g.eventTime;if((n&h)===h){c!==null&&(c=c.next={eventTime:p,lane:0,tag:g.tag,payload:g.payload,callback:g.callback,next:null});e:{var m=i,f=g;switch(h=e,p=t,f.tag){case 1:if(m=f.payload,typeof m=="function"){C=m.call(p,C,h);break e}C=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=f.payload,h=typeof m=="function"?m.call(p,C,h):m,h==null)break e;C=ci({},C,h);break e;case 2:sc=!0}}g.callback!==null&&g.lane!==0&&(i.flags|=64,h=s.effects,h===null?s.effects=[g]:h.push(g))}else p={eventTime:p,lane:h,tag:g.tag,payload:g.payload,callback:g.callback,next:null},c===null?(l=c=p,a=C):c=c.next=p,o|=h;if(g=g.next,g===null){if(g=s.shared.pending,g===null)break;h=g,g=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(c===null&&(a=C),s.baseState=a,s.firstBaseUpdate=l,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else r===null&&(s.shared.lanes=0);pu|=o,i.lanes=o,i.memoizedState=C}}function OS(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],s=n.callback;if(s!==null){if(n.callback=null,n=t,typeof s!="function")throw Error(Ue(191,s));s.call(n)}}}var v9=new y5.Component().refs;function F2(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:ci({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var $b={isMounted:function(i){return(i=i._reactInternals)?Su(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=or(),s=Bc(i),r=$a(n,s);r.payload=e,t!=null&&(r.callback=t),e=Gc(i,r,s),e!==null&&(Rg(e,i,s,n),z0(e,i,s))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=or(),s=Bc(i),r=$a(n,s);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=Gc(i,r,s),e!==null&&(Rg(e,i,s,n),z0(e,i,s))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=or(),n=Bc(i),s=$a(t,n);s.tag=2,e!=null&&(s.callback=e),e=Gc(i,s,n),e!==null&&(Rg(e,i,n,t),z0(e,i,n))}};function QS(i,e,t,n,s,r,o){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,r,o):e.prototype&&e.prototype.isPureReactComponent?!gp(t,n)||!gp(s,r):!0}function Z9(i,e,t){var n=!1,s=xc,r=e.contextType;return typeof r=="object"&&r!==null?r=qo(r):(s=xr(e)?du:Ts.current,n=e.contextTypes,r=(n=n!=null)?vd(i,s):xc),e=new e(t,r),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$b,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=r),e}function jS(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&$b.enqueueReplaceState(e,e.state,null)}function N2(i,e,t,n){var s=i.stateNode;s.props=t,s.state=i.memoizedState,s.refs=v9,F1(i);var r=e.contextType;typeof r=="object"&&r!==null?s.context=qo(r):(r=xr(e)?du:Ts.current,s.context=vd(i,r)),s.state=i.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(F2(i,e,r,t),s.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&$b.enqueueReplaceState(s,s.state,null),yb(i,t,s,n),s.state=i.memoizedState),typeof s.componentDidMount=="function"&&(i.flags|=4194308)}function tA(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ue(309));var n=t.stateNode}if(!n)throw Error(Ue(147,i));var s=n,r=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var g=s.refs;g===v9&&(g=s.refs={}),o===null?delete g[r]:g[r]=o},e._stringRef=r,e)}if(typeof i!="string")throw Error(Ue(284));if(!t._owner)throw Error(Ue(290,i))}return i}function Hm(i,e){throw i=Object.prototype.toString.call(e),Error(Ue(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function qS(i){var e=i._init;return e(i._payload)}function w9(i){function e(y,v){if(i){var G=y.deletions;G===null?(y.deletions=[v],y.flags|=16):G.push(v)}}function t(y,v){if(!i)return null;for(;v!==null;)e(y,v),v=v.sibling;return null}function n(y,v){for(y=new Map;v!==null;)v.key!==null?y.set(v.key,v):y.set(v.index,v),v=v.sibling;return y}function s(y,v){return y=vc(y,v),y.index=0,y.sibling=null,y}function r(y,v,G){return y.index=G,i?(G=y.alternate,G!==null?(G=G.index,G<v?(y.flags|=2,v):G):(y.flags|=2,v)):(y.flags|=1048576,v)}function o(y){return i&&y.alternate===null&&(y.flags|=2),y}function g(y,v,G,w){return v===null||v.tag!==6?(v=Ey(G,y.mode,w),v.return=y,v):(v=s(v,G),v.return=y,v)}function a(y,v,G,w){var W=G.type;return W===DC?c(y,v,G.props.children,w,G.key):v!==null&&(v.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===ic&&qS(W)===v.type)?(w=s(v,G.props),w.ref=tA(y,v,G),w.return=y,w):(w=J0(G.type,G.key,G.props,null,y.mode,w),w.ref=tA(y,v,G),w.return=y,w)}function l(y,v,G,w){return v===null||v.tag!==4||v.stateNode.containerInfo!==G.containerInfo||v.stateNode.implementation!==G.implementation?(v=Dy(G,y.mode,w),v.return=y,v):(v=s(v,G.children||[]),v.return=y,v)}function c(y,v,G,w,W){return v===null||v.tag!==7?(v=iu(G,y.mode,w,W),v.return=y,v):(v=s(v,G),v.return=y,v)}function C(y,v,G){if(typeof v=="string"&&v!==""||typeof v=="number")return v=Ey(""+v,y.mode,G),v.return=y,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Gm:return G=J0(v.type,v.key,v.props,null,y.mode,G),G.ref=tA(y,null,v),G.return=y,G;case EC:return v=Dy(v,y.mode,G),v.return=y,v;case ic:var w=v._init;return C(y,w(v._payload),G)}if(xA(v)||Qh(v))return v=iu(v,y.mode,G,null),v.return=y,v;Hm(y,v)}return null}function h(y,v,G,w){var W=v!==null?v.key:null;if(typeof G=="string"&&G!==""||typeof G=="number")return W!==null?null:g(y,v,""+G,w);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case Gm:return G.key===W?a(y,v,G,w):null;case EC:return G.key===W?l(y,v,G,w):null;case ic:return W=G._init,h(y,v,W(G._payload),w)}if(xA(G)||Qh(G))return W!==null?null:c(y,v,G,w,null);Hm(y,G)}return null}function p(y,v,G,w,W){if(typeof w=="string"&&w!==""||typeof w=="number")return y=y.get(G)||null,g(v,y,""+w,W);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Gm:return y=y.get(w.key===null?G:w.key)||null,a(v,y,w,W);case EC:return y=y.get(w.key===null?G:w.key)||null,l(v,y,w,W);case ic:var V=w._init;return p(y,v,G,V(w._payload),W)}if(xA(w)||Qh(w))return y=y.get(G)||null,c(v,y,w,W,null);Hm(v,w)}return null}function m(y,v,G,w){for(var W=null,V=null,X=v,R=v=0,Y=null;X!==null&&R<G.length;R++){X.index>R?(Y=X,X=null):Y=X.sibling;var M=h(y,X,G[R],w);if(M===null){X===null&&(X=Y);break}i&&X&&M.alternate===null&&e(y,X),v=r(M,v,R),V===null?W=M:V.sibling=M,V=M,X=Y}if(R===G.length)return t(y,X),Qn&&MI(y,R),W;if(X===null){for(;R<G.length;R++)X=C(y,G[R],w),X!==null&&(v=r(X,v,R),V===null?W=X:V.sibling=X,V=X);return Qn&&MI(y,R),W}for(X=n(y,X);R<G.length;R++)Y=p(X,y,R,G[R],w),Y!==null&&(i&&Y.alternate!==null&&X.delete(Y.key===null?R:Y.key),v=r(Y,v,R),V===null?W=Y:V.sibling=Y,V=Y);return i&&X.forEach(function(L){return e(y,L)}),Qn&&MI(y,R),W}function f(y,v,G,w){var W=Qh(G);if(typeof W!="function")throw Error(Ue(150));if(G=W.call(G),G==null)throw Error(Ue(151));for(var V=W=null,X=v,R=v=0,Y=null,M=G.next();X!==null&&!M.done;R++,M=G.next()){X.index>R?(Y=X,X=null):Y=X.sibling;var L=h(y,X,M.value,w);if(L===null){X===null&&(X=Y);break}i&&X&&L.alternate===null&&e(y,X),v=r(L,v,R),V===null?W=L:V.sibling=L,V=L,X=Y}if(M.done)return t(y,X),Qn&&MI(y,R),W;if(X===null){for(;!M.done;R++,M=G.next())M=C(y,M.value,w),M!==null&&(v=r(M,v,R),V===null?W=M:V.sibling=M,V=M);return Qn&&MI(y,R),W}for(X=n(y,X);!M.done;R++,M=G.next())M=p(X,y,R,M.value,w),M!==null&&(i&&M.alternate!==null&&X.delete(M.key===null?R:M.key),v=r(M,v,R),V===null?W=M:V.sibling=M,V=M);return i&&X.forEach(function(re){return e(y,re)}),Qn&&MI(y,R),W}function b(y,v,G,w){if(typeof G=="object"&&G!==null&&G.type===DC&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case Gm:e:{for(var W=G.key,V=v;V!==null;){if(V.key===W){if(W=G.type,W===DC){if(V.tag===7){t(y,V.sibling),v=s(V,G.props.children),v.return=y,y=v;break e}}else if(V.elementType===W||typeof W=="object"&&W!==null&&W.$$typeof===ic&&qS(W)===V.type){t(y,V.sibling),v=s(V,G.props),v.ref=tA(y,V,G),v.return=y,y=v;break e}t(y,V);break}else e(y,V);V=V.sibling}G.type===DC?(v=iu(G.props.children,y.mode,w,G.key),v.return=y,y=v):(w=J0(G.type,G.key,G.props,null,y.mode,w),w.ref=tA(y,v,G),w.return=y,y=w)}return o(y);case EC:e:{for(V=G.key;v!==null;){if(v.key===V)if(v.tag===4&&v.stateNode.containerInfo===G.containerInfo&&v.stateNode.implementation===G.implementation){t(y,v.sibling),v=s(v,G.children||[]),v.return=y,y=v;break e}else{t(y,v);break}else e(y,v);v=v.sibling}v=Dy(G,y.mode,w),v.return=y,y=v}return o(y);case ic:return V=G._init,b(y,v,V(G._payload),w)}if(xA(G))return m(y,v,G,w);if(Qh(G))return f(y,v,G,w);Hm(y,G)}return typeof G=="string"&&G!==""||typeof G=="number"?(G=""+G,v!==null&&v.tag===6?(t(y,v.sibling),v=s(v,G),v.return=y,y=v):(t(y,v),v=Ey(G,y.mode,w),v.return=y,y=v),o(y)):t(y,v)}return b}var wd=w9(!0),S9=w9(!1),Lp={},la=Mc(Lp),Ip=Mc(Lp),up=Mc(Lp);function OI(i){if(i===Lp)throw Error(Ue(174));return i}function N1(i,e){switch(_n(up,e),_n(Ip,i),_n(la,Lp),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:d2(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=d2(e,i)}Jn(la),_n(la,e)}function Sd(){Jn(la),Jn(Ip),Jn(up)}function R9(i){OI(up.current);var e=OI(la.current),t=d2(e,i.type);e!==t&&(_n(Ip,i),_n(la,t))}function M1(i){Ip.current===i&&(Jn(la),Jn(Ip))}var si=Mc(0);function Bb(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ky=[];function K1(){for(var i=0;i<Ky.length;i++)Ky[i]._workInProgressVersionPrimary=null;Ky.length=0}var _0=ul.ReactCurrentDispatcher,Ly=ul.ReactCurrentBatchConfig,Au=0,li=null,Di=null,ls=null,vb=!1,TA=!1,Cp=0,i_=0;function Hs(){throw Error(Ue(321))}function L1(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!Vg(i[t],e[t]))return!1;return!0}function z1(i,e,t,n,s,r){if(Au=r,li=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,_0.current=i===null||i.memoizedState===null?g_:a_,i=t(n,s),TA){r=0;do{if(TA=!1,Cp=0,25<=r)throw Error(Ue(301));r+=1,ls=Di=null,e.updateQueue=null,_0.current=l_,i=t(n,s)}while(TA)}if(_0.current=Zb,e=Di!==null&&Di.next!==null,Au=0,ls=Di=li=null,vb=!1,e)throw Error(Ue(300));return i}function _1(){var i=Cp!==0;return Cp=0,i}function sa(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ls===null?li.memoizedState=ls=i:ls=ls.next=i,ls}function $o(){if(Di===null){var i=li.alternate;i=i!==null?i.memoizedState:null}else i=Di.next;var e=ls===null?li.memoizedState:ls.next;if(e!==null)ls=e,Di=i;else{if(i===null)throw Error(Ue(310));Di=i,i={memoizedState:Di.memoizedState,baseState:Di.baseState,baseQueue:Di.baseQueue,queue:Di.queue,next:null},ls===null?li.memoizedState=ls=i:ls=ls.next=i}return ls}function dp(i,e){return typeof e=="function"?e(i):e}function zy(i){var e=$o(),t=e.queue;if(t===null)throw Error(Ue(311));t.lastRenderedReducer=i;var n=Di,s=n.baseQueue,r=t.pending;if(r!==null){if(s!==null){var o=s.next;s.next=r.next,r.next=o}n.baseQueue=s=r,t.pending=null}if(s!==null){r=s.next,n=n.baseState;var g=o=null,a=null,l=r;do{var c=l.lane;if((Au&c)===c)a!==null&&(a=a.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:i(n,l.action);else{var C={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};a===null?(g=a=C,o=n):a=a.next=C,li.lanes|=c,pu|=c}l=l.next}while(l!==null&&l!==r);a===null?o=n:a.next=g,Vg(n,e.memoizedState)||(Rr=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=a,t.lastRenderedState=n}if(i=t.interleaved,i!==null){s=i;do r=s.lane,li.lanes|=r,pu|=r,s=s.next;while(s!==i)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function _y(i){var e=$o(),t=e.queue;if(t===null)throw Error(Ue(311));t.lastRenderedReducer=i;var n=t.dispatch,s=t.pending,r=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do r=i(r,o.action),o=o.next;while(o!==s);Vg(r,e.memoizedState)||(Rr=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,n]}function W9(){}function x9(i,e){var t=li,n=$o(),s=e(),r=!Vg(n.memoizedState,s);if(r&&(n.memoizedState=s,Rr=!0),n=n.queue,k1(X9.bind(null,t,n,i),[i]),n.getSnapshot!==e||r||ls!==null&&ls.memoizedState.tag&1){if(t.flags|=2048,hp(9,H9.bind(null,t,n,s,e),void 0,null),Is===null)throw Error(Ue(349));Au&30||V9(t,e,s)}return s}function V9(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=li.updateQueue,e===null?(e={lastEffect:null,stores:null},li.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function H9(i,e,t,n){e.value=t,e.getSnapshot=n,Y9(e)&&F9(i)}function X9(i,e,t){return t(function(){Y9(e)&&F9(i)})}function Y9(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!Vg(i,t)}catch{return!0}}function F9(i){var e=il(i,1);e!==null&&Rg(e,i,1,-1)}function $S(i){var e=sa();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:dp,lastRenderedState:i},e.queue=i,i=i.dispatch=o_.bind(null,li,i),[e.memoizedState,i]}function hp(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=li.updateQueue,e===null?(e={lastEffect:null,stores:null},li.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function N9(){return $o().memoizedState}function k0(i,e,t,n){var s=sa();li.flags|=i,s.memoizedState=hp(1|e,t,void 0,n===void 0?null:n)}function eG(i,e,t,n){var s=$o();n=n===void 0?null:n;var r=void 0;if(Di!==null){var o=Di.memoizedState;if(r=o.destroy,n!==null&&L1(n,o.deps)){s.memoizedState=hp(e,t,r,n);return}}li.flags|=i,s.memoizedState=hp(1|e,t,r,n)}function eR(i,e){return k0(8390656,8,i,e)}function k1(i,e){return eG(2048,8,i,e)}function M9(i,e){return eG(4,2,i,e)}function K9(i,e){return eG(4,4,i,e)}function L9(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function z9(i,e,t){return t=t!=null?t.concat([i]):null,eG(4,4,L9.bind(null,e,i),t)}function T1(){}function _9(i,e){var t=$o();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&L1(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function k9(i,e){var t=$o();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&L1(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function T9(i,e,t){return Au&21?(Vg(t,e)||(t=J5(),li.lanes|=t,pu|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,Rr=!0),i.memoizedState=t)}function s_(i,e){var t=Sn;Sn=t!==0&&4>t?t:4,i(!0);var n=Ly.transition;Ly.transition={};try{i(!1),e()}finally{Sn=t,Ly.transition=n}}function E9(){return $o().memoizedState}function r_(i,e,t){var n=Bc(i);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},D9(i))J9(e,t);else if(t=y9(i,e,t,n),t!==null){var s=or();Rg(t,i,n,s),U9(t,e,n)}}function o_(i,e,t){var n=Bc(i),s={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(D9(i))J9(e,s);else{var r=i.alternate;if(i.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,g=r(o,t);if(s.hasEagerState=!0,s.eagerState=g,Vg(g,o)){var a=e.interleaved;a===null?(s.next=s,Y1(e)):(s.next=a.next,a.next=s),e.interleaved=s;return}}catch{}finally{}t=y9(i,e,s,n),t!==null&&(s=or(),Rg(t,i,n,s),U9(t,e,n))}}function D9(i){var e=i.alternate;return i===li||e!==null&&e===li}function J9(i,e){TA=vb=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function U9(i,e,t){if(t&4194240){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,b1(i,t)}}var Zb={readContext:qo,useCallback:Hs,useContext:Hs,useEffect:Hs,useImperativeHandle:Hs,useInsertionEffect:Hs,useLayoutEffect:Hs,useMemo:Hs,useReducer:Hs,useRef:Hs,useState:Hs,useDebugValue:Hs,useDeferredValue:Hs,useTransition:Hs,useMutableSource:Hs,useSyncExternalStore:Hs,useId:Hs,unstable_isNewReconciler:!1},g_={readContext:qo,useCallback:function(i,e){return sa().memoizedState=[i,e===void 0?null:e],i},useContext:qo,useEffect:eR,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,k0(4194308,4,L9.bind(null,e,i),t)},useLayoutEffect:function(i,e){return k0(4194308,4,i,e)},useInsertionEffect:function(i,e){return k0(4,2,i,e)},useMemo:function(i,e){var t=sa();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=sa();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},n.queue=i,i=i.dispatch=r_.bind(null,li,i),[n.memoizedState,i]},useRef:function(i){var e=sa();return i={current:i},e.memoizedState=i},useState:$S,useDebugValue:T1,useDeferredValue:function(i){return sa().memoizedState=i},useTransition:function(){var i=$S(!1),e=i[0];return i=s_.bind(null,i[1]),sa().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var n=li,s=sa();if(Qn){if(t===void 0)throw Error(Ue(407));t=t()}else{if(t=e(),Is===null)throw Error(Ue(349));Au&30||V9(n,e,t)}s.memoizedState=t;var r={value:t,getSnapshot:e};return s.queue=r,eR(X9.bind(null,n,r,i),[i]),n.flags|=2048,hp(9,H9.bind(null,n,r,t,e),void 0,null),t},useId:function(){var i=sa(),e=Is.identifierPrefix;if(Qn){var t=Oa,n=Pa;t=(n&~(1<<32-Sg(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Cp++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=i_++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},a_={readContext:qo,useCallback:_9,useContext:qo,useEffect:k1,useImperativeHandle:z9,useInsertionEffect:M9,useLayoutEffect:K9,useMemo:k9,useReducer:zy,useRef:N9,useState:function(){return zy(dp)},useDebugValue:T1,useDeferredValue:function(i){var e=$o();return T9(e,Di.memoizedState,i)},useTransition:function(){var i=zy(dp)[0],e=$o().memoizedState;return[i,e]},useMutableSource:W9,useSyncExternalStore:x9,useId:E9,unstable_isNewReconciler:!1},l_={readContext:qo,useCallback:_9,useContext:qo,useEffect:k1,useImperativeHandle:z9,useInsertionEffect:M9,useLayoutEffect:K9,useMemo:k9,useReducer:_y,useRef:N9,useState:function(){return _y(dp)},useDebugValue:T1,useDeferredValue:function(i){var e=$o();return Di===null?e.memoizedState=i:T9(e,Di.memoizedState,i)},useTransition:function(){var i=_y(dp)[0],e=$o().memoizedState;return[i,e]},useMutableSource:W9,useSyncExternalStore:x9,useId:E9,unstable_isNewReconciler:!1};function Rd(i,e){try{var t="",n=e;do t+=ML(n),n=n.return;while(n);var s=t}catch(r){s=`
Error generating stack: `+r.message+`
`+r.stack}return{value:i,source:e,stack:s,digest:null}}function ky(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function M2(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var c_=typeof WeakMap=="function"?WeakMap:Map;function P9(i,e,t){t=$a(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){Sb||(Sb=!0,U2=n),M2(i,e)},t}function O9(i,e,t){t=$a(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;t.payload=function(){return n(s)},t.callback=function(){M2(i,e)}}var r=i.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){M2(i,e),typeof n!="function"&&(yc===null?yc=new Set([this]):yc.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function tR(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new c_;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(s.add(t),i=v_.bind(null,i,e,t),e.then(i,i))}function nR(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function iR(i,e,t,n,s){return i.mode&1?(i.flags|=65536,i.lanes=s,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=$a(-1,1),e.tag=2,Gc(t,e,1))),t.lanes|=1),i)}var I_=ul.ReactCurrentOwner,Rr=!1;function nr(i,e,t,n){e.child=i===null?S9(e,null,t,n):wd(e,i.child,t,n)}function sR(i,e,t,n,s){t=t.render;var r=e.ref;return Cd(e,s),n=z1(i,e,t,n,r,s),t=_1(),i!==null&&!Rr?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,sl(i,e,s)):(Qn&&t&&R1(e),e.flags|=1,nr(i,e,n,s),e.child)}function rR(i,e,t,n,s){if(i===null){var r=t.type;return typeof r=="function"&&!j1(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,Q9(i,e,r,n,s)):(i=J0(t.type,null,n,e,e.mode,s),i.ref=e.ref,i.return=e,e.child=i)}if(r=i.child,!(i.lanes&s)){var o=r.memoizedProps;if(t=t.compare,t=t!==null?t:gp,t(o,n)&&i.ref===e.ref)return sl(i,e,s)}return e.flags|=1,i=vc(r,n),i.ref=e.ref,i.return=e,e.child=i}function Q9(i,e,t,n,s){if(i!==null){var r=i.memoizedProps;if(gp(r,n)&&i.ref===e.ref)if(Rr=!1,e.pendingProps=n=r,(i.lanes&s)!==0)i.flags&131072&&(Rr=!0);else return e.lanes=i.lanes,sl(i,e,s)}return K2(i,e,t,n,s)}function j9(i,e,t){var n=e.pendingProps,s=n.children,r=i!==null?i.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_n(td,to),to|=t;else{if(!(t&1073741824))return i=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,_n(td,to),to|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=r!==null?r.baseLanes:t,_n(td,to),to|=n}else r!==null?(n=r.baseLanes|t,e.memoizedState=null):n=t,_n(td,to),to|=n;return nr(i,e,s,t),e.child}function q9(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function K2(i,e,t,n,s){var r=xr(t)?du:Ts.current;return r=vd(e,r),Cd(e,s),t=z1(i,e,t,n,r,s),n=_1(),i!==null&&!Rr?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,sl(i,e,s)):(Qn&&n&&R1(e),e.flags|=1,nr(i,e,t,s),e.child)}function oR(i,e,t,n,s){if(xr(t)){var r=!0;pb(e)}else r=!1;if(Cd(e,s),e.stateNode===null)T0(i,e),Z9(e,t,n),N2(e,t,n,s),n=!0;else if(i===null){var o=e.stateNode,g=e.memoizedProps;o.props=g;var a=o.context,l=t.contextType;typeof l=="object"&&l!==null?l=qo(l):(l=xr(t)?du:Ts.current,l=vd(e,l));var c=t.getDerivedStateFromProps,C=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";C||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(g!==n||a!==l)&&jS(e,o,n,l),sc=!1;var h=e.memoizedState;o.state=h,yb(e,n,o,s),a=e.memoizedState,g!==n||h!==a||Wr.current||sc?(typeof c=="function"&&(F2(e,t,c,n),a=e.memoizedState),(g=sc||QS(e,t,g,n,h,a,l))?(C||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=a),o.props=n,o.state=a,o.context=l,n=g):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,B9(i,e),g=e.memoizedProps,l=e.type===e.elementType?g:yg(e.type,g),o.props=l,C=e.pendingProps,h=o.context,a=t.contextType,typeof a=="object"&&a!==null?a=qo(a):(a=xr(t)?du:Ts.current,a=vd(e,a));var p=t.getDerivedStateFromProps;(c=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(g!==C||h!==a)&&jS(e,o,n,a),sc=!1,h=e.memoizedState,o.state=h,yb(e,n,o,s);var m=e.memoizedState;g!==C||h!==m||Wr.current||sc?(typeof p=="function"&&(F2(e,t,p,n),m=e.memoizedState),(l=sc||QS(e,t,l,n,h,m,a)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,m,a),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,m,a)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||g===i.memoizedProps&&h===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||g===i.memoizedProps&&h===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),o.props=n,o.state=m,o.context=a,n=l):(typeof o.componentDidUpdate!="function"||g===i.memoizedProps&&h===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||g===i.memoizedProps&&h===i.memoizedState||(e.flags|=1024),n=!1)}return L2(i,e,t,n,r,s)}function L2(i,e,t,n,s,r){q9(i,e);var o=(e.flags&128)!==0;if(!n&&!o)return s&&DS(e,t,!1),sl(i,e,r);n=e.stateNode,I_.current=e;var g=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&o?(e.child=wd(e,i.child,null,r),e.child=wd(e,null,g,r)):nr(i,e,g,r),e.memoizedState=n.state,s&&DS(e,t,!0),e.child}function $9(i){var e=i.stateNode;e.pendingContext?ES(i,e.pendingContext,e.pendingContext!==e.context):e.context&&ES(i,e.context,!1),N1(i,e.containerInfo)}function gR(i,e,t,n,s){return Zd(),x1(s),e.flags|=256,nr(i,e,t,n),e.child}var z2={dehydrated:null,treeContext:null,retryLane:0};function _2(i){return{baseLanes:i,cachePool:null,transitions:null}}function ex(i,e,t){var n=e.pendingProps,s=si.current,r=!1,o=(e.flags&128)!==0,g;if((g=o)||(g=i!==null&&i.memoizedState===null?!1:(s&2)!==0),g?(r=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(s|=1),_n(si,s&1),i===null)return X2(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,i=n.fallback,r?(n=e.mode,r=e.child,o={mode:"hidden",children:o},!(n&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=iG(o,n,0,null),i=iu(i,n,t,null),r.return=e,i.return=e,r.sibling=i,e.child=r,e.child.memoizedState=_2(t),e.memoizedState=z2,i):E1(e,o));if(s=i.memoizedState,s!==null&&(g=s.dehydrated,g!==null))return u_(i,e,o,n,g,s,t);if(r){r=n.fallback,o=e.mode,s=i.child,g=s.sibling;var a={mode:"hidden",children:n.children};return!(o&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=a,e.deletions=null):(n=vc(s,a),n.subtreeFlags=s.subtreeFlags&14680064),g!==null?r=vc(g,r):(r=iu(r,o,t,null),r.flags|=2),r.return=e,n.return=e,n.sibling=r,e.child=n,n=r,r=e.child,o=i.child.memoizedState,o=o===null?_2(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=i.childLanes&~t,e.memoizedState=z2,n}return r=i.child,i=r.sibling,n=vc(r,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=n,e.memoizedState=null,n}function E1(i,e){return e=iG({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function Xm(i,e,t,n){return n!==null&&x1(n),wd(e,i.child,null,t),i=E1(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function u_(i,e,t,n,s,r,o){if(t)return e.flags&256?(e.flags&=-257,n=ky(Error(Ue(422))),Xm(i,e,o,n)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(r=n.fallback,s=e.mode,n=iG({mode:"visible",children:n.children},s,0,null),r=iu(r,s,o,null),r.flags|=2,n.return=e,r.return=e,n.sibling=r,e.child=n,e.mode&1&&wd(e,i.child,null,o),e.child.memoizedState=_2(o),e.memoizedState=z2,r);if(!(e.mode&1))return Xm(i,e,o,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var g=n.dgst;return n=g,r=Error(Ue(419)),n=ky(r,n,void 0),Xm(i,e,o,n)}if(g=(o&i.childLanes)!==0,Rr||g){if(n=Is,n!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|o)?0:s,s!==0&&s!==r.retryLane&&(r.retryLane=s,il(i,s),Rg(n,i,s,-1))}return Q1(),n=ky(Error(Ue(421))),Xm(i,e,o,n)}return s.data==="$?"?(e.flags|=128,e.child=i.child,e=Z_.bind(null,i),s._reactRetry=e,null):(i=r.treeContext,ro=bc(s.nextSibling),go=e,Qn=!0,Zg=null,i!==null&&(_o[ko++]=Pa,_o[ko++]=Oa,_o[ko++]=hu,Pa=i.id,Oa=i.overflow,hu=e),e=E1(e,n.children),e.flags|=4096,e)}function aR(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),Y2(i.return,e,t)}function Ty(i,e,t,n,s){var r=i.memoizedState;r===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=t,r.tailMode=s)}function tx(i,e,t){var n=e.pendingProps,s=n.revealOrder,r=n.tail;if(nr(i,e,n.children,t),n=si.current,n&2)n=n&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&aR(i,t,e);else if(i.tag===19)aR(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(_n(si,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)i=t.alternate,i!==null&&Bb(i)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Ty(e,!1,s,t,r);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(i=s.alternate,i!==null&&Bb(i)===null){e.child=s;break}i=s.sibling,s.sibling=t,t=s,s=i}Ty(e,!0,t,null,r);break;case"together":Ty(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function T0(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function sl(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),pu|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(Ue(153));if(e.child!==null){for(i=e.child,t=vc(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=vc(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function C_(i,e,t){switch(e.tag){case 3:$9(e),Zd();break;case 5:R9(e);break;case 1:xr(e.type)&&pb(e);break;case 4:N1(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;_n(bb,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(_n(si,si.current&1),e.flags|=128,null):t&e.child.childLanes?ex(i,e,t):(_n(si,si.current&1),i=sl(i,e,t),i!==null?i.sibling:null);_n(si,si.current&1);break;case 19:if(n=(t&e.childLanes)!==0,i.flags&128){if(n)return tx(i,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),_n(si,si.current),n)break;return null;case 22:case 23:return e.lanes=0,j9(i,e,t)}return sl(i,e,t)}var nx,k2,ix,sx;nx=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};k2=function(){};ix=function(i,e,t,n){var s=i.memoizedProps;if(s!==n){i=e.stateNode,OI(la.current);var r=null;switch(t){case"input":s=c2(i,s),n=c2(i,n),r=[];break;case"select":s=ci({},s,{value:void 0}),n=ci({},n,{value:void 0}),r=[];break;case"textarea":s=C2(i,s),n=C2(i,n),r=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=hb)}h2(t,n);var o;t=null;for(l in s)if(!n.hasOwnProperty(l)&&s.hasOwnProperty(l)&&s[l]!=null)if(l==="style"){var g=s[l];for(o in g)g.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ep.hasOwnProperty(l)?r||(r=[]):(r=r||[]).push(l,null));for(l in n){var a=n[l];if(g=s!=null?s[l]:void 0,n.hasOwnProperty(l)&&a!==g&&(a!=null||g!=null))if(l==="style")if(g){for(o in g)!g.hasOwnProperty(o)||a&&a.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in a)a.hasOwnProperty(o)&&g[o]!==a[o]&&(t||(t={}),t[o]=a[o])}else t||(r||(r=[]),r.push(l,t)),t=a;else l==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,g=g?g.__html:void 0,a!=null&&g!==a&&(r=r||[]).push(l,a)):l==="children"?typeof a!="string"&&typeof a!="number"||(r=r||[]).push(l,""+a):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(ep.hasOwnProperty(l)?(a!=null&&l==="onScroll"&&Tn("scroll",i),r||g===a||(r=[])):(r=r||[]).push(l,a))}t&&(r=r||[]).push("style",t);var l=r;(e.updateQueue=l)&&(e.flags|=4)}};sx=function(i,e,t,n){t!==n&&(e.flags|=4)};function nA(i,e){if(!Qn)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function Xs(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=i,s=s.sibling;else for(s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=i,s=s.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function d_(i,e,t){var n=e.pendingProps;switch(W1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xs(e),null;case 1:return xr(e.type)&&Ab(),Xs(e),null;case 3:return n=e.stateNode,Sd(),Jn(Wr),Jn(Ts),K1(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(Vm(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Zg!==null&&(Q2(Zg),Zg=null))),k2(i,e),Xs(e),null;case 5:M1(e);var s=OI(up.current);if(t=e.type,i!==null&&e.stateNode!=null)ix(i,e,t,n,s),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Ue(166));return Xs(e),null}if(i=OI(la.current),Vm(e)){n=e.stateNode,t=e.type;var r=e.memoizedProps;switch(n[ra]=e,n[cp]=r,i=(e.mode&1)!==0,t){case"dialog":Tn("cancel",n),Tn("close",n);break;case"iframe":case"object":case"embed":Tn("load",n);break;case"video":case"audio":for(s=0;s<HA.length;s++)Tn(HA[s],n);break;case"source":Tn("error",n);break;case"img":case"image":case"link":Tn("error",n),Tn("load",n);break;case"details":Tn("toggle",n);break;case"input":pS(n,r),Tn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!r.multiple},Tn("invalid",n);break;case"textarea":mS(n,r),Tn("invalid",n)}h2(t,r),s=null;for(var o in r)if(r.hasOwnProperty(o)){var g=r[o];o==="children"?typeof g=="string"?n.textContent!==g&&(r.suppressHydrationWarning!==!0&&xm(n.textContent,g,i),s=["children",g]):typeof g=="number"&&n.textContent!==""+g&&(r.suppressHydrationWarning!==!0&&xm(n.textContent,g,i),s=["children",""+g]):ep.hasOwnProperty(o)&&g!=null&&o==="onScroll"&&Tn("scroll",n)}switch(t){case"input":ym(n),fS(n,r,!0);break;case"textarea":ym(n),bS(n);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(n.onclick=hb)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=V5(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=o.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=o.createElement(t,{is:n.is}):(i=o.createElement(t),t==="select"&&(o=i,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):i=o.createElementNS(i,t),i[ra]=e,i[cp]=n,nx(i,e,!1,!1),e.stateNode=i;e:{switch(o=A2(t,n),t){case"dialog":Tn("cancel",i),Tn("close",i),s=n;break;case"iframe":case"object":case"embed":Tn("load",i),s=n;break;case"video":case"audio":for(s=0;s<HA.length;s++)Tn(HA[s],i);s=n;break;case"source":Tn("error",i),s=n;break;case"img":case"image":case"link":Tn("error",i),Tn("load",i),s=n;break;case"details":Tn("toggle",i),s=n;break;case"input":pS(i,n),s=c2(i,n),Tn("invalid",i);break;case"option":s=n;break;case"select":i._wrapperState={wasMultiple:!!n.multiple},s=ci({},n,{value:void 0}),Tn("invalid",i);break;case"textarea":mS(i,n),s=C2(i,n),Tn("invalid",i);break;default:s=n}h2(t,s),g=s;for(r in g)if(g.hasOwnProperty(r)){var a=g[r];r==="style"?Y5(i,a):r==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&H5(i,a)):r==="children"?typeof a=="string"?(t!=="textarea"||a!=="")&&tp(i,a):typeof a=="number"&&tp(i,""+a):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(ep.hasOwnProperty(r)?a!=null&&r==="onScroll"&&Tn("scroll",i):a!=null&&d1(i,r,a,o))}switch(t){case"input":ym(i),fS(i,n,!1);break;case"textarea":ym(i),bS(i);break;case"option":n.value!=null&&i.setAttribute("value",""+Wc(n.value));break;case"select":i.multiple=!!n.multiple,r=n.value,r!=null?ld(i,!!n.multiple,r,!1):n.defaultValue!=null&&ld(i,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(i.onclick=hb)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Xs(e),null;case 6:if(i&&e.stateNode!=null)sx(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Ue(166));if(t=OI(up.current),OI(la.current),Vm(e)){if(n=e.stateNode,t=e.memoizedProps,n[ra]=e,(r=n.nodeValue!==t)&&(i=go,i!==null))switch(i.tag){case 3:xm(n.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&xm(n.nodeValue,t,(i.mode&1)!==0)}r&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[ra]=e,e.stateNode=n}return Xs(e),null;case 13:if(Jn(si),n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Qn&&ro!==null&&e.mode&1&&!(e.flags&128))G9(),Zd(),e.flags|=98560,r=!1;else if(r=Vm(e),n!==null&&n.dehydrated!==null){if(i===null){if(!r)throw Error(Ue(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Ue(317));r[ra]=e}else Zd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Xs(e),r=!1}else Zg!==null&&(Q2(Zg),Zg=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(i!==null&&i.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(i===null||si.current&1?Pi===0&&(Pi=3):Q1())),e.updateQueue!==null&&(e.flags|=4),Xs(e),null);case 4:return Sd(),k2(i,e),i===null&&ap(e.stateNode.containerInfo),Xs(e),null;case 10:return X1(e.type._context),Xs(e),null;case 17:return xr(e.type)&&Ab(),Xs(e),null;case 19:if(Jn(si),r=e.memoizedState,r===null)return Xs(e),null;if(n=(e.flags&128)!==0,o=r.rendering,o===null)if(n)nA(r,!1);else{if(Pi!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(o=Bb(i),o!==null){for(e.flags|=128,nA(r,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)r=t,i=n,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=i,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,i=o.dependencies,r.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return _n(si,si.current&1|2),e.child}i=i.sibling}r.tail!==null&&xi()>Wd&&(e.flags|=128,n=!0,nA(r,!1),e.lanes=4194304)}else{if(!n)if(i=Bb(o),i!==null){if(e.flags|=128,n=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),nA(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Qn)return Xs(e),null}else 2*xi()-r.renderingStartTime>Wd&&t!==1073741824&&(e.flags|=128,n=!0,nA(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=xi(),e.sibling=null,t=si.current,_n(si,n?t&1|2:t&1),e):(Xs(e),null);case 22:case 23:return O1(),n=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?to&1073741824&&(Xs(e),e.subtreeFlags&6&&(e.flags|=8192)):Xs(e),null;case 24:return null;case 25:return null}throw Error(Ue(156,e.tag))}function h_(i,e){switch(W1(e),e.tag){case 1:return xr(e.type)&&Ab(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Sd(),Jn(Wr),Jn(Ts),K1(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return M1(e),null;case 13:if(Jn(si),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(Ue(340));Zd()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return Jn(si),null;case 4:return Sd(),null;case 10:return X1(e.type._context),null;case 22:case 23:return O1(),null;case 24:return null;default:return null}}var Ym=!1,Ks=!1,A_=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function ed(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){fi(i,e,n)}else t.current=null}function T2(i,e,t){try{t()}catch(n){fi(i,e,n)}}var lR=!1;function p_(i,e){if(w2=ub,i=a9(),S1(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,r=n.focusNode;n=n.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var o=0,g=-1,a=-1,l=0,c=0,C=i,h=null;t:for(;;){for(var p;C!==t||s!==0&&C.nodeType!==3||(g=o+s),C!==r||n!==0&&C.nodeType!==3||(a=o+n),C.nodeType===3&&(o+=C.nodeValue.length),(p=C.firstChild)!==null;)h=C,C=p;for(;;){if(C===i)break t;if(h===t&&++l===s&&(g=o),h===r&&++c===n&&(a=o),(p=C.nextSibling)!==null)break;C=h,h=C.parentNode}C=p}t=g===-1||a===-1?null:{start:g,end:a}}else t=null}t=t||{start:0,end:0}}else t=null;for(S2={focusedElem:i,selectionRange:t},ub=!1,Ct=e;Ct!==null;)if(e=Ct,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,Ct=i;else for(;Ct!==null;){e=Ct;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var f=m.memoizedProps,b=m.memoizedState,y=e.stateNode,v=y.getSnapshotBeforeUpdate(e.elementType===e.type?f:yg(e.type,f),b);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var G=e.stateNode.containerInfo;G.nodeType===1?G.textContent="":G.nodeType===9&&G.documentElement&&G.removeChild(G.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ue(163))}}catch(w){fi(e,e.return,w)}if(i=e.sibling,i!==null){i.return=e.return,Ct=i;break}Ct=e.return}return m=lR,lR=!1,m}function EA(i,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&i)===i){var r=s.destroy;s.destroy=void 0,r!==void 0&&T2(e,t,r)}s=s.next}while(s!==n)}}function tG(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function E2(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function rx(i){var e=i.alternate;e!==null&&(i.alternate=null,rx(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[ra],delete e[cp],delete e[x2],delete e[$z],delete e[e_])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function ox(i){return i.tag===5||i.tag===3||i.tag===4}function cR(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||ox(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function D2(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=hb));else if(n!==4&&(i=i.child,i!==null))for(D2(i,e,t),i=i.sibling;i!==null;)D2(i,e,t),i=i.sibling}function J2(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(J2(i,e,t),i=i.sibling;i!==null;)J2(i,e,t),i=i.sibling}var ps=null,Bg=!1;function Ol(i,e,t){for(t=t.child;t!==null;)gx(i,e,t),t=t.sibling}function gx(i,e,t){if(aa&&typeof aa.onCommitFiberUnmount=="function")try{aa.onCommitFiberUnmount(Ub,t)}catch{}switch(t.tag){case 5:Ks||ed(t,e);case 6:var n=ps,s=Bg;ps=null,Ol(i,e,t),ps=n,Bg=s,ps!==null&&(Bg?(i=ps,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):ps.removeChild(t.stateNode));break;case 18:ps!==null&&(Bg?(i=ps,t=t.stateNode,i.nodeType===8?Ny(i.parentNode,t):i.nodeType===1&&Ny(i,t),rp(i)):Ny(ps,t.stateNode));break;case 4:n=ps,s=Bg,ps=t.stateNode.containerInfo,Bg=!0,Ol(i,e,t),ps=n,Bg=s;break;case 0:case 11:case 14:case 15:if(!Ks&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var r=s,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&T2(t,e,o),s=s.next}while(s!==n)}Ol(i,e,t);break;case 1:if(!Ks&&(ed(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(g){fi(t,e,g)}Ol(i,e,t);break;case 21:Ol(i,e,t);break;case 22:t.mode&1?(Ks=(n=Ks)||t.memoizedState!==null,Ol(i,e,t),Ks=n):Ol(i,e,t);break;default:Ol(i,e,t)}}function IR(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new A_),e.forEach(function(n){var s=w_.bind(null,i,n);t.has(n)||(t.add(n),n.then(s,s))})}}function Ag(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n];try{var r=i,o=e,g=o;e:for(;g!==null;){switch(g.tag){case 5:ps=g.stateNode,Bg=!1;break e;case 3:ps=g.stateNode.containerInfo,Bg=!0;break e;case 4:ps=g.stateNode.containerInfo,Bg=!0;break e}g=g.return}if(ps===null)throw Error(Ue(160));gx(r,o,s),ps=null,Bg=!1;var a=s.alternate;a!==null&&(a.return=null),s.return=null}catch(l){fi(s,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ax(e,i),e=e.sibling}function ax(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Ag(e,i),$g(i),n&4){try{EA(3,i,i.return),tG(3,i)}catch(f){fi(i,i.return,f)}try{EA(5,i,i.return)}catch(f){fi(i,i.return,f)}}break;case 1:Ag(e,i),$g(i),n&512&&t!==null&&ed(t,t.return);break;case 5:if(Ag(e,i),$g(i),n&512&&t!==null&&ed(t,t.return),i.flags&32){var s=i.stateNode;try{tp(s,"")}catch(f){fi(i,i.return,f)}}if(n&4&&(s=i.stateNode,s!=null)){var r=i.memoizedProps,o=t!==null?t.memoizedProps:r,g=i.type,a=i.updateQueue;if(i.updateQueue=null,a!==null)try{g==="input"&&r.type==="radio"&&r.name!=null&&W5(s,r),A2(g,o);var l=A2(g,r);for(o=0;o<a.length;o+=2){var c=a[o],C=a[o+1];c==="style"?Y5(s,C):c==="dangerouslySetInnerHTML"?H5(s,C):c==="children"?tp(s,C):d1(s,c,C,l)}switch(g){case"input":I2(s,r);break;case"textarea":x5(s,r);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!r.multiple;var p=r.value;p!=null?ld(s,!!r.multiple,p,!1):h!==!!r.multiple&&(r.defaultValue!=null?ld(s,!!r.multiple,r.defaultValue,!0):ld(s,!!r.multiple,r.multiple?[]:"",!1))}s[cp]=r}catch(f){fi(i,i.return,f)}}break;case 6:if(Ag(e,i),$g(i),n&4){if(i.stateNode===null)throw Error(Ue(162));s=i.stateNode,r=i.memoizedProps;try{s.nodeValue=r}catch(f){fi(i,i.return,f)}}break;case 3:if(Ag(e,i),$g(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{rp(e.containerInfo)}catch(f){fi(i,i.return,f)}break;case 4:Ag(e,i),$g(i);break;case 13:Ag(e,i),$g(i),s=i.child,s.flags&8192&&(r=s.memoizedState!==null,s.stateNode.isHidden=r,!r||s.alternate!==null&&s.alternate.memoizedState!==null||(U1=xi())),n&4&&IR(i);break;case 22:if(c=t!==null&&t.memoizedState!==null,i.mode&1?(Ks=(l=Ks)||c,Ag(e,i),Ks=l):Ag(e,i),$g(i),n&8192){if(l=i.memoizedState!==null,(i.stateNode.isHidden=l)&&!c&&i.mode&1)for(Ct=i,c=i.child;c!==null;){for(C=Ct=c;Ct!==null;){switch(h=Ct,p=h.child,h.tag){case 0:case 11:case 14:case 15:EA(4,h,h.return);break;case 1:ed(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){n=h,t=h.return;try{e=n,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(f){fi(n,t,f)}}break;case 5:ed(h,h.return);break;case 22:if(h.memoizedState!==null){CR(C);continue}}p!==null?(p.return=h,Ct=p):CR(C)}c=c.sibling}e:for(c=null,C=i;;){if(C.tag===5){if(c===null){c=C;try{s=C.stateNode,l?(r=s.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(g=C.stateNode,a=C.memoizedProps.style,o=a!=null&&a.hasOwnProperty("display")?a.display:null,g.style.display=X5("display",o))}catch(f){fi(i,i.return,f)}}}else if(C.tag===6){if(c===null)try{C.stateNode.nodeValue=l?"":C.memoizedProps}catch(f){fi(i,i.return,f)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===i)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===i)break e;for(;C.sibling===null;){if(C.return===null||C.return===i)break e;c===C&&(c=null),C=C.return}c===C&&(c=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Ag(e,i),$g(i),n&4&&IR(i);break;case 21:break;default:Ag(e,i),$g(i)}}function $g(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(ox(t)){var n=t;break e}t=t.return}throw Error(Ue(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(tp(s,""),n.flags&=-33);var r=cR(i);J2(i,r,s);break;case 3:case 4:var o=n.stateNode.containerInfo,g=cR(i);D2(i,g,o);break;default:throw Error(Ue(161))}}catch(a){fi(i,i.return,a)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function f_(i,e,t){Ct=i,lx(i)}function lx(i,e,t){for(var n=(i.mode&1)!==0;Ct!==null;){var s=Ct,r=s.child;if(s.tag===22&&n){var o=s.memoizedState!==null||Ym;if(!o){var g=s.alternate,a=g!==null&&g.memoizedState!==null||Ks;g=Ym;var l=Ks;if(Ym=o,(Ks=a)&&!l)for(Ct=s;Ct!==null;)o=Ct,a=o.child,o.tag===22&&o.memoizedState!==null?dR(s):a!==null?(a.return=o,Ct=a):dR(s);for(;r!==null;)Ct=r,lx(r),r=r.sibling;Ct=s,Ym=g,Ks=l}uR(i)}else s.subtreeFlags&8772&&r!==null?(r.return=s,Ct=r):uR(i)}}function uR(i){for(;Ct!==null;){var e=Ct;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ks||tG(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Ks)if(t===null)n.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:yg(e.type,t.memoizedProps);n.componentDidUpdate(s,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&OS(e,r,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}OS(e,o,t)}break;case 5:var g=e.stateNode;if(t===null&&e.flags&4){t=g;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&t.focus();break;case"img":a.src&&(t.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var C=c.dehydrated;C!==null&&rp(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ue(163))}Ks||e.flags&512&&E2(e)}catch(h){fi(e,e.return,h)}}if(e===i){Ct=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ct=t;break}Ct=e.return}}function CR(i){for(;Ct!==null;){var e=Ct;if(e===i){Ct=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ct=t;break}Ct=e.return}}function dR(i){for(;Ct!==null;){var e=Ct;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{tG(4,e)}catch(a){fi(e,t,a)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(a){fi(e,s,a)}}var r=e.return;try{E2(e)}catch(a){fi(e,r,a)}break;case 5:var o=e.return;try{E2(e)}catch(a){fi(e,o,a)}}}catch(a){fi(e,e.return,a)}if(e===i){Ct=null;break}var g=e.sibling;if(g!==null){g.return=e.return,Ct=g;break}Ct=e.return}}var m_=Math.ceil,wb=ul.ReactCurrentDispatcher,D1=ul.ReactCurrentOwner,Qo=ul.ReactCurrentBatchConfig,mn=0,Is=null,Li=null,ms=0,to=0,td=Mc(0),Pi=0,Ap=null,pu=0,nG=0,J1=0,DA=null,vr=null,U1=0,Wd=1/0,_a=null,Sb=!1,U2=null,yc=null,Fm=!1,uc=null,Rb=0,JA=0,P2=null,E0=-1,D0=0;function or(){return mn&6?xi():E0!==-1?E0:E0=xi()}function Bc(i){return i.mode&1?mn&2&&ms!==0?ms&-ms:n_.transition!==null?(D0===0&&(D0=J5()),D0):(i=Sn,i!==0||(i=window.event,i=i===void 0?16:$5(i.type)),i):1}function Rg(i,e,t,n){if(50<JA)throw JA=0,P2=null,Error(Ue(185));Np(i,t,n),(!(mn&2)||i!==Is)&&(i===Is&&(!(mn&2)&&(nG|=t),Pi===4&&cc(i,ms)),Vr(i,n),t===1&&mn===0&&!(e.mode&1)&&(Wd=xi()+500,qb&&Kc()))}function Vr(i,e){var t=i.callbackNode;nz(i,e);var n=Ib(i,i===Is?ms:0);if(n===0)t!==null&&BS(t),i.callbackNode=null,i.callbackPriority=0;else if(e=n&-n,i.callbackPriority!==e){if(t!=null&&BS(t),e===1)i.tag===0?t_(hR.bind(null,i)):f9(hR.bind(null,i)),jz(function(){!(mn&6)&&Kc()}),t=null;else{switch(U5(n)){case 1:t=m1;break;case 4:t=E5;break;case 16:t=cb;break;case 536870912:t=D5;break;default:t=cb}t=px(t,cx.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function cx(i,e){if(E0=-1,D0=0,mn&6)throw Error(Ue(327));var t=i.callbackNode;if(dd()&&i.callbackNode!==t)return null;var n=Ib(i,i===Is?ms:0);if(n===0)return null;if(n&30||n&i.expiredLanes||e)e=Wb(i,n);else{e=n;var s=mn;mn|=2;var r=ux();(Is!==i||ms!==e)&&(_a=null,Wd=xi()+500,nu(i,e));do try{y_();break}catch(g){Ix(i,g)}while(1);H1(),wb.current=r,mn=s,Li!==null?e=0:(Is=null,ms=0,e=Pi)}if(e!==0){if(e===2&&(s=G2(i),s!==0&&(n=s,e=O2(i,s))),e===1)throw t=Ap,nu(i,0),cc(i,n),Vr(i,xi()),t;if(e===6)cc(i,n);else{if(s=i.current.alternate,!(n&30)&&!b_(s)&&(e=Wb(i,n),e===2&&(r=G2(i),r!==0&&(n=r,e=O2(i,r))),e===1))throw t=Ap,nu(i,0),cc(i,n),Vr(i,xi()),t;switch(i.finishedWork=s,i.finishedLanes=n,e){case 0:case 1:throw Error(Ue(345));case 2:KI(i,vr,_a);break;case 3:if(cc(i,n),(n&130023424)===n&&(e=U1+500-xi(),10<e)){if(Ib(i,0)!==0)break;if(s=i.suspendedLanes,(s&n)!==n){or(),i.pingedLanes|=i.suspendedLanes&s;break}i.timeoutHandle=W2(KI.bind(null,i,vr,_a),e);break}KI(i,vr,_a);break;case 4:if(cc(i,n),(n&4194240)===n)break;for(e=i.eventTimes,s=-1;0<n;){var o=31-Sg(n);r=1<<o,o=e[o],o>s&&(s=o),n&=~r}if(n=s,n=xi()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*m_(n/1960))-n,10<n){i.timeoutHandle=W2(KI.bind(null,i,vr,_a),n);break}KI(i,vr,_a);break;case 5:KI(i,vr,_a);break;default:throw Error(Ue(329))}}}return Vr(i,xi()),i.callbackNode===t?cx.bind(null,i):null}function O2(i,e){var t=DA;return i.current.memoizedState.isDehydrated&&(nu(i,e).flags|=256),i=Wb(i,e),i!==2&&(e=vr,vr=t,e!==null&&Q2(e)),i}function Q2(i){vr===null?vr=i:vr.push.apply(vr,i)}function b_(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var s=t[n],r=s.getSnapshot;s=s.value;try{if(!Vg(r(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function cc(i,e){for(e&=~J1,e&=~nG,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-Sg(e),n=1<<t;i[t]=-1,e&=~n}}function hR(i){if(mn&6)throw Error(Ue(327));dd();var e=Ib(i,0);if(!(e&1))return Vr(i,xi()),null;var t=Wb(i,e);if(i.tag!==0&&t===2){var n=G2(i);n!==0&&(e=n,t=O2(i,n))}if(t===1)throw t=Ap,nu(i,0),cc(i,e),Vr(i,xi()),t;if(t===6)throw Error(Ue(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,KI(i,vr,_a),Vr(i,xi()),null}function P1(i,e){var t=mn;mn|=1;try{return i(e)}finally{mn=t,mn===0&&(Wd=xi()+500,qb&&Kc())}}function fu(i){uc!==null&&uc.tag===0&&!(mn&6)&&dd();var e=mn;mn|=1;var t=Qo.transition,n=Sn;try{if(Qo.transition=null,Sn=1,i)return i()}finally{Sn=n,Qo.transition=t,mn=e,!(mn&6)&&Kc()}}function O1(){to=td.current,Jn(td)}function nu(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,Qz(t)),Li!==null)for(t=Li.return;t!==null;){var n=t;switch(W1(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Ab();break;case 3:Sd(),Jn(Wr),Jn(Ts),K1();break;case 5:M1(n);break;case 4:Sd();break;case 13:Jn(si);break;case 19:Jn(si);break;case 10:X1(n.type._context);break;case 22:case 23:O1()}t=t.return}if(Is=i,Li=i=vc(i.current,null),ms=to=e,Pi=0,Ap=null,J1=nG=pu=0,vr=DA=null,PI!==null){for(e=0;e<PI.length;e++)if(t=PI[e],n=t.interleaved,n!==null){t.interleaved=null;var s=n.next,r=t.pending;if(r!==null){var o=r.next;r.next=s,n.next=o}t.pending=n}PI=null}return i}function Ix(i,e){do{var t=Li;try{if(H1(),_0.current=Zb,vb){for(var n=li.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}vb=!1}if(Au=0,ls=Di=li=null,TA=!1,Cp=0,D1.current=null,t===null||t.return===null){Pi=1,Ap=e,Li=null;break}e:{var r=i,o=t.return,g=t,a=e;if(e=ms,g.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var l=a,c=g,C=c.tag;if(!(c.mode&1)&&(C===0||C===11||C===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var p=nR(o);if(p!==null){p.flags&=-257,iR(p,o,g,r,e),p.mode&1&&tR(r,l,e),e=p,a=l;var m=e.updateQueue;if(m===null){var f=new Set;f.add(a),e.updateQueue=f}else m.add(a);break e}else{if(!(e&1)){tR(r,l,e),Q1();break e}a=Error(Ue(426))}}else if(Qn&&g.mode&1){var b=nR(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),iR(b,o,g,r,e),x1(Rd(a,g));break e}}r=a=Rd(a,g),Pi!==4&&(Pi=2),DA===null?DA=[r]:DA.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var y=P9(r,a,e);PS(r,y);break e;case 1:g=a;var v=r.type,G=r.stateNode;if(!(r.flags&128)&&(typeof v.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(yc===null||!yc.has(G)))){r.flags|=65536,e&=-e,r.lanes|=e;var w=O9(r,g,e);PS(r,w);break e}}r=r.return}while(r!==null)}dx(t)}catch(W){e=W,Li===t&&t!==null&&(Li=t=t.return);continue}break}while(1)}function ux(){var i=wb.current;return wb.current=Zb,i===null?Zb:i}function Q1(){(Pi===0||Pi===3||Pi===2)&&(Pi=4),Is===null||!(pu&268435455)&&!(nG&268435455)||cc(Is,ms)}function Wb(i,e){var t=mn;mn|=2;var n=ux();(Is!==i||ms!==e)&&(_a=null,nu(i,e));do try{G_();break}catch(s){Ix(i,s)}while(1);if(H1(),mn=t,wb.current=n,Li!==null)throw Error(Ue(261));return Is=null,ms=0,Pi}function G_(){for(;Li!==null;)Cx(Li)}function y_(){for(;Li!==null&&!UL();)Cx(Li)}function Cx(i){var e=Ax(i.alternate,i,to);i.memoizedProps=i.pendingProps,e===null?dx(i):Li=e,D1.current=null}function dx(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=h_(t,e),t!==null){t.flags&=32767,Li=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Pi=6,Li=null;return}}else if(t=d_(t,e,to),t!==null){Li=t;return}if(e=e.sibling,e!==null){Li=e;return}Li=e=i}while(e!==null);Pi===0&&(Pi=5)}function KI(i,e,t){var n=Sn,s=Qo.transition;try{Qo.transition=null,Sn=1,B_(i,e,t,n)}finally{Qo.transition=s,Sn=n}return null}function B_(i,e,t,n){do dd();while(uc!==null);if(mn&6)throw Error(Ue(327));t=i.finishedWork;var s=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(Ue(177));i.callbackNode=null,i.callbackPriority=0;var r=t.lanes|t.childLanes;if(iz(i,r),i===Is&&(Li=Is=null,ms=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Fm||(Fm=!0,px(cb,function(){return dd(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=Qo.transition,Qo.transition=null;var o=Sn;Sn=1;var g=mn;mn|=4,D1.current=null,p_(i,t),ax(t,i),Tz(S2),ub=!!w2,S2=w2=null,i.current=t,f_(t),PL(),mn=g,Sn=o,Qo.transition=r}else i.current=t;if(Fm&&(Fm=!1,uc=i,Rb=s),r=i.pendingLanes,r===0&&(yc=null),jL(t.stateNode),Vr(i,xi()),e!==null)for(n=i.onRecoverableError,t=0;t<e.length;t++)s=e[t],n(s.value,{componentStack:s.stack,digest:s.digest});if(Sb)throw Sb=!1,i=U2,U2=null,i;return Rb&1&&i.tag!==0&&dd(),r=i.pendingLanes,r&1?i===P2?JA++:(JA=0,P2=i):JA=0,Kc(),null}function dd(){if(uc!==null){var i=U5(Rb),e=Qo.transition,t=Sn;try{if(Qo.transition=null,Sn=16>i?16:i,uc===null)var n=!1;else{if(i=uc,uc=null,Rb=0,mn&6)throw Error(Ue(331));var s=mn;for(mn|=4,Ct=i.current;Ct!==null;){var r=Ct,o=r.child;if(Ct.flags&16){var g=r.deletions;if(g!==null){for(var a=0;a<g.length;a++){var l=g[a];for(Ct=l;Ct!==null;){var c=Ct;switch(c.tag){case 0:case 11:case 15:EA(8,c,r)}var C=c.child;if(C!==null)C.return=c,Ct=C;else for(;Ct!==null;){c=Ct;var h=c.sibling,p=c.return;if(rx(c),c===l){Ct=null;break}if(h!==null){h.return=p,Ct=h;break}Ct=p}}}var m=r.alternate;if(m!==null){var f=m.child;if(f!==null){m.child=null;do{var b=f.sibling;f.sibling=null,f=b}while(f!==null)}}Ct=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,Ct=o;else e:for(;Ct!==null;){if(r=Ct,r.flags&2048)switch(r.tag){case 0:case 11:case 15:EA(9,r,r.return)}var y=r.sibling;if(y!==null){y.return=r.return,Ct=y;break e}Ct=r.return}}var v=i.current;for(Ct=v;Ct!==null;){o=Ct;var G=o.child;if(o.subtreeFlags&2064&&G!==null)G.return=o,Ct=G;else e:for(o=v;Ct!==null;){if(g=Ct,g.flags&2048)try{switch(g.tag){case 0:case 11:case 15:tG(9,g)}}catch(W){fi(g,g.return,W)}if(g===o){Ct=null;break e}var w=g.sibling;if(w!==null){w.return=g.return,Ct=w;break e}Ct=g.return}}if(mn=s,Kc(),aa&&typeof aa.onPostCommitFiberRoot=="function")try{aa.onPostCommitFiberRoot(Ub,i)}catch{}n=!0}return n}finally{Sn=t,Qo.transition=e}}return!1}function AR(i,e,t){e=Rd(t,e),e=P9(i,e,1),i=Gc(i,e,1),e=or(),i!==null&&(Np(i,1,e),Vr(i,e))}function fi(i,e,t){if(i.tag===3)AR(i,i,t);else for(;e!==null;){if(e.tag===3){AR(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(yc===null||!yc.has(n))){i=Rd(t,i),i=O9(e,i,1),e=Gc(e,i,1),i=or(),e!==null&&(Np(e,1,i),Vr(e,i));break}}e=e.return}}function v_(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=or(),i.pingedLanes|=i.suspendedLanes&t,Is===i&&(ms&t)===t&&(Pi===4||Pi===3&&(ms&130023424)===ms&&500>xi()-U1?nu(i,0):J1|=t),Vr(i,e)}function hx(i,e){e===0&&(i.mode&1?(e=Zm,Zm<<=1,!(Zm&130023424)&&(Zm=4194304)):e=1);var t=or();i=il(i,e),i!==null&&(Np(i,e,t),Vr(i,t))}function Z_(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),hx(i,t)}function w_(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,s=i.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=i.stateNode;break;default:throw Error(Ue(314))}n!==null&&n.delete(e),hx(i,t)}var Ax;Ax=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||Wr.current)Rr=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return Rr=!1,C_(i,e,t);Rr=!!(i.flags&131072)}else Rr=!1,Qn&&e.flags&1048576&&m9(e,mb,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;T0(i,e),i=e.pendingProps;var s=vd(e,Ts.current);Cd(e,t),s=z1(null,e,n,i,s,t);var r=_1();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,xr(n)?(r=!0,pb(e)):r=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,F1(e),s.updater=$b,e.stateNode=s,s._reactInternals=e,N2(e,n,i,t),e=L2(null,e,n,!0,r,t)):(e.tag=0,Qn&&r&&R1(e),nr(null,e,s,t),e=e.child),e;case 16:n=e.elementType;e:{switch(T0(i,e),i=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=R_(n),i=yg(n,i),s){case 0:e=K2(null,e,n,i,t);break e;case 1:e=oR(null,e,n,i,t);break e;case 11:e=sR(null,e,n,i,t);break e;case 14:e=rR(null,e,n,yg(n.type,i),t);break e}throw Error(Ue(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yg(n,s),K2(i,e,n,s,t);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yg(n,s),oR(i,e,n,s,t);case 3:e:{if($9(e),i===null)throw Error(Ue(387));n=e.pendingProps,r=e.memoizedState,s=r.element,B9(i,e),yb(e,n,null,t);var o=e.memoizedState;if(n=o.element,r.isDehydrated)if(r={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){s=Rd(Error(Ue(423)),e),e=gR(i,e,n,t,s);break e}else if(n!==s){s=Rd(Error(Ue(424)),e),e=gR(i,e,n,t,s);break e}else for(ro=bc(e.stateNode.containerInfo.firstChild),go=e,Qn=!0,Zg=null,t=S9(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Zd(),n===s){e=sl(i,e,t);break e}nr(i,e,n,t)}e=e.child}return e;case 5:return R9(e),i===null&&X2(e),n=e.type,s=e.pendingProps,r=i!==null?i.memoizedProps:null,o=s.children,R2(n,s)?o=null:r!==null&&R2(n,r)&&(e.flags|=32),q9(i,e),nr(i,e,o,t),e.child;case 6:return i===null&&X2(e),null;case 13:return ex(i,e,t);case 4:return N1(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=wd(e,null,n,t):nr(i,e,n,t),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yg(n,s),sR(i,e,n,s,t);case 7:return nr(i,e,e.pendingProps,t),e.child;case 8:return nr(i,e,e.pendingProps.children,t),e.child;case 12:return nr(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,r=e.memoizedProps,o=s.value,_n(bb,n._currentValue),n._currentValue=o,r!==null)if(Vg(r.value,o)){if(r.children===s.children&&!Wr.current){e=sl(i,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var g=r.dependencies;if(g!==null){o=r.child;for(var a=g.firstContext;a!==null;){if(a.context===n){if(r.tag===1){a=$a(-1,t&-t),a.tag=2;var l=r.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?a.next=a:(a.next=c.next,c.next=a),l.pending=a}}r.lanes|=t,a=r.alternate,a!==null&&(a.lanes|=t),Y2(r.return,t,e),g.lanes|=t;break}a=a.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(Ue(341));o.lanes|=t,g=o.alternate,g!==null&&(g.lanes|=t),Y2(o,t,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}nr(i,e,s.children,t),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,Cd(e,t),s=qo(s),n=n(s),e.flags|=1,nr(i,e,n,t),e.child;case 14:return n=e.type,s=yg(n,e.pendingProps),s=yg(n.type,s),rR(i,e,n,s,t);case 15:return Q9(i,e,e.type,e.pendingProps,t);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yg(n,s),T0(i,e),e.tag=1,xr(n)?(i=!0,pb(e)):i=!1,Cd(e,t),Z9(e,n,s),N2(e,n,s,t),L2(null,e,n,!0,i,t);case 19:return tx(i,e,t);case 22:return j9(i,e,t)}throw Error(Ue(156,e.tag))};function px(i,e){return T5(i,e)}function S_(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Eo(i,e,t,n){return new S_(i,e,t,n)}function j1(i){return i=i.prototype,!(!i||!i.isReactComponent)}function R_(i){if(typeof i=="function")return j1(i)?1:0;if(i!=null){if(i=i.$$typeof,i===A1)return 11;if(i===p1)return 14}return 2}function vc(i,e){var t=i.alternate;return t===null?(t=Eo(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function J0(i,e,t,n,s,r){var o=2;if(n=i,typeof i=="function")j1(i)&&(o=1);else if(typeof i=="string")o=5;else e:switch(i){case DC:return iu(t.children,s,r,e);case h1:o=8,s|=8;break;case o2:return i=Eo(12,t,e,s|2),i.elementType=o2,i.lanes=r,i;case g2:return i=Eo(13,t,e,s),i.elementType=g2,i.lanes=r,i;case a2:return i=Eo(19,t,e,s),i.elementType=a2,i.lanes=r,i;case w5:return iG(t,s,r,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case v5:o=10;break e;case Z5:o=9;break e;case A1:o=11;break e;case p1:o=14;break e;case ic:o=16,n=null;break e}throw Error(Ue(130,i==null?i:typeof i,""))}return e=Eo(o,t,e,s),e.elementType=i,e.type=n,e.lanes=r,e}function iu(i,e,t,n){return i=Eo(7,i,n,e),i.lanes=t,i}function iG(i,e,t,n){return i=Eo(22,i,n,e),i.elementType=w5,i.lanes=t,i.stateNode={isHidden:!1},i}function Ey(i,e,t){return i=Eo(6,i,null,e),i.lanes=t,i}function Dy(i,e,t){return e=Eo(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function W_(i,e,t,n,s){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Zy(0),this.expirationTimes=Zy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Zy(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function q1(i,e,t,n,s,r,o,g,a){return i=new W_(i,e,t,g,a),e===1?(e=1,r===!0&&(e|=8)):e=0,r=Eo(3,null,null,e),i.current=r,r.stateNode=i,r.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},F1(r),i}function x_(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:EC,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function fx(i){if(!i)return xc;i=i._reactInternals;e:{if(Su(i)!==i||i.tag!==1)throw Error(Ue(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(xr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ue(171))}if(i.tag===1){var t=i.type;if(xr(t))return p9(i,t,e)}return e}function mx(i,e,t,n,s,r,o,g,a){return i=q1(t,n,!0,i,s,r,o,g,a),i.context=fx(null),t=i.current,n=or(),s=Bc(t),r=$a(n,s),r.callback=e??null,Gc(t,r,s),i.current.lanes=s,Np(i,s,n),Vr(i,n),i}function sG(i,e,t,n){var s=e.current,r=or(),o=Bc(s);return t=fx(t),e.context===null?e.context=t:e.pendingContext=t,e=$a(r,o),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),i=Gc(s,e,o),i!==null&&(Rg(i,s,o,r),z0(i,s,o)),o}function xb(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function pR(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function $1(i,e){pR(i,e),(i=i.alternate)&&pR(i,e)}function V_(){return null}var bx=typeof reportError=="function"?reportError:function(i){console.error(i)};function eZ(i){this._internalRoot=i}rG.prototype.render=eZ.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(Ue(409));sG(i,e,null,null)};rG.prototype.unmount=eZ.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;fu(function(){sG(null,i,null,null)}),e[nl]=null}};function rG(i){this._internalRoot=i}rG.prototype.unstable_scheduleHydration=function(i){if(i){var e=Q5();i={blockedOn:null,target:i,priority:e};for(var t=0;t<lc.length&&e!==0&&e<lc[t].priority;t++);lc.splice(t,0,i),t===0&&q5(i)}};function tZ(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function oG(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function fR(){}function H_(i,e,t,n,s){if(s){if(typeof n=="function"){var r=n;n=function(){var l=xb(o);r.call(l)}}var o=mx(e,n,i,0,null,!1,!1,"",fR);return i._reactRootContainer=o,i[nl]=o.current,ap(i.nodeType===8?i.parentNode:i),fu(),o}for(;s=i.lastChild;)i.removeChild(s);if(typeof n=="function"){var g=n;n=function(){var l=xb(a);g.call(l)}}var a=q1(i,0,!1,null,null,!1,!1,"",fR);return i._reactRootContainer=a,i[nl]=a.current,ap(i.nodeType===8?i.parentNode:i),fu(function(){sG(e,a,t,n)}),a}function gG(i,e,t,n,s){var r=t._reactRootContainer;if(r){var o=r;if(typeof s=="function"){var g=s;s=function(){var a=xb(o);g.call(a)}}sG(e,o,i,s)}else o=H_(t,e,i,s,n);return xb(o)}P5=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=VA(e.pendingLanes);t!==0&&(b1(e,t|1),Vr(e,xi()),!(mn&6)&&(Wd=xi()+500,Kc()))}break;case 13:fu(function(){var n=il(i,1);if(n!==null){var s=or();Rg(n,i,1,s)}}),$1(i,1)}};G1=function(i){if(i.tag===13){var e=il(i,134217728);if(e!==null){var t=or();Rg(e,i,134217728,t)}$1(i,134217728)}};O5=function(i){if(i.tag===13){var e=Bc(i),t=il(i,e);if(t!==null){var n=or();Rg(t,i,e,n)}$1(i,e)}};Q5=function(){return Sn};j5=function(i,e){var t=Sn;try{return Sn=i,e()}finally{Sn=t}};f2=function(i,e,t){switch(e){case"input":if(I2(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var s=jb(n);if(!s)throw Error(Ue(90));R5(n),I2(n,s)}}}break;case"textarea":x5(i,t);break;case"select":e=t.value,e!=null&&ld(i,!!t.multiple,e,!1)}};M5=P1;K5=fu;var X_={usingClientEntryPoint:!1,Events:[Kp,OC,jb,F5,N5,P1]},iA={findFiberByHostInstance:UI,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Y_={bundleType:iA.bundleType,version:iA.version,rendererPackageName:iA.rendererPackageName,rendererConfig:iA.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ul.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=_5(i),i===null?null:i.stateNode},findFiberByHostInstance:iA.findFiberByHostInstance||V_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Nm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Nm.isDisabled&&Nm.supportsFiber)try{Ub=Nm.inject(Y_),aa=Nm}catch{}}Ao.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X_;Ao.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tZ(e))throw Error(Ue(200));return x_(i,e,null,t)};Ao.createRoot=function(i,e){if(!tZ(i))throw Error(Ue(299));var t=!1,n="",s=bx;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=q1(i,1,!1,null,null,t,!1,n,s),i[nl]=e.current,ap(i.nodeType===8?i.parentNode:i),new eZ(e)};Ao.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(Ue(188)):(i=Object.keys(i).join(","),Error(Ue(268,i)));return i=_5(e),i=i===null?null:i.stateNode,i};Ao.flushSync=function(i){return fu(i)};Ao.hydrate=function(i,e,t){if(!oG(e))throw Error(Ue(200));return gG(null,i,e,!0,t)};Ao.hydrateRoot=function(i,e,t){if(!tZ(i))throw Error(Ue(405));var n=t!=null&&t.hydratedSources||null,s=!1,r="",o=bx;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=mx(e,null,i,1,t??null,s,!1,r,o),i[nl]=e.current,ap(i),n)for(i=0;i<n.length;i++)t=n[i],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new rG(e)};Ao.render=function(i,e,t){if(!oG(e))throw Error(Ue(200));return gG(null,i,e,!1,t)};Ao.unmountComponentAtNode=function(i){if(!oG(i))throw Error(Ue(40));return i._reactRootContainer?(fu(function(){gG(null,null,i,!1,function(){i._reactRootContainer=null,i[nl]=null})}),!0):!1};Ao.unstable_batchedUpdates=P1;Ao.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!oG(t))throw Error(Ue(200));if(i==null||i._reactInternals===void 0)throw Error(Ue(38));return gG(i,e,t,!1,n)};Ao.version="18.2.0-next-9e3b772b8-20220608";function Gx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Gx)}catch(i){console.error(i)}}Gx(),m5.exports=Ao;var F_=m5.exports,nZ,mR=F_;nZ=mR.createRoot,mR.hydrateRoot;/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const zp="148",LI={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},zI={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},yx=0,j2=1,Bx=2,N_=3,vx=0,aG=1,UA=2,QI=3,ua=0,ao=1,Lc=2,XA=3,el=0,su=1,q2=2,$2=3,ev=4,Zx=5,TI=100,wx=101,Sx=102,tv=103,nv=104,Rx=200,Wx=201,xx=202,Vx=203,iZ=204,sZ=205,Hx=206,Xx=207,Yx=208,Fx=209,Nx=210,Mx=0,Kx=1,Lx=2,Vb=3,zx=4,_x=5,kx=6,Tx=7,_p=0,Ex=1,Dx=2,Wg=0,Jx=1,Ux=2,Px=3,rZ=4,Ox=5,lG=300,rl=301,Vc=302,xd=303,pp=304,Ud=306,Hg=1e3,cs=1001,mu=1002,oi=1003,Vd=1004,M_=1004,ru=1005,K_=1005,Zn=1006,kp=1007,L_=1007,eg=1008,z_=1008,ol=1009,Qx=1010,jx=1011,oZ=1012,qx=1013,Cc=1014,Do=1015,Jo=1016,$x=1017,eV=1018,ou=1020,tV=1021,nV=1022,Zr=1023,iV=1024,sV=1025,Zc=1026,bu=1027,rV=1028,oV=1029,gV=1030,aV=1031,lV=1033,U0=33776,P0=33777,O0=33778,Q0=33779,iv=35840,sv=35841,rv=35842,ov=35843,cV=36196,gv=37492,av=37496,lv=37808,cv=37809,Iv=37810,uv=37811,Cv=37812,dv=37813,hv=37814,Av=37815,pv=37816,fv=37817,mv=37818,bv=37819,Gv=37820,yv=37821,Bv=36492,IV=2200,uV=2201,CV=2202,Gu=2300,gl=2301,j0=2302,jI=2400,qI=2401,fp=2402,cG=2500,gZ=2501,dV=0,IG=1,Hd=2,al=3e3,bn=3001,hV=3200,AV=3201,zc=0,pV=1,__="",vg="srgb",Xd="srgb-linear",k_=0,q0=7680,T_=7681,E_=7682,D_=7683,J_=34055,U_=34056,P_=5386,O_=512,Q_=513,j_=514,q_=515,$_=516,ek=517,tk=518,fV=519,mp=35044,Hb=35048,nk=35040,ik=35045,sk=35049,rk=35041,ok=35046,gk=35050,ak=35042,lk="100",vv="300 es",Xb=1035;class ha{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}const Ys=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bR=1234567;const gu=Math.PI/180,bp=180/Math.PI;function lo(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ys[i&255]+Ys[i>>8&255]+Ys[i>>16&255]+Ys[i>>24&255]+"-"+Ys[e&255]+Ys[e>>8&255]+"-"+Ys[e>>16&15|64]+Ys[e>>24&255]+"-"+Ys[t&63|128]+Ys[t>>8&255]+"-"+Ys[t>>16&255]+Ys[t>>24&255]+Ys[n&255]+Ys[n>>8&255]+Ys[n>>16&255]+Ys[n>>24&255]).toLowerCase()}function Vi(i,e,t){return Math.max(e,Math.min(t,i))}function aZ(i,e){return(i%e+e)%e}function ck(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}function Ik(i,e,t){return i!==e?(t-i)/(e-i):0}function PA(i,e,t){return(1-t)*i+t*e}function uk(i,e,t,n){return PA(i,e,1-Math.exp(-t*n))}function Ck(i,e=1){return e-Math.abs(aZ(i,e*2)-e)}function dk(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function hk(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function Ak(i,e){return i+Math.floor(Math.random()*(e-i+1))}function pk(i,e){return i+Math.random()*(e-i)}function fk(i){return i*(.5-Math.random())}function mk(i){i!==void 0&&(bR=i);let e=bR+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function bk(i){return i*gu}function Gk(i){return i*bp}function Zv(i){return(i&i-1)===0&&i!==0}function mV(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Yb(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function yk(i,e,t,n,s){const r=Math.cos,o=Math.sin,g=r(t/2),a=o(t/2),l=r((e+n)/2),c=o((e+n)/2),C=r((e-n)/2),h=o((e-n)/2),p=r((n-e)/2),m=o((n-e)/2);switch(s){case"XYX":i.set(g*c,a*C,a*h,g*l);break;case"YZY":i.set(a*h,g*c,a*C,g*l);break;case"ZXZ":i.set(a*C,a*h,g*c,g*l);break;case"XZX":i.set(g*c,a*m,a*p,g*l);break;case"YXY":i.set(a*p,g*c,a*m,g*l);break;case"ZYZ":i.set(a*m,a*p,g*c,g*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Qa(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Mn(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}var lZ=Object.freeze({__proto__:null,DEG2RAD:gu,RAD2DEG:bp,generateUUID:lo,clamp:Vi,euclideanModulo:aZ,mapLinear:ck,inverseLerp:Ik,lerp:PA,damp:uk,pingpong:Ck,smoothstep:dk,smootherstep:hk,randInt:Ak,randFloat:pk,randFloatSpread:fk,seededRandom:mk,degToRad:bk,radToDeg:Gk,isPowerOfTwo:Zv,ceilPowerOfTwo:mV,floorPowerOfTwo:Yb,setQuaternionFromProperEuler:yk,normalize:Mn,denormalize:Qa});class Fe{constructor(e=0,t=0){Fe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*s+e.x,this.y=r*s+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class rr{constructor(){rr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,s,r,o,g,a,l){const c=this.elements;return c[0]=e,c[1]=s,c[2]=g,c[3]=t,c[4]=r,c[5]=a,c[6]=n,c[7]=o,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],g=n[3],a=n[6],l=n[1],c=n[4],C=n[7],h=n[2],p=n[5],m=n[8],f=s[0],b=s[3],y=s[6],v=s[1],G=s[4],w=s[7],W=s[2],V=s[5],X=s[8];return r[0]=o*f+g*v+a*W,r[3]=o*b+g*G+a*V,r[6]=o*y+g*w+a*X,r[1]=l*f+c*v+C*W,r[4]=l*b+c*G+C*V,r[7]=l*y+c*w+C*X,r[2]=h*f+p*v+m*W,r[5]=h*b+p*G+m*V,r[8]=h*y+p*w+m*X,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],g=e[5],a=e[6],l=e[7],c=e[8];return t*o*c-t*g*l-n*r*c+n*g*a+s*r*l-s*o*a}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],g=e[5],a=e[6],l=e[7],c=e[8],C=c*o-g*l,h=g*a-c*r,p=l*r-o*a,m=t*C+n*h+s*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const f=1/m;return e[0]=C*f,e[1]=(s*l-c*n)*f,e[2]=(g*n-s*o)*f,e[3]=h*f,e[4]=(c*t-s*a)*f,e[5]=(s*r-g*t)*f,e[6]=p*f,e[7]=(n*a-l*t)*f,e[8]=(o*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,o,g){const a=Math.cos(r),l=Math.sin(r);return this.set(n*a,n*l,-n*(a*o+l*g)+o+e,-s*l,s*a,-s*(-l*o+a*g)+g+t,0,0,1),this}scale(e,t){return this.premultiply(Jy.makeScale(e,t)),this}rotate(e){return this.premultiply(Jy.makeRotation(-e)),this}translate(e,t){return this.premultiply(Jy.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Jy=new rr;function bV(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const Bk={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function nd(i,e){return new Bk[i](e)}function Gp(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function au(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function $0(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const Uy={[vg]:{[Xd]:au},[Xd]:{[vg]:$0}},Fs={legacyMode:!0,get workingColorSpace(){return Xd},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,t){if(this.legacyMode||e===t||!e||!t)return i;if(Uy[e]&&Uy[e][t]!==void 0){const n=Uy[e][t];return i.r=n(i.r),i.g=n(i.g),i.b=n(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}},GV={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ei={r:0,g:0,b:0},pg={h:0,s:0,l:0},Mm={h:0,s:0,l:0};function Py(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}function Km(i,e){return e.r=i.r,e.g=i.g,e.b=i.b,e}class et{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=vg){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Fs.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=Fs.workingColorSpace){return this.r=e,this.g=t,this.b=n,Fs.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=Fs.workingColorSpace){if(e=aZ(e,1),t=Vi(t,0,1),n=Vi(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=Py(o,r,e+1/3),this.g=Py(o,r,e),this.b=Py(o,r,e-1/3)}return Fs.toWorkingColorSpace(this,s),this}setStyle(e,t=vg){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],g=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,Fs.toWorkingColorSpace(this,t),n(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,Fs.toWorkingColorSpace(this,t),n(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g)){const a=parseFloat(r[1])/360,l=parseFloat(r[2])/100,c=parseFloat(r[3])/100;return n(r[4]),this.setHSL(a,l,c,t)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,Fs.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,Fs.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=vg){const n=GV[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=au(e.r),this.g=au(e.g),this.b=au(e.b),this}copyLinearToSRGB(e){return this.r=$0(e.r),this.g=$0(e.g),this.b=$0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=vg){return Fs.fromWorkingColorSpace(Km(this,Ei),e),Vi(Ei.r*255,0,255)<<16^Vi(Ei.g*255,0,255)<<8^Vi(Ei.b*255,0,255)<<0}getHexString(e=vg){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Fs.workingColorSpace){Fs.fromWorkingColorSpace(Km(this,Ei),t);const n=Ei.r,s=Ei.g,r=Ei.b,o=Math.max(n,s,r),g=Math.min(n,s,r);let a,l;const c=(g+o)/2;if(g===o)a=0,l=0;else{const C=o-g;switch(l=c<=.5?C/(o+g):C/(2-o-g),o){case n:a=(s-r)/C+(s<r?6:0);break;case s:a=(r-n)/C+2;break;case r:a=(n-s)/C+4;break}a/=6}return e.h=a,e.s=l,e.l=c,e}getRGB(e,t=Fs.workingColorSpace){return Fs.fromWorkingColorSpace(Km(this,Ei),t),e.r=Ei.r,e.g=Ei.g,e.b=Ei.b,e}getStyle(e=vg){return Fs.fromWorkingColorSpace(Km(this,Ei),e),e!==vg?`color(${e} ${Ei.r} ${Ei.g} ${Ei.b})`:`rgb(${Ei.r*255|0},${Ei.g*255|0},${Ei.b*255|0})`}offsetHSL(e,t,n){return this.getHSL(pg),pg.h+=e,pg.s+=t,pg.l+=n,this.setHSL(pg.h,pg.s,pg.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(pg),e.getHSL(Mm);const n=PA(pg.h,Mm.h,t),s=PA(pg.s,Mm.s,t),r=PA(pg.l,Mm.l,t);return this.setHSL(n,s,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}et.NAMES=GV;let GC;class cZ{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{GC===void 0&&(GC=Gp("canvas")),GC.width=e.width,GC.height=e.height;const n=GC.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=GC}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Gp("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=au(r[o]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(au(t[n]/255)*255):t[n]=au(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class $I{constructor(e=null){this.isSource=!0,this.uuid=lo(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,g=s.length;o<g;o++)s[o].isDataTexture?r.push(Oy(s[o].image)):r.push(Oy(s[o]))}else r=Oy(s);n.url=r}return t||(e.images[this.uuid]=n),n}}function Oy(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?cZ.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let vk=0;class kn extends ha{constructor(e=kn.DEFAULT_IMAGE,t=kn.DEFAULT_MAPPING,n=cs,s=cs,r=Zn,o=eg,g=Zr,a=ol,l=kn.DEFAULT_ANISOTROPY,c=al){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:vk++}),this.uuid=lo(),this.name="",this.source=new $I(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=l,this.format=g,this.internalFormat=null,this.type=a,this.offset=new Fe(0,0),this.repeat=new Fe(1,1),this.center=new Fe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lG)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Hg:e.x=e.x-Math.floor(e.x);break;case cs:e.x=e.x<0?0:1;break;case mu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Hg:e.y=e.y-Math.floor(e.y);break;case cs:e.y=e.y<0?0:1;break;case mu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}kn.DEFAULT_IMAGE=null;kn.DEFAULT_MAPPING=lG;kn.DEFAULT_ANISOTROPY=1;class wn{constructor(e=0,t=0,n=0,s=1){wn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const a=e.elements,l=a[0],c=a[4],C=a[8],h=a[1],p=a[5],m=a[9],f=a[2],b=a[6],y=a[10];if(Math.abs(c-h)<.01&&Math.abs(C-f)<.01&&Math.abs(m-b)<.01){if(Math.abs(c+h)<.1&&Math.abs(C+f)<.1&&Math.abs(m+b)<.1&&Math.abs(l+p+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const G=(l+1)/2,w=(p+1)/2,W=(y+1)/2,V=(c+h)/4,X=(C+f)/4,R=(m+b)/4;return G>w&&G>W?G<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(G),s=V/n,r=X/n):w>W?w<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(w),n=V/s,r=R/s):W<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(W),n=X/r,s=R/r),this.set(n,s,r,t),this}let v=Math.sqrt((b-m)*(b-m)+(C-f)*(C-f)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(b-m)/v,this.y=(C-f)/v,this.z=(h-c)/v,this.w=Math.acos((l+p+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Co extends ha{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new wn(0,0,e,t),this.scissorTest=!1,this.viewport=new wn(0,0,e,t);const s={width:e,height:t,depth:1};this.texture=new kn(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Zn,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new $I(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Tp extends kn{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=oi,this.minFilter=oi,this.wrapR=cs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Zk extends Co{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Tp(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class uG extends kn{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=oi,this.minFilter=oi,this.wrapR=cs,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class wk extends Co{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new uG(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Sk extends Co{constructor(e=1,t=1,n=1,s={}){super(e,t,s),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,r=this.texture.length;s<r;s++)this.texture[s].image.width=e,this.texture[s].image.height=t,this.texture[s].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}let jn=class{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,o,g){let a=n[s+0],l=n[s+1],c=n[s+2],C=n[s+3];const h=r[o+0],p=r[o+1],m=r[o+2],f=r[o+3];if(g===0){e[t+0]=a,e[t+1]=l,e[t+2]=c,e[t+3]=C;return}if(g===1){e[t+0]=h,e[t+1]=p,e[t+2]=m,e[t+3]=f;return}if(C!==f||a!==h||l!==p||c!==m){let b=1-g;const y=a*h+l*p+c*m+C*f,v=y>=0?1:-1,G=1-y*y;if(G>Number.EPSILON){const W=Math.sqrt(G),V=Math.atan2(W,y*v);b=Math.sin(b*V)/W,g=Math.sin(g*V)/W}const w=g*v;if(a=a*b+h*w,l=l*b+p*w,c=c*b+m*w,C=C*b+f*w,b===1-g){const W=1/Math.sqrt(a*a+l*l+c*c+C*C);a*=W,l*=W,c*=W,C*=W}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=C}static multiplyQuaternionsFlat(e,t,n,s,r,o){const g=n[s],a=n[s+1],l=n[s+2],c=n[s+3],C=r[o],h=r[o+1],p=r[o+2],m=r[o+3];return e[t]=g*m+c*C+a*p-l*h,e[t+1]=a*m+c*h+l*C-g*p,e[t+2]=l*m+c*p+g*h-a*C,e[t+3]=c*m-g*C-a*h-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,s=e._y,r=e._z,o=e._order,g=Math.cos,a=Math.sin,l=g(n/2),c=g(s/2),C=g(r/2),h=a(n/2),p=a(s/2),m=a(r/2);switch(o){case"XYZ":this._x=h*c*C+l*p*m,this._y=l*p*C-h*c*m,this._z=l*c*m+h*p*C,this._w=l*c*C-h*p*m;break;case"YXZ":this._x=h*c*C+l*p*m,this._y=l*p*C-h*c*m,this._z=l*c*m-h*p*C,this._w=l*c*C+h*p*m;break;case"ZXY":this._x=h*c*C-l*p*m,this._y=l*p*C+h*c*m,this._z=l*c*m+h*p*C,this._w=l*c*C-h*p*m;break;case"ZYX":this._x=h*c*C-l*p*m,this._y=l*p*C+h*c*m,this._z=l*c*m-h*p*C,this._w=l*c*C+h*p*m;break;case"YZX":this._x=h*c*C+l*p*m,this._y=l*p*C+h*c*m,this._z=l*c*m-h*p*C,this._w=l*c*C-h*p*m;break;case"XZY":this._x=h*c*C-l*p*m,this._y=l*p*C-h*c*m,this._z=l*c*m+h*p*C,this._w=l*c*C+h*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],o=t[1],g=t[5],a=t[9],l=t[2],c=t[6],C=t[10],h=n+g+C;if(h>0){const p=.5/Math.sqrt(h+1);this._w=.25/p,this._x=(c-a)*p,this._y=(r-l)*p,this._z=(o-s)*p}else if(n>g&&n>C){const p=2*Math.sqrt(1+n-g-C);this._w=(c-a)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+l)/p}else if(g>C){const p=2*Math.sqrt(1+g-n-C);this._w=(r-l)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(a+c)/p}else{const p=2*Math.sqrt(1+C-n-g);this._w=(o-s)/p,this._x=(r+l)/p,this._y=(a+c)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vi(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,o=e._w,g=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+o*g+s*l-r*a,this._y=s*c+o*a+r*g-n*l,this._z=r*c+o*l+n*a-s*g,this._w=o*c-n*g-s*a-r*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,r=this._z,o=this._w;let g=o*e._w+n*e._x+s*e._y+r*e._z;if(g<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,g=-g):this.copy(e),g>=1)return this._w=o,this._x=n,this._y=s,this._z=r,this;const a=1-g*g;if(a<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*n+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,g),C=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=o*C+this._w*h,this._x=n*C+this._x*h,this._y=s*C+this._y*h,this._z=r*C+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),n*Math.sin(r),n*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class E{constructor(e=0,t=0,n=0){E.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(GR.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(GR.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,g=e.z,a=e.w,l=a*t+o*s-g*n,c=a*n+g*t-r*s,C=a*s+r*n-o*t,h=-r*t-o*n-g*s;return this.x=l*a+h*-r+c*-g-C*-o,this.y=c*a+h*-o+C*-r-l*-g,this.z=C*a+h*-g+l*-o-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,o=t.x,g=t.y,a=t.z;return this.x=s*a-r*g,this.y=r*o-n*a,this.z=n*g-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Qy.copy(this).projectOnVector(e),this.sub(Qy)}reflect(e){return this.sub(Qy.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vi(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Qy=new E,GR=new jn;class Cl{constructor(e=new E(1/0,1/0,1/0),t=new E(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,s=1/0,r=-1/0,o=-1/0,g=-1/0;for(let a=0,l=e.length;a<l;a+=3){const c=e[a],C=e[a+1],h=e[a+2];c<t&&(t=c),C<n&&(n=C),h<s&&(s=h),c>r&&(r=c),C>o&&(o=C),h>g&&(g=h)}return this.min.set(t,n,s),this.max.set(r,o,g),this}setFromBufferAttribute(e){let t=1/0,n=1/0,s=1/0,r=-1/0,o=-1/0,g=-1/0;for(let a=0,l=e.count;a<l;a++){const c=e.getX(a),C=e.getY(a),h=e.getZ(a);c<t&&(t=c),C<n&&(n=C),h<s&&(s=h),c>r&&(r=c),C>o&&(o=C),h>g&&(g=h)}return this.min.set(t,n,s),this.max.set(r,o,g),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=wI.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const r=n.attributes.position;for(let o=0,g=r.count;o<g;o++)wI.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(wI)}else n.boundingBox===null&&n.computeBoundingBox(),jy.copy(n.boundingBox),jy.applyMatrix4(e.matrixWorld),this.union(jy);const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,wI),wI.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(sA),Lm.subVectors(this.max,sA),yC.subVectors(e.a,sA),BC.subVectors(e.b,sA),vC.subVectors(e.c,sA),Ql.subVectors(BC,yC),jl.subVectors(vC,BC),SI.subVectors(yC,vC);let t=[0,-Ql.z,Ql.y,0,-jl.z,jl.y,0,-SI.z,SI.y,Ql.z,0,-Ql.x,jl.z,0,-jl.x,SI.z,0,-SI.x,-Ql.y,Ql.x,0,-jl.y,jl.x,0,-SI.y,SI.x,0];return!qy(t,yC,BC,vC,Lm)||(t=[1,0,0,0,1,0,0,0,1],!qy(t,yC,BC,vC,Lm))?!1:(zm.crossVectors(Ql,jl),t=[zm.x,zm.y,zm.z],qy(t,yC,BC,vC,Lm))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return wI.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(wI).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Fa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Fa=[new E,new E,new E,new E,new E,new E,new E,new E],wI=new E,jy=new Cl,yC=new E,BC=new E,vC=new E,Ql=new E,jl=new E,SI=new E,sA=new E,Lm=new E,zm=new E,RI=new E;function qy(i,e,t,n,s){for(let r=0,o=i.length-3;r<=o;r+=3){RI.fromArray(i,r);const g=s.x*Math.abs(RI.x)+s.y*Math.abs(RI.y)+s.z*Math.abs(RI.z),a=e.dot(RI),l=t.dot(RI),c=n.dot(RI);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>g)return!1}return!0}const Rk=new Cl,rA=new E,$y=new E;class dl{constructor(e=new E,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Rk.setFromPoints(e).getCenter(n);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;rA.subVectors(e,this.center);const t=rA.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(rA,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):($y.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(rA.copy(e.center).add($y)),this.expandByPoint(rA.copy(e.center).sub($y))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Na=new E,eB=new E,_m=new E,ql=new E,tB=new E,km=new E,nB=new E;let Ep=class{constructor(e=new E,t=new E(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Na)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Na.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Na.copy(this.direction).multiplyScalar(t).add(this.origin),Na.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){eB.copy(e).add(t).multiplyScalar(.5),_m.copy(t).sub(e).normalize(),ql.copy(this.origin).sub(eB);const r=e.distanceTo(t)*.5,o=-this.direction.dot(_m),g=ql.dot(this.direction),a=-ql.dot(_m),l=ql.lengthSq(),c=Math.abs(1-o*o);let C,h,p,m;if(c>0)if(C=o*a-g,h=o*g-a,m=r*c,C>=0)if(h>=-m)if(h<=m){const f=1/c;C*=f,h*=f,p=C*(C+o*h+2*g)+h*(o*C+h+2*a)+l}else h=r,C=Math.max(0,-(o*h+g)),p=-C*C+h*(h+2*a)+l;else h=-r,C=Math.max(0,-(o*h+g)),p=-C*C+h*(h+2*a)+l;else h<=-m?(C=Math.max(0,-(-o*r+g)),h=C>0?-r:Math.min(Math.max(-r,-a),r),p=-C*C+h*(h+2*a)+l):h<=m?(C=0,h=Math.min(Math.max(-r,-a),r),p=h*(h+2*a)+l):(C=Math.max(0,-(o*r+g)),h=C>0?r:Math.min(Math.max(-r,-a),r),p=-C*C+h*(h+2*a)+l);else h=o>0?-r:r,C=Math.max(0,-(o*h+g)),p=-C*C+h*(h+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(C).add(this.origin),s&&s.copy(_m).multiplyScalar(h).add(eB),p}intersectSphere(e,t){Na.subVectors(e.center,this.origin);const n=Na.dot(this.direction),s=Na.dot(Na)-n*n,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),g=n-o,a=n+o;return g<0&&a<0?null:g<0?this.at(a,t):this.at(g,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,o,g,a;const l=1/this.direction.x,c=1/this.direction.y,C=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,s=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,s=(e.min.x-h.x)*l),c>=0?(r=(e.min.y-h.y)*c,o=(e.max.y-h.y)*c):(r=(e.max.y-h.y)*c,o=(e.min.y-h.y)*c),n>o||r>s||((r>n||isNaN(n))&&(n=r),(o<s||isNaN(s))&&(s=o),C>=0?(g=(e.min.z-h.z)*C,a=(e.max.z-h.z)*C):(g=(e.max.z-h.z)*C,a=(e.min.z-h.z)*C),n>a||g>s)||((g>n||n!==n)&&(n=g),(a<s||s!==s)&&(s=a),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,Na)!==null}intersectTriangle(e,t,n,s,r){tB.subVectors(t,e),km.subVectors(n,e),nB.crossVectors(tB,km);let o=this.direction.dot(nB),g;if(o>0){if(s)return null;g=1}else if(o<0)g=-1,o=-o;else return null;ql.subVectors(this.origin,e);const a=g*this.direction.dot(km.crossVectors(ql,km));if(a<0)return null;const l=g*this.direction.dot(tB.cross(ql));if(l<0||a+l>o)return null;const c=-g*ql.dot(nB);return c<0?null:this.at(c/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class mt{constructor(){mt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,s,r,o,g,a,l,c,C,h,p,m,f,b){const y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=s,y[1]=r,y[5]=o,y[9]=g,y[13]=a,y[2]=l,y[6]=c,y[10]=C,y[14]=h,y[3]=p,y[7]=m,y[11]=f,y[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new mt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/ZC.setFromMatrixColumn(e,0).length(),r=1/ZC.setFromMatrixColumn(e,1).length(),o=1/ZC.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,o=Math.cos(n),g=Math.sin(n),a=Math.cos(s),l=Math.sin(s),c=Math.cos(r),C=Math.sin(r);if(e.order==="XYZ"){const h=o*c,p=o*C,m=g*c,f=g*C;t[0]=a*c,t[4]=-a*C,t[8]=l,t[1]=p+m*l,t[5]=h-f*l,t[9]=-g*a,t[2]=f-h*l,t[6]=m+p*l,t[10]=o*a}else if(e.order==="YXZ"){const h=a*c,p=a*C,m=l*c,f=l*C;t[0]=h+f*g,t[4]=m*g-p,t[8]=o*l,t[1]=o*C,t[5]=o*c,t[9]=-g,t[2]=p*g-m,t[6]=f+h*g,t[10]=o*a}else if(e.order==="ZXY"){const h=a*c,p=a*C,m=l*c,f=l*C;t[0]=h-f*g,t[4]=-o*C,t[8]=m+p*g,t[1]=p+m*g,t[5]=o*c,t[9]=f-h*g,t[2]=-o*l,t[6]=g,t[10]=o*a}else if(e.order==="ZYX"){const h=o*c,p=o*C,m=g*c,f=g*C;t[0]=a*c,t[4]=m*l-p,t[8]=h*l+f,t[1]=a*C,t[5]=f*l+h,t[9]=p*l-m,t[2]=-l,t[6]=g*a,t[10]=o*a}else if(e.order==="YZX"){const h=o*a,p=o*l,m=g*a,f=g*l;t[0]=a*c,t[4]=f-h*C,t[8]=m*C+p,t[1]=C,t[5]=o*c,t[9]=-g*c,t[2]=-l*c,t[6]=p*C+m,t[10]=h-f*C}else if(e.order==="XZY"){const h=o*a,p=o*l,m=g*a,f=g*l;t[0]=a*c,t[4]=-C,t[8]=l*c,t[1]=h*C+f,t[5]=o*c,t[9]=p*C-m,t[2]=m*C-p,t[6]=g*c,t[10]=f*C+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Wk,e,xk)}lookAt(e,t,n){const s=this.elements;return $r.subVectors(e,t),$r.lengthSq()===0&&($r.z=1),$r.normalize(),$l.crossVectors(n,$r),$l.lengthSq()===0&&(Math.abs(n.z)===1?$r.x+=1e-4:$r.z+=1e-4,$r.normalize(),$l.crossVectors(n,$r)),$l.normalize(),Tm.crossVectors($r,$l),s[0]=$l.x,s[4]=Tm.x,s[8]=$r.x,s[1]=$l.y,s[5]=Tm.y,s[9]=$r.y,s[2]=$l.z,s[6]=Tm.z,s[10]=$r.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],g=n[4],a=n[8],l=n[12],c=n[1],C=n[5],h=n[9],p=n[13],m=n[2],f=n[6],b=n[10],y=n[14],v=n[3],G=n[7],w=n[11],W=n[15],V=s[0],X=s[4],R=s[8],Y=s[12],M=s[1],L=s[5],re=s[9],j=s[13],$=s[2],ie=s[6],he=s[10],le=s[14],_=s[3],ne=s[7],te=s[11],q=s[15];return r[0]=o*V+g*M+a*$+l*_,r[4]=o*X+g*L+a*ie+l*ne,r[8]=o*R+g*re+a*he+l*te,r[12]=o*Y+g*j+a*le+l*q,r[1]=c*V+C*M+h*$+p*_,r[5]=c*X+C*L+h*ie+p*ne,r[9]=c*R+C*re+h*he+p*te,r[13]=c*Y+C*j+h*le+p*q,r[2]=m*V+f*M+b*$+y*_,r[6]=m*X+f*L+b*ie+y*ne,r[10]=m*R+f*re+b*he+y*te,r[14]=m*Y+f*j+b*le+y*q,r[3]=v*V+G*M+w*$+W*_,r[7]=v*X+G*L+w*ie+W*ne,r[11]=v*R+G*re+w*he+W*te,r[15]=v*Y+G*j+w*le+W*q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],o=e[1],g=e[5],a=e[9],l=e[13],c=e[2],C=e[6],h=e[10],p=e[14],m=e[3],f=e[7],b=e[11],y=e[15];return m*(+r*a*C-s*l*C-r*g*h+n*l*h+s*g*p-n*a*p)+f*(+t*a*p-t*l*h+r*o*h-s*o*p+s*l*c-r*a*c)+b*(+t*l*C-t*g*p-r*o*C+n*o*p+r*g*c-n*l*c)+y*(-s*g*c-t*a*C+t*g*h+s*o*C-n*o*h+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],g=e[5],a=e[6],l=e[7],c=e[8],C=e[9],h=e[10],p=e[11],m=e[12],f=e[13],b=e[14],y=e[15],v=C*b*l-f*h*l+f*a*p-g*b*p-C*a*y+g*h*y,G=m*h*l-c*b*l-m*a*p+o*b*p+c*a*y-o*h*y,w=c*f*l-m*C*l+m*g*p-o*f*p-c*g*y+o*C*y,W=m*C*a-c*f*a-m*g*h+o*f*h+c*g*b-o*C*b,V=t*v+n*G+s*w+r*W;if(V===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const X=1/V;return e[0]=v*X,e[1]=(f*h*r-C*b*r-f*s*p+n*b*p+C*s*y-n*h*y)*X,e[2]=(g*b*r-f*a*r+f*s*l-n*b*l-g*s*y+n*a*y)*X,e[3]=(C*a*r-g*h*r-C*s*l+n*h*l+g*s*p-n*a*p)*X,e[4]=G*X,e[5]=(c*b*r-m*h*r+m*s*p-t*b*p-c*s*y+t*h*y)*X,e[6]=(m*a*r-o*b*r-m*s*l+t*b*l+o*s*y-t*a*y)*X,e[7]=(o*h*r-c*a*r+c*s*l-t*h*l-o*s*p+t*a*p)*X,e[8]=w*X,e[9]=(m*C*r-c*f*r-m*n*p+t*f*p+c*n*y-t*C*y)*X,e[10]=(o*f*r-m*g*r+m*n*l-t*f*l-o*n*y+t*g*y)*X,e[11]=(c*g*r-o*C*r-c*n*l+t*C*l+o*n*p-t*g*p)*X,e[12]=W*X,e[13]=(c*f*s-m*C*s+m*n*h-t*f*h-c*n*b+t*C*b)*X,e[14]=(m*g*s-o*f*s-m*n*a+t*f*a+o*n*b-t*g*b)*X,e[15]=(o*C*s-c*g*s+c*n*a-t*C*a-o*n*h+t*g*h)*X,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,o=e.x,g=e.y,a=e.z,l=r*o,c=r*g;return this.set(l*o+n,l*g-s*a,l*a+s*g,0,l*g+s*a,c*g+n,c*a-s*o,0,l*a-s*g,c*a+s*o,r*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,o){return this.set(1,n,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,o=t._y,g=t._z,a=t._w,l=r+r,c=o+o,C=g+g,h=r*l,p=r*c,m=r*C,f=o*c,b=o*C,y=g*C,v=a*l,G=a*c,w=a*C,W=n.x,V=n.y,X=n.z;return s[0]=(1-(f+y))*W,s[1]=(p+w)*W,s[2]=(m-G)*W,s[3]=0,s[4]=(p-w)*V,s[5]=(1-(h+y))*V,s[6]=(b+v)*V,s[7]=0,s[8]=(m+G)*X,s[9]=(b-v)*X,s[10]=(1-(h+f))*X,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=ZC.set(s[0],s[1],s[2]).length();const o=ZC.set(s[4],s[5],s[6]).length(),g=ZC.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],fg.copy(this);const l=1/r,c=1/o,C=1/g;return fg.elements[0]*=l,fg.elements[1]*=l,fg.elements[2]*=l,fg.elements[4]*=c,fg.elements[5]*=c,fg.elements[6]*=c,fg.elements[8]*=C,fg.elements[9]*=C,fg.elements[10]*=C,t.setFromRotationMatrix(fg),n.x=r,n.y=o,n.z=g,this}makePerspective(e,t,n,s,r,o){const g=this.elements,a=2*r/(t-e),l=2*r/(n-s),c=(t+e)/(t-e),C=(n+s)/(n-s),h=-(o+r)/(o-r),p=-2*o*r/(o-r);return g[0]=a,g[4]=0,g[8]=c,g[12]=0,g[1]=0,g[5]=l,g[9]=C,g[13]=0,g[2]=0,g[6]=0,g[10]=h,g[14]=p,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this}makeOrthographic(e,t,n,s,r,o){const g=this.elements,a=1/(t-e),l=1/(n-s),c=1/(o-r),C=(t+e)*a,h=(n+s)*l,p=(o+r)*c;return g[0]=2*a,g[4]=0,g[8]=0,g[12]=-C,g[1]=0,g[5]=2*l,g[9]=0,g[13]=-h,g[2]=0,g[6]=0,g[10]=-2*c,g[14]=-p,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const ZC=new E,fg=new mt,Wk=new E(0,0,0),xk=new E(1,1,1),$l=new E,Tm=new E,$r=new E,yR=new mt,BR=new jn;class Ru{constructor(e=0,t=0,n=0,s=Ru.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],o=s[4],g=s[8],a=s[1],l=s[5],c=s[9],C=s[2],h=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(Vi(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Vi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(g,p),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-C,r),this._z=0);break;case"ZXY":this._x=Math.asin(Vi(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-C,p),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-Vi(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Vi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-C,r)):(this._x=0,this._y=Math.atan2(g,p));break;case"XZY":this._z=Math.asin(-Vi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(g,r)):(this._x=Math.atan2(-c,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return yR.makeRotationFromQuaternion(e),this.setFromRotationMatrix(yR,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return BR.setFromEuler(this),this.setFromQuaternion(BR,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Ru.DefaultOrder="XYZ";Ru.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class lu{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Vk=0;const vR=new E,wC=new jn,Ma=new mt,Em=new E,oA=new E,Hk=new E,Xk=new jn,ZR=new E(1,0,0),wR=new E(0,1,0),SR=new E(0,0,1),Yk={type:"added"},RR={type:"removed"};class en extends ha{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vk++}),this.uuid=lo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=en.DefaultUp.clone();const e=new E,t=new Ru,n=new jn,s=new E(1,1,1);function r(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new mt},normalMatrix:{value:new rr}}),this.matrix=new mt,this.matrixWorld=new mt,this.matrixAutoUpdate=en.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=en.DefaultMatrixWorldAutoUpdate,this.layers=new lu,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return wC.setFromAxisAngle(e,t),this.quaternion.multiply(wC),this}rotateOnWorldAxis(e,t){return wC.setFromAxisAngle(e,t),this.quaternion.premultiply(wC),this}rotateX(e){return this.rotateOnAxis(ZR,e)}rotateY(e){return this.rotateOnAxis(wR,e)}rotateZ(e){return this.rotateOnAxis(SR,e)}translateOnAxis(e,t){return vR.copy(e).applyQuaternion(this.quaternion),this.position.add(vR.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(ZR,e)}translateY(e){return this.translateOnAxis(wR,e)}translateZ(e){return this.translateOnAxis(SR,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ma.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Em.copy(e):Em.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),oA.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ma.lookAt(oA,Em,this.up):Ma.lookAt(Em,oA,this.up),this.quaternion.setFromRotationMatrix(Ma),s&&(Ma.extractRotation(s.matrixWorld),wC.setFromRotationMatrix(Ma),this.quaternion.premultiply(wC.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Yk)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(RR)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(RR)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ma.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ma.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ma),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let s=0,r=this.children.length;s<r;s++){const o=this.children[s].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oA,e,Hk),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(oA,Xk,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++){const r=t[n];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++){const g=s[r];g.matrixWorldAutoUpdate===!0&&g.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(g,a){return g[a.uuid]===void 0&&(g[a.uuid]=a.toJSON(e)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const g=this.geometry.parameters;if(g!==void 0&&g.shapes!==void 0){const a=g.shapes;if(Array.isArray(a))for(let l=0,c=a.length;l<c;l++){const C=a[l];r(e.shapes,C)}else r(e.shapes,a)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const g=[];for(let a=0,l=this.material.length;a<l;a++)g.push(r(e.materials,this.material[a]));s.material=g}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let g=0;g<this.children.length;g++)s.children.push(this.children[g].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let g=0;g<this.animations.length;g++){const a=this.animations[g];s.animations.push(r(e.animations,a))}}if(t){const g=o(e.geometries),a=o(e.materials),l=o(e.textures),c=o(e.images),C=o(e.shapes),h=o(e.skeletons),p=o(e.animations),m=o(e.nodes);g.length>0&&(n.geometries=g),a.length>0&&(n.materials=a),l.length>0&&(n.textures=l),c.length>0&&(n.images=c),C.length>0&&(n.shapes=C),h.length>0&&(n.skeletons=h),p.length>0&&(n.animations=p),m.length>0&&(n.nodes=m)}return n.object=s,n;function o(g){const a=[];for(const l in g){const c=g[l];delete c.metadata,a.push(c)}return a}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}en.DefaultUp=new E(0,1,0);en.DefaultMatrixAutoUpdate=!0;en.DefaultMatrixWorldAutoUpdate=!0;const mg=new E,Ka=new E,iB=new E,La=new E,SC=new E,RC=new E,WR=new E,sB=new E,rB=new E,oB=new E;class To{constructor(e=new E,t=new E,n=new E){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),mg.subVectors(e,t),s.cross(mg);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){mg.subVectors(s,t),Ka.subVectors(n,t),iB.subVectors(e,t);const o=mg.dot(mg),g=mg.dot(Ka),a=mg.dot(iB),l=Ka.dot(Ka),c=Ka.dot(iB),C=o*l-g*g;if(C===0)return r.set(-2,-1,-1);const h=1/C,p=(l*a-g*c)*h,m=(o*c-g*a)*h;return r.set(1-p-m,m,p)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,La),La.x>=0&&La.y>=0&&La.x+La.y<=1}static getUV(e,t,n,s,r,o,g,a){return this.getBarycoord(e,t,n,s,La),a.set(0,0),a.addScaledVector(r,La.x),a.addScaledVector(o,La.y),a.addScaledVector(g,La.z),a}static isFrontFacing(e,t,n,s){return mg.subVectors(n,t),Ka.subVectors(e,t),mg.cross(Ka).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return mg.subVectors(this.c,this.b),Ka.subVectors(this.a,this.b),mg.cross(Ka).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return To.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return To.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,s,r){return To.getUV(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return To.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return To.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let o,g;SC.subVectors(s,n),RC.subVectors(r,n),sB.subVectors(e,n);const a=SC.dot(sB),l=RC.dot(sB);if(a<=0&&l<=0)return t.copy(n);rB.subVectors(e,s);const c=SC.dot(rB),C=RC.dot(rB);if(c>=0&&C<=c)return t.copy(s);const h=a*C-c*l;if(h<=0&&a>=0&&c<=0)return o=a/(a-c),t.copy(n).addScaledVector(SC,o);oB.subVectors(e,r);const p=SC.dot(oB),m=RC.dot(oB);if(m>=0&&p<=m)return t.copy(r);const f=p*l-a*m;if(f<=0&&l>=0&&m<=0)return g=l/(l-m),t.copy(n).addScaledVector(RC,g);const b=c*m-p*C;if(b<=0&&C-c>=0&&p-m>=0)return WR.subVectors(r,s),g=(C-c)/(C-c+(p-m)),t.copy(s).addScaledVector(WR,g);const y=1/(b+f+h);return o=f*y,g=h*y,t.copy(n).addScaledVector(SC,o).addScaledVector(RC,g)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Fk=0;class qn extends ha{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Fk++}),this.uuid=lo(),this.name="",this.type="Material",this.blending=su,this.side=ua,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=iZ,this.blendDst=sZ,this.blendEquation=TI,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Vb,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fV,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=q0,this.stencilZFail=q0,this.stencilZPass=q0,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const s=this[t];if(s===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==su&&(n.blending=this.blending),this.side!==ua&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(r){const o=[];for(const g in r){const a=r[g];delete a.metadata,o.push(a)}return o}if(t){const r=s(e.textures),o=s(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Oi extends qn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_p,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Mi=new E,Dm=new Fe;class on{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=mp,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Dm.fromBufferAttribute(this,t),Dm.applyMatrix3(e),this.setXY(t,Dm.x,Dm.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Mi.fromBufferAttribute(this,t),Mi.applyMatrix3(e),this.setXYZ(t,Mi.x,Mi.y,Mi.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Mi.fromBufferAttribute(this,t),Mi.applyMatrix4(e),this.setXYZ(t,Mi.x,Mi.y,Mi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Mi.fromBufferAttribute(this,t),Mi.applyNormalMatrix(e),this.setXYZ(t,Mi.x,Mi.y,Mi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Mi.fromBufferAttribute(this,t),Mi.transformDirection(e),this.setXYZ(t,Mi.x,Mi.y,Mi.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Qa(t,this.array)),t}setX(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Qa(t,this.array)),t}setY(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Qa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Qa(t,this.array)),t}setW(e,t){return this.normalized&&(t=Mn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array),r=Mn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==mp&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Nk extends on{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Mk extends on{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Kk extends on{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Lk extends on{constructor(e,t,n){super(new Int16Array(e),t,n)}}class IZ extends on{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class zk extends on{constructor(e,t,n){super(new Int32Array(e),t,n)}}class uZ extends on{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class _k extends on{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}}class pt extends on{constructor(e,t,n){super(new Float32Array(e),t,n)}}class kk extends on{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Tk=0;const Fo=new mt,gB=new en,WC=new E,eo=new Cl,gA=new Cl,as=new E;class zt extends ha{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Tk++}),this.uuid=lo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(bV(e)?uZ:IZ)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new rr().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Fo.makeRotationFromQuaternion(e),this.applyMatrix4(Fo),this}rotateX(e){return Fo.makeRotationX(e),this.applyMatrix4(Fo),this}rotateY(e){return Fo.makeRotationY(e),this.applyMatrix4(Fo),this}rotateZ(e){return Fo.makeRotationZ(e),this.applyMatrix4(Fo),this}translate(e,t,n){return Fo.makeTranslation(e,t,n),this.applyMatrix4(Fo),this}scale(e,t,n){return Fo.makeScale(e,t,n),this.applyMatrix4(Fo),this}lookAt(e){return gB.lookAt(e),gB.updateMatrix(),this.applyMatrix4(gB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(WC).negate(),this.translate(WC.x,WC.y,WC.z),this}setFromPoints(e){const t=[];for(let n=0,s=e.length;n<s;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new pt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Cl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new E(-1/0,-1/0,-1/0),new E(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];eo.setFromBufferAttribute(r),this.morphTargetsRelative?(as.addVectors(this.boundingBox.min,eo.min),this.boundingBox.expandByPoint(as),as.addVectors(this.boundingBox.max,eo.max),this.boundingBox.expandByPoint(as)):(this.boundingBox.expandByPoint(eo.min),this.boundingBox.expandByPoint(eo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new dl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new E,1/0);return}if(e){const n=this.boundingSphere.center;if(eo.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const g=t[r];gA.setFromBufferAttribute(g),this.morphTargetsRelative?(as.addVectors(eo.min,gA.min),eo.expandByPoint(as),as.addVectors(eo.max,gA.max),eo.expandByPoint(as)):(eo.expandByPoint(gA.min),eo.expandByPoint(gA.max))}eo.getCenter(n);let s=0;for(let r=0,o=e.count;r<o;r++)as.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared(as));if(t)for(let r=0,o=t.length;r<o;r++){const g=t[r],a=this.morphTargetsRelative;for(let l=0,c=g.count;l<c;l++)as.fromBufferAttribute(g,l),a&&(WC.fromBufferAttribute(e,l),as.add(WC)),s=Math.max(s,n.distanceToSquared(as))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,s=t.position.array,r=t.normal.array,o=t.uv.array,g=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new on(new Float32Array(4*g),4));const a=this.getAttribute("tangent").array,l=[],c=[];for(let M=0;M<g;M++)l[M]=new E,c[M]=new E;const C=new E,h=new E,p=new E,m=new Fe,f=new Fe,b=new Fe,y=new E,v=new E;function G(M,L,re){C.fromArray(s,M*3),h.fromArray(s,L*3),p.fromArray(s,re*3),m.fromArray(o,M*2),f.fromArray(o,L*2),b.fromArray(o,re*2),h.sub(C),p.sub(C),f.sub(m),b.sub(m);const j=1/(f.x*b.y-b.x*f.y);isFinite(j)&&(y.copy(h).multiplyScalar(b.y).addScaledVector(p,-f.y).multiplyScalar(j),v.copy(p).multiplyScalar(f.x).addScaledVector(h,-b.x).multiplyScalar(j),l[M].add(y),l[L].add(y),l[re].add(y),c[M].add(v),c[L].add(v),c[re].add(v))}let w=this.groups;w.length===0&&(w=[{start:0,count:n.length}]);for(let M=0,L=w.length;M<L;++M){const re=w[M],j=re.start,$=re.count;for(let ie=j,he=j+$;ie<he;ie+=3)G(n[ie+0],n[ie+1],n[ie+2])}const W=new E,V=new E,X=new E,R=new E;function Y(M){X.fromArray(r,M*3),R.copy(X);const L=l[M];W.copy(L),W.sub(X.multiplyScalar(X.dot(L))).normalize(),V.crossVectors(R,L);const j=V.dot(c[M])<0?-1:1;a[M*4]=W.x,a[M*4+1]=W.y,a[M*4+2]=W.z,a[M*4+3]=j}for(let M=0,L=w.length;M<L;++M){const re=w[M],j=re.start,$=re.count;for(let ie=j,he=j+$;ie<he;ie+=3)Y(n[ie+0]),Y(n[ie+1]),Y(n[ie+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new on(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,p=n.count;h<p;h++)n.setXYZ(h,0,0,0);const s=new E,r=new E,o=new E,g=new E,a=new E,l=new E,c=new E,C=new E;if(e)for(let h=0,p=e.count;h<p;h+=3){const m=e.getX(h+0),f=e.getX(h+1),b=e.getX(h+2);s.fromBufferAttribute(t,m),r.fromBufferAttribute(t,f),o.fromBufferAttribute(t,b),c.subVectors(o,r),C.subVectors(s,r),c.cross(C),g.fromBufferAttribute(n,m),a.fromBufferAttribute(n,f),l.fromBufferAttribute(n,b),g.add(c),a.add(c),l.add(c),n.setXYZ(m,g.x,g.y,g.z),n.setXYZ(f,a.x,a.y,a.z),n.setXYZ(b,l.x,l.y,l.z)}else for(let h=0,p=t.count;h<p;h+=3)s.fromBufferAttribute(t,h+0),r.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),c.subVectors(o,r),C.subVectors(s,r),c.cross(C),n.setXYZ(h+0,c.x,c.y,c.z),n.setXYZ(h+1,c.x,c.y,c.z),n.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)as.fromBufferAttribute(e,t),as.normalize(),e.setXYZ(t,as.x,as.y,as.z)}toNonIndexed(){function e(g,a){const l=g.array,c=g.itemSize,C=g.normalized,h=new l.constructor(a.length*c);let p=0,m=0;for(let f=0,b=a.length;f<b;f++){g.isInterleavedBufferAttribute?p=a[f]*g.data.stride+g.offset:p=a[f]*c;for(let y=0;y<c;y++)h[m++]=l[p++]}return new on(h,c,C)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new zt,n=this.index.array,s=this.attributes;for(const g in s){const a=s[g],l=e(a,n);t.setAttribute(g,l)}const r=this.morphAttributes;for(const g in r){const a=[],l=r[g];for(let c=0,C=l.length;c<C;c++){const h=l[c],p=e(h,n);a.push(p)}t.morphAttributes[g]=a}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let g=0,a=o.length;g<a;g++){const l=o[g];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const a=this.parameters;for(const l in a)a[l]!==void 0&&(e[l]=a[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const l=n[a];e.data.attributes[a]=l.toJSON(e.data)}const s={};let r=!1;for(const a in this.morphAttributes){const l=this.morphAttributes[a],c=[];for(let C=0,h=l.length;C<h;C++){const p=l[C];c.push(p.toJSON(e.data))}c.length>0&&(s[a]=c,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const g=this.boundingSphere;return g!==null&&(e.data.boundingSphere={center:g.center.toArray(),radius:g.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const s=e.attributes;for(const l in s){const c=s[l];this.setAttribute(l,c.clone(t))}const r=e.morphAttributes;for(const l in r){const c=[],C=r[l];for(let h=0,p=C.length;h<p;h++)c.push(C[h].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let l=0,c=o.length;l<c;l++){const C=o[l];this.addGroup(C.start,C.count,C.materialIndex)}const g=e.boundingBox;g!==null&&(this.boundingBox=g.clone());const a=e.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const xR=new mt,xC=new Ep,aB=new dl,aA=new E,lA=new E,cA=new E,lB=new E,Jm=new E,Um=new Fe,Pm=new Fe,Om=new Fe,cB=new E,Qm=new E;class mi extends en{constructor(e=new zt,t=new Oi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const g=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=r}}}}getVertexPosition(e,t){const n=this.geometry,s=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(s,e);const g=this.morphTargetInfluences;if(r&&g){Jm.set(0,0,0);for(let a=0,l=r.length;a<l;a++){const c=g[a],C=r[a];c!==0&&(lB.fromBufferAttribute(C,e),o?Jm.addScaledVector(lB,c):Jm.addScaledVector(lB.sub(t),c))}t.add(Jm)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;if(s===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),aB.copy(n.boundingSphere),aB.applyMatrix4(r),e.ray.intersectsSphere(aB)===!1)||(xR.copy(r).invert(),xC.copy(e.ray).applyMatrix4(xR),n.boundingBox!==null&&xC.intersectsBox(n.boundingBox)===!1))return;let o;const g=n.index,a=n.attributes.position,l=n.attributes.uv,c=n.attributes.uv2,C=n.groups,h=n.drawRange;if(g!==null)if(Array.isArray(s))for(let p=0,m=C.length;p<m;p++){const f=C[p],b=s[f.materialIndex],y=Math.max(f.start,h.start),v=Math.min(g.count,Math.min(f.start+f.count,h.start+h.count));for(let G=y,w=v;G<w;G+=3){const W=g.getX(G),V=g.getX(G+1),X=g.getX(G+2);o=jm(this,b,e,xC,l,c,W,V,X),o&&(o.faceIndex=Math.floor(G/3),o.face.materialIndex=f.materialIndex,t.push(o))}}else{const p=Math.max(0,h.start),m=Math.min(g.count,h.start+h.count);for(let f=p,b=m;f<b;f+=3){const y=g.getX(f),v=g.getX(f+1),G=g.getX(f+2);o=jm(this,s,e,xC,l,c,y,v,G),o&&(o.faceIndex=Math.floor(f/3),t.push(o))}}else if(a!==void 0)if(Array.isArray(s))for(let p=0,m=C.length;p<m;p++){const f=C[p],b=s[f.materialIndex],y=Math.max(f.start,h.start),v=Math.min(a.count,Math.min(f.start+f.count,h.start+h.count));for(let G=y,w=v;G<w;G+=3){const W=G,V=G+1,X=G+2;o=jm(this,b,e,xC,l,c,W,V,X),o&&(o.faceIndex=Math.floor(G/3),o.face.materialIndex=f.materialIndex,t.push(o))}}else{const p=Math.max(0,h.start),m=Math.min(a.count,h.start+h.count);for(let f=p,b=m;f<b;f+=3){const y=f,v=f+1,G=f+2;o=jm(this,s,e,xC,l,c,y,v,G),o&&(o.faceIndex=Math.floor(f/3),t.push(o))}}}}function Ek(i,e,t,n,s,r,o,g){let a;if(e.side===ao?a=n.intersectTriangle(o,r,s,!0,g):a=n.intersectTriangle(s,r,o,e.side===ua,g),a===null)return null;Qm.copy(g),Qm.applyMatrix4(i.matrixWorld);const l=t.ray.origin.distanceTo(Qm);return l<t.near||l>t.far?null:{distance:l,point:Qm.clone(),object:i}}function jm(i,e,t,n,s,r,o,g,a){i.getVertexPosition(o,aA),i.getVertexPosition(g,lA),i.getVertexPosition(a,cA);const l=Ek(i,e,t,n,aA,lA,cA,cB);if(l){s&&(Um.fromBufferAttribute(s,o),Pm.fromBufferAttribute(s,g),Om.fromBufferAttribute(s,a),l.uv=To.getUV(cB,aA,lA,cA,Um,Pm,Om,new Fe)),r&&(Um.fromBufferAttribute(r,o),Pm.fromBufferAttribute(r,g),Om.fromBufferAttribute(r,a),l.uv2=To.getUV(cB,aA,lA,cA,Um,Pm,Om,new Fe));const c={a:o,b:g,c:a,normal:new E,materialIndex:0};To.getNormal(aA,lA,cA,c.normal),l.face=c}return l}class hl extends zt{constructor(e=1,t=1,n=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:o};const g=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const a=[],l=[],c=[],C=[];let h=0,p=0;m("z","y","x",-1,-1,n,t,e,o,r,0),m("z","y","x",1,-1,n,t,-e,o,r,1),m("x","z","y",1,1,e,n,t,s,o,2),m("x","z","y",1,-1,e,n,-t,s,o,3),m("x","y","z",1,-1,e,t,n,s,r,4),m("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(a),this.setAttribute("position",new pt(l,3)),this.setAttribute("normal",new pt(c,3)),this.setAttribute("uv",new pt(C,2));function m(f,b,y,v,G,w,W,V,X,R,Y){const M=w/X,L=W/R,re=w/2,j=W/2,$=V/2,ie=X+1,he=R+1;let le=0,_=0;const ne=new E;for(let te=0;te<he;te++){const q=te*L-j;for(let se=0;se<ie;se++){const ue=se*M-re;ne[f]=ue*v,ne[b]=q*G,ne[y]=$,l.push(ne.x,ne.y,ne.z),ne[f]=0,ne[b]=0,ne[y]=V>0?1:-1,c.push(ne.x,ne.y,ne.z),C.push(se/X),C.push(1-te/R),le+=1}}for(let te=0;te<R;te++)for(let q=0;q<X;q++){const se=h+q+ie*te,ue=h+q+ie*(te+1),Ae=h+(q+1)+ie*(te+1),We=h+(q+1)+ie*te;a.push(se,ue,We),a.push(ue,Ae,We),_+=6}g.addGroup(p,_,Y),p+=_,h+=le}}static fromJSON(e){return new hl(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Yd(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function tr(i){const e={};for(let t=0;t<i.length;t++){const n=Yd(i[t]);for(const s in n)e[s]=n[s]}return e}function Dk(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}function yV(i){return i.getRenderTarget()===null&&i.outputEncoding===bn?vg:Xd}const BV={clone:Yd,merge:tr};var Jk=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Uk=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xg extends qn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Jk,this.fragmentShader=Uk,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Yd(e.uniforms),this.uniformsGroups=Dk(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}let Dp=class extends en{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new mt,this.projectionMatrix=new mt,this.projectionMatrixInverse=new mt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Dn=class extends Dp{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=bp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(gu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return bp*2*Math.atan(Math.tan(gu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(gu*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const a=o.fullWidth,l=o.fullHeight;r+=o.offsetX*s/a,t-=o.offsetY*n/l,s*=o.width/a,n*=o.height/l}const g=this.filmOffset;g!==0&&(r+=e*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const VC=-90,HC=1;class vV extends en{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const s=new Dn(VC,HC,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(1,0,0),this.add(s);const r=new Dn(VC,HC,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);const o=new Dn(VC,HC,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(0,1,0),this.add(o);const g=new Dn(VC,HC,e,t);g.layers=this.layers,g.up.set(0,0,1),g.lookAt(0,-1,0),this.add(g);const a=new Dn(VC,HC,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(0,0,1),this.add(a);const l=new Dn(VC,HC,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[s,r,o,g,a,l]=this.children,c=e.getRenderTarget(),C=e.toneMapping,h=e.xr.enabled;e.toneMapping=Wg,e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,s),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,g),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=p,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=C,e.xr.enabled=h,n.texture.needsPMREMUpdate=!0}}class Jp extends kn{constructor(e,t,n,s,r,o,g,a,l,c){e=e!==void 0?e:[],t=t!==void 0?t:rl,super(e,t,n,s,r,o,g,a,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class CZ extends Co{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new Jp(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Zn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new hl(5,5,5),r=new Xg({name:"CubemapFromEquirect",uniforms:Yd(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:ao,blending:el});r.uniforms.tEquirect.value=t;const o=new mi(s,r),g=t.minFilter;return t.minFilter===eg&&(t.minFilter=Zn),new vV(1,10,this).update(e,o),t.minFilter=g,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,s);e.setRenderTarget(r)}}const IB=new E,Pk=new E,Ok=new rr;let rc=class{constructor(e=new E(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=IB.subVectors(n,t).cross(Pk.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(IB),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Ok.getNormalMatrix(e),s=this.coplanarPoint(IB).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};const XC=new dl,qm=new E;class CG{constructor(e=new rc,t=new rc,n=new rc,s=new rc,r=new rc,o=new rc){this.planes=[e,t,n,s,r,o]}set(e,t,n,s,r,o){const g=this.planes;return g[0].copy(e),g[1].copy(t),g[2].copy(n),g[3].copy(s),g[4].copy(r),g[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,s=n[0],r=n[1],o=n[2],g=n[3],a=n[4],l=n[5],c=n[6],C=n[7],h=n[8],p=n[9],m=n[10],f=n[11],b=n[12],y=n[13],v=n[14],G=n[15];return t[0].setComponents(g-s,C-a,f-h,G-b).normalize(),t[1].setComponents(g+s,C+a,f+h,G+b).normalize(),t[2].setComponents(g+r,C+l,f+p,G+y).normalize(),t[3].setComponents(g-r,C-l,f-p,G-y).normalize(),t[4].setComponents(g-o,C-c,f-m,G-v).normalize(),t[5].setComponents(g+o,C+c,f+m,G+v).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),XC.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(XC)}intersectsSprite(e){return XC.center.set(0,0,0),XC.radius=.7071067811865476,XC.applyMatrix4(e.matrixWorld),this.intersectsSphere(XC)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(qm.x=s.normal.x>0?e.max.x:e.min.x,qm.y=s.normal.y>0?e.max.y:e.min.y,qm.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(qm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function ZV(){let i=null,e=!1,t=null,n=null;function s(r,o){t(r,o),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}function Qk(i,e){const t=e.isWebGL2,n=new WeakMap;function s(l,c){const C=l.array,h=l.usage,p=i.createBuffer();i.bindBuffer(c,p),i.bufferData(c,C,h),l.onUploadCallback();let m;if(C instanceof Float32Array)m=5126;else if(C instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(t)m=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else m=5123;else if(C instanceof Int16Array)m=5122;else if(C instanceof Uint32Array)m=5125;else if(C instanceof Int32Array)m=5124;else if(C instanceof Int8Array)m=5120;else if(C instanceof Uint8Array)m=5121;else if(C instanceof Uint8ClampedArray)m=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+C);return{buffer:p,type:m,bytesPerElement:C.BYTES_PER_ELEMENT,version:l.version}}function r(l,c,C){const h=c.array,p=c.updateRange;i.bindBuffer(C,l),p.count===-1?i.bufferSubData(C,0,h):(t?i.bufferSubData(C,p.offset*h.BYTES_PER_ELEMENT,h,p.offset,p.count):i.bufferSubData(C,p.offset*h.BYTES_PER_ELEMENT,h.subarray(p.offset,p.offset+p.count)),p.count=-1),c.onUploadCallback()}function o(l){return l.isInterleavedBufferAttribute&&(l=l.data),n.get(l)}function g(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=n.get(l);c&&(i.deleteBuffer(c.buffer),n.delete(l))}function a(l,c){if(l.isGLBufferAttribute){const h=n.get(l);(!h||h.version<l.version)&&n.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const C=n.get(l);C===void 0?n.set(l,s(l,c)):C.version<l.version&&(r(C.buffer,l,c),C.version=l.version)}return{get:o,remove:g,update:a}}class Pd extends zt{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,o=t/2,g=Math.floor(n),a=Math.floor(s),l=g+1,c=a+1,C=e/g,h=t/a,p=[],m=[],f=[],b=[];for(let y=0;y<c;y++){const v=y*h-o;for(let G=0;G<l;G++){const w=G*C-r;m.push(w,-v,0),f.push(0,0,1),b.push(G/g),b.push(1-y/a)}}for(let y=0;y<a;y++)for(let v=0;v<g;v++){const G=v+l*y,w=v+l*(y+1),W=v+1+l*(y+1),V=v+1+l*y;p.push(G,w,V),p.push(w,W,V)}this.setIndex(p),this.setAttribute("position",new pt(m,3)),this.setAttribute("normal",new pt(f,3)),this.setAttribute("uv",new pt(b,2))}static fromJSON(e){return new Pd(e.width,e.height,e.widthSegments,e.heightSegments)}}var jk=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,qk=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$k=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,e4=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,t4=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,n4=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,i4="vec3 transformed = vec3( position );",s4=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,r4=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,o4=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,g4=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,a4=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,l4=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,c4=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,I4=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,u4=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,C4=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,d4=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,h4=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,A4=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,p4=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,f4=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,m4=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,b4=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,G4=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,y4=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,B4="gl_FragColor = linearToOutputTexel( gl_FragColor );",v4=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Z4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,w4=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,S4=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,R4=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,W4=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,x4=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,V4=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,H4=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,X4=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Y4=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,F4=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,N4=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,M4=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,K4=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,L4=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,z4=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,_4=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,k4=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,T4=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,E4=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,D4=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,J4=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,U4=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,P4=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,O4=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Q4=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,j4=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,q4=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,$4=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,eT=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,tT=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,nT=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,iT=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,sT=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,rT=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,oT=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,gT=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,aT=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,lT=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,cT=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,IT=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,uT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,CT=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,dT=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,hT=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,AT=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,pT=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,fT=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,mT=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,bT=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,GT=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,yT=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,BT=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,vT=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,ZT=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,wT=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,ST=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,RT=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,WT=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,xT=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,VT=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,HT=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,XT=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,YT=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,FT=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,NT=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,MT=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,KT=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,LT=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,zT=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,_T=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,kT=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,TT=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,ET=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,DT=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,JT=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,UT=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,PT=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const OT=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,QT=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,jT=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,qT=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,$T=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,eE=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,tE=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,nE=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,iE=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,sE=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,rE=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,oE=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,gE=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,aE=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,lE=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,cE=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IE=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,uE=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CE=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,dE=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hE=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,AE=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,pE=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fE=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mE=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,bE=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GE=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yE=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BE=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,vE=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ZE=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wE=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,SE=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,RE=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,$t={alphamap_fragment:jk,alphamap_pars_fragment:qk,alphatest_fragment:$k,alphatest_pars_fragment:e4,aomap_fragment:t4,aomap_pars_fragment:n4,begin_vertex:i4,beginnormal_vertex:s4,bsdfs:r4,iridescence_fragment:o4,bumpmap_pars_fragment:g4,clipping_planes_fragment:a4,clipping_planes_pars_fragment:l4,clipping_planes_pars_vertex:c4,clipping_planes_vertex:I4,color_fragment:u4,color_pars_fragment:C4,color_pars_vertex:d4,color_vertex:h4,common:A4,cube_uv_reflection_fragment:p4,defaultnormal_vertex:f4,displacementmap_pars_vertex:m4,displacementmap_vertex:b4,emissivemap_fragment:G4,emissivemap_pars_fragment:y4,encodings_fragment:B4,encodings_pars_fragment:v4,envmap_fragment:Z4,envmap_common_pars_fragment:w4,envmap_pars_fragment:S4,envmap_pars_vertex:R4,envmap_physical_pars_fragment:z4,envmap_vertex:W4,fog_vertex:x4,fog_pars_vertex:V4,fog_fragment:H4,fog_pars_fragment:X4,gradientmap_pars_fragment:Y4,lightmap_fragment:F4,lightmap_pars_fragment:N4,lights_lambert_fragment:M4,lights_lambert_pars_fragment:K4,lights_pars_begin:L4,lights_toon_fragment:_4,lights_toon_pars_fragment:k4,lights_phong_fragment:T4,lights_phong_pars_fragment:E4,lights_physical_fragment:D4,lights_physical_pars_fragment:J4,lights_fragment_begin:U4,lights_fragment_maps:P4,lights_fragment_end:O4,logdepthbuf_fragment:Q4,logdepthbuf_pars_fragment:j4,logdepthbuf_pars_vertex:q4,logdepthbuf_vertex:$4,map_fragment:eT,map_pars_fragment:tT,map_particle_fragment:nT,map_particle_pars_fragment:iT,metalnessmap_fragment:sT,metalnessmap_pars_fragment:rT,morphcolor_vertex:oT,morphnormal_vertex:gT,morphtarget_pars_vertex:aT,morphtarget_vertex:lT,normal_fragment_begin:cT,normal_fragment_maps:IT,normal_pars_fragment:uT,normal_pars_vertex:CT,normal_vertex:dT,normalmap_pars_fragment:hT,clearcoat_normal_fragment_begin:AT,clearcoat_normal_fragment_maps:pT,clearcoat_pars_fragment:fT,iridescence_pars_fragment:mT,output_fragment:bT,packing:GT,premultiplied_alpha_fragment:yT,project_vertex:BT,dithering_fragment:vT,dithering_pars_fragment:ZT,roughnessmap_fragment:wT,roughnessmap_pars_fragment:ST,shadowmap_pars_fragment:RT,shadowmap_pars_vertex:WT,shadowmap_vertex:xT,shadowmask_pars_fragment:VT,skinbase_vertex:HT,skinning_pars_vertex:XT,skinning_vertex:YT,skinnormal_vertex:FT,specularmap_fragment:NT,specularmap_pars_fragment:MT,tonemapping_fragment:KT,tonemapping_pars_fragment:LT,transmission_fragment:zT,transmission_pars_fragment:_T,uv_pars_fragment:kT,uv_pars_vertex:TT,uv_vertex:ET,uv2_pars_fragment:DT,uv2_pars_vertex:JT,uv2_vertex:UT,worldpos_vertex:PT,background_vert:OT,background_frag:QT,backgroundCube_vert:jT,backgroundCube_frag:qT,cube_vert:$T,cube_frag:eE,depth_vert:tE,depth_frag:nE,distanceRGBA_vert:iE,distanceRGBA_frag:sE,equirect_vert:rE,equirect_frag:oE,linedashed_vert:gE,linedashed_frag:aE,meshbasic_vert:lE,meshbasic_frag:cE,meshlambert_vert:IE,meshlambert_frag:uE,meshmatcap_vert:CE,meshmatcap_frag:dE,meshnormal_vert:hE,meshnormal_frag:AE,meshphong_vert:pE,meshphong_frag:fE,meshphysical_vert:mE,meshphysical_frag:bE,meshtoon_vert:GE,meshtoon_frag:yE,points_vert:BE,points_frag:vE,shadow_vert:ZE,shadow_frag:wE,sprite_vert:SE,sprite_frag:RE},it={common:{diffuse:{value:new et(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new rr},uv2Transform:{value:new rr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Fe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new et(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new et(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new rr}},sprite:{diffuse:{value:new et(16777215)},opacity:{value:1},center:{value:new Fe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new rr}}},wg={basic:{uniforms:tr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.fog]),vertexShader:$t.meshbasic_vert,fragmentShader:$t.meshbasic_frag},lambert:{uniforms:tr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.fog,it.lights,{emissive:{value:new et(0)}}]),vertexShader:$t.meshlambert_vert,fragmentShader:$t.meshlambert_frag},phong:{uniforms:tr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.fog,it.lights,{emissive:{value:new et(0)},specular:{value:new et(1118481)},shininess:{value:30}}]),vertexShader:$t.meshphong_vert,fragmentShader:$t.meshphong_frag},standard:{uniforms:tr([it.common,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.roughnessmap,it.metalnessmap,it.fog,it.lights,{emissive:{value:new et(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:$t.meshphysical_vert,fragmentShader:$t.meshphysical_frag},toon:{uniforms:tr([it.common,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.gradientmap,it.fog,it.lights,{emissive:{value:new et(0)}}]),vertexShader:$t.meshtoon_vert,fragmentShader:$t.meshtoon_frag},matcap:{uniforms:tr([it.common,it.bumpmap,it.normalmap,it.displacementmap,it.fog,{matcap:{value:null}}]),vertexShader:$t.meshmatcap_vert,fragmentShader:$t.meshmatcap_frag},points:{uniforms:tr([it.points,it.fog]),vertexShader:$t.points_vert,fragmentShader:$t.points_frag},dashed:{uniforms:tr([it.common,it.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:$t.linedashed_vert,fragmentShader:$t.linedashed_frag},depth:{uniforms:tr([it.common,it.displacementmap]),vertexShader:$t.depth_vert,fragmentShader:$t.depth_frag},normal:{uniforms:tr([it.common,it.bumpmap,it.normalmap,it.displacementmap,{opacity:{value:1}}]),vertexShader:$t.meshnormal_vert,fragmentShader:$t.meshnormal_frag},sprite:{uniforms:tr([it.sprite,it.fog]),vertexShader:$t.sprite_vert,fragmentShader:$t.sprite_frag},background:{uniforms:{uvTransform:{value:new rr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:$t.background_vert,fragmentShader:$t.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:$t.backgroundCube_vert,fragmentShader:$t.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:$t.cube_vert,fragmentShader:$t.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:$t.equirect_vert,fragmentShader:$t.equirect_frag},distanceRGBA:{uniforms:tr([it.common,it.displacementmap,{referencePosition:{value:new E},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:$t.distanceRGBA_vert,fragmentShader:$t.distanceRGBA_frag},shadow:{uniforms:tr([it.lights,it.fog,{color:{value:new et(0)},opacity:{value:1}}]),vertexShader:$t.shadow_vert,fragmentShader:$t.shadow_frag}};wg.physical={uniforms:tr([wg.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Fe(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new et(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Fe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new et(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new et(1,1,1)},specularColorMap:{value:null}}]),vertexShader:$t.meshphysical_vert,fragmentShader:$t.meshphysical_frag};const $m={r:0,b:0,g:0};function WE(i,e,t,n,s,r,o){const g=new et(0);let a=r===!0?0:1,l,c,C=null,h=0,p=null;function m(b,y){let v=!1,G=y.isScene===!0?y.background:null;G&&G.isTexture&&(G=(y.backgroundBlurriness>0?t:e).get(G));const w=i.xr,W=w.getSession&&w.getSession();W&&W.environmentBlendMode==="additive"&&(G=null),G===null?f(g,a):G&&G.isColor&&(f(G,1),v=!0),(i.autoClear||v)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),G&&(G.isCubeTexture||G.mapping===Ud)?(c===void 0&&(c=new mi(new hl(1,1,1),new Xg({name:"BackgroundCubeMaterial",uniforms:Yd(wg.backgroundCube.uniforms),vertexShader:wg.backgroundCube.vertexShader,fragmentShader:wg.backgroundCube.fragmentShader,side:ao,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(V,X,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(c)),c.material.uniforms.envMap.value=G,c.material.uniforms.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,c.material.toneMapped=G.encoding!==bn,(C!==G||h!==G.version||p!==i.toneMapping)&&(c.material.needsUpdate=!0,C=G,h=G.version,p=i.toneMapping),c.layers.enableAll(),b.unshift(c,c.geometry,c.material,0,0,null)):G&&G.isTexture&&(l===void 0&&(l=new mi(new Pd(2,2),new Xg({name:"BackgroundMaterial",uniforms:Yd(wg.background.uniforms),vertexShader:wg.background.vertexShader,fragmentShader:wg.background.fragmentShader,side:ua,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=G,l.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,l.material.toneMapped=G.encoding!==bn,G.matrixAutoUpdate===!0&&G.updateMatrix(),l.material.uniforms.uvTransform.value.copy(G.matrix),(C!==G||h!==G.version||p!==i.toneMapping)&&(l.material.needsUpdate=!0,C=G,h=G.version,p=i.toneMapping),l.layers.enableAll(),b.unshift(l,l.geometry,l.material,0,0,null))}function f(b,y){b.getRGB($m,yV(i)),n.buffers.color.setClear($m.r,$m.g,$m.b,y,o)}return{getClearColor:function(){return g},setClearColor:function(b,y=1){g.set(b),a=y,f(g,a)},getClearAlpha:function(){return a},setClearAlpha:function(b){a=b,f(g,a)},render:m}}function xE(i,e,t,n){const s=i.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||r!==null,g={},a=b(null);let l=a,c=!1;function C($,ie,he,le,_){let ne=!1;if(o){const te=f(le,he,ie);l!==te&&(l=te,p(l.object)),ne=y($,le,he,_),ne&&v($,le,he,_)}else{const te=ie.wireframe===!0;(l.geometry!==le.id||l.program!==he.id||l.wireframe!==te)&&(l.geometry=le.id,l.program=he.id,l.wireframe=te,ne=!0)}_!==null&&t.update(_,34963),(ne||c)&&(c=!1,R($,ie,he,le),_!==null&&i.bindBuffer(34963,t.get(_).buffer))}function h(){return n.isWebGL2?i.createVertexArray():r.createVertexArrayOES()}function p($){return n.isWebGL2?i.bindVertexArray($):r.bindVertexArrayOES($)}function m($){return n.isWebGL2?i.deleteVertexArray($):r.deleteVertexArrayOES($)}function f($,ie,he){const le=he.wireframe===!0;let _=g[$.id];_===void 0&&(_={},g[$.id]=_);let ne=_[ie.id];ne===void 0&&(ne={},_[ie.id]=ne);let te=ne[le];return te===void 0&&(te=b(h()),ne[le]=te),te}function b($){const ie=[],he=[],le=[];for(let _=0;_<s;_++)ie[_]=0,he[_]=0,le[_]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ie,enabledAttributes:he,attributeDivisors:le,object:$,attributes:{},index:null}}function y($,ie,he,le){const _=l.attributes,ne=ie.attributes;let te=0;const q=he.getAttributes();for(const se in q)if(q[se].location>=0){const Ae=_[se];let We=ne[se];if(We===void 0&&(se==="instanceMatrix"&&$.instanceMatrix&&(We=$.instanceMatrix),se==="instanceColor"&&$.instanceColor&&(We=$.instanceColor)),Ae===void 0||Ae.attribute!==We||We&&Ae.data!==We.data)return!0;te++}return l.attributesNum!==te||l.index!==le}function v($,ie,he,le){const _={},ne=ie.attributes;let te=0;const q=he.getAttributes();for(const se in q)if(q[se].location>=0){let Ae=ne[se];Ae===void 0&&(se==="instanceMatrix"&&$.instanceMatrix&&(Ae=$.instanceMatrix),se==="instanceColor"&&$.instanceColor&&(Ae=$.instanceColor));const We={};We.attribute=Ae,Ae&&Ae.data&&(We.data=Ae.data),_[se]=We,te++}l.attributes=_,l.attributesNum=te,l.index=le}function G(){const $=l.newAttributes;for(let ie=0,he=$.length;ie<he;ie++)$[ie]=0}function w($){W($,0)}function W($,ie){const he=l.newAttributes,le=l.enabledAttributes,_=l.attributeDivisors;he[$]=1,le[$]===0&&(i.enableVertexAttribArray($),le[$]=1),_[$]!==ie&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"]($,ie),_[$]=ie)}function V(){const $=l.newAttributes,ie=l.enabledAttributes;for(let he=0,le=ie.length;he<le;he++)ie[he]!==$[he]&&(i.disableVertexAttribArray(he),ie[he]=0)}function X($,ie,he,le,_,ne){n.isWebGL2===!0&&(he===5124||he===5125)?i.vertexAttribIPointer($,ie,he,_,ne):i.vertexAttribPointer($,ie,he,le,_,ne)}function R($,ie,he,le){if(n.isWebGL2===!1&&($.isInstancedMesh||le.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;G();const _=le.attributes,ne=he.getAttributes(),te=ie.defaultAttributeValues;for(const q in ne){const se=ne[q];if(se.location>=0){let ue=_[q];if(ue===void 0&&(q==="instanceMatrix"&&$.instanceMatrix&&(ue=$.instanceMatrix),q==="instanceColor"&&$.instanceColor&&(ue=$.instanceColor)),ue!==void 0){const Ae=ue.normalized,We=ue.itemSize,me=t.get(ue);if(me===void 0)continue;const tt=me.buffer,Oe=me.type,It=me.bytesPerElement;if(ue.isInterleavedBufferAttribute){const ke=ue.data,je=ke.stride,ve=ue.offset;if(ke.isInstancedInterleavedBuffer){for(let be=0;be<se.locationSize;be++)W(se.location+be,ke.meshPerAttribute);$.isInstancedMesh!==!0&&le._maxInstanceCount===void 0&&(le._maxInstanceCount=ke.meshPerAttribute*ke.count)}else for(let be=0;be<se.locationSize;be++)w(se.location+be);i.bindBuffer(34962,tt);for(let be=0;be<se.locationSize;be++)X(se.location+be,We/se.locationSize,Oe,Ae,je*It,(ve+We/se.locationSize*be)*It)}else{if(ue.isInstancedBufferAttribute){for(let ke=0;ke<se.locationSize;ke++)W(se.location+ke,ue.meshPerAttribute);$.isInstancedMesh!==!0&&le._maxInstanceCount===void 0&&(le._maxInstanceCount=ue.meshPerAttribute*ue.count)}else for(let ke=0;ke<se.locationSize;ke++)w(se.location+ke);i.bindBuffer(34962,tt);for(let ke=0;ke<se.locationSize;ke++)X(se.location+ke,We/se.locationSize,Oe,Ae,We*It,We/se.locationSize*ke*It)}}else if(te!==void 0){const Ae=te[q];if(Ae!==void 0)switch(Ae.length){case 2:i.vertexAttrib2fv(se.location,Ae);break;case 3:i.vertexAttrib3fv(se.location,Ae);break;case 4:i.vertexAttrib4fv(se.location,Ae);break;default:i.vertexAttrib1fv(se.location,Ae)}}}}V()}function Y(){re();for(const $ in g){const ie=g[$];for(const he in ie){const le=ie[he];for(const _ in le)m(le[_].object),delete le[_];delete ie[he]}delete g[$]}}function M($){if(g[$.id]===void 0)return;const ie=g[$.id];for(const he in ie){const le=ie[he];for(const _ in le)m(le[_].object),delete le[_];delete ie[he]}delete g[$.id]}function L($){for(const ie in g){const he=g[ie];if(he[$.id]===void 0)continue;const le=he[$.id];for(const _ in le)m(le[_].object),delete le[_];delete he[$.id]}}function re(){j(),c=!0,l!==a&&(l=a,p(l.object))}function j(){a.geometry=null,a.program=null,a.wireframe=!1}return{setup:C,reset:re,resetDefaultState:j,dispose:Y,releaseStatesOfGeometry:M,releaseStatesOfProgram:L,initAttributes:G,enableAttribute:w,disableUnusedAttributes:V}}function VE(i,e,t,n){const s=n.isWebGL2;let r;function o(l){r=l}function g(l,c){i.drawArrays(r,l,c),t.update(c,r,1)}function a(l,c,C){if(C===0)return;let h,p;if(s)h=i,p="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",h===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}h[p](r,l,c,C),t.update(c,r,C)}this.setMode=o,this.render=g,this.renderInstances=a}function HE(i,e,t){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const X=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(X.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(X){if(X==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";X="mediump"}return X==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let g=t.precision!==void 0?t.precision:"highp";const a=r(g);a!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",a,"instead."),g=a);const l=o||e.has("WEBGL_draw_buffers"),c=t.logarithmicDepthBuffer===!0,C=i.getParameter(34930),h=i.getParameter(35660),p=i.getParameter(3379),m=i.getParameter(34076),f=i.getParameter(34921),b=i.getParameter(36347),y=i.getParameter(36348),v=i.getParameter(36349),G=h>0,w=o||e.has("OES_texture_float"),W=G&&w,V=o?i.getParameter(36183):0;return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:s,getMaxPrecision:r,precision:g,logarithmicDepthBuffer:c,maxTextures:C,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:m,maxAttributes:f,maxVertexUniforms:b,maxVaryings:y,maxFragmentUniforms:v,vertexTextures:G,floatFragmentTextures:w,floatVertexTextures:W,maxSamples:V}}function XE(i){const e=this;let t=null,n=0,s=!1,r=!1;const o=new rc,g=new rr,a={value:null,needsUpdate:!1};this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(C,h,p){const m=C.length!==0||h||n!==0||s;return s=h,t=c(C,p,0),n=C.length,m},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(C,h,p){const m=C.clippingPlanes,f=C.clipIntersection,b=C.clipShadows,y=i.get(C);if(!s||m===null||m.length===0||r&&!b)r?c(null):l();else{const v=r?0:n,G=v*4;let w=y.clippingState||null;a.value=w,w=c(m,h,G,p);for(let W=0;W!==G;++W)w[W]=t[W];y.clippingState=w,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=v}};function l(){a.value!==t&&(a.value=t,a.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(C,h,p,m){const f=C!==null?C.length:0;let b=null;if(f!==0){if(b=a.value,m!==!0||b===null){const y=p+f*4,v=h.matrixWorldInverse;g.getNormalMatrix(v),(b===null||b.length<y)&&(b=new Float32Array(y));for(let G=0,w=p;G!==f;++G,w+=4)o.copy(C[G]).applyMatrix4(v,g),o.normal.toArray(b,w),b[w+3]=o.constant}a.value=b,a.needsUpdate=!0}return e.numPlanes=f,e.numIntersection=0,b}}function YE(i){let e=new WeakMap;function t(o,g){return g===xd?o.mapping=rl:g===pp&&(o.mapping=Vc),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const g=o.mapping;if(g===xd||g===pp)if(e.has(o)){const a=e.get(o).texture;return t(a,o.mapping)}else{const a=o.image;if(a&&a.height>0){const l=new CZ(a.height/2);return l.fromEquirectangularTexture(i,o),e.set(o,l),o.addEventListener("dispose",s),t(l.texture,o.mapping)}else return null}}return o}function s(o){const g=o.target;g.removeEventListener("dispose",s);const a=e.get(g);a!==void 0&&(e.delete(g),a.dispose())}function r(){e=new WeakMap}return{get:n,dispose:r}}class co extends Dp{constructor(e=-1,t=1,n=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,o=n+e,g=s+t,a=s-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=l*this.view.offsetX,o=r+l*this.view.width,g-=c*this.view.offsetY,a=g-c*this.view.height}this.projectionMatrix.makeOrthographic(r,o,g,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const id=4,VR=[.125,.215,.35,.446,.526,.582],EI=20,uB=new co,HR=new et;let CB=null;const _I=(1+Math.sqrt(5))/2,YC=1/_I,XR=[new E(1,1,1),new E(-1,1,1),new E(1,1,-1),new E(-1,1,-1),new E(0,_I,YC),new E(0,_I,-YC),new E(YC,0,_I),new E(-YC,0,_I),new E(_I,YC,0),new E(-_I,YC,0)];class wv{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){CB=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=NR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=FR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(CB),e.scissorTest=!1,e0(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===rl||e.mapping===Vc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),CB=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Zn,minFilter:Zn,generateMipmaps:!1,type:Jo,format:Zr,encoding:al,depthBuffer:!1},s=YR(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=YR(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=FE(r)),this._blurMaterial=NE(r,e,t)}return s}_compileMaterial(e){const t=new mi(this._lodPlanes[0],e);this._renderer.compile(t,uB)}_sceneToCubeUV(e,t,n,s){const g=new Dn(90,1,t,n),a=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],c=this._renderer,C=c.autoClear,h=c.toneMapping;c.getClearColor(HR),c.toneMapping=Wg,c.autoClear=!1;const p=new Oi({name:"PMREM.Background",side:ao,depthWrite:!1,depthTest:!1}),m=new mi(new hl,p);let f=!1;const b=e.background;b?b.isColor&&(p.color.copy(b),e.background=null,f=!0):(p.color.copy(HR),f=!0);for(let y=0;y<6;y++){const v=y%3;v===0?(g.up.set(0,a[y],0),g.lookAt(l[y],0,0)):v===1?(g.up.set(0,0,a[y]),g.lookAt(0,l[y],0)):(g.up.set(0,a[y],0),g.lookAt(0,0,l[y]));const G=this._cubeSize;e0(s,v*G,y>2?G:0,G,G),c.setRenderTarget(s),f&&c.render(m,g),c.render(e,g)}m.geometry.dispose(),m.material.dispose(),c.toneMapping=h,c.autoClear=C,e.background=b}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===rl||e.mapping===Vc;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=NR()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=FR());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new mi(this._lodPlanes[0],r),g=r.uniforms;g.envMap.value=e;const a=this._cubeSize;e0(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(o,uB)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=XR[(s-1)%XR.length];this._blur(e,s-1,s,r,o)}t.autoClear=n}_blur(e,t,n,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,s,"latitudinal",r),this._halfBlur(o,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,o,g){const a=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,C=new mi(this._lodPlanes[s],l),h=l.uniforms,p=this._sizeLods[n]-1,m=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*EI-1),f=r/m,b=isFinite(r)?1+Math.floor(c*f):EI;b>EI&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${EI}`);const y=[];let v=0;for(let X=0;X<EI;++X){const R=X/f,Y=Math.exp(-R*R/2);y.push(Y),X===0?v+=Y:X<b&&(v+=2*Y)}for(let X=0;X<y.length;X++)y[X]=y[X]/v;h.envMap.value=e.texture,h.samples.value=b,h.weights.value=y,h.latitudinal.value=o==="latitudinal",g&&(h.poleAxis.value=g);const{_lodMax:G}=this;h.dTheta.value=m,h.mipInt.value=G-n;const w=this._sizeLods[s],W=3*w*(s>G-id?s-G+id:0),V=4*(this._cubeSize-w);e0(t,W,V,3*w,2*w),a.setRenderTarget(t),a.render(C,uB)}}function FE(i){const e=[],t=[],n=[];let s=i;const r=i-id+1+VR.length;for(let o=0;o<r;o++){const g=Math.pow(2,s);t.push(g);let a=1/g;o>i-id?a=VR[o-i+id-1]:o===0&&(a=0),n.push(a);const l=1/(g-2),c=-l,C=1+l,h=[c,c,C,c,C,C,c,c,C,C,c,C],p=6,m=6,f=3,b=2,y=1,v=new Float32Array(f*m*p),G=new Float32Array(b*m*p),w=new Float32Array(y*m*p);for(let V=0;V<p;V++){const X=V%3*2/3-1,R=V>2?0:-1,Y=[X,R,0,X+2/3,R,0,X+2/3,R+1,0,X,R,0,X+2/3,R+1,0,X,R+1,0];v.set(Y,f*m*V),G.set(h,b*m*V);const M=[V,V,V,V,V,V];w.set(M,y*m*V)}const W=new zt;W.setAttribute("position",new on(v,f)),W.setAttribute("uv",new on(G,b)),W.setAttribute("faceIndex",new on(w,y)),e.push(W),s>id&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function YR(i,e,t){const n=new Co(i,e,t);return n.texture.mapping=Ud,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function e0(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function NE(i,e,t){const n=new Float32Array(EI),s=new E(0,1,0);return new Xg({name:"SphericalGaussianBlur",defines:{n:EI,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:dZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:el,depthTest:!1,depthWrite:!1})}function FR(){return new Xg({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:dZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:el,depthTest:!1,depthWrite:!1})}function NR(){return new Xg({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:dZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:el,depthTest:!1,depthWrite:!1})}function dZ(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ME(i){let e=new WeakMap,t=null;function n(g){if(g&&g.isTexture){const a=g.mapping,l=a===xd||a===pp,c=a===rl||a===Vc;if(l||c)if(g.isRenderTargetTexture&&g.needsPMREMUpdate===!0){g.needsPMREMUpdate=!1;let C=e.get(g);return t===null&&(t=new wv(i)),C=l?t.fromEquirectangular(g,C):t.fromCubemap(g,C),e.set(g,C),C.texture}else{if(e.has(g))return e.get(g).texture;{const C=g.image;if(l&&C&&C.height>0||c&&C&&s(C)){t===null&&(t=new wv(i));const h=l?t.fromEquirectangular(g):t.fromCubemap(g);return e.set(g,h),g.addEventListener("dispose",r),h.texture}else return null}}}return g}function s(g){let a=0;const l=6;for(let c=0;c<l;c++)g[c]!==void 0&&a++;return a===l}function r(g){const a=g.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function KE(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const s=t(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function LE(i,e,t,n){const s={},r=new WeakMap;function o(C){const h=C.target;h.index!==null&&e.remove(h.index);for(const m in h.attributes)e.remove(h.attributes[m]);h.removeEventListener("dispose",o),delete s[h.id];const p=r.get(h);p&&(e.remove(p),r.delete(h)),n.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function g(C,h){return s[h.id]===!0||(h.addEventListener("dispose",o),s[h.id]=!0,t.memory.geometries++),h}function a(C){const h=C.attributes;for(const m in h)e.update(h[m],34962);const p=C.morphAttributes;for(const m in p){const f=p[m];for(let b=0,y=f.length;b<y;b++)e.update(f[b],34962)}}function l(C){const h=[],p=C.index,m=C.attributes.position;let f=0;if(p!==null){const v=p.array;f=p.version;for(let G=0,w=v.length;G<w;G+=3){const W=v[G+0],V=v[G+1],X=v[G+2];h.push(W,V,V,X,X,W)}}else{const v=m.array;f=m.version;for(let G=0,w=v.length/3-1;G<w;G+=3){const W=G+0,V=G+1,X=G+2;h.push(W,V,V,X,X,W)}}const b=new(bV(h)?uZ:IZ)(h,1);b.version=f;const y=r.get(C);y&&e.remove(y),r.set(C,b)}function c(C){const h=r.get(C);if(h){const p=C.index;p!==null&&h.version<p.version&&l(C)}else l(C);return r.get(C)}return{get:g,update:a,getWireframeAttribute:c}}function zE(i,e,t,n){const s=n.isWebGL2;let r;function o(h){r=h}let g,a;function l(h){g=h.type,a=h.bytesPerElement}function c(h,p){i.drawElements(r,p,g,h*a),t.update(p,r,1)}function C(h,p,m){if(m===0)return;let f,b;if(s)f=i,b="drawElementsInstanced";else if(f=e.get("ANGLE_instanced_arrays"),b="drawElementsInstancedANGLE",f===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[b](r,p,g,h*a,m),t.update(p,r,m)}this.setMode=o,this.setIndex=l,this.render=c,this.renderInstances=C}function _E(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,g){switch(t.calls++,o){case 4:t.triangles+=g*(r/3);break;case 1:t.lines+=g*(r/2);break;case 3:t.lines+=g*(r-1);break;case 2:t.lines+=g*r;break;case 0:t.points+=g*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function kE(i,e){return i[0]-e[0]}function TE(i,e){return Math.abs(e[1])-Math.abs(i[1])}function EE(i,e,t){const n={},s=new Float32Array(8),r=new WeakMap,o=new wn,g=[];for(let l=0;l<8;l++)g[l]=[l,0];function a(l,c,C,h){const p=l.morphTargetInfluences;if(e.isWebGL2===!0){const f=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,b=f!==void 0?f.length:0;let y=r.get(c);if(y===void 0||y.count!==b){let he=function(){$.dispose(),r.delete(c),c.removeEventListener("dispose",he)};var m=he;y!==void 0&&y.texture.dispose();const w=c.morphAttributes.position!==void 0,W=c.morphAttributes.normal!==void 0,V=c.morphAttributes.color!==void 0,X=c.morphAttributes.position||[],R=c.morphAttributes.normal||[],Y=c.morphAttributes.color||[];let M=0;w===!0&&(M=1),W===!0&&(M=2),V===!0&&(M=3);let L=c.attributes.position.count*M,re=1;L>e.maxTextureSize&&(re=Math.ceil(L/e.maxTextureSize),L=e.maxTextureSize);const j=new Float32Array(L*re*4*b),$=new Tp(j,L,re,b);$.type=Do,$.needsUpdate=!0;const ie=M*4;for(let le=0;le<b;le++){const _=X[le],ne=R[le],te=Y[le],q=L*re*4*le;for(let se=0;se<_.count;se++){const ue=se*ie;w===!0&&(o.fromBufferAttribute(_,se),j[q+ue+0]=o.x,j[q+ue+1]=o.y,j[q+ue+2]=o.z,j[q+ue+3]=0),W===!0&&(o.fromBufferAttribute(ne,se),j[q+ue+4]=o.x,j[q+ue+5]=o.y,j[q+ue+6]=o.z,j[q+ue+7]=0),V===!0&&(o.fromBufferAttribute(te,se),j[q+ue+8]=o.x,j[q+ue+9]=o.y,j[q+ue+10]=o.z,j[q+ue+11]=te.itemSize===4?o.w:1)}}y={count:b,texture:$,size:new Fe(L,re)},r.set(c,y),c.addEventListener("dispose",he)}let v=0;for(let w=0;w<p.length;w++)v+=p[w];const G=c.morphTargetsRelative?1:1-v;h.getUniforms().setValue(i,"morphTargetBaseInfluence",G),h.getUniforms().setValue(i,"morphTargetInfluences",p),h.getUniforms().setValue(i,"morphTargetsTexture",y.texture,t),h.getUniforms().setValue(i,"morphTargetsTextureSize",y.size)}else{const f=p===void 0?0:p.length;let b=n[c.id];if(b===void 0||b.length!==f){b=[];for(let W=0;W<f;W++)b[W]=[W,0];n[c.id]=b}for(let W=0;W<f;W++){const V=b[W];V[0]=W,V[1]=p[W]}b.sort(TE);for(let W=0;W<8;W++)W<f&&b[W][1]?(g[W][0]=b[W][0],g[W][1]=b[W][1]):(g[W][0]=Number.MAX_SAFE_INTEGER,g[W][1]=0);g.sort(kE);const y=c.morphAttributes.position,v=c.morphAttributes.normal;let G=0;for(let W=0;W<8;W++){const V=g[W],X=V[0],R=V[1];X!==Number.MAX_SAFE_INTEGER&&R?(y&&c.getAttribute("morphTarget"+W)!==y[X]&&c.setAttribute("morphTarget"+W,y[X]),v&&c.getAttribute("morphNormal"+W)!==v[X]&&c.setAttribute("morphNormal"+W,v[X]),s[W]=R,G+=R):(y&&c.hasAttribute("morphTarget"+W)===!0&&c.deleteAttribute("morphTarget"+W),v&&c.hasAttribute("morphNormal"+W)===!0&&c.deleteAttribute("morphNormal"+W),s[W]=0)}const w=c.morphTargetsRelative?1:1-G;h.getUniforms().setValue(i,"morphTargetBaseInfluence",w),h.getUniforms().setValue(i,"morphTargetInfluences",s)}}return{update:a}}function DE(i,e,t,n){let s=new WeakMap;function r(a){const l=n.render.frame,c=a.geometry,C=e.get(a,c);return s.get(C)!==l&&(e.update(C),s.set(C,l)),a.isInstancedMesh&&(a.hasEventListener("dispose",g)===!1&&a.addEventListener("dispose",g),t.update(a.instanceMatrix,34962),a.instanceColor!==null&&t.update(a.instanceColor,34962)),C}function o(){s=new WeakMap}function g(a){const l=a.target;l.removeEventListener("dispose",g),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:r,dispose:o}}const wV=new kn,SV=new Tp,RV=new uG,WV=new Jp,MR=[],KR=[],LR=new Float32Array(16),zR=new Float32Array(9),_R=new Float32Array(4);function Od(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=MR[s];if(r===void 0&&(r=new Float32Array(s),MR[s]=r),e!==0){n.toArray(r,0);for(let o=1,g=0;o!==e;++o)g+=t,i[o].toArray(r,g)}return r}function Qi(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function ji(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function dG(i,e){let t=KR[e];t===void 0&&(t=new Int32Array(e),KR[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function JE(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function UE(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Qi(t,e))return;i.uniform2fv(this.addr,e),ji(t,e)}}function PE(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Qi(t,e))return;i.uniform3fv(this.addr,e),ji(t,e)}}function OE(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Qi(t,e))return;i.uniform4fv(this.addr,e),ji(t,e)}}function QE(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Qi(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),ji(t,e)}else{if(Qi(t,n))return;_R.set(n),i.uniformMatrix2fv(this.addr,!1,_R),ji(t,n)}}function jE(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Qi(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),ji(t,e)}else{if(Qi(t,n))return;zR.set(n),i.uniformMatrix3fv(this.addr,!1,zR),ji(t,n)}}function qE(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Qi(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),ji(t,e)}else{if(Qi(t,n))return;LR.set(n),i.uniformMatrix4fv(this.addr,!1,LR),ji(t,n)}}function $E(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function eD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Qi(t,e))return;i.uniform2iv(this.addr,e),ji(t,e)}}function tD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Qi(t,e))return;i.uniform3iv(this.addr,e),ji(t,e)}}function nD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Qi(t,e))return;i.uniform4iv(this.addr,e),ji(t,e)}}function iD(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function sD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Qi(t,e))return;i.uniform2uiv(this.addr,e),ji(t,e)}}function rD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Qi(t,e))return;i.uniform3uiv(this.addr,e),ji(t,e)}}function oD(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Qi(t,e))return;i.uniform4uiv(this.addr,e),ji(t,e)}}function gD(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2D(e||wV,s)}function aD(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||RV,s)}function lD(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||WV,s)}function cD(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||SV,s)}function ID(i){switch(i){case 5126:return JE;case 35664:return UE;case 35665:return PE;case 35666:return OE;case 35674:return QE;case 35675:return jE;case 35676:return qE;case 5124:case 35670:return $E;case 35667:case 35671:return eD;case 35668:case 35672:return tD;case 35669:case 35673:return nD;case 5125:return iD;case 36294:return sD;case 36295:return rD;case 36296:return oD;case 35678:case 36198:case 36298:case 36306:case 35682:return gD;case 35679:case 36299:case 36307:return aD;case 35680:case 36300:case 36308:case 36293:return lD;case 36289:case 36303:case 36311:case 36292:return cD}}function uD(i,e){i.uniform1fv(this.addr,e)}function CD(i,e){const t=Od(e,this.size,2);i.uniform2fv(this.addr,t)}function dD(i,e){const t=Od(e,this.size,3);i.uniform3fv(this.addr,t)}function hD(i,e){const t=Od(e,this.size,4);i.uniform4fv(this.addr,t)}function AD(i,e){const t=Od(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function pD(i,e){const t=Od(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function fD(i,e){const t=Od(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function mD(i,e){i.uniform1iv(this.addr,e)}function bD(i,e){i.uniform2iv(this.addr,e)}function GD(i,e){i.uniform3iv(this.addr,e)}function yD(i,e){i.uniform4iv(this.addr,e)}function BD(i,e){i.uniform1uiv(this.addr,e)}function vD(i,e){i.uniform2uiv(this.addr,e)}function ZD(i,e){i.uniform3uiv(this.addr,e)}function wD(i,e){i.uniform4uiv(this.addr,e)}function SD(i,e,t){const n=this.cache,s=e.length,r=dG(t,s);Qi(n,r)||(i.uniform1iv(this.addr,r),ji(n,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||wV,r[o])}function RD(i,e,t){const n=this.cache,s=e.length,r=dG(t,s);Qi(n,r)||(i.uniform1iv(this.addr,r),ji(n,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||RV,r[o])}function WD(i,e,t){const n=this.cache,s=e.length,r=dG(t,s);Qi(n,r)||(i.uniform1iv(this.addr,r),ji(n,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||WV,r[o])}function xD(i,e,t){const n=this.cache,s=e.length,r=dG(t,s);Qi(n,r)||(i.uniform1iv(this.addr,r),ji(n,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||SV,r[o])}function VD(i){switch(i){case 5126:return uD;case 35664:return CD;case 35665:return dD;case 35666:return hD;case 35674:return AD;case 35675:return pD;case 35676:return fD;case 5124:case 35670:return mD;case 35667:case 35671:return bD;case 35668:case 35672:return GD;case 35669:case 35673:return yD;case 5125:return BD;case 36294:return vD;case 36295:return ZD;case 36296:return wD;case 35678:case 36198:case 36298:case 36306:case 35682:return SD;case 35679:case 36299:case 36307:return RD;case 35680:case 36300:case 36308:case 36293:return WD;case 36289:case 36303:case 36311:case 36292:return xD}}class HD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=ID(t.type)}}class XD{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=VD(t.type)}}class YD{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const g=s[r];g.setValue(e,t[g.id],n)}}}const dB=/(\w+)(\])?(\[|\.)?/g;function kR(i,e){i.seq.push(e),i.map[e.id]=e}function FD(i,e,t){const n=i.name,s=n.length;for(dB.lastIndex=0;;){const r=dB.exec(n),o=dB.lastIndex;let g=r[1];const a=r[2]==="]",l=r[3];if(a&&(g=g|0),l===void 0||l==="["&&o+2===s){kR(t,l===void 0?new HD(g,i,e):new XD(g,i,e));break}else{let C=t.map[g];C===void 0&&(C=new YD(g),kR(t,C)),t=C}}}class eb{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let s=0;s<n;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);FD(r,o,this)}}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,o=t.length;r!==o;++r){const g=t[r],a=n[g.id];a.needsUpdate!==!1&&g.setValue(e,a.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&n.push(o)}return n}}function TR(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}let ND=0;function MD(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const g=o+1;n.push(`${g===e?">":" "} ${g}: ${t[o]}`)}return n.join(`
`)}function KD(i){switch(i){case al:return["Linear","( value )"];case bn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function ER(i,e,t){const n=i.getShaderParameter(e,35713),s=i.getShaderInfoLog(e).trim();if(n&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+MD(i.getShaderSource(e),o)}else return s}function LD(i,e){const t=KD(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function zD(i,e){let t;switch(e){case Jx:t="Linear";break;case Ux:t="Reinhard";break;case Px:t="OptimizedCineon";break;case rZ:t="ACESFilmic";break;case Ox:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function _D(i){return[i.extensionDerivatives||i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(YA).join(`
`)}function kD(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function TD(i,e){const t={},n=i.getProgramParameter(e,35721);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),o=r.name;let g=1;r.type===35674&&(g=2),r.type===35675&&(g=3),r.type===35676&&(g=4),t[o]={type:r.type,location:i.getAttribLocation(e,o),locationSize:g}}return t}function YA(i){return i!==""}function DR(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function JR(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ED=/^[ \t]*#include +<([\w\d./]+)>/gm;function Sv(i){return i.replace(ED,DD)}function DD(i,e){const t=$t[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Sv(t)}const JD=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function UR(i){return i.replace(JD,UD)}function UD(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function PR(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function PD(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===aG?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===UA?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===QI&&(e="SHADOWMAP_TYPE_VSM"),e}function OD(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case rl:case Vc:e="ENVMAP_TYPE_CUBE";break;case Ud:e="ENVMAP_TYPE_CUBE_UV";break}return e}function QD(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Vc:e="ENVMAP_MODE_REFRACTION";break}return e}function jD(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case _p:e="ENVMAP_BLENDING_MULTIPLY";break;case Ex:e="ENVMAP_BLENDING_MIX";break;case Dx:e="ENVMAP_BLENDING_ADD";break}return e}function qD(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function $D(i,e,t,n){const s=i.getContext(),r=t.defines;let o=t.vertexShader,g=t.fragmentShader;const a=PD(t),l=OD(t),c=QD(t),C=jD(t),h=qD(t),p=t.isWebGL2?"":_D(t),m=kD(r),f=s.createProgram();let b,y,v=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=[m].filter(YA).join(`
`),b.length>0&&(b+=`
`),y=[p,m].filter(YA).join(`
`),y.length>0&&(y+=`
`)):(b=[PR(t),"#define SHADER_NAME "+t.shaderName,m,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+a:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(YA).join(`
`),y=[p,PR(t),"#define SHADER_NAME "+t.shaderName,m,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+c:"",t.envMap?"#define "+C:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+a:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Wg?"#define TONE_MAPPING":"",t.toneMapping!==Wg?$t.tonemapping_pars_fragment:"",t.toneMapping!==Wg?zD("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",$t.encodings_pars_fragment,LD("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(YA).join(`
`)),o=Sv(o),o=DR(o,t),o=JR(o,t),g=Sv(g),g=DR(g,t),g=JR(g,t),o=UR(o),g=UR(g),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(v=`#version 300 es
`,b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,y=["#define varying in",t.glslVersion===vv?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===vv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const G=v+b+o,w=v+y+g,W=TR(s,35633,G),V=TR(s,35632,w);if(s.attachShader(f,W),s.attachShader(f,V),t.index0AttributeName!==void 0?s.bindAttribLocation(f,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(f,0,"position"),s.linkProgram(f),i.debug.checkShaderErrors){const Y=s.getProgramInfoLog(f).trim(),M=s.getShaderInfoLog(W).trim(),L=s.getShaderInfoLog(V).trim();let re=!0,j=!0;if(s.getProgramParameter(f,35714)===!1){re=!1;const $=ER(s,W,"vertex"),ie=ER(s,V,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(f,35715)+`

Program Info Log: `+Y+`
`+$+`
`+ie)}else Y!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Y):(M===""||L==="")&&(j=!1);j&&(this.diagnostics={runnable:re,programLog:Y,vertexShader:{log:M,prefix:b},fragmentShader:{log:L,prefix:y}})}s.deleteShader(W),s.deleteShader(V);let X;this.getUniforms=function(){return X===void 0&&(X=new eb(s,f)),X};let R;return this.getAttributes=function(){return R===void 0&&(R=TD(s,f)),R},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(f),this.program=void 0},this.name=t.shaderName,this.id=ND++,this.cacheKey=e,this.usedTimes=1,this.program=f,this.vertexShader=W,this.fragmentShader=V,this}let eJ=0;class tJ{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new nJ(e),t.set(e,n)),n}}class nJ{constructor(e){this.id=eJ++,this.code=e,this.usedTimes=0}}function iJ(i,e,t,n,s,r,o){const g=new lu,a=new tJ,l=[],c=s.isWebGL2,C=s.logarithmicDepthBuffer,h=s.vertexTextures;let p=s.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(R,Y,M,L,re){const j=L.fog,$=re.geometry,ie=R.isMeshStandardMaterial?L.environment:null,he=(R.isMeshStandardMaterial?t:e).get(R.envMap||ie),le=he&&he.mapping===Ud?he.image.height:null,_=m[R.type];R.precision!==null&&(p=s.getMaxPrecision(R.precision),p!==R.precision&&console.warn("THREE.WebGLProgram.getParameters:",R.precision,"not supported, using",p,"instead."));const ne=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,te=ne!==void 0?ne.length:0;let q=0;$.morphAttributes.position!==void 0&&(q=1),$.morphAttributes.normal!==void 0&&(q=2),$.morphAttributes.color!==void 0&&(q=3);let se,ue,Ae,We;if(_){const je=wg[_];se=je.vertexShader,ue=je.fragmentShader}else se=R.vertexShader,ue=R.fragmentShader,a.update(R),Ae=a.getVertexShaderID(R),We=a.getFragmentShaderID(R);const me=i.getRenderTarget(),tt=R.alphaTest>0,Oe=R.clearcoat>0,It=R.iridescence>0;return{isWebGL2:c,shaderID:_,shaderName:R.type,vertexShader:se,fragmentShader:ue,defines:R.defines,customVertexShaderID:Ae,customFragmentShaderID:We,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:p,instancing:re.isInstancedMesh===!0,instancingColor:re.isInstancedMesh===!0&&re.instanceColor!==null,supportsVertexTextures:h,outputEncoding:me===null?i.outputEncoding:me.isXRRenderTarget===!0?me.texture.encoding:al,map:!!R.map,matcap:!!R.matcap,envMap:!!he,envMapMode:he&&he.mapping,envMapCubeUVHeight:le,lightMap:!!R.lightMap,aoMap:!!R.aoMap,emissiveMap:!!R.emissiveMap,bumpMap:!!R.bumpMap,normalMap:!!R.normalMap,objectSpaceNormalMap:R.normalMapType===pV,tangentSpaceNormalMap:R.normalMapType===zc,decodeVideoTexture:!!R.map&&R.map.isVideoTexture===!0&&R.map.encoding===bn,clearcoat:Oe,clearcoatMap:Oe&&!!R.clearcoatMap,clearcoatRoughnessMap:Oe&&!!R.clearcoatRoughnessMap,clearcoatNormalMap:Oe&&!!R.clearcoatNormalMap,iridescence:It,iridescenceMap:It&&!!R.iridescenceMap,iridescenceThicknessMap:It&&!!R.iridescenceThicknessMap,displacementMap:!!R.displacementMap,roughnessMap:!!R.roughnessMap,metalnessMap:!!R.metalnessMap,specularMap:!!R.specularMap,specularIntensityMap:!!R.specularIntensityMap,specularColorMap:!!R.specularColorMap,opaque:R.transparent===!1&&R.blending===su,alphaMap:!!R.alphaMap,alphaTest:tt,gradientMap:!!R.gradientMap,sheen:R.sheen>0,sheenColorMap:!!R.sheenColorMap,sheenRoughnessMap:!!R.sheenRoughnessMap,transmission:R.transmission>0,transmissionMap:!!R.transmissionMap,thicknessMap:!!R.thicknessMap,combine:R.combine,vertexTangents:!!R.normalMap&&!!$.attributes.tangent,vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,vertexUvs:!!R.map||!!R.bumpMap||!!R.normalMap||!!R.specularMap||!!R.alphaMap||!!R.emissiveMap||!!R.roughnessMap||!!R.metalnessMap||!!R.clearcoatMap||!!R.clearcoatRoughnessMap||!!R.clearcoatNormalMap||!!R.iridescenceMap||!!R.iridescenceThicknessMap||!!R.displacementMap||!!R.transmissionMap||!!R.thicknessMap||!!R.specularIntensityMap||!!R.specularColorMap||!!R.sheenColorMap||!!R.sheenRoughnessMap,uvsVertexOnly:!(R.map||R.bumpMap||R.normalMap||R.specularMap||R.alphaMap||R.emissiveMap||R.roughnessMap||R.metalnessMap||R.clearcoatNormalMap||R.iridescenceMap||R.iridescenceThicknessMap||R.transmission>0||R.transmissionMap||R.thicknessMap||R.specularIntensityMap||R.specularColorMap||R.sheen>0||R.sheenColorMap||R.sheenRoughnessMap)&&!!R.displacementMap,fog:!!j,useFog:R.fog===!0,fogExp2:j&&j.isFogExp2,flatShading:!!R.flatShading,sizeAttenuation:R.sizeAttenuation,logarithmicDepthBuffer:C,skinning:re.isSkinnedMesh===!0,morphTargets:$.morphAttributes.position!==void 0,morphNormals:$.morphAttributes.normal!==void 0,morphColors:$.morphAttributes.color!==void 0,morphTargetsCount:te,morphTextureStride:q,numDirLights:Y.directional.length,numPointLights:Y.point.length,numSpotLights:Y.spot.length,numSpotLightMaps:Y.spotLightMap.length,numRectAreaLights:Y.rectArea.length,numHemiLights:Y.hemi.length,numDirLightShadows:Y.directionalShadowMap.length,numPointLightShadows:Y.pointShadowMap.length,numSpotLightShadows:Y.spotShadowMap.length,numSpotLightShadowsWithMaps:Y.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:R.dithering,shadowMapEnabled:i.shadowMap.enabled&&M.length>0,shadowMapType:i.shadowMap.type,toneMapping:R.toneMapped?i.toneMapping:Wg,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===Lc,flipSided:R.side===ao,useDepthPacking:!!R.depthPacking,depthPacking:R.depthPacking||0,index0AttributeName:R.index0AttributeName,extensionDerivatives:R.extensions&&R.extensions.derivatives,extensionFragDepth:R.extensions&&R.extensions.fragDepth,extensionDrawBuffers:R.extensions&&R.extensions.drawBuffers,extensionShaderTextureLOD:R.extensions&&R.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),customProgramCacheKey:R.customProgramCacheKey()}}function b(R){const Y=[];if(R.shaderID?Y.push(R.shaderID):(Y.push(R.customVertexShaderID),Y.push(R.customFragmentShaderID)),R.defines!==void 0)for(const M in R.defines)Y.push(M),Y.push(R.defines[M]);return R.isRawShaderMaterial===!1&&(y(Y,R),v(Y,R),Y.push(i.outputEncoding)),Y.push(R.customProgramCacheKey),Y.join()}function y(R,Y){R.push(Y.precision),R.push(Y.outputEncoding),R.push(Y.envMapMode),R.push(Y.envMapCubeUVHeight),R.push(Y.combine),R.push(Y.vertexUvs),R.push(Y.fogExp2),R.push(Y.sizeAttenuation),R.push(Y.morphTargetsCount),R.push(Y.morphAttributeCount),R.push(Y.numDirLights),R.push(Y.numPointLights),R.push(Y.numSpotLights),R.push(Y.numSpotLightMaps),R.push(Y.numHemiLights),R.push(Y.numRectAreaLights),R.push(Y.numDirLightShadows),R.push(Y.numPointLightShadows),R.push(Y.numSpotLightShadows),R.push(Y.numSpotLightShadowsWithMaps),R.push(Y.shadowMapType),R.push(Y.toneMapping),R.push(Y.numClippingPlanes),R.push(Y.numClipIntersection),R.push(Y.depthPacking)}function v(R,Y){g.disableAll(),Y.isWebGL2&&g.enable(0),Y.supportsVertexTextures&&g.enable(1),Y.instancing&&g.enable(2),Y.instancingColor&&g.enable(3),Y.map&&g.enable(4),Y.matcap&&g.enable(5),Y.envMap&&g.enable(6),Y.lightMap&&g.enable(7),Y.aoMap&&g.enable(8),Y.emissiveMap&&g.enable(9),Y.bumpMap&&g.enable(10),Y.normalMap&&g.enable(11),Y.objectSpaceNormalMap&&g.enable(12),Y.tangentSpaceNormalMap&&g.enable(13),Y.clearcoat&&g.enable(14),Y.clearcoatMap&&g.enable(15),Y.clearcoatRoughnessMap&&g.enable(16),Y.clearcoatNormalMap&&g.enable(17),Y.iridescence&&g.enable(18),Y.iridescenceMap&&g.enable(19),Y.iridescenceThicknessMap&&g.enable(20),Y.displacementMap&&g.enable(21),Y.specularMap&&g.enable(22),Y.roughnessMap&&g.enable(23),Y.metalnessMap&&g.enable(24),Y.gradientMap&&g.enable(25),Y.alphaMap&&g.enable(26),Y.alphaTest&&g.enable(27),Y.vertexColors&&g.enable(28),Y.vertexAlphas&&g.enable(29),Y.vertexUvs&&g.enable(30),Y.vertexTangents&&g.enable(31),Y.uvsVertexOnly&&g.enable(32),R.push(g.mask),g.disableAll(),Y.fog&&g.enable(0),Y.useFog&&g.enable(1),Y.flatShading&&g.enable(2),Y.logarithmicDepthBuffer&&g.enable(3),Y.skinning&&g.enable(4),Y.morphTargets&&g.enable(5),Y.morphNormals&&g.enable(6),Y.morphColors&&g.enable(7),Y.premultipliedAlpha&&g.enable(8),Y.shadowMapEnabled&&g.enable(9),Y.physicallyCorrectLights&&g.enable(10),Y.doubleSided&&g.enable(11),Y.flipSided&&g.enable(12),Y.useDepthPacking&&g.enable(13),Y.dithering&&g.enable(14),Y.specularIntensityMap&&g.enable(15),Y.specularColorMap&&g.enable(16),Y.transmission&&g.enable(17),Y.transmissionMap&&g.enable(18),Y.thicknessMap&&g.enable(19),Y.sheen&&g.enable(20),Y.sheenColorMap&&g.enable(21),Y.sheenRoughnessMap&&g.enable(22),Y.decodeVideoTexture&&g.enable(23),Y.opaque&&g.enable(24),R.push(g.mask)}function G(R){const Y=m[R.type];let M;if(Y){const L=wg[Y];M=BV.clone(L.uniforms)}else M=R.uniforms;return M}function w(R,Y){let M;for(let L=0,re=l.length;L<re;L++){const j=l[L];if(j.cacheKey===Y){M=j,++M.usedTimes;break}}return M===void 0&&(M=new $D(i,Y,R,r),l.push(M)),M}function W(R){if(--R.usedTimes===0){const Y=l.indexOf(R);l[Y]=l[l.length-1],l.pop(),R.destroy()}}function V(R){a.remove(R)}function X(){a.dispose()}return{getParameters:f,getProgramCacheKey:b,getUniforms:G,acquireProgram:w,releaseProgram:W,releaseShaderCache:V,programs:l,dispose:X}}function sJ(){let i=new WeakMap;function e(r){let o=i.get(r);return o===void 0&&(o={},i.set(r,o)),o}function t(r){i.delete(r)}function n(r,o,g){i.get(r)[o]=g}function s(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:s}}function rJ(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function OR(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function QR(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}function o(C,h,p,m,f,b){let y=i[e];return y===void 0?(y={id:C.id,object:C,geometry:h,material:p,groupOrder:m,renderOrder:C.renderOrder,z:f,group:b},i[e]=y):(y.id=C.id,y.object=C,y.geometry=h,y.material=p,y.groupOrder=m,y.renderOrder=C.renderOrder,y.z=f,y.group=b),e++,y}function g(C,h,p,m,f,b){const y=o(C,h,p,m,f,b);p.transmission>0?n.push(y):p.transparent===!0?s.push(y):t.push(y)}function a(C,h,p,m,f,b){const y=o(C,h,p,m,f,b);p.transmission>0?n.unshift(y):p.transparent===!0?s.unshift(y):t.unshift(y)}function l(C,h){t.length>1&&t.sort(C||rJ),n.length>1&&n.sort(h||OR),s.length>1&&s.sort(h||OR)}function c(){for(let C=e,h=i.length;C<h;C++){const p=i[C];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:n,transparent:s,init:r,push:g,unshift:a,finish:c,sort:l}}function oJ(){let i=new WeakMap;function e(n,s){const r=i.get(n);let o;return r===void 0?(o=new QR,i.set(n,[o])):s>=r.length?(o=new QR,r.push(o)):o=r[s],o}function t(){i=new WeakMap}return{get:e,dispose:t}}function gJ(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new E,color:new et};break;case"SpotLight":t={position:new E,direction:new E,color:new et,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new E,color:new et,distance:0,decay:0};break;case"HemisphereLight":t={direction:new E,skyColor:new et,groundColor:new et};break;case"RectAreaLight":t={color:new et,position:new E,halfWidth:new E,halfHeight:new E};break}return i[e.id]=t,t}}}function aJ(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let lJ=0;function cJ(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function IJ(i,e){const t=new gJ,n=aJ(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let c=0;c<9;c++)s.probe.push(new E);const r=new E,o=new mt,g=new mt;function a(c,C){let h=0,p=0,m=0;for(let L=0;L<9;L++)s.probe[L].set(0,0,0);let f=0,b=0,y=0,v=0,G=0,w=0,W=0,V=0,X=0,R=0;c.sort(cJ);const Y=C!==!0?Math.PI:1;for(let L=0,re=c.length;L<re;L++){const j=c[L],$=j.color,ie=j.intensity,he=j.distance,le=j.shadow&&j.shadow.map?j.shadow.map.texture:null;if(j.isAmbientLight)h+=$.r*ie*Y,p+=$.g*ie*Y,m+=$.b*ie*Y;else if(j.isLightProbe)for(let _=0;_<9;_++)s.probe[_].addScaledVector(j.sh.coefficients[_],ie);else if(j.isDirectionalLight){const _=t.get(j);if(_.color.copy(j.color).multiplyScalar(j.intensity*Y),j.castShadow){const ne=j.shadow,te=n.get(j);te.shadowBias=ne.bias,te.shadowNormalBias=ne.normalBias,te.shadowRadius=ne.radius,te.shadowMapSize=ne.mapSize,s.directionalShadow[f]=te,s.directionalShadowMap[f]=le,s.directionalShadowMatrix[f]=j.shadow.matrix,w++}s.directional[f]=_,f++}else if(j.isSpotLight){const _=t.get(j);_.position.setFromMatrixPosition(j.matrixWorld),_.color.copy($).multiplyScalar(ie*Y),_.distance=he,_.coneCos=Math.cos(j.angle),_.penumbraCos=Math.cos(j.angle*(1-j.penumbra)),_.decay=j.decay,s.spot[y]=_;const ne=j.shadow;if(j.map&&(s.spotLightMap[X]=j.map,X++,ne.updateMatrices(j),j.castShadow&&R++),s.spotLightMatrix[y]=ne.matrix,j.castShadow){const te=n.get(j);te.shadowBias=ne.bias,te.shadowNormalBias=ne.normalBias,te.shadowRadius=ne.radius,te.shadowMapSize=ne.mapSize,s.spotShadow[y]=te,s.spotShadowMap[y]=le,V++}y++}else if(j.isRectAreaLight){const _=t.get(j);_.color.copy($).multiplyScalar(ie),_.halfWidth.set(j.width*.5,0,0),_.halfHeight.set(0,j.height*.5,0),s.rectArea[v]=_,v++}else if(j.isPointLight){const _=t.get(j);if(_.color.copy(j.color).multiplyScalar(j.intensity*Y),_.distance=j.distance,_.decay=j.decay,j.castShadow){const ne=j.shadow,te=n.get(j);te.shadowBias=ne.bias,te.shadowNormalBias=ne.normalBias,te.shadowRadius=ne.radius,te.shadowMapSize=ne.mapSize,te.shadowCameraNear=ne.camera.near,te.shadowCameraFar=ne.camera.far,s.pointShadow[b]=te,s.pointShadowMap[b]=le,s.pointShadowMatrix[b]=j.shadow.matrix,W++}s.point[b]=_,b++}else if(j.isHemisphereLight){const _=t.get(j);_.skyColor.copy(j.color).multiplyScalar(ie*Y),_.groundColor.copy(j.groundColor).multiplyScalar(ie*Y),s.hemi[G]=_,G++}}v>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=it.LTC_FLOAT_1,s.rectAreaLTC2=it.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=it.LTC_HALF_1,s.rectAreaLTC2=it.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=h,s.ambient[1]=p,s.ambient[2]=m;const M=s.hash;(M.directionalLength!==f||M.pointLength!==b||M.spotLength!==y||M.rectAreaLength!==v||M.hemiLength!==G||M.numDirectionalShadows!==w||M.numPointShadows!==W||M.numSpotShadows!==V||M.numSpotMaps!==X)&&(s.directional.length=f,s.spot.length=y,s.rectArea.length=v,s.point.length=b,s.hemi.length=G,s.directionalShadow.length=w,s.directionalShadowMap.length=w,s.pointShadow.length=W,s.pointShadowMap.length=W,s.spotShadow.length=V,s.spotShadowMap.length=V,s.directionalShadowMatrix.length=w,s.pointShadowMatrix.length=W,s.spotLightMatrix.length=V+X-R,s.spotLightMap.length=X,s.numSpotLightShadowsWithMaps=R,M.directionalLength=f,M.pointLength=b,M.spotLength=y,M.rectAreaLength=v,M.hemiLength=G,M.numDirectionalShadows=w,M.numPointShadows=W,M.numSpotShadows=V,M.numSpotMaps=X,s.version=lJ++)}function l(c,C){let h=0,p=0,m=0,f=0,b=0;const y=C.matrixWorldInverse;for(let v=0,G=c.length;v<G;v++){const w=c[v];if(w.isDirectionalLight){const W=s.directional[h];W.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),W.direction.sub(r),W.direction.transformDirection(y),h++}else if(w.isSpotLight){const W=s.spot[m];W.position.setFromMatrixPosition(w.matrixWorld),W.position.applyMatrix4(y),W.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),W.direction.sub(r),W.direction.transformDirection(y),m++}else if(w.isRectAreaLight){const W=s.rectArea[f];W.position.setFromMatrixPosition(w.matrixWorld),W.position.applyMatrix4(y),g.identity(),o.copy(w.matrixWorld),o.premultiply(y),g.extractRotation(o),W.halfWidth.set(w.width*.5,0,0),W.halfHeight.set(0,w.height*.5,0),W.halfWidth.applyMatrix4(g),W.halfHeight.applyMatrix4(g),f++}else if(w.isPointLight){const W=s.point[p];W.position.setFromMatrixPosition(w.matrixWorld),W.position.applyMatrix4(y),p++}else if(w.isHemisphereLight){const W=s.hemi[b];W.direction.setFromMatrixPosition(w.matrixWorld),W.direction.transformDirection(y),b++}}}return{setup:a,setupView:l,state:s}}function jR(i,e){const t=new IJ(i,e),n=[],s=[];function r(){n.length=0,s.length=0}function o(C){n.push(C)}function g(C){s.push(C)}function a(C){t.setup(n,C)}function l(C){t.setupView(n,C)}return{init:r,state:{lightsArray:n,shadowsArray:s,lights:t},setupLights:a,setupLightsView:l,pushLight:o,pushShadow:g}}function uJ(i,e){let t=new WeakMap;function n(r,o=0){const g=t.get(r);let a;return g===void 0?(a=new jR(i,e),t.set(r,[a])):o>=g.length?(a=new jR(i,e),g.push(a)):a=g[o],a}function s(){t=new WeakMap}return{get:n,dispose:s}}class hZ extends qn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=hV,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class AZ extends qn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new E,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const CJ=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,dJ=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function hJ(i,e,t){let n=new CG;const s=new Fe,r=new Fe,o=new wn,g=new hZ({depthPacking:AV}),a=new AZ,l={},c=t.maxTextureSize,C={0:ao,1:ua,2:Lc},h=new Xg({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Fe},radius:{value:4}},vertexShader:CJ,fragmentShader:dJ}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const m=new zt;m.setAttribute("position",new on(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new mi(m,h),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=aG,this.render=function(w,W,V){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||w.length===0)return;const X=i.getRenderTarget(),R=i.getActiveCubeFace(),Y=i.getActiveMipmapLevel(),M=i.state;M.setBlending(el),M.buffers.color.setClear(1,1,1,1),M.buffers.depth.setTest(!0),M.setScissorTest(!1);for(let L=0,re=w.length;L<re;L++){const j=w[L],$=j.shadow;if($===void 0){console.warn("THREE.WebGLShadowMap:",j,"has no shadow.");continue}if($.autoUpdate===!1&&$.needsUpdate===!1)continue;s.copy($.mapSize);const ie=$.getFrameExtents();if(s.multiply(ie),r.copy($.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(r.x=Math.floor(c/ie.x),s.x=r.x*ie.x,$.mapSize.x=r.x),s.y>c&&(r.y=Math.floor(c/ie.y),s.y=r.y*ie.y,$.mapSize.y=r.y)),$.map===null){const le=this.type!==QI?{minFilter:oi,magFilter:oi}:{};$.map=new Co(s.x,s.y,le),$.map.texture.name=j.name+".shadowMap",$.camera.updateProjectionMatrix()}i.setRenderTarget($.map),i.clear();const he=$.getViewportCount();for(let le=0;le<he;le++){const _=$.getViewport(le);o.set(r.x*_.x,r.y*_.y,r.x*_.z,r.y*_.w),M.viewport(o),$.updateMatrices(j,le),n=$.getFrustum(),G(W,V,$.camera,j,this.type)}$.isPointLightShadow!==!0&&this.type===QI&&y($,V),$.needsUpdate=!1}b.needsUpdate=!1,i.setRenderTarget(X,R,Y)};function y(w,W){const V=e.update(f);h.defines.VSM_SAMPLES!==w.blurSamples&&(h.defines.VSM_SAMPLES=w.blurSamples,p.defines.VSM_SAMPLES=w.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new Co(s.x,s.y)),h.uniforms.shadow_pass.value=w.map.texture,h.uniforms.resolution.value=w.mapSize,h.uniforms.radius.value=w.radius,i.setRenderTarget(w.mapPass),i.clear(),i.renderBufferDirect(W,null,V,h,f,null),p.uniforms.shadow_pass.value=w.mapPass.texture,p.uniforms.resolution.value=w.mapSize,p.uniforms.radius.value=w.radius,i.setRenderTarget(w.map),i.clear(),i.renderBufferDirect(W,null,V,p,f,null)}function v(w,W,V,X,R,Y){let M=null;const L=V.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(L!==void 0)M=L;else if(M=V.isPointLight===!0?a:g,i.localClippingEnabled&&W.clipShadows===!0&&Array.isArray(W.clippingPlanes)&&W.clippingPlanes.length!==0||W.displacementMap&&W.displacementScale!==0||W.alphaMap&&W.alphaTest>0||W.map&&W.alphaTest>0){const re=M.uuid,j=W.uuid;let $=l[re];$===void 0&&($={},l[re]=$);let ie=$[j];ie===void 0&&(ie=M.clone(),$[j]=ie),M=ie}return M.visible=W.visible,M.wireframe=W.wireframe,Y===QI?M.side=W.shadowSide!==null?W.shadowSide:W.side:M.side=W.shadowSide!==null?W.shadowSide:C[W.side],M.alphaMap=W.alphaMap,M.alphaTest=W.alphaTest,M.map=W.map,M.clipShadows=W.clipShadows,M.clippingPlanes=W.clippingPlanes,M.clipIntersection=W.clipIntersection,M.displacementMap=W.displacementMap,M.displacementScale=W.displacementScale,M.displacementBias=W.displacementBias,M.wireframeLinewidth=W.wireframeLinewidth,M.linewidth=W.linewidth,V.isPointLight===!0&&M.isMeshDistanceMaterial===!0&&(M.referencePosition.setFromMatrixPosition(V.matrixWorld),M.nearDistance=X,M.farDistance=R),M}function G(w,W,V,X,R){if(w.visible===!1)return;if(w.layers.test(W.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&R===QI)&&(!w.frustumCulled||n.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(V.matrixWorldInverse,w.matrixWorld);const L=e.update(w),re=w.material;if(Array.isArray(re)){const j=L.groups;for(let $=0,ie=j.length;$<ie;$++){const he=j[$],le=re[he.materialIndex];if(le&&le.visible){const _=v(w,le,X,V.near,V.far,R);i.renderBufferDirect(V,null,L,_,w,he)}}}else if(re.visible){const j=v(w,re,X,V.near,V.far,R);i.renderBufferDirect(V,null,L,j,w,null)}}const M=w.children;for(let L=0,re=M.length;L<re;L++)G(M[L],W,V,X,R)}}function AJ(i,e,t){const n=t.isWebGL2;function s(){let Ie=!1;const Se=new wn;let ze=null;const at=new wn(0,0,0,0);return{setMask:function(bt){ze!==bt&&!Ie&&(i.colorMask(bt,bt,bt,bt),ze=bt)},setLocked:function(bt){Ie=bt},setClear:function(bt,cn,$n,Hi,Nr){Nr===!0&&(bt*=Hi,cn*=Hi,$n*=Hi),Se.set(bt,cn,$n,Hi),at.equals(Se)===!1&&(i.clearColor(bt,cn,$n,Hi),at.copy(Se))},reset:function(){Ie=!1,ze=null,at.set(-1,0,0,0)}}}function r(){let Ie=!1,Se=null,ze=null,at=null;return{setTest:function(bt){bt?tt(2929):Oe(2929)},setMask:function(bt){Se!==bt&&!Ie&&(i.depthMask(bt),Se=bt)},setFunc:function(bt){if(ze!==bt){switch(bt){case Mx:i.depthFunc(512);break;case Kx:i.depthFunc(519);break;case Lx:i.depthFunc(513);break;case Vb:i.depthFunc(515);break;case zx:i.depthFunc(514);break;case _x:i.depthFunc(518);break;case kx:i.depthFunc(516);break;case Tx:i.depthFunc(517);break;default:i.depthFunc(515)}ze=bt}},setLocked:function(bt){Ie=bt},setClear:function(bt){at!==bt&&(i.clearDepth(bt),at=bt)},reset:function(){Ie=!1,Se=null,ze=null,at=null}}}function o(){let Ie=!1,Se=null,ze=null,at=null,bt=null,cn=null,$n=null,Hi=null,Nr=null;return{setTest:function(Bn){Ie||(Bn?tt(2960):Oe(2960))},setMask:function(Bn){Se!==Bn&&!Ie&&(i.stencilMask(Bn),Se=Bn)},setFunc:function(Bn,lr,ws){(ze!==Bn||at!==lr||bt!==ws)&&(i.stencilFunc(Bn,lr,ws),ze=Bn,at=lr,bt=ws)},setOp:function(Bn,lr,ws){(cn!==Bn||$n!==lr||Hi!==ws)&&(i.stencilOp(Bn,lr,ws),cn=Bn,$n=lr,Hi=ws)},setLocked:function(Bn){Ie=Bn},setClear:function(Bn){Nr!==Bn&&(i.clearStencil(Bn),Nr=Bn)},reset:function(){Ie=!1,Se=null,ze=null,at=null,bt=null,cn=null,$n=null,Hi=null,Nr=null}}}const g=new s,a=new r,l=new o,c=new WeakMap,C=new WeakMap;let h={},p={},m=new WeakMap,f=[],b=null,y=!1,v=null,G=null,w=null,W=null,V=null,X=null,R=null,Y=!1,M=null,L=null,re=null,j=null,$=null;const ie=i.getParameter(35661);let he=!1,le=0;const _=i.getParameter(7938);_.indexOf("WebGL")!==-1?(le=parseFloat(/^WebGL (\d)/.exec(_)[1]),he=le>=1):_.indexOf("OpenGL ES")!==-1&&(le=parseFloat(/^OpenGL ES (\d)/.exec(_)[1]),he=le>=2);let ne=null,te={};const q=i.getParameter(3088),se=i.getParameter(2978),ue=new wn().fromArray(q),Ae=new wn().fromArray(se);function We(Ie,Se,ze){const at=new Uint8Array(4),bt=i.createTexture();i.bindTexture(Ie,bt),i.texParameteri(Ie,10241,9728),i.texParameteri(Ie,10240,9728);for(let cn=0;cn<ze;cn++)i.texImage2D(Se+cn,0,6408,1,1,0,6408,5121,at);return bt}const me={};me[3553]=We(3553,3553,1),me[34067]=We(34067,34069,6),g.setClear(0,0,0,1),a.setClear(1),l.setClear(0),tt(2929),a.setFunc(Vb),Xe(!1),Pe(j2),tt(2884),Ve(el);function tt(Ie){h[Ie]!==!0&&(i.enable(Ie),h[Ie]=!0)}function Oe(Ie){h[Ie]!==!1&&(i.disable(Ie),h[Ie]=!1)}function It(Ie,Se){return p[Ie]!==Se?(i.bindFramebuffer(Ie,Se),p[Ie]=Se,n&&(Ie===36009&&(p[36160]=Se),Ie===36160&&(p[36009]=Se)),!0):!1}function ke(Ie,Se){let ze=f,at=!1;if(Ie)if(ze=m.get(Se),ze===void 0&&(ze=[],m.set(Se,ze)),Ie.isWebGLMultipleRenderTargets){const bt=Ie.texture;if(ze.length!==bt.length||ze[0]!==36064){for(let cn=0,$n=bt.length;cn<$n;cn++)ze[cn]=36064+cn;ze.length=bt.length,at=!0}}else ze[0]!==36064&&(ze[0]=36064,at=!0);else ze[0]!==1029&&(ze[0]=1029,at=!0);at&&(t.isWebGL2?i.drawBuffers(ze):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ze))}function je(Ie){return b!==Ie?(i.useProgram(Ie),b=Ie,!0):!1}const ve={[TI]:32774,[wx]:32778,[Sx]:32779};if(n)ve[tv]=32775,ve[nv]=32776;else{const Ie=e.get("EXT_blend_minmax");Ie!==null&&(ve[tv]=Ie.MIN_EXT,ve[nv]=Ie.MAX_EXT)}const be={[Rx]:0,[Wx]:1,[xx]:768,[iZ]:770,[Nx]:776,[Yx]:774,[Hx]:772,[Vx]:769,[sZ]:771,[Fx]:775,[Xx]:773};function Ve(Ie,Se,ze,at,bt,cn,$n,Hi){if(Ie===el){y===!0&&(Oe(3042),y=!1);return}if(y===!1&&(tt(3042),y=!0),Ie!==Zx){if(Ie!==v||Hi!==Y){if((G!==TI||V!==TI)&&(i.blendEquation(32774),G=TI,V=TI),Hi)switch(Ie){case su:i.blendFuncSeparate(1,771,1,771);break;case q2:i.blendFunc(1,1);break;case $2:i.blendFuncSeparate(0,769,0,1);break;case ev:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ie);break}else switch(Ie){case su:i.blendFuncSeparate(770,771,1,771);break;case q2:i.blendFunc(770,1);break;case $2:i.blendFuncSeparate(0,769,0,1);break;case ev:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ie);break}w=null,W=null,X=null,R=null,v=Ie,Y=Hi}return}bt=bt||Se,cn=cn||ze,$n=$n||at,(Se!==G||bt!==V)&&(i.blendEquationSeparate(ve[Se],ve[bt]),G=Se,V=bt),(ze!==w||at!==W||cn!==X||$n!==R)&&(i.blendFuncSeparate(be[ze],be[at],be[cn],be[$n]),w=ze,W=at,X=cn,R=$n),v=Ie,Y=!1}function qe(Ie,Se){Ie.side===Lc?Oe(2884):tt(2884);let ze=Ie.side===ao;Se&&(ze=!ze),Xe(ze),Ie.blending===su&&Ie.transparent===!1?Ve(el):Ve(Ie.blending,Ie.blendEquation,Ie.blendSrc,Ie.blendDst,Ie.blendEquationAlpha,Ie.blendSrcAlpha,Ie.blendDstAlpha,Ie.premultipliedAlpha),a.setFunc(Ie.depthFunc),a.setTest(Ie.depthTest),a.setMask(Ie.depthWrite),g.setMask(Ie.colorWrite);const at=Ie.stencilWrite;l.setTest(at),at&&(l.setMask(Ie.stencilWriteMask),l.setFunc(Ie.stencilFunc,Ie.stencilRef,Ie.stencilFuncMask),l.setOp(Ie.stencilFail,Ie.stencilZFail,Ie.stencilZPass)),gt(Ie.polygonOffset,Ie.polygonOffsetFactor,Ie.polygonOffsetUnits),Ie.alphaToCoverage===!0?tt(32926):Oe(32926)}function Xe(Ie){M!==Ie&&(Ie?i.frontFace(2304):i.frontFace(2305),M=Ie)}function Pe(Ie){Ie!==yx?(tt(2884),Ie!==L&&(Ie===j2?i.cullFace(1029):Ie===Bx?i.cullFace(1028):i.cullFace(1032))):Oe(2884),L=Ie}function ct(Ie){Ie!==re&&(he&&i.lineWidth(Ie),re=Ie)}function gt(Ie,Se,ze){Ie?(tt(32823),(j!==Se||$!==ze)&&(i.polygonOffset(Se,ze),j=Se,$=ze)):Oe(32823)}function Yt(Ie){Ie?tt(3089):Oe(3089)}function Zt(Ie){Ie===void 0&&(Ie=33984+ie-1),ne!==Ie&&(i.activeTexture(Ie),ne=Ie)}function O(Ie,Se,ze){ze===void 0&&(ne===null?ze=33984+ie-1:ze=ne);let at=te[ze];at===void 0&&(at={type:void 0,texture:void 0},te[ze]=at),(at.type!==Ie||at.texture!==Se)&&(ne!==ze&&(i.activeTexture(ze),ne=ze),i.bindTexture(Ie,Se||me[Ie]),at.type=Ie,at.texture=Se)}function z(){const Ie=te[ne];Ie!==void 0&&Ie.type!==void 0&&(i.bindTexture(Ie.type,null),Ie.type=void 0,Ie.texture=void 0)}function ye(){try{i.compressedTexImage2D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Le(){try{i.compressedTexImage3D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Te(){try{i.texSubImage2D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function De(){try{i.texSubImage3D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function vt(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function nt(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Ye(){try{i.texStorage2D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function dt(){try{i.texStorage3D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function oe(){try{i.texImage2D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function we(){try{i.texImage3D.apply(i,arguments)}catch(Ie){console.error("THREE.WebGLState:",Ie)}}function Ee(Ie){ue.equals(Ie)===!1&&(i.scissor(Ie.x,Ie.y,Ie.z,Ie.w),ue.copy(Ie))}function Qe(Ie){Ae.equals(Ie)===!1&&(i.viewport(Ie.x,Ie.y,Ie.z,Ie.w),Ae.copy(Ie))}function wt(Ie,Se){let ze=C.get(Se);ze===void 0&&(ze=new WeakMap,C.set(Se,ze));let at=ze.get(Ie);at===void 0&&(at=i.getUniformBlockIndex(Se,Ie.name),ze.set(Ie,at))}function Ot(Ie,Se){const at=C.get(Se).get(Ie);c.get(Se)!==at&&(i.uniformBlockBinding(Se,at,Ie.__bindingPointIndex),c.set(Se,at))}function Vn(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),h={},ne=null,te={},p={},m=new WeakMap,f=[],b=null,y=!1,v=null,G=null,w=null,W=null,V=null,X=null,R=null,Y=!1,M=null,L=null,re=null,j=null,$=null,ue.set(0,0,i.canvas.width,i.canvas.height),Ae.set(0,0,i.canvas.width,i.canvas.height),g.reset(),a.reset(),l.reset()}return{buffers:{color:g,depth:a,stencil:l},enable:tt,disable:Oe,bindFramebuffer:It,drawBuffers:ke,useProgram:je,setBlending:Ve,setMaterial:qe,setFlipSided:Xe,setCullFace:Pe,setLineWidth:ct,setPolygonOffset:gt,setScissorTest:Yt,activeTexture:Zt,bindTexture:O,unbindTexture:z,compressedTexImage2D:ye,compressedTexImage3D:Le,texImage2D:oe,texImage3D:we,updateUBOMapping:wt,uniformBlockBinding:Ot,texStorage2D:Ye,texStorage3D:dt,texSubImage2D:Te,texSubImage3D:De,compressedTexSubImage2D:vt,compressedTexSubImage3D:nt,scissor:Ee,viewport:Qe,reset:Vn}}function pJ(i,e,t,n,s,r,o){const g=s.isWebGL2,a=s.maxTextures,l=s.maxCubemapSize,c=s.maxTextureSize,C=s.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap;let f;const b=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(O,z){return y?new OffscreenCanvas(O,z):Gp("canvas")}function G(O,z,ye,Le){let Te=1;if((O.width>Le||O.height>Le)&&(Te=Le/Math.max(O.width,O.height)),Te<1||z===!0)if(typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&O instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&O instanceof ImageBitmap){const De=z?Yb:Math.floor,vt=De(Te*O.width),nt=De(Te*O.height);f===void 0&&(f=v(vt,nt));const Ye=ye?v(vt,nt):f;return Ye.width=vt,Ye.height=nt,Ye.getContext("2d").drawImage(O,0,0,vt,nt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+O.width+"x"+O.height+") to ("+vt+"x"+nt+")."),Ye}else return"data"in O&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+O.width+"x"+O.height+")."),O;return O}function w(O){return Zv(O.width)&&Zv(O.height)}function W(O){return g?!1:O.wrapS!==cs||O.wrapT!==cs||O.minFilter!==oi&&O.minFilter!==Zn}function V(O,z){return O.generateMipmaps&&z&&O.minFilter!==oi&&O.minFilter!==Zn}function X(O){i.generateMipmap(O)}function R(O,z,ye,Le,Te=!1){if(g===!1)return z;if(O!==null){if(i[O]!==void 0)return i[O];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+O+"'")}let De=z;return z===6403&&(ye===5126&&(De=33326),ye===5131&&(De=33325),ye===5121&&(De=33321)),z===33319&&(ye===5126&&(De=33328),ye===5131&&(De=33327),ye===5121&&(De=33323)),z===6408&&(ye===5126&&(De=34836),ye===5131&&(De=34842),ye===5121&&(De=Le===bn&&Te===!1?35907:32856),ye===32819&&(De=32854),ye===32820&&(De=32855)),(De===33325||De===33326||De===33327||De===33328||De===34842||De===34836)&&e.get("EXT_color_buffer_float"),De}function Y(O,z,ye){return V(O,ye)===!0||O.isFramebufferTexture&&O.minFilter!==oi&&O.minFilter!==Zn?Math.log2(Math.max(z.width,z.height))+1:O.mipmaps!==void 0&&O.mipmaps.length>0?O.mipmaps.length:O.isCompressedTexture&&Array.isArray(O.image)?z.mipmaps.length:1}function M(O){return O===oi||O===Vd||O===ru?9728:9729}function L(O){const z=O.target;z.removeEventListener("dispose",L),j(z),z.isVideoTexture&&m.delete(z)}function re(O){const z=O.target;z.removeEventListener("dispose",re),ie(z)}function j(O){const z=n.get(O);if(z.__webglInit===void 0)return;const ye=O.source,Le=b.get(ye);if(Le){const Te=Le[z.__cacheKey];Te.usedTimes--,Te.usedTimes===0&&$(O),Object.keys(Le).length===0&&b.delete(ye)}n.remove(O)}function $(O){const z=n.get(O);i.deleteTexture(z.__webglTexture);const ye=O.source,Le=b.get(ye);delete Le[z.__cacheKey],o.memory.textures--}function ie(O){const z=O.texture,ye=n.get(O),Le=n.get(z);if(Le.__webglTexture!==void 0&&(i.deleteTexture(Le.__webglTexture),o.memory.textures--),O.depthTexture&&O.depthTexture.dispose(),O.isWebGLCubeRenderTarget)for(let Te=0;Te<6;Te++)i.deleteFramebuffer(ye.__webglFramebuffer[Te]),ye.__webglDepthbuffer&&i.deleteRenderbuffer(ye.__webglDepthbuffer[Te]);else{if(i.deleteFramebuffer(ye.__webglFramebuffer),ye.__webglDepthbuffer&&i.deleteRenderbuffer(ye.__webglDepthbuffer),ye.__webglMultisampledFramebuffer&&i.deleteFramebuffer(ye.__webglMultisampledFramebuffer),ye.__webglColorRenderbuffer)for(let Te=0;Te<ye.__webglColorRenderbuffer.length;Te++)ye.__webglColorRenderbuffer[Te]&&i.deleteRenderbuffer(ye.__webglColorRenderbuffer[Te]);ye.__webglDepthRenderbuffer&&i.deleteRenderbuffer(ye.__webglDepthRenderbuffer)}if(O.isWebGLMultipleRenderTargets)for(let Te=0,De=z.length;Te<De;Te++){const vt=n.get(z[Te]);vt.__webglTexture&&(i.deleteTexture(vt.__webglTexture),o.memory.textures--),n.remove(z[Te])}n.remove(z),n.remove(O)}let he=0;function le(){he=0}function _(){const O=he;return O>=a&&console.warn("THREE.WebGLTextures: Trying to use "+O+" texture units while this GPU supports only "+a),he+=1,O}function ne(O){const z=[];return z.push(O.wrapS),z.push(O.wrapT),z.push(O.wrapR||0),z.push(O.magFilter),z.push(O.minFilter),z.push(O.anisotropy),z.push(O.internalFormat),z.push(O.format),z.push(O.type),z.push(O.generateMipmaps),z.push(O.premultiplyAlpha),z.push(O.flipY),z.push(O.unpackAlignment),z.push(O.encoding),z.join()}function te(O,z){const ye=n.get(O);if(O.isVideoTexture&&Yt(O),O.isRenderTargetTexture===!1&&O.version>0&&ye.__version!==O.version){const Le=O.image;if(Le===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Oe(ye,O,z);return}}t.bindTexture(3553,ye.__webglTexture,33984+z)}function q(O,z){const ye=n.get(O);if(O.version>0&&ye.__version!==O.version){Oe(ye,O,z);return}t.bindTexture(35866,ye.__webglTexture,33984+z)}function se(O,z){const ye=n.get(O);if(O.version>0&&ye.__version!==O.version){Oe(ye,O,z);return}t.bindTexture(32879,ye.__webglTexture,33984+z)}function ue(O,z){const ye=n.get(O);if(O.version>0&&ye.__version!==O.version){It(ye,O,z);return}t.bindTexture(34067,ye.__webglTexture,33984+z)}const Ae={[Hg]:10497,[cs]:33071,[mu]:33648},We={[oi]:9728,[Vd]:9984,[ru]:9986,[Zn]:9729,[kp]:9985,[eg]:9987};function me(O,z,ye){if(ye?(i.texParameteri(O,10242,Ae[z.wrapS]),i.texParameteri(O,10243,Ae[z.wrapT]),(O===32879||O===35866)&&i.texParameteri(O,32882,Ae[z.wrapR]),i.texParameteri(O,10240,We[z.magFilter]),i.texParameteri(O,10241,We[z.minFilter])):(i.texParameteri(O,10242,33071),i.texParameteri(O,10243,33071),(O===32879||O===35866)&&i.texParameteri(O,32882,33071),(z.wrapS!==cs||z.wrapT!==cs)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(O,10240,M(z.magFilter)),i.texParameteri(O,10241,M(z.minFilter)),z.minFilter!==oi&&z.minFilter!==Zn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Le=e.get("EXT_texture_filter_anisotropic");if(z.magFilter===oi||z.minFilter!==ru&&z.minFilter!==eg||z.type===Do&&e.has("OES_texture_float_linear")===!1||g===!1&&z.type===Jo&&e.has("OES_texture_half_float_linear")===!1)return;(z.anisotropy>1||n.get(z).__currentAnisotropy)&&(i.texParameterf(O,Le.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,s.getMaxAnisotropy())),n.get(z).__currentAnisotropy=z.anisotropy)}}function tt(O,z){let ye=!1;O.__webglInit===void 0&&(O.__webglInit=!0,z.addEventListener("dispose",L));const Le=z.source;let Te=b.get(Le);Te===void 0&&(Te={},b.set(Le,Te));const De=ne(z);if(De!==O.__cacheKey){Te[De]===void 0&&(Te[De]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,ye=!0),Te[De].usedTimes++;const vt=Te[O.__cacheKey];vt!==void 0&&(Te[O.__cacheKey].usedTimes--,vt.usedTimes===0&&$(z)),O.__cacheKey=De,O.__webglTexture=Te[De].texture}return ye}function Oe(O,z,ye){let Le=3553;(z.isDataArrayTexture||z.isCompressedArrayTexture)&&(Le=35866),z.isData3DTexture&&(Le=32879);const Te=tt(O,z),De=z.source;t.bindTexture(Le,O.__webglTexture,33984+ye);const vt=n.get(De);if(De.version!==vt.__version||Te===!0){t.activeTexture(33984+ye),i.pixelStorei(37440,z.flipY),i.pixelStorei(37441,z.premultiplyAlpha),i.pixelStorei(3317,z.unpackAlignment),i.pixelStorei(37443,0);const nt=W(z)&&w(z.image)===!1;let Ye=G(z.image,nt,!1,c);Ye=Zt(z,Ye);const dt=w(Ye)||g,oe=r.convert(z.format,z.encoding);let we=r.convert(z.type),Ee=R(z.internalFormat,oe,we,z.encoding,z.isVideoTexture);me(Le,z,dt);let Qe;const wt=z.mipmaps,Ot=g&&z.isVideoTexture!==!0,Vn=vt.__version===void 0||Te===!0,Ie=Y(z,Ye,dt);if(z.isDepthTexture)Ee=6402,g?z.type===Do?Ee=36012:z.type===Cc?Ee=33190:z.type===ou?Ee=35056:Ee=33189:z.type===Do&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),z.format===Zc&&Ee===6402&&z.type!==oZ&&z.type!==Cc&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),z.type=Cc,we=r.convert(z.type)),z.format===bu&&Ee===6402&&(Ee=34041,z.type!==ou&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),z.type=ou,we=r.convert(z.type))),Vn&&(Ot?t.texStorage2D(3553,1,Ee,Ye.width,Ye.height):t.texImage2D(3553,0,Ee,Ye.width,Ye.height,0,oe,we,null));else if(z.isDataTexture)if(wt.length>0&&dt){Ot&&Vn&&t.texStorage2D(3553,Ie,Ee,wt[0].width,wt[0].height);for(let Se=0,ze=wt.length;Se<ze;Se++)Qe=wt[Se],Ot?t.texSubImage2D(3553,Se,0,0,Qe.width,Qe.height,oe,we,Qe.data):t.texImage2D(3553,Se,Ee,Qe.width,Qe.height,0,oe,we,Qe.data);z.generateMipmaps=!1}else Ot?(Vn&&t.texStorage2D(3553,Ie,Ee,Ye.width,Ye.height),t.texSubImage2D(3553,0,0,0,Ye.width,Ye.height,oe,we,Ye.data)):t.texImage2D(3553,0,Ee,Ye.width,Ye.height,0,oe,we,Ye.data);else if(z.isCompressedTexture)if(z.isCompressedArrayTexture){Ot&&Vn&&t.texStorage3D(35866,Ie,Ee,wt[0].width,wt[0].height,Ye.depth);for(let Se=0,ze=wt.length;Se<ze;Se++)Qe=wt[Se],z.format!==Zr?oe!==null?Ot?t.compressedTexSubImage3D(35866,Se,0,0,0,Qe.width,Qe.height,Ye.depth,oe,Qe.data,0,0):t.compressedTexImage3D(35866,Se,Ee,Qe.width,Qe.height,Ye.depth,0,Qe.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ot?t.texSubImage3D(35866,Se,0,0,0,Qe.width,Qe.height,Ye.depth,oe,we,Qe.data):t.texImage3D(35866,Se,Ee,Qe.width,Qe.height,Ye.depth,0,oe,we,Qe.data)}else{Ot&&Vn&&t.texStorage2D(3553,Ie,Ee,wt[0].width,wt[0].height);for(let Se=0,ze=wt.length;Se<ze;Se++)Qe=wt[Se],z.format!==Zr?oe!==null?Ot?t.compressedTexSubImage2D(3553,Se,0,0,Qe.width,Qe.height,oe,Qe.data):t.compressedTexImage2D(3553,Se,Ee,Qe.width,Qe.height,0,Qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ot?t.texSubImage2D(3553,Se,0,0,Qe.width,Qe.height,oe,we,Qe.data):t.texImage2D(3553,Se,Ee,Qe.width,Qe.height,0,oe,we,Qe.data)}else if(z.isDataArrayTexture)Ot?(Vn&&t.texStorage3D(35866,Ie,Ee,Ye.width,Ye.height,Ye.depth),t.texSubImage3D(35866,0,0,0,0,Ye.width,Ye.height,Ye.depth,oe,we,Ye.data)):t.texImage3D(35866,0,Ee,Ye.width,Ye.height,Ye.depth,0,oe,we,Ye.data);else if(z.isData3DTexture)Ot?(Vn&&t.texStorage3D(32879,Ie,Ee,Ye.width,Ye.height,Ye.depth),t.texSubImage3D(32879,0,0,0,0,Ye.width,Ye.height,Ye.depth,oe,we,Ye.data)):t.texImage3D(32879,0,Ee,Ye.width,Ye.height,Ye.depth,0,oe,we,Ye.data);else if(z.isFramebufferTexture){if(Vn)if(Ot)t.texStorage2D(3553,Ie,Ee,Ye.width,Ye.height);else{let Se=Ye.width,ze=Ye.height;for(let at=0;at<Ie;at++)t.texImage2D(3553,at,Ee,Se,ze,0,oe,we,null),Se>>=1,ze>>=1}}else if(wt.length>0&&dt){Ot&&Vn&&t.texStorage2D(3553,Ie,Ee,wt[0].width,wt[0].height);for(let Se=0,ze=wt.length;Se<ze;Se++)Qe=wt[Se],Ot?t.texSubImage2D(3553,Se,0,0,oe,we,Qe):t.texImage2D(3553,Se,Ee,oe,we,Qe);z.generateMipmaps=!1}else Ot?(Vn&&t.texStorage2D(3553,Ie,Ee,Ye.width,Ye.height),t.texSubImage2D(3553,0,0,0,oe,we,Ye)):t.texImage2D(3553,0,Ee,oe,we,Ye);V(z,dt)&&X(Le),vt.__version=De.version,z.onUpdate&&z.onUpdate(z)}O.__version=z.version}function It(O,z,ye){if(z.image.length!==6)return;const Le=tt(O,z),Te=z.source;t.bindTexture(34067,O.__webglTexture,33984+ye);const De=n.get(Te);if(Te.version!==De.__version||Le===!0){t.activeTexture(33984+ye),i.pixelStorei(37440,z.flipY),i.pixelStorei(37441,z.premultiplyAlpha),i.pixelStorei(3317,z.unpackAlignment),i.pixelStorei(37443,0);const vt=z.isCompressedTexture||z.image[0].isCompressedTexture,nt=z.image[0]&&z.image[0].isDataTexture,Ye=[];for(let Se=0;Se<6;Se++)!vt&&!nt?Ye[Se]=G(z.image[Se],!1,!0,l):Ye[Se]=nt?z.image[Se].image:z.image[Se],Ye[Se]=Zt(z,Ye[Se]);const dt=Ye[0],oe=w(dt)||g,we=r.convert(z.format,z.encoding),Ee=r.convert(z.type),Qe=R(z.internalFormat,we,Ee,z.encoding),wt=g&&z.isVideoTexture!==!0,Ot=De.__version===void 0||Le===!0;let Vn=Y(z,dt,oe);me(34067,z,oe);let Ie;if(vt){wt&&Ot&&t.texStorage2D(34067,Vn,Qe,dt.width,dt.height);for(let Se=0;Se<6;Se++){Ie=Ye[Se].mipmaps;for(let ze=0;ze<Ie.length;ze++){const at=Ie[ze];z.format!==Zr?we!==null?wt?t.compressedTexSubImage2D(34069+Se,ze,0,0,at.width,at.height,we,at.data):t.compressedTexImage2D(34069+Se,ze,Qe,at.width,at.height,0,at.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):wt?t.texSubImage2D(34069+Se,ze,0,0,at.width,at.height,we,Ee,at.data):t.texImage2D(34069+Se,ze,Qe,at.width,at.height,0,we,Ee,at.data)}}}else{Ie=z.mipmaps,wt&&Ot&&(Ie.length>0&&Vn++,t.texStorage2D(34067,Vn,Qe,Ye[0].width,Ye[0].height));for(let Se=0;Se<6;Se++)if(nt){wt?t.texSubImage2D(34069+Se,0,0,0,Ye[Se].width,Ye[Se].height,we,Ee,Ye[Se].data):t.texImage2D(34069+Se,0,Qe,Ye[Se].width,Ye[Se].height,0,we,Ee,Ye[Se].data);for(let ze=0;ze<Ie.length;ze++){const bt=Ie[ze].image[Se].image;wt?t.texSubImage2D(34069+Se,ze+1,0,0,bt.width,bt.height,we,Ee,bt.data):t.texImage2D(34069+Se,ze+1,Qe,bt.width,bt.height,0,we,Ee,bt.data)}}else{wt?t.texSubImage2D(34069+Se,0,0,0,we,Ee,Ye[Se]):t.texImage2D(34069+Se,0,Qe,we,Ee,Ye[Se]);for(let ze=0;ze<Ie.length;ze++){const at=Ie[ze];wt?t.texSubImage2D(34069+Se,ze+1,0,0,we,Ee,at.image[Se]):t.texImage2D(34069+Se,ze+1,Qe,we,Ee,at.image[Se])}}}V(z,oe)&&X(34067),De.__version=Te.version,z.onUpdate&&z.onUpdate(z)}O.__version=z.version}function ke(O,z,ye,Le,Te){const De=r.convert(ye.format,ye.encoding),vt=r.convert(ye.type),nt=R(ye.internalFormat,De,vt,ye.encoding);n.get(z).__hasExternalTextures||(Te===32879||Te===35866?t.texImage3D(Te,0,nt,z.width,z.height,z.depth,0,De,vt,null):t.texImage2D(Te,0,nt,z.width,z.height,0,De,vt,null)),t.bindFramebuffer(36160,O),gt(z)?h.framebufferTexture2DMultisampleEXT(36160,Le,Te,n.get(ye).__webglTexture,0,ct(z)):(Te===3553||Te>=34069&&Te<=34074)&&i.framebufferTexture2D(36160,Le,Te,n.get(ye).__webglTexture,0),t.bindFramebuffer(36160,null)}function je(O,z,ye){if(i.bindRenderbuffer(36161,O),z.depthBuffer&&!z.stencilBuffer){let Le=33189;if(ye||gt(z)){const Te=z.depthTexture;Te&&Te.isDepthTexture&&(Te.type===Do?Le=36012:Te.type===Cc&&(Le=33190));const De=ct(z);gt(z)?h.renderbufferStorageMultisampleEXT(36161,De,Le,z.width,z.height):i.renderbufferStorageMultisample(36161,De,Le,z.width,z.height)}else i.renderbufferStorage(36161,Le,z.width,z.height);i.framebufferRenderbuffer(36160,36096,36161,O)}else if(z.depthBuffer&&z.stencilBuffer){const Le=ct(z);ye&&gt(z)===!1?i.renderbufferStorageMultisample(36161,Le,35056,z.width,z.height):gt(z)?h.renderbufferStorageMultisampleEXT(36161,Le,35056,z.width,z.height):i.renderbufferStorage(36161,34041,z.width,z.height),i.framebufferRenderbuffer(36160,33306,36161,O)}else{const Le=z.isWebGLMultipleRenderTargets===!0?z.texture:[z.texture];for(let Te=0;Te<Le.length;Te++){const De=Le[Te],vt=r.convert(De.format,De.encoding),nt=r.convert(De.type),Ye=R(De.internalFormat,vt,nt,De.encoding),dt=ct(z);ye&&gt(z)===!1?i.renderbufferStorageMultisample(36161,dt,Ye,z.width,z.height):gt(z)?h.renderbufferStorageMultisampleEXT(36161,dt,Ye,z.width,z.height):i.renderbufferStorage(36161,Ye,z.width,z.height)}}i.bindRenderbuffer(36161,null)}function ve(O,z){if(z&&z.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,O),!(z.depthTexture&&z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(z.depthTexture).__webglTexture||z.depthTexture.image.width!==z.width||z.depthTexture.image.height!==z.height)&&(z.depthTexture.image.width=z.width,z.depthTexture.image.height=z.height,z.depthTexture.needsUpdate=!0),te(z.depthTexture,0);const Le=n.get(z.depthTexture).__webglTexture,Te=ct(z);if(z.depthTexture.format===Zc)gt(z)?h.framebufferTexture2DMultisampleEXT(36160,36096,3553,Le,0,Te):i.framebufferTexture2D(36160,36096,3553,Le,0);else if(z.depthTexture.format===bu)gt(z)?h.framebufferTexture2DMultisampleEXT(36160,33306,3553,Le,0,Te):i.framebufferTexture2D(36160,33306,3553,Le,0);else throw new Error("Unknown depthTexture format")}function be(O){const z=n.get(O),ye=O.isWebGLCubeRenderTarget===!0;if(O.depthTexture&&!z.__autoAllocateDepthBuffer){if(ye)throw new Error("target.depthTexture not supported in Cube render targets");ve(z.__webglFramebuffer,O)}else if(ye){z.__webglDepthbuffer=[];for(let Le=0;Le<6;Le++)t.bindFramebuffer(36160,z.__webglFramebuffer[Le]),z.__webglDepthbuffer[Le]=i.createRenderbuffer(),je(z.__webglDepthbuffer[Le],O,!1)}else t.bindFramebuffer(36160,z.__webglFramebuffer),z.__webglDepthbuffer=i.createRenderbuffer(),je(z.__webglDepthbuffer,O,!1);t.bindFramebuffer(36160,null)}function Ve(O,z,ye){const Le=n.get(O);z!==void 0&&ke(Le.__webglFramebuffer,O,O.texture,36064,3553),ye!==void 0&&be(O)}function qe(O){const z=O.texture,ye=n.get(O),Le=n.get(z);O.addEventListener("dispose",re),O.isWebGLMultipleRenderTargets!==!0&&(Le.__webglTexture===void 0&&(Le.__webglTexture=i.createTexture()),Le.__version=z.version,o.memory.textures++);const Te=O.isWebGLCubeRenderTarget===!0,De=O.isWebGLMultipleRenderTargets===!0,vt=w(O)||g;if(Te){ye.__webglFramebuffer=[];for(let nt=0;nt<6;nt++)ye.__webglFramebuffer[nt]=i.createFramebuffer()}else{if(ye.__webglFramebuffer=i.createFramebuffer(),De)if(s.drawBuffers){const nt=O.texture;for(let Ye=0,dt=nt.length;Ye<dt;Ye++){const oe=n.get(nt[Ye]);oe.__webglTexture===void 0&&(oe.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(g&&O.samples>0&&gt(O)===!1){const nt=De?z:[z];ye.__webglMultisampledFramebuffer=i.createFramebuffer(),ye.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,ye.__webglMultisampledFramebuffer);for(let Ye=0;Ye<nt.length;Ye++){const dt=nt[Ye];ye.__webglColorRenderbuffer[Ye]=i.createRenderbuffer(),i.bindRenderbuffer(36161,ye.__webglColorRenderbuffer[Ye]);const oe=r.convert(dt.format,dt.encoding),we=r.convert(dt.type),Ee=R(dt.internalFormat,oe,we,dt.encoding,O.isXRRenderTarget===!0),Qe=ct(O);i.renderbufferStorageMultisample(36161,Qe,Ee,O.width,O.height),i.framebufferRenderbuffer(36160,36064+Ye,36161,ye.__webglColorRenderbuffer[Ye])}i.bindRenderbuffer(36161,null),O.depthBuffer&&(ye.__webglDepthRenderbuffer=i.createRenderbuffer(),je(ye.__webglDepthRenderbuffer,O,!0)),t.bindFramebuffer(36160,null)}}if(Te){t.bindTexture(34067,Le.__webglTexture),me(34067,z,vt);for(let nt=0;nt<6;nt++)ke(ye.__webglFramebuffer[nt],O,z,36064,34069+nt);V(z,vt)&&X(34067),t.unbindTexture()}else if(De){const nt=O.texture;for(let Ye=0,dt=nt.length;Ye<dt;Ye++){const oe=nt[Ye],we=n.get(oe);t.bindTexture(3553,we.__webglTexture),me(3553,oe,vt),ke(ye.__webglFramebuffer,O,oe,36064+Ye,3553),V(oe,vt)&&X(3553)}t.unbindTexture()}else{let nt=3553;(O.isWebGL3DRenderTarget||O.isWebGLArrayRenderTarget)&&(g?nt=O.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(nt,Le.__webglTexture),me(nt,z,vt),ke(ye.__webglFramebuffer,O,z,36064,nt),V(z,vt)&&X(nt),t.unbindTexture()}O.depthBuffer&&be(O)}function Xe(O){const z=w(O)||g,ye=O.isWebGLMultipleRenderTargets===!0?O.texture:[O.texture];for(let Le=0,Te=ye.length;Le<Te;Le++){const De=ye[Le];if(V(De,z)){const vt=O.isWebGLCubeRenderTarget?34067:3553,nt=n.get(De).__webglTexture;t.bindTexture(vt,nt),X(vt),t.unbindTexture()}}}function Pe(O){if(g&&O.samples>0&&gt(O)===!1){const z=O.isWebGLMultipleRenderTargets?O.texture:[O.texture],ye=O.width,Le=O.height;let Te=16384;const De=[],vt=O.stencilBuffer?33306:36096,nt=n.get(O),Ye=O.isWebGLMultipleRenderTargets===!0;if(Ye)for(let dt=0;dt<z.length;dt++)t.bindFramebuffer(36160,nt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+dt,36161,null),t.bindFramebuffer(36160,nt.__webglFramebuffer),i.framebufferTexture2D(36009,36064+dt,3553,null,0);t.bindFramebuffer(36008,nt.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,nt.__webglFramebuffer);for(let dt=0;dt<z.length;dt++){De.push(36064+dt),O.depthBuffer&&De.push(vt);const oe=nt.__ignoreDepthValues!==void 0?nt.__ignoreDepthValues:!1;if(oe===!1&&(O.depthBuffer&&(Te|=256),O.stencilBuffer&&(Te|=1024)),Ye&&i.framebufferRenderbuffer(36008,36064,36161,nt.__webglColorRenderbuffer[dt]),oe===!0&&(i.invalidateFramebuffer(36008,[vt]),i.invalidateFramebuffer(36009,[vt])),Ye){const we=n.get(z[dt]).__webglTexture;i.framebufferTexture2D(36009,36064,3553,we,0)}i.blitFramebuffer(0,0,ye,Le,0,0,ye,Le,Te,9728),p&&i.invalidateFramebuffer(36008,De)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),Ye)for(let dt=0;dt<z.length;dt++){t.bindFramebuffer(36160,nt.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+dt,36161,nt.__webglColorRenderbuffer[dt]);const oe=n.get(z[dt]).__webglTexture;t.bindFramebuffer(36160,nt.__webglFramebuffer),i.framebufferTexture2D(36009,36064+dt,3553,oe,0)}t.bindFramebuffer(36009,nt.__webglMultisampledFramebuffer)}}function ct(O){return Math.min(C,O.samples)}function gt(O){const z=n.get(O);return g&&O.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&z.__useRenderToTexture!==!1}function Yt(O){const z=o.render.frame;m.get(O)!==z&&(m.set(O,z),O.update())}function Zt(O,z){const ye=O.encoding,Le=O.format,Te=O.type;return O.isCompressedTexture===!0||O.isVideoTexture===!0||O.format===Xb||ye!==al&&(ye===bn?g===!1?e.has("EXT_sRGB")===!0&&Le===Zr?(O.format=Xb,O.minFilter=Zn,O.generateMipmaps=!1):z=cZ.sRGBToLinear(z):(Le!==Zr||Te!==ol)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ye)),z}this.allocateTextureUnit=_,this.resetTextureUnits=le,this.setTexture2D=te,this.setTexture2DArray=q,this.setTexture3D=se,this.setTextureCube=ue,this.rebindTextures=Ve,this.setupRenderTarget=qe,this.updateRenderTargetMipmap=Xe,this.updateMultisampleRenderTarget=Pe,this.setupDepthRenderbuffer=be,this.setupFrameBufferTexture=ke,this.useMultisampledRTT=gt}function xV(i,e,t){const n=t.isWebGL2;function s(r,o=null){let g;if(r===ol)return 5121;if(r===$x)return 32819;if(r===eV)return 32820;if(r===Qx)return 5120;if(r===jx)return 5122;if(r===oZ)return 5123;if(r===qx)return 5124;if(r===Cc)return 5125;if(r===Do)return 5126;if(r===Jo)return n?5131:(g=e.get("OES_texture_half_float"),g!==null?g.HALF_FLOAT_OES:null);if(r===tV)return 6406;if(r===Zr)return 6408;if(r===iV)return 6409;if(r===sV)return 6410;if(r===Zc)return 6402;if(r===bu)return 34041;if(r===nV)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===Xb)return g=e.get("EXT_sRGB"),g!==null?g.SRGB_ALPHA_EXT:null;if(r===rV)return 6403;if(r===oV)return 36244;if(r===gV)return 33319;if(r===aV)return 33320;if(r===lV)return 36249;if(r===U0||r===P0||r===O0||r===Q0)if(o===bn)if(g=e.get("WEBGL_compressed_texture_s3tc_srgb"),g!==null){if(r===U0)return g.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===P0)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===O0)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Q0)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(g=e.get("WEBGL_compressed_texture_s3tc"),g!==null){if(r===U0)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===P0)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===O0)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Q0)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===iv||r===sv||r===rv||r===ov)if(g=e.get("WEBGL_compressed_texture_pvrtc"),g!==null){if(r===iv)return g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===sv)return g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===rv)return g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===ov)return g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===cV)return g=e.get("WEBGL_compressed_texture_etc1"),g!==null?g.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===gv||r===av)if(g=e.get("WEBGL_compressed_texture_etc"),g!==null){if(r===gv)return o===bn?g.COMPRESSED_SRGB8_ETC2:g.COMPRESSED_RGB8_ETC2;if(r===av)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===lv||r===cv||r===Iv||r===uv||r===Cv||r===dv||r===hv||r===Av||r===pv||r===fv||r===mv||r===bv||r===Gv||r===yv)if(g=e.get("WEBGL_compressed_texture_astc"),g!==null){if(r===lv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:g.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===cv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:g.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===Iv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:g.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===uv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:g.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Cv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:g.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===dv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:g.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===hv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:g.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===Av)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:g.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===pv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:g.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===fv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:g.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===mv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:g.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===bv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:g.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===Gv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:g.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===yv)return o===bn?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:g.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Bv)if(g=e.get("EXT_texture_compression_bptc"),g!==null){if(r===Bv)return o===bn?g.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:g.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===ou?n?34042:(g=e.get("WEBGL_depth_texture"),g!==null?g.UNSIGNED_INT_24_8_WEBGL:null):i[r]!==void 0?i[r]:null}return{convert:s}}class VV extends Dn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class oo extends en{constructor(){super(),this.isGroup=!0,this.type="Group"}}const fJ={type:"move"};class hB{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new oo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new oo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new E,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new E),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new oo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new E,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new E),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,o=null;const g=this._targetRay,a=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){o=!0;for(const f of e.hand.values()){const b=t.getJointPose(f,n),y=this._getHandJoint(l,f);b!==null&&(y.matrix.fromArray(b.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=b.radius),y.visible=b!==null}const c=l.joints["index-finger-tip"],C=l.joints["thumb-tip"],h=c.position.distanceTo(C.position),p=.02,m=.005;l.inputState.pinching&&h>p+m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=p-m&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else a!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));g!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(g.matrix.fromArray(s.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),s.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(s.linearVelocity)):g.hasLinearVelocity=!1,s.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(s.angularVelocity)):g.hasAngularVelocity=!1,this.dispatchEvent(fJ)))}return g!==null&&(g.visible=s!==null),a!==null&&(a.visible=r!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new oo;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class HV extends kn{constructor(e,t,n,s,r,o,g,a,l,c){if(c=c!==void 0?c:Zc,c!==Zc&&c!==bu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&c===Zc&&(n=Cc),n===void 0&&c===bu&&(n=ou),super(null,s,r,o,g,a,c,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=g!==void 0?g:oi,this.minFilter=a!==void 0?a:oi,this.flipY=!1,this.generateMipmaps=!1}}class mJ extends ha{constructor(e,t){super();const n=this;let s=null,r=1,o=null,g="local-floor",a=null,l=null,c=null,C=null,h=null,p=null;const m=t.getContextAttributes();let f=null,b=null;const y=[],v=[],G=new Set,w=new Map,W=new Dn;W.layers.enable(1),W.viewport=new wn;const V=new Dn;V.layers.enable(2),V.viewport=new wn;const X=[W,V],R=new VV;R.layers.enable(1),R.layers.enable(2);let Y=null,M=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(q){let se=y[q];return se===void 0&&(se=new hB,y[q]=se),se.getTargetRaySpace()},this.getControllerGrip=function(q){let se=y[q];return se===void 0&&(se=new hB,y[q]=se),se.getGripSpace()},this.getHand=function(q){let se=y[q];return se===void 0&&(se=new hB,y[q]=se),se.getHandSpace()};function L(q){const se=v.indexOf(q.inputSource);if(se===-1)return;const ue=y[se];ue!==void 0&&ue.dispatchEvent({type:q.type,data:q.inputSource})}function re(){s.removeEventListener("select",L),s.removeEventListener("selectstart",L),s.removeEventListener("selectend",L),s.removeEventListener("squeeze",L),s.removeEventListener("squeezestart",L),s.removeEventListener("squeezeend",L),s.removeEventListener("end",re),s.removeEventListener("inputsourceschange",j);for(let q=0;q<y.length;q++){const se=v[q];se!==null&&(v[q]=null,y[q].disconnect(se))}Y=null,M=null,e.setRenderTarget(f),h=null,C=null,c=null,s=null,b=null,te.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(q){r=q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(q){g=q,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a||o},this.setReferenceSpace=function(q){a=q},this.getBaseLayer=function(){return C!==null?C:h},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(q){if(s=q,s!==null){if(f=e.getRenderTarget(),s.addEventListener("select",L),s.addEventListener("selectstart",L),s.addEventListener("selectend",L),s.addEventListener("squeeze",L),s.addEventListener("squeezestart",L),s.addEventListener("squeezeend",L),s.addEventListener("end",re),s.addEventListener("inputsourceschange",j),m.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const se={antialias:s.renderState.layers===void 0?m.antialias:!0,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:r};h=new XRWebGLLayer(s,t,se),s.updateRenderState({baseLayer:h}),b=new Co(h.framebufferWidth,h.framebufferHeight,{format:Zr,type:ol,encoding:e.outputEncoding,stencilBuffer:m.stencil})}else{let se=null,ue=null,Ae=null;m.depth&&(Ae=m.stencil?35056:33190,se=m.stencil?bu:Zc,ue=m.stencil?ou:Cc);const We={colorFormat:32856,depthFormat:Ae,scaleFactor:r};c=new XRWebGLBinding(s,t),C=c.createProjectionLayer(We),s.updateRenderState({layers:[C]}),b=new Co(C.textureWidth,C.textureHeight,{format:Zr,type:ol,depthTexture:new HV(C.textureWidth,C.textureHeight,ue,void 0,void 0,void 0,void 0,void 0,void 0,se),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0});const me=e.properties.get(b);me.__ignoreDepthValues=C.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(1),a=null,o=await s.requestReferenceSpace(g),te.setContext(s),te.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function j(q){for(let se=0;se<q.removed.length;se++){const ue=q.removed[se],Ae=v.indexOf(ue);Ae>=0&&(v[Ae]=null,y[Ae].disconnect(ue))}for(let se=0;se<q.added.length;se++){const ue=q.added[se];let Ae=v.indexOf(ue);if(Ae===-1){for(let me=0;me<y.length;me++)if(me>=v.length){v.push(ue),Ae=me;break}else if(v[me]===null){v[me]=ue,Ae=me;break}if(Ae===-1)break}const We=y[Ae];We&&We.connect(ue)}}const $=new E,ie=new E;function he(q,se,ue){$.setFromMatrixPosition(se.matrixWorld),ie.setFromMatrixPosition(ue.matrixWorld);const Ae=$.distanceTo(ie),We=se.projectionMatrix.elements,me=ue.projectionMatrix.elements,tt=We[14]/(We[10]-1),Oe=We[14]/(We[10]+1),It=(We[9]+1)/We[5],ke=(We[9]-1)/We[5],je=(We[8]-1)/We[0],ve=(me[8]+1)/me[0],be=tt*je,Ve=tt*ve,qe=Ae/(-je+ve),Xe=qe*-je;se.matrixWorld.decompose(q.position,q.quaternion,q.scale),q.translateX(Xe),q.translateZ(qe),q.matrixWorld.compose(q.position,q.quaternion,q.scale),q.matrixWorldInverse.copy(q.matrixWorld).invert();const Pe=tt+qe,ct=Oe+qe,gt=be-Xe,Yt=Ve+(Ae-Xe),Zt=It*Oe/ct*Pe,O=ke*Oe/ct*Pe;q.projectionMatrix.makePerspective(gt,Yt,Zt,O,Pe,ct)}function le(q,se){se===null?q.matrixWorld.copy(q.matrix):q.matrixWorld.multiplyMatrices(se.matrixWorld,q.matrix),q.matrixWorldInverse.copy(q.matrixWorld).invert()}this.updateCamera=function(q){if(s===null)return;R.near=V.near=W.near=q.near,R.far=V.far=W.far=q.far,(Y!==R.near||M!==R.far)&&(s.updateRenderState({depthNear:R.near,depthFar:R.far}),Y=R.near,M=R.far);const se=q.parent,ue=R.cameras;le(R,se);for(let We=0;We<ue.length;We++)le(ue[We],se);R.matrixWorld.decompose(R.position,R.quaternion,R.scale),q.matrix.copy(R.matrix),q.matrix.decompose(q.position,q.quaternion,q.scale);const Ae=q.children;for(let We=0,me=Ae.length;We<me;We++)Ae[We].updateMatrixWorld(!0);ue.length===2?he(R,W,V):R.projectionMatrix.copy(W.projectionMatrix)},this.getCamera=function(){return R},this.getFoveation=function(){if(C!==null)return C.fixedFoveation;if(h!==null)return h.fixedFoveation},this.setFoveation=function(q){C!==null&&(C.fixedFoveation=q),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=q)},this.getPlanes=function(){return G};let _=null;function ne(q,se){if(l=se.getViewerPose(a||o),p=se,l!==null){const ue=l.views;h!==null&&(e.setRenderTargetFramebuffer(b,h.framebuffer),e.setRenderTarget(b));let Ae=!1;ue.length!==R.cameras.length&&(R.cameras.length=0,Ae=!0);for(let We=0;We<ue.length;We++){const me=ue[We];let tt=null;if(h!==null)tt=h.getViewport(me);else{const It=c.getViewSubImage(C,me);tt=It.viewport,We===0&&(e.setRenderTargetTextures(b,It.colorTexture,C.ignoreDepthValues?void 0:It.depthStencilTexture),e.setRenderTarget(b))}let Oe=X[We];Oe===void 0&&(Oe=new Dn,Oe.layers.enable(We),Oe.viewport=new wn,X[We]=Oe),Oe.matrix.fromArray(me.transform.matrix),Oe.projectionMatrix.fromArray(me.projectionMatrix),Oe.viewport.set(tt.x,tt.y,tt.width,tt.height),We===0&&R.matrix.copy(Oe.matrix),Ae===!0&&R.cameras.push(Oe)}}for(let ue=0;ue<y.length;ue++){const Ae=v[ue],We=y[ue];Ae!==null&&We!==void 0&&We.update(Ae,se,a||o)}if(_&&_(q,se),se.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:se.detectedPlanes});let ue=null;for(const Ae of G)se.detectedPlanes.has(Ae)||(ue===null&&(ue=[]),ue.push(Ae));if(ue!==null)for(const Ae of ue)G.delete(Ae),w.delete(Ae),n.dispatchEvent({type:"planeremoved",data:Ae});for(const Ae of se.detectedPlanes)if(!G.has(Ae))G.add(Ae),w.set(Ae,se.lastChangedTime),n.dispatchEvent({type:"planeadded",data:Ae});else{const We=w.get(Ae);Ae.lastChangedTime>We&&(w.set(Ae,Ae.lastChangedTime),n.dispatchEvent({type:"planechanged",data:Ae}))}}p=null}const te=new ZV;te.setAnimationLoop(ne),this.setAnimationLoop=function(q){_=q},this.dispose=function(){}}}function bJ(i,e){function t(f,b){b.color.getRGB(f.fogColor.value,yV(i)),b.isFog?(f.fogNear.value=b.near,f.fogFar.value=b.far):b.isFogExp2&&(f.fogDensity.value=b.density)}function n(f,b,y,v,G){b.isMeshBasicMaterial||b.isMeshLambertMaterial?s(f,b):b.isMeshToonMaterial?(s(f,b),c(f,b)):b.isMeshPhongMaterial?(s(f,b),l(f,b)):b.isMeshStandardMaterial?(s(f,b),C(f,b),b.isMeshPhysicalMaterial&&h(f,b,G)):b.isMeshMatcapMaterial?(s(f,b),p(f,b)):b.isMeshDepthMaterial?s(f,b):b.isMeshDistanceMaterial?(s(f,b),m(f,b)):b.isMeshNormalMaterial?s(f,b):b.isLineBasicMaterial?(r(f,b),b.isLineDashedMaterial&&o(f,b)):b.isPointsMaterial?g(f,b,y,v):b.isSpriteMaterial?a(f,b):b.isShadowMaterial?(f.color.value.copy(b.color),f.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function s(f,b){f.opacity.value=b.opacity,b.color&&f.diffuse.value.copy(b.color),b.emissive&&f.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(f.map.value=b.map),b.alphaMap&&(f.alphaMap.value=b.alphaMap),b.bumpMap&&(f.bumpMap.value=b.bumpMap,f.bumpScale.value=b.bumpScale,b.side===ao&&(f.bumpScale.value*=-1)),b.displacementMap&&(f.displacementMap.value=b.displacementMap,f.displacementScale.value=b.displacementScale,f.displacementBias.value=b.displacementBias),b.emissiveMap&&(f.emissiveMap.value=b.emissiveMap),b.normalMap&&(f.normalMap.value=b.normalMap,f.normalScale.value.copy(b.normalScale),b.side===ao&&f.normalScale.value.negate()),b.specularMap&&(f.specularMap.value=b.specularMap),b.alphaTest>0&&(f.alphaTest.value=b.alphaTest);const y=e.get(b).envMap;if(y&&(f.envMap.value=y,f.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,f.reflectivity.value=b.reflectivity,f.ior.value=b.ior,f.refractionRatio.value=b.refractionRatio),b.lightMap){f.lightMap.value=b.lightMap;const w=i.physicallyCorrectLights!==!0?Math.PI:1;f.lightMapIntensity.value=b.lightMapIntensity*w}b.aoMap&&(f.aoMap.value=b.aoMap,f.aoMapIntensity.value=b.aoMapIntensity);let v;b.map?v=b.map:b.specularMap?v=b.specularMap:b.displacementMap?v=b.displacementMap:b.normalMap?v=b.normalMap:b.bumpMap?v=b.bumpMap:b.roughnessMap?v=b.roughnessMap:b.metalnessMap?v=b.metalnessMap:b.alphaMap?v=b.alphaMap:b.emissiveMap?v=b.emissiveMap:b.clearcoatMap?v=b.clearcoatMap:b.clearcoatNormalMap?v=b.clearcoatNormalMap:b.clearcoatRoughnessMap?v=b.clearcoatRoughnessMap:b.iridescenceMap?v=b.iridescenceMap:b.iridescenceThicknessMap?v=b.iridescenceThicknessMap:b.specularIntensityMap?v=b.specularIntensityMap:b.specularColorMap?v=b.specularColorMap:b.transmissionMap?v=b.transmissionMap:b.thicknessMap?v=b.thicknessMap:b.sheenColorMap?v=b.sheenColorMap:b.sheenRoughnessMap&&(v=b.sheenRoughnessMap),v!==void 0&&(v.isWebGLRenderTarget&&(v=v.texture),v.matrixAutoUpdate===!0&&v.updateMatrix(),f.uvTransform.value.copy(v.matrix));let G;b.aoMap?G=b.aoMap:b.lightMap&&(G=b.lightMap),G!==void 0&&(G.isWebGLRenderTarget&&(G=G.texture),G.matrixAutoUpdate===!0&&G.updateMatrix(),f.uv2Transform.value.copy(G.matrix))}function r(f,b){f.diffuse.value.copy(b.color),f.opacity.value=b.opacity}function o(f,b){f.dashSize.value=b.dashSize,f.totalSize.value=b.dashSize+b.gapSize,f.scale.value=b.scale}function g(f,b,y,v){f.diffuse.value.copy(b.color),f.opacity.value=b.opacity,f.size.value=b.size*y,f.scale.value=v*.5,b.map&&(f.map.value=b.map),b.alphaMap&&(f.alphaMap.value=b.alphaMap),b.alphaTest>0&&(f.alphaTest.value=b.alphaTest);let G;b.map?G=b.map:b.alphaMap&&(G=b.alphaMap),G!==void 0&&(G.matrixAutoUpdate===!0&&G.updateMatrix(),f.uvTransform.value.copy(G.matrix))}function a(f,b){f.diffuse.value.copy(b.color),f.opacity.value=b.opacity,f.rotation.value=b.rotation,b.map&&(f.map.value=b.map),b.alphaMap&&(f.alphaMap.value=b.alphaMap),b.alphaTest>0&&(f.alphaTest.value=b.alphaTest);let y;b.map?y=b.map:b.alphaMap&&(y=b.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),f.uvTransform.value.copy(y.matrix))}function l(f,b){f.specular.value.copy(b.specular),f.shininess.value=Math.max(b.shininess,1e-4)}function c(f,b){b.gradientMap&&(f.gradientMap.value=b.gradientMap)}function C(f,b){f.roughness.value=b.roughness,f.metalness.value=b.metalness,b.roughnessMap&&(f.roughnessMap.value=b.roughnessMap),b.metalnessMap&&(f.metalnessMap.value=b.metalnessMap),e.get(b).envMap&&(f.envMapIntensity.value=b.envMapIntensity)}function h(f,b,y){f.ior.value=b.ior,b.sheen>0&&(f.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),f.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(f.sheenColorMap.value=b.sheenColorMap),b.sheenRoughnessMap&&(f.sheenRoughnessMap.value=b.sheenRoughnessMap)),b.clearcoat>0&&(f.clearcoat.value=b.clearcoat,f.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(f.clearcoatMap.value=b.clearcoatMap),b.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap),b.clearcoatNormalMap&&(f.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),f.clearcoatNormalMap.value=b.clearcoatNormalMap,b.side===ao&&f.clearcoatNormalScale.value.negate())),b.iridescence>0&&(f.iridescence.value=b.iridescence,f.iridescenceIOR.value=b.iridescenceIOR,f.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],f.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(f.iridescenceMap.value=b.iridescenceMap),b.iridescenceThicknessMap&&(f.iridescenceThicknessMap.value=b.iridescenceThicknessMap)),b.transmission>0&&(f.transmission.value=b.transmission,f.transmissionSamplerMap.value=y.texture,f.transmissionSamplerSize.value.set(y.width,y.height),b.transmissionMap&&(f.transmissionMap.value=b.transmissionMap),f.thickness.value=b.thickness,b.thicknessMap&&(f.thicknessMap.value=b.thicknessMap),f.attenuationDistance.value=b.attenuationDistance,f.attenuationColor.value.copy(b.attenuationColor)),f.specularIntensity.value=b.specularIntensity,f.specularColor.value.copy(b.specularColor),b.specularIntensityMap&&(f.specularIntensityMap.value=b.specularIntensityMap),b.specularColorMap&&(f.specularColorMap.value=b.specularColorMap)}function p(f,b){b.matcap&&(f.matcap.value=b.matcap)}function m(f,b){f.referencePosition.value.copy(b.referencePosition),f.nearDistance.value=b.nearDistance,f.farDistance.value=b.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function GJ(i,e,t,n){let s={},r={},o=[];const g=t.isWebGL2?i.getParameter(35375):0;function a(v,G){const w=G.program;n.uniformBlockBinding(v,w)}function l(v,G){let w=s[v.id];w===void 0&&(m(v),w=c(v),s[v.id]=w,v.addEventListener("dispose",b));const W=G.program;n.updateUBOMapping(v,W);const V=e.render.frame;r[v.id]!==V&&(h(v),r[v.id]=V)}function c(v){const G=C();v.__bindingPointIndex=G;const w=i.createBuffer(),W=v.__size,V=v.usage;return i.bindBuffer(35345,w),i.bufferData(35345,W,V),i.bindBuffer(35345,null),i.bindBufferBase(35345,G,w),w}function C(){for(let v=0;v<g;v++)if(o.indexOf(v)===-1)return o.push(v),v;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(v){const G=s[v.id],w=v.uniforms,W=v.__cache;i.bindBuffer(35345,G);for(let V=0,X=w.length;V<X;V++){const R=w[V];if(p(R,V,W)===!0){const Y=R.__offset,M=Array.isArray(R.value)?R.value:[R.value];let L=0;for(let re=0;re<M.length;re++){const j=M[re],$=f(j);typeof j=="number"?(R.__data[0]=j,i.bufferSubData(35345,Y+L,R.__data)):j.isMatrix3?(R.__data[0]=j.elements[0],R.__data[1]=j.elements[1],R.__data[2]=j.elements[2],R.__data[3]=j.elements[0],R.__data[4]=j.elements[3],R.__data[5]=j.elements[4],R.__data[6]=j.elements[5],R.__data[7]=j.elements[0],R.__data[8]=j.elements[6],R.__data[9]=j.elements[7],R.__data[10]=j.elements[8],R.__data[11]=j.elements[0]):(j.toArray(R.__data,L),L+=$.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(35345,Y,R.__data)}}i.bindBuffer(35345,null)}function p(v,G,w){const W=v.value;if(w[G]===void 0){if(typeof W=="number")w[G]=W;else{const V=Array.isArray(W)?W:[W],X=[];for(let R=0;R<V.length;R++)X.push(V[R].clone());w[G]=X}return!0}else if(typeof W=="number"){if(w[G]!==W)return w[G]=W,!0}else{const V=Array.isArray(w[G])?w[G]:[w[G]],X=Array.isArray(W)?W:[W];for(let R=0;R<V.length;R++){const Y=V[R];if(Y.equals(X[R])===!1)return Y.copy(X[R]),!0}}return!1}function m(v){const G=v.uniforms;let w=0;const W=16;let V=0;for(let X=0,R=G.length;X<R;X++){const Y=G[X],M={boundary:0,storage:0},L=Array.isArray(Y.value)?Y.value:[Y.value];for(let re=0,j=L.length;re<j;re++){const $=L[re],ie=f($);M.boundary+=ie.boundary,M.storage+=ie.storage}if(Y.__data=new Float32Array(M.storage/Float32Array.BYTES_PER_ELEMENT),Y.__offset=w,X>0){V=w%W;const re=W-V;V!==0&&re-M.boundary<0&&(w+=W-V,Y.__offset=w)}w+=M.storage}return V=w%W,V>0&&(w+=W-V),v.__size=w,v.__cache={},this}function f(v){const G={boundary:0,storage:0};return typeof v=="number"?(G.boundary=4,G.storage=4):v.isVector2?(G.boundary=8,G.storage=8):v.isVector3||v.isColor?(G.boundary=16,G.storage=12):v.isVector4?(G.boundary=16,G.storage=16):v.isMatrix3?(G.boundary=48,G.storage=48):v.isMatrix4?(G.boundary=64,G.storage=64):v.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",v),G}function b(v){const G=v.target;G.removeEventListener("dispose",b);const w=o.indexOf(G.__bindingPointIndex);o.splice(w,1),i.deleteBuffer(s[G.id]),delete s[G.id],delete r[G.id]}function y(){for(const v in s)i.deleteBuffer(s[v]);o=[],s={},r={}}return{bind:a,update:l,dispose:y}}function yJ(){const i=Gp("canvas");return i.style.display="block",i}function pZ(i={}){this.isWebGLRenderer=!0;const e=i.canvas!==void 0?i.canvas:yJ(),t=i.context!==void 0?i.context:null,n=i.depth!==void 0?i.depth:!0,s=i.stencil!==void 0?i.stencil:!0,r=i.antialias!==void 0?i.antialias:!1,o=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,g=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,a=i.powerPreference!==void 0?i.powerPreference:"default",l=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let c;t!==null?c=t.getContextAttributes().alpha:c=i.alpha!==void 0?i.alpha:!1;let C=null,h=null;const p=[],m=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=al,this.physicallyCorrectLights=!1,this.toneMapping=Wg,this.toneMappingExposure=1;const f=this;let b=!1,y=0,v=0,G=null,w=-1,W=null;const V=new wn,X=new wn;let R=null,Y=e.width,M=e.height,L=1,re=null,j=null;const $=new wn(0,0,Y,M),ie=new wn(0,0,Y,M);let he=!1;const le=new CG;let _=!1,ne=!1,te=null;const q=new mt,se=new Fe,ue=new E,Ae={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function We(){return G===null?L:1}let me=t;function tt(J,Ge){for(let He=0;He<J.length;He++){const pe=J[He],Ne=e.getContext(pe,Ge);if(Ne!==null)return Ne}return null}try{const J={alpha:!0,depth:n,stencil:s,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:g,powerPreference:a,failIfMajorPerformanceCaveat:l};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${zp}`),e.addEventListener("webglcontextlost",Ee,!1),e.addEventListener("webglcontextrestored",Qe,!1),e.addEventListener("webglcontextcreationerror",wt,!1),me===null){const Ge=["webgl2","webgl","experimental-webgl"];if(f.isWebGL1Renderer===!0&&Ge.shift(),me=tt(Ge,J),me===null)throw tt(Ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}me.getShaderPrecisionFormat===void 0&&(me.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(J){throw console.error("THREE.WebGLRenderer: "+J.message),J}let Oe,It,ke,je,ve,be,Ve,qe,Xe,Pe,ct,gt,Yt,Zt,O,z,ye,Le,Te,De,vt,nt,Ye,dt;function oe(){Oe=new KE(me),It=new HE(me,Oe,i),Oe.init(It),nt=new xV(me,Oe,It),ke=new AJ(me,Oe,It),je=new _E,ve=new sJ,be=new pJ(me,Oe,ke,ve,It,nt,je),Ve=new YE(f),qe=new ME(f),Xe=new Qk(me,It),Ye=new xE(me,Oe,Xe,It),Pe=new LE(me,Xe,je,Ye),ct=new DE(me,Pe,Xe,je),Te=new EE(me,It,be),z=new XE(ve),gt=new iJ(f,Ve,qe,Oe,It,Ye,z),Yt=new bJ(f,ve),Zt=new oJ,O=new uJ(Oe,It),Le=new WE(f,Ve,qe,ke,ct,c,o),ye=new hJ(f,ct,It),dt=new GJ(me,je,It,ke),De=new VE(me,Oe,je,It),vt=new zE(me,Oe,je,It),je.programs=gt.programs,f.capabilities=It,f.extensions=Oe,f.properties=ve,f.renderLists=Zt,f.shadowMap=ye,f.state=ke,f.info=je}oe();const we=new mJ(f,me);this.xr=we,this.getContext=function(){return me},this.getContextAttributes=function(){return me.getContextAttributes()},this.forceContextLoss=function(){const J=Oe.get("WEBGL_lose_context");J&&J.loseContext()},this.forceContextRestore=function(){const J=Oe.get("WEBGL_lose_context");J&&J.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(J){J!==void 0&&(L=J,this.setSize(Y,M,!1))},this.getSize=function(J){return J.set(Y,M)},this.setSize=function(J,Ge,He){if(we.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Y=J,M=Ge,e.width=Math.floor(J*L),e.height=Math.floor(Ge*L),He!==!1&&(e.style.width=J+"px",e.style.height=Ge+"px"),this.setViewport(0,0,J,Ge)},this.getDrawingBufferSize=function(J){return J.set(Y*L,M*L).floor()},this.setDrawingBufferSize=function(J,Ge,He){Y=J,M=Ge,L=He,e.width=Math.floor(J*He),e.height=Math.floor(Ge*He),this.setViewport(0,0,J,Ge)},this.getCurrentViewport=function(J){return J.copy(V)},this.getViewport=function(J){return J.copy($)},this.setViewport=function(J,Ge,He,pe){J.isVector4?$.set(J.x,J.y,J.z,J.w):$.set(J,Ge,He,pe),ke.viewport(V.copy($).multiplyScalar(L).floor())},this.getScissor=function(J){return J.copy(ie)},this.setScissor=function(J,Ge,He,pe){J.isVector4?ie.set(J.x,J.y,J.z,J.w):ie.set(J,Ge,He,pe),ke.scissor(X.copy(ie).multiplyScalar(L).floor())},this.getScissorTest=function(){return he},this.setScissorTest=function(J){ke.setScissorTest(he=J)},this.setOpaqueSort=function(J){re=J},this.setTransparentSort=function(J){j=J},this.getClearColor=function(J){return J.copy(Le.getClearColor())},this.setClearColor=function(){Le.setClearColor.apply(Le,arguments)},this.getClearAlpha=function(){return Le.getClearAlpha()},this.setClearAlpha=function(){Le.setClearAlpha.apply(Le,arguments)},this.clear=function(J=!0,Ge=!0,He=!0){let pe=0;J&&(pe|=16384),Ge&&(pe|=256),He&&(pe|=1024),me.clear(pe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ee,!1),e.removeEventListener("webglcontextrestored",Qe,!1),e.removeEventListener("webglcontextcreationerror",wt,!1),Zt.dispose(),O.dispose(),ve.dispose(),Ve.dispose(),qe.dispose(),ct.dispose(),Ye.dispose(),dt.dispose(),gt.dispose(),we.dispose(),we.removeEventListener("sessionstart",at),we.removeEventListener("sessionend",bt),te&&(te.dispose(),te=null),cn.stop()};function Ee(J){J.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Qe(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const J=je.autoReset,Ge=ye.enabled,He=ye.autoUpdate,pe=ye.needsUpdate,Ne=ye.type;oe(),je.autoReset=J,ye.enabled=Ge,ye.autoUpdate=He,ye.needsUpdate=pe,ye.type=Ne}function wt(J){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",J.statusMessage)}function Ot(J){const Ge=J.target;Ge.removeEventListener("dispose",Ot),Vn(Ge)}function Vn(J){Ie(J),ve.remove(J)}function Ie(J){const Ge=ve.get(J).programs;Ge!==void 0&&(Ge.forEach(function(He){gt.releaseProgram(He)}),J.isShaderMaterial&&gt.releaseShaderCache(J))}this.renderBufferDirect=function(J,Ge,He,pe,Ne,St){Ge===null&&(Ge=Ae);const Nt=Ne.isMesh&&Ne.matrixWorld.determinant()<0,_t=nh(J,Ge,He,pe,Ne);ke.setMaterial(pe,Nt);let Qt=He.index,sn=1;pe.wireframe===!0&&(Qt=Pe.getWireframeAttribute(He),sn=2);const tn=He.drawRange,nn=He.attributes.position;let Un=tn.start*sn,Cs=(tn.start+tn.count)*sn;St!==null&&(Un=Math.max(Un,St.start*sn),Cs=Math.min(Cs,(St.start+St.count)*sn)),Qt!==null?(Un=Math.max(Un,0),Cs=Math.min(Cs,Qt.count)):nn!=null&&(Un=Math.max(Un,0),Cs=Math.min(Cs,nn.count));const Ss=Cs-Un;if(Ss<0||Ss===1/0)return;Ye.setup(Ne,pe,_t,He,Qt);let rg,vn=De;if(Qt!==null&&(rg=Xe.get(Qt),vn=vt,vn.setIndex(rg)),Ne.isMesh)pe.wireframe===!0?(ke.setLineWidth(pe.wireframeLinewidth*We()),vn.setMode(1)):vn.setMode(4);else if(Ne.isLine){let Dt=pe.linewidth;Dt===void 0&&(Dt=1),ke.setLineWidth(Dt*We()),Ne.isLineSegments?vn.setMode(1):Ne.isLineLoop?vn.setMode(2):vn.setMode(3)}else Ne.isPoints?vn.setMode(0):Ne.isSprite&&vn.setMode(4);if(Ne.isInstancedMesh)vn.renderInstances(Un,Ss,Ne.count);else if(He.isInstancedBufferGeometry){const Dt=He._maxInstanceCount!==void 0?He._maxInstanceCount:1/0,pa=Math.min(He.instanceCount,Dt);vn.renderInstances(Un,Ss,pa)}else vn.render(Un,Ss)},this.compile=function(J,Ge){function He(pe,Ne,St){pe.transparent===!0&&pe.side===XA?(pe.side=ao,pe.needsUpdate=!0,ws(pe,Ne,St),pe.side=ua,pe.needsUpdate=!0,ws(pe,Ne,St),pe.side=XA):ws(pe,Ne,St)}h=O.get(J),h.init(),m.push(h),J.traverseVisible(function(pe){pe.isLight&&pe.layers.test(Ge.layers)&&(h.pushLight(pe),pe.castShadow&&h.pushShadow(pe))}),h.setupLights(f.physicallyCorrectLights),J.traverse(function(pe){const Ne=pe.material;if(Ne)if(Array.isArray(Ne))for(let St=0;St<Ne.length;St++){const Nt=Ne[St];He(Nt,J,pe)}else He(Ne,J,pe)}),m.pop(),h=null};let Se=null;function ze(J){Se&&Se(J)}function at(){cn.stop()}function bt(){cn.start()}const cn=new ZV;cn.setAnimationLoop(ze),typeof self<"u"&&cn.setContext(self),this.setAnimationLoop=function(J){Se=J,we.setAnimationLoop(J),J===null?cn.stop():cn.start()},we.addEventListener("sessionstart",at),we.addEventListener("sessionend",bt),this.render=function(J,Ge){if(Ge!==void 0&&Ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;J.matrixWorldAutoUpdate===!0&&J.updateMatrixWorld(),Ge.parent===null&&Ge.matrixWorldAutoUpdate===!0&&Ge.updateMatrixWorld(),we.enabled===!0&&we.isPresenting===!0&&(we.cameraAutoUpdate===!0&&we.updateCamera(Ge),Ge=we.getCamera()),J.isScene===!0&&J.onBeforeRender(f,J,Ge,G),h=O.get(J,m.length),h.init(),m.push(h),q.multiplyMatrices(Ge.projectionMatrix,Ge.matrixWorldInverse),le.setFromProjectionMatrix(q),ne=this.localClippingEnabled,_=z.init(this.clippingPlanes,ne,Ge),C=Zt.get(J,p.length),C.init(),p.push(C),$n(J,Ge,0,f.sortObjects),C.finish(),f.sortObjects===!0&&C.sort(re,j),_===!0&&z.beginShadows();const He=h.state.shadowsArray;if(ye.render(He,J,Ge),_===!0&&z.endShadows(),this.info.autoReset===!0&&this.info.reset(),Le.render(C,J),h.setupLights(f.physicallyCorrectLights),Ge.isArrayCamera){const pe=Ge.cameras;for(let Ne=0,St=pe.length;Ne<St;Ne++){const Nt=pe[Ne];Hi(C,J,Nt,Nt.viewport)}}else Hi(C,J,Ge);G!==null&&(be.updateMultisampleRenderTarget(G),be.updateRenderTargetMipmap(G)),J.isScene===!0&&J.onAfterRender(f,J,Ge),Ye.resetDefaultState(),w=-1,W=null,m.pop(),m.length>0?h=m[m.length-1]:h=null,p.pop(),p.length>0?C=p[p.length-1]:C=null};function $n(J,Ge,He,pe){if(J.visible===!1)return;if(J.layers.test(Ge.layers)){if(J.isGroup)He=J.renderOrder;else if(J.isLOD)J.autoUpdate===!0&&J.update(Ge);else if(J.isLight)h.pushLight(J),J.castShadow&&h.pushShadow(J);else if(J.isSprite){if(!J.frustumCulled||le.intersectsSprite(J)){pe&&ue.setFromMatrixPosition(J.matrixWorld).applyMatrix4(q);const Nt=ct.update(J),_t=J.material;_t.visible&&C.push(J,Nt,_t,He,ue.z,null)}}else if((J.isMesh||J.isLine||J.isPoints)&&(J.isSkinnedMesh&&J.skeleton.frame!==je.render.frame&&(J.skeleton.update(),J.skeleton.frame=je.render.frame),!J.frustumCulled||le.intersectsObject(J))){pe&&ue.setFromMatrixPosition(J.matrixWorld).applyMatrix4(q);const Nt=ct.update(J),_t=J.material;if(Array.isArray(_t)){const Qt=Nt.groups;for(let sn=0,tn=Qt.length;sn<tn;sn++){const nn=Qt[sn],Un=_t[nn.materialIndex];Un&&Un.visible&&C.push(J,Nt,Un,He,ue.z,nn)}}else _t.visible&&C.push(J,Nt,_t,He,ue.z,null)}}const St=J.children;for(let Nt=0,_t=St.length;Nt<_t;Nt++)$n(St[Nt],Ge,He,pe)}function Hi(J,Ge,He,pe){const Ne=J.opaque,St=J.transmissive,Nt=J.transparent;h.setupLightsView(He),St.length>0&&Nr(Ne,Ge,He),pe&&ke.viewport(V.copy(pe)),Ne.length>0&&Bn(Ne,Ge,He),St.length>0&&Bn(St,Ge,He),Nt.length>0&&Bn(Nt,Ge,He),ke.buffers.depth.setTest(!0),ke.buffers.depth.setMask(!0),ke.buffers.color.setMask(!0),ke.setPolygonOffset(!1)}function Nr(J,Ge,He){const pe=It.isWebGL2;te===null&&(te=new Co(1,1,{generateMipmaps:!0,type:Oe.has("EXT_color_buffer_half_float")?Jo:ol,minFilter:eg,samples:pe&&r===!0?4:0})),f.getDrawingBufferSize(se),pe?te.setSize(se.x,se.y):te.setSize(Yb(se.x),Yb(se.y));const Ne=f.getRenderTarget();f.setRenderTarget(te),f.clear();const St=f.toneMapping;f.toneMapping=Wg,Bn(J,Ge,He),f.toneMapping=St,be.updateMultisampleRenderTarget(te),be.updateRenderTargetMipmap(te),f.setRenderTarget(Ne)}function Bn(J,Ge,He){const pe=Ge.isScene===!0?Ge.overrideMaterial:null;for(let Ne=0,St=J.length;Ne<St;Ne++){const Nt=J[Ne],_t=Nt.object,Qt=Nt.geometry,sn=pe===null?Nt.material:pe,tn=Nt.group;_t.layers.test(He.layers)&&lr(_t,Ge,He,Qt,sn,tn)}}function lr(J,Ge,He,pe,Ne,St){J.onBeforeRender(f,Ge,He,pe,Ne,St),J.modelViewMatrix.multiplyMatrices(He.matrixWorldInverse,J.matrixWorld),J.normalMatrix.getNormalMatrix(J.modelViewMatrix),Ne.onBeforeRender(f,Ge,He,pe,J,St),Ne.transparent===!0&&Ne.side===XA?(Ne.side=ao,Ne.needsUpdate=!0,f.renderBufferDirect(He,Ge,pe,Ne,J,St),Ne.side=ua,Ne.needsUpdate=!0,f.renderBufferDirect(He,Ge,pe,Ne,J,St),Ne.side=XA):f.renderBufferDirect(He,Ge,pe,Ne,J,St),J.onAfterRender(f,Ge,He,pe,Ne,St)}function ws(J,Ge,He){Ge.isScene!==!0&&(Ge=Ae);const pe=ve.get(J),Ne=h.state.lights,St=h.state.shadowsArray,Nt=Ne.state.version,_t=gt.getParameters(J,Ne.state,St,Ge,He),Qt=gt.getProgramCacheKey(_t);let sn=pe.programs;pe.environment=J.isMeshStandardMaterial?Ge.environment:null,pe.fog=Ge.fog,pe.envMap=(J.isMeshStandardMaterial?qe:Ve).get(J.envMap||pe.environment),sn===void 0&&(J.addEventListener("dispose",Ot),sn=new Map,pe.programs=sn);let tn=sn.get(Qt);if(tn!==void 0){if(pe.currentProgram===tn&&pe.lightsStateVersion===Nt)return pl(J,_t),tn}else _t.uniforms=gt.getUniforms(J),J.onBuild(He,_t,f),J.onBeforeCompile(_t,f),tn=gt.acquireProgram(_t,Qt),sn.set(Qt,tn),pe.uniforms=_t.uniforms;const nn=pe.uniforms;(!J.isShaderMaterial&&!J.isRawShaderMaterial||J.clipping===!0)&&(nn.clippingPlanes=z.uniform),pl(J,_t),pe.needsLights=Tc(J),pe.lightsStateVersion=Nt,pe.needsLights&&(nn.ambientLightColor.value=Ne.state.ambient,nn.lightProbe.value=Ne.state.probe,nn.directionalLights.value=Ne.state.directional,nn.directionalLightShadows.value=Ne.state.directionalShadow,nn.spotLights.value=Ne.state.spot,nn.spotLightShadows.value=Ne.state.spotShadow,nn.rectAreaLights.value=Ne.state.rectArea,nn.ltc_1.value=Ne.state.rectAreaLTC1,nn.ltc_2.value=Ne.state.rectAreaLTC2,nn.pointLights.value=Ne.state.point,nn.pointLightShadows.value=Ne.state.pointShadow,nn.hemisphereLights.value=Ne.state.hemi,nn.directionalShadowMap.value=Ne.state.directionalShadowMap,nn.directionalShadowMatrix.value=Ne.state.directionalShadowMatrix,nn.spotShadowMap.value=Ne.state.spotShadowMap,nn.spotLightMatrix.value=Ne.state.spotLightMatrix,nn.spotLightMap.value=Ne.state.spotLightMap,nn.pointShadowMap.value=Ne.state.pointShadowMap,nn.pointShadowMatrix.value=Ne.state.pointShadowMatrix);const Un=tn.getUniforms(),Cs=eb.seqWithValue(Un.seq,nn);return pe.currentProgram=tn,pe.uniformsList=Cs,tn}function pl(J,Ge){const He=ve.get(J);He.outputEncoding=Ge.outputEncoding,He.instancing=Ge.instancing,He.skinning=Ge.skinning,He.morphTargets=Ge.morphTargets,He.morphNormals=Ge.morphNormals,He.morphColors=Ge.morphColors,He.morphTargetsCount=Ge.morphTargetsCount,He.numClippingPlanes=Ge.numClippingPlanes,He.numIntersection=Ge.numClipIntersection,He.vertexAlphas=Ge.vertexAlphas,He.vertexTangents=Ge.vertexTangents,He.toneMapping=Ge.toneMapping}function nh(J,Ge,He,pe,Ne){Ge.isScene!==!0&&(Ge=Ae),be.resetTextureUnits();const St=Ge.fog,Nt=pe.isMeshStandardMaterial?Ge.environment:null,_t=G===null?f.outputEncoding:G.isXRRenderTarget===!0?G.texture.encoding:al,Qt=(pe.isMeshStandardMaterial?qe:Ve).get(pe.envMap||Nt),sn=pe.vertexColors===!0&&!!He.attributes.color&&He.attributes.color.itemSize===4,tn=!!pe.normalMap&&!!He.attributes.tangent,nn=!!He.morphAttributes.position,Un=!!He.morphAttributes.normal,Cs=!!He.morphAttributes.color,Ss=pe.toneMapped?f.toneMapping:Wg,rg=He.morphAttributes.position||He.morphAttributes.normal||He.morphAttributes.color,vn=rg!==void 0?rg.length:0,Dt=ve.get(pe),pa=h.state.lights;if(_===!0&&(ne===!0||J!==W)){const An=J===W&&pe.id===w;z.setState(pe,J,An)}let Pn=!1;pe.version===Dt.__version?(Dt.needsLights&&Dt.lightsStateVersion!==pa.state.version||Dt.outputEncoding!==_t||Ne.isInstancedMesh&&Dt.instancing===!1||!Ne.isInstancedMesh&&Dt.instancing===!0||Ne.isSkinnedMesh&&Dt.skinning===!1||!Ne.isSkinnedMesh&&Dt.skinning===!0||Dt.envMap!==Qt||pe.fog===!0&&Dt.fog!==St||Dt.numClippingPlanes!==void 0&&(Dt.numClippingPlanes!==z.numPlanes||Dt.numIntersection!==z.numIntersection)||Dt.vertexAlphas!==sn||Dt.vertexTangents!==tn||Dt.morphTargets!==nn||Dt.morphNormals!==Un||Dt.morphColors!==Cs||Dt.toneMapping!==Ss||It.isWebGL2===!0&&Dt.morphTargetsCount!==vn)&&(Pn=!0):(Pn=!0,Dt.__version=pe.version);let fo=Dt.currentProgram;Pn===!0&&(fo=ws(pe,Ge,Ne));let fa=!1,Es=!1,cr=!1;const kt=fo.getUniforms(),gn=Dt.uniforms;if(ke.useProgram(fo.program)&&(fa=!0,Es=!0,cr=!0),pe.id!==w&&(w=pe.id,Es=!0),fa||W!==J){if(kt.setValue(me,"projectionMatrix",J.projectionMatrix),It.logarithmicDepthBuffer&&kt.setValue(me,"logDepthBufFC",2/(Math.log(J.far+1)/Math.LN2)),W!==J&&(W=J,Es=!0,cr=!0),pe.isShaderMaterial||pe.isMeshPhongMaterial||pe.isMeshToonMaterial||pe.isMeshStandardMaterial||pe.envMap){const An=kt.map.cameraPosition;An!==void 0&&An.setValue(me,ue.setFromMatrixPosition(J.matrixWorld))}(pe.isMeshPhongMaterial||pe.isMeshToonMaterial||pe.isMeshLambertMaterial||pe.isMeshBasicMaterial||pe.isMeshStandardMaterial||pe.isShaderMaterial)&&kt.setValue(me,"isOrthographic",J.isOrthographicCamera===!0),(pe.isMeshPhongMaterial||pe.isMeshToonMaterial||pe.isMeshLambertMaterial||pe.isMeshBasicMaterial||pe.isMeshStandardMaterial||pe.isShaderMaterial||pe.isShadowMaterial||Ne.isSkinnedMesh)&&kt.setValue(me,"viewMatrix",J.matrixWorldInverse)}if(Ne.isSkinnedMesh){kt.setOptional(me,Ne,"bindMatrix"),kt.setOptional(me,Ne,"bindMatrixInverse");const An=Ne.skeleton;An&&(It.floatVertexTextures?(An.boneTexture===null&&An.computeBoneTexture(),kt.setValue(me,"boneTexture",An.boneTexture,be),kt.setValue(me,"boneTextureSize",An.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Ir=He.morphAttributes;if((Ir.position!==void 0||Ir.normal!==void 0||Ir.color!==void 0&&It.isWebGL2===!0)&&Te.update(Ne,He,pe,fo),(Es||Dt.receiveShadow!==Ne.receiveShadow)&&(Dt.receiveShadow=Ne.receiveShadow,kt.setValue(me,"receiveShadow",Ne.receiveShadow)),pe.isMeshGouraudMaterial&&pe.envMap!==null&&(gn.envMap.value=Qt,gn.flipEnvMap.value=Qt.isCubeTexture&&Qt.isRenderTargetTexture===!1?-1:1),Es&&(kt.setValue(me,"toneMappingExposure",f.toneMappingExposure),Dt.needsLights&&fl(gn,cr),St&&pe.fog===!0&&Yt.refreshFogUniforms(gn,St),Yt.refreshMaterialUniforms(gn,pe,L,M,te),eb.upload(me,Dt.uniformsList,gn,be)),pe.isShaderMaterial&&pe.uniformsNeedUpdate===!0&&(eb.upload(me,Dt.uniformsList,gn,be),pe.uniformsNeedUpdate=!1),pe.isSpriteMaterial&&kt.setValue(me,"center",Ne.center),kt.setValue(me,"modelViewMatrix",Ne.modelViewMatrix),kt.setValue(me,"normalMatrix",Ne.normalMatrix),kt.setValue(me,"modelMatrix",Ne.matrixWorld),pe.isShaderMaterial||pe.isRawShaderMaterial){const An=pe.uniformsGroups;for(let Gi=0,mo=An.length;Gi<mo;Gi++)if(It.isWebGL2){const Mr=An[Gi];dt.update(Mr,fo),dt.bind(Mr,fo)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return fo}function fl(J,Ge){J.ambientLightColor.needsUpdate=Ge,J.lightProbe.needsUpdate=Ge,J.directionalLights.needsUpdate=Ge,J.directionalLightShadows.needsUpdate=Ge,J.pointLights.needsUpdate=Ge,J.pointLightShadows.needsUpdate=Ge,J.spotLights.needsUpdate=Ge,J.spotLightShadows.needsUpdate=Ge,J.rectAreaLights.needsUpdate=Ge,J.hemisphereLights.needsUpdate=Ge}function Tc(J){return J.isMeshLambertMaterial||J.isMeshToonMaterial||J.isMeshPhongMaterial||J.isMeshStandardMaterial||J.isShadowMaterial||J.isShaderMaterial&&J.lights===!0}this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return G},this.setRenderTargetTextures=function(J,Ge,He){ve.get(J.texture).__webglTexture=Ge,ve.get(J.depthTexture).__webglTexture=He;const pe=ve.get(J);pe.__hasExternalTextures=!0,pe.__hasExternalTextures&&(pe.__autoAllocateDepthBuffer=He===void 0,pe.__autoAllocateDepthBuffer||Oe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),pe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(J,Ge){const He=ve.get(J);He.__webglFramebuffer=Ge,He.__useDefaultFramebuffer=Ge===void 0},this.setRenderTarget=function(J,Ge=0,He=0){G=J,y=Ge,v=He;let pe=!0,Ne=null,St=!1,Nt=!1;if(J){const Qt=ve.get(J);Qt.__useDefaultFramebuffer!==void 0?(ke.bindFramebuffer(36160,null),pe=!1):Qt.__webglFramebuffer===void 0?be.setupRenderTarget(J):Qt.__hasExternalTextures&&be.rebindTextures(J,ve.get(J.texture).__webglTexture,ve.get(J.depthTexture).__webglTexture);const sn=J.texture;(sn.isData3DTexture||sn.isDataArrayTexture||sn.isCompressedArrayTexture)&&(Nt=!0);const tn=ve.get(J).__webglFramebuffer;J.isWebGLCubeRenderTarget?(Ne=tn[Ge],St=!0):It.isWebGL2&&J.samples>0&&be.useMultisampledRTT(J)===!1?Ne=ve.get(J).__webglMultisampledFramebuffer:Ne=tn,V.copy(J.viewport),X.copy(J.scissor),R=J.scissorTest}else V.copy($).multiplyScalar(L).floor(),X.copy(ie).multiplyScalar(L).floor(),R=he;if(ke.bindFramebuffer(36160,Ne)&&It.drawBuffers&&pe&&ke.drawBuffers(J,Ne),ke.viewport(V),ke.scissor(X),ke.setScissorTest(R),St){const Qt=ve.get(J.texture);me.framebufferTexture2D(36160,36064,34069+Ge,Qt.__webglTexture,He)}else if(Nt){const Qt=ve.get(J.texture),sn=Ge||0;me.framebufferTextureLayer(36160,36064,Qt.__webglTexture,He||0,sn)}w=-1},this.readRenderTargetPixels=function(J,Ge,He,pe,Ne,St,Nt){if(!(J&&J.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let _t=ve.get(J).__webglFramebuffer;if(J.isWebGLCubeRenderTarget&&Nt!==void 0&&(_t=_t[Nt]),_t){ke.bindFramebuffer(36160,_t);try{const Qt=J.texture,sn=Qt.format,tn=Qt.type;if(sn!==Zr&&nt.convert(sn)!==me.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const nn=tn===Jo&&(Oe.has("EXT_color_buffer_half_float")||It.isWebGL2&&Oe.has("EXT_color_buffer_float"));if(tn!==ol&&nt.convert(tn)!==me.getParameter(35738)&&!(tn===Do&&(It.isWebGL2||Oe.has("OES_texture_float")||Oe.has("WEBGL_color_buffer_float")))&&!nn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ge>=0&&Ge<=J.width-pe&&He>=0&&He<=J.height-Ne&&me.readPixels(Ge,He,pe,Ne,nt.convert(sn),nt.convert(tn),St)}finally{const Qt=G!==null?ve.get(G).__webglFramebuffer:null;ke.bindFramebuffer(36160,Qt)}}},this.copyFramebufferToTexture=function(J,Ge,He=0){const pe=Math.pow(2,-He),Ne=Math.floor(Ge.image.width*pe),St=Math.floor(Ge.image.height*pe);be.setTexture2D(Ge,0),me.copyTexSubImage2D(3553,He,0,0,J.x,J.y,Ne,St),ke.unbindTexture()},this.copyTextureToTexture=function(J,Ge,He,pe=0){const Ne=Ge.image.width,St=Ge.image.height,Nt=nt.convert(He.format),_t=nt.convert(He.type);be.setTexture2D(He,0),me.pixelStorei(37440,He.flipY),me.pixelStorei(37441,He.premultiplyAlpha),me.pixelStorei(3317,He.unpackAlignment),Ge.isDataTexture?me.texSubImage2D(3553,pe,J.x,J.y,Ne,St,Nt,_t,Ge.image.data):Ge.isCompressedTexture?me.compressedTexSubImage2D(3553,pe,J.x,J.y,Ge.mipmaps[0].width,Ge.mipmaps[0].height,Nt,Ge.mipmaps[0].data):me.texSubImage2D(3553,pe,J.x,J.y,Nt,_t,Ge.image),pe===0&&He.generateMipmaps&&me.generateMipmap(3553),ke.unbindTexture()},this.copyTextureToTexture3D=function(J,Ge,He,pe,Ne=0){if(f.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const St=J.max.x-J.min.x+1,Nt=J.max.y-J.min.y+1,_t=J.max.z-J.min.z+1,Qt=nt.convert(pe.format),sn=nt.convert(pe.type);let tn;if(pe.isData3DTexture)be.setTexture3D(pe,0),tn=32879;else if(pe.isDataArrayTexture)be.setTexture2DArray(pe,0),tn=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}me.pixelStorei(37440,pe.flipY),me.pixelStorei(37441,pe.premultiplyAlpha),me.pixelStorei(3317,pe.unpackAlignment);const nn=me.getParameter(3314),Un=me.getParameter(32878),Cs=me.getParameter(3316),Ss=me.getParameter(3315),rg=me.getParameter(32877),vn=He.isCompressedTexture?He.mipmaps[0]:He.image;me.pixelStorei(3314,vn.width),me.pixelStorei(32878,vn.height),me.pixelStorei(3316,J.min.x),me.pixelStorei(3315,J.min.y),me.pixelStorei(32877,J.min.z),He.isDataTexture||He.isData3DTexture?me.texSubImage3D(tn,Ne,Ge.x,Ge.y,Ge.z,St,Nt,_t,Qt,sn,vn.data):He.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),me.compressedTexSubImage3D(tn,Ne,Ge.x,Ge.y,Ge.z,St,Nt,_t,Qt,vn.data)):me.texSubImage3D(tn,Ne,Ge.x,Ge.y,Ge.z,St,Nt,_t,Qt,sn,vn),me.pixelStorei(3314,nn),me.pixelStorei(32878,Un),me.pixelStorei(3316,Cs),me.pixelStorei(3315,Ss),me.pixelStorei(32877,rg),Ne===0&&pe.generateMipmaps&&me.generateMipmap(tn),ke.unbindTexture()},this.initTexture=function(J){J.isCubeTexture?be.setTextureCube(J,0):J.isData3DTexture?be.setTexture3D(J,0):J.isDataArrayTexture||J.isCompressedArrayTexture?be.setTexture2DArray(J,0):be.setTexture2D(J,0),ke.unbindTexture()},this.resetState=function(){y=0,v=0,G=null,ke.reset(),Ye.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class XV extends pZ{}XV.prototype.isWebGL1Renderer=!0;class hG{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new et(e),this.density=t}clone(){return new hG(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class AG{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new et(e),this.near=t,this.far=n}clone(){return new AG(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class yp extends en{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class Qd{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=mp,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=lo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=lo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=lo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const er=new E;class ll{constructor(e,t,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)er.fromBufferAttribute(this,t),er.applyMatrix4(e),this.setXYZ(t,er.x,er.y,er.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)er.fromBufferAttribute(this,t),er.applyNormalMatrix(e),this.setXYZ(t,er.x,er.y,er.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)er.fromBufferAttribute(this,t),er.transformDirection(e),this.setXYZ(t,er.x,er.y,er.z);return this}setX(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Mn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Qa(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Qa(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Qa(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Qa(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mn(t,this.array),n=Mn(n,this.array),s=Mn(s,this.array),r=Mn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new on(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ll(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class fZ extends qn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new et(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let FC;const IA=new E,NC=new E,MC=new E,KC=new Fe,uA=new Fe,YV=new mt,t0=new E,CA=new E,n0=new E,qR=new Fe,AB=new Fe,$R=new Fe;class FV extends en{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",FC===void 0){FC=new zt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Qd(t,5);FC.setIndex([0,1,2,0,2,3]),FC.setAttribute("position",new ll(n,3,0,!1)),FC.setAttribute("uv",new ll(n,2,3,!1))}this.geometry=FC,this.material=e!==void 0?e:new fZ,this.center=new Fe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),NC.setFromMatrixScale(this.matrixWorld),YV.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),MC.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&NC.multiplyScalar(-MC.z);const n=this.material.rotation;let s,r;n!==0&&(r=Math.cos(n),s=Math.sin(n));const o=this.center;i0(t0.set(-.5,-.5,0),MC,o,NC,s,r),i0(CA.set(.5,-.5,0),MC,o,NC,s,r),i0(n0.set(.5,.5,0),MC,o,NC,s,r),qR.set(0,0),AB.set(1,0),$R.set(1,1);let g=e.ray.intersectTriangle(t0,CA,n0,!1,IA);if(g===null&&(i0(CA.set(-.5,.5,0),MC,o,NC,s,r),AB.set(0,1),g=e.ray.intersectTriangle(t0,n0,CA,!1,IA),g===null))return;const a=e.ray.origin.distanceTo(IA);a<e.near||a>e.far||t.push({distance:a,point:IA.clone(),uv:To.getUV(IA,t0,CA,n0,qR,AB,$R,new Fe),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function i0(i,e,t,n,s,r){KC.subVectors(i,t).addScalar(.5).multiply(n),s!==void 0?(uA.x=r*KC.x-s*KC.y,uA.y=s*KC.x+r*KC.y):uA.copy(KC),i.copy(e),i.x+=uA.x,i.y+=uA.y,i.applyMatrix4(YV)}const s0=new E,eW=new E;class NV extends en{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,s=t.length;n<s;n++){const r=t[n];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const s=this.levels;let r;for(r=0;r<s.length&&!(t<s[r].distance);r++);return s.splice(r,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,s;for(n=1,s=t.length;n<s;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){s0.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(s0);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){s0.setFromMatrixPosition(e.matrixWorld),eW.setFromMatrixPosition(this.matrixWorld);const n=s0.distanceTo(eW)/e.zoom;t[0].object.visible=!0;let s,r;for(s=1,r=t.length;s<r;s++){let o=t[s].distance;if(t[s].object.visible&&(o-=o*t[s].hysteresis),n>=o)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<r;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let s=0,r=n.length;s<r;s++){const o=n[s];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const tW=new E,nW=new wn,iW=new wn,BJ=new E,sW=new mt;class pG extends mi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new mt,this.bindMatrixInverse=new mt}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new wn,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,s=this.geometry;nW.fromBufferAttribute(s.attributes.skinIndex,e),iW.fromBufferAttribute(s.attributes.skinWeight,e),tW.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=iW.getComponent(r);if(o!==0){const g=nW.getComponent(r);sW.multiplyMatrices(n.bones[g].matrixWorld,n.boneInverses[g]),t.addScaledVector(BJ.copy(tW).applyMatrix4(sW),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Up extends en{constructor(){super(),this.isBone=!0,this.type="Bone"}}class hd extends kn{constructor(e=null,t=1,n=1,s,r,o,g,a,l=oi,c=oi,C,h){super(null,o,g,a,l,c,s,r,C,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const rW=new mt,vJ=new mt;class jd{constructor(e=[],t=[]){this.uuid=lo(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new mt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new mt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const g=e[r]?e[r].matrixWorld:vJ;rW.multiplyMatrices(g,t[r]),rW.toArray(n,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new jd(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=mV(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new hd(t,e,e,Zr,Do);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const r=e.bones[n];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Up),this.bones.push(o),this.boneInverses.push(new mt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const g=n[s];e.boneInverses.push(g.toArray())}return e}}class Fd extends on{constructor(e,t,n,s=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const oW=new mt,gW=new mt,r0=[],ZJ=new mt,dA=new mi;class wc extends mi{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Fd(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1;for(let s=0;s<n;s++)this.setMatrixAt(s,ZJ)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,s=this.count;if(dA.geometry=this.geometry,dA.material=this.material,dA.material!==void 0)for(let r=0;r<s;r++){this.getMatrixAt(r,oW),gW.multiplyMatrices(n,oW),dA.matrixWorld=gW,dA.raycast(e,r0);for(let o=0,g=r0.length;o<g;o++){const a=r0[o];a.instanceId=r,a.object=this,t.push(a)}r0.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Fd(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Bs extends qn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new et(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const aW=new E,lW=new E,cW=new mt,pB=new Ep,o0=new dl;class Ca extends en{constructor(e=new zt,t=new Bs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let s=1,r=t.count;s<r;s++)aW.fromBufferAttribute(t,s-1),lW.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=aW.distanceTo(lW);e.setAttribute("lineDistance",new pt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),o0.copy(n.boundingSphere),o0.applyMatrix4(s),o0.radius+=r,e.ray.intersectsSphere(o0)===!1)return;cW.copy(s).invert(),pB.copy(e.ray).applyMatrix4(cW);const g=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=g*g,l=new E,c=new E,C=new E,h=new E,p=this.isLineSegments?2:1,m=n.index,b=n.attributes.position;if(m!==null){const y=Math.max(0,o.start),v=Math.min(m.count,o.start+o.count);for(let G=y,w=v-1;G<w;G+=p){const W=m.getX(G),V=m.getX(G+1);if(l.fromBufferAttribute(b,W),c.fromBufferAttribute(b,V),pB.distanceSqToSegment(l,c,h,C)>a)continue;h.applyMatrix4(this.matrixWorld);const R=e.ray.origin.distanceTo(h);R<e.near||R>e.far||t.push({distance:R,point:C.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),v=Math.min(b.count,o.start+o.count);for(let G=y,w=v-1;G<w;G+=p){if(l.fromBufferAttribute(b,G),c.fromBufferAttribute(b,G+1),pB.distanceSqToSegment(l,c,h,C)>a)continue;h.applyMatrix4(this.matrixWorld);const V=e.ray.origin.distanceTo(h);V<e.near||V>e.far||t.push({distance:V,point:C.clone().applyMatrix4(this.matrixWorld),index:G,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const g=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=r}}}}}const IW=new E,uW=new E;class ng extends Ca{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let s=0,r=t.count;s<r;s+=2)IW.fromBufferAttribute(t,s),uW.fromBufferAttribute(t,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+IW.distanceTo(uW);e.setAttribute("lineDistance",new pt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class fG extends Ca{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Pp extends qn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new et(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const CW=new mt,Rv=new Ep,g0=new dl,a0=new E;class mG extends en{constructor(e=new zt,t=new Pp){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),g0.copy(n.boundingSphere),g0.applyMatrix4(s),g0.radius+=r,e.ray.intersectsSphere(g0)===!1)return;CW.copy(s).invert(),Rv.copy(e.ray).applyMatrix4(CW);const g=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=g*g,l=n.index,C=n.attributes.position;if(l!==null){const h=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);for(let m=h,f=p;m<f;m++){const b=l.getX(m);a0.fromBufferAttribute(C,b),dW(a0,b,a,s,e,t,this)}}else{const h=Math.max(0,o.start),p=Math.min(C.count,o.start+o.count);for(let m=h,f=p;m<f;m++)a0.fromBufferAttribute(C,m),dW(a0,m,a,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const g=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=r}}}}}function dW(i,e,t,n,s,r,o){const g=Rv.distanceSqToPoint(i);if(g<t){const a=new E;Rv.closestPointToPoint(i,a),a.applyMatrix4(n);const l=s.ray.origin.distanceTo(a);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(g),point:a,index:e,face:null,object:o})}}class wJ extends kn{constructor(e,t,n,s,r,o,g,a,l){super(e,t,n,s,r,o,g,a,l),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:Zn,this.magFilter=r!==void 0?r:Zn,this.generateMipmaps=!1;const c=this;function C(){c.needsUpdate=!0,e.requestVideoFrameCallback(C)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(C)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class SJ extends kn{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=oi,this.minFilter=oi,this.generateMipmaps=!1,this.needsUpdate=!0}}class mZ extends kn{constructor(e,t,n,s,r,o,g,a,l,c,C,h){super(null,o,g,a,l,c,s,r,C,h),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class RJ extends mZ{constructor(e,t,n,s,r,o){super(e,t,n,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=cs}}class WJ extends kn{constructor(e,t,n,s,r,o,g,a,l){super(e,t,n,s,r,o,g,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Fg{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(s),t.push(r),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let s=0;const r=n.length;let o;t?o=t:o=e*n[r-1];let g=0,a=r-1,l;for(;g<=a;)if(s=Math.floor(g+(a-g)/2),l=n[s]-o,l<0)g=s+1;else if(l>0)a=s-1;else{a=s;break}if(s=a,n[s]===o)return s/(r-1);const c=n[s],h=n[s+1]-c,p=(o-c)/h;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),g=this.getPoint(r),a=t||(o.isVector2?new Fe:new E);return a.copy(g).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new E,s=[],r=[],o=[],g=new E,a=new mt;for(let p=0;p<=e;p++){const m=p/e;s[p]=this.getTangentAt(m,new E)}r[0]=new E,o[0]=new E;let l=Number.MAX_VALUE;const c=Math.abs(s[0].x),C=Math.abs(s[0].y),h=Math.abs(s[0].z);c<=l&&(l=c,n.set(1,0,0)),C<=l&&(l=C,n.set(0,1,0)),h<=l&&n.set(0,0,1),g.crossVectors(s[0],n).normalize(),r[0].crossVectors(s[0],g),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),g.crossVectors(s[p-1],s[p]),g.length()>Number.EPSILON){g.normalize();const m=Math.acos(Vi(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(a.makeRotationAxis(g,m))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(Vi(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(g.crossVectors(r[0],r[e]))>0&&(p=-p);for(let m=1;m<=e;m++)r[m].applyMatrix4(a.makeRotationAxis(s[m],p*m)),o[m].crossVectors(s[m],r[m])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class bG extends Fg{constructor(e=0,t=0,n=1,s=1,r=0,o=Math.PI*2,g=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=g,this.aRotation=a}getPoint(e,t){const n=t||new Fe,s=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=s;for(;r>s;)r-=s;r<Number.EPSILON&&(o?r=0:r=s),this.aClockwise===!0&&!o&&(r===s?r=-s:r=r-s);const g=this.aStartAngle+e*r;let a=this.aX+this.xRadius*Math.cos(g),l=this.aY+this.yRadius*Math.sin(g);if(this.aRotation!==0){const c=Math.cos(this.aRotation),C=Math.sin(this.aRotation),h=a-this.aX,p=l-this.aY;a=h*c-p*C+this.aX,l=h*C+p*c+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class MV extends bG{constructor(e,t,n,s,r,o){super(e,t,n,n,s,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function bZ(){let i=0,e=0,t=0,n=0;function s(r,o,g,a){i=r,e=g,t=-3*r+3*o-2*g-a,n=2*r-2*o+g+a}return{initCatmullRom:function(r,o,g,a,l){s(o,g,l*(g-r),l*(a-o))},initNonuniformCatmullRom:function(r,o,g,a,l,c,C){let h=(o-r)/l-(g-r)/(l+c)+(g-o)/c,p=(g-o)/c-(a-o)/(c+C)+(a-g)/C;h*=c,p*=c,s(o,g,h,p)},calc:function(r){const o=r*r,g=o*r;return i+e*r+t*o+n*g}}}const l0=new E,fB=new bZ,mB=new bZ,bB=new bZ;class KV extends Fg{constructor(e=[],t=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new E){const n=t,s=this.points,r=s.length,o=(r-(this.closed?0:1))*e;let g=Math.floor(o),a=o-g;this.closed?g+=g>0?0:(Math.floor(Math.abs(g)/r)+1)*r:a===0&&g===r-1&&(g=r-2,a=1);let l,c;this.closed||g>0?l=s[(g-1)%r]:(l0.subVectors(s[0],s[1]).add(s[0]),l=l0);const C=s[g%r],h=s[(g+1)%r];if(this.closed||g+2<r?c=s[(g+2)%r]:(l0.subVectors(s[r-1],s[r-2]).add(s[r-1]),c=l0),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let m=Math.pow(l.distanceToSquared(C),p),f=Math.pow(C.distanceToSquared(h),p),b=Math.pow(h.distanceToSquared(c),p);f<1e-4&&(f=1),m<1e-4&&(m=f),b<1e-4&&(b=f),fB.initNonuniformCatmullRom(l.x,C.x,h.x,c.x,m,f,b),mB.initNonuniformCatmullRom(l.y,C.y,h.y,c.y,m,f,b),bB.initNonuniformCatmullRom(l.z,C.z,h.z,c.z,m,f,b)}else this.curveType==="catmullrom"&&(fB.initCatmullRom(l.x,C.x,h.x,c.x,this.tension),mB.initCatmullRom(l.y,C.y,h.y,c.y,this.tension),bB.initCatmullRom(l.z,C.z,h.z,c.z,this.tension));return n.set(fB.calc(a),mB.calc(a),bB.calc(a)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new E().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function hW(i,e,t,n,s){const r=(n-e)*.5,o=(s-t)*.5,g=i*i,a=i*g;return(2*t-2*n+r+o)*a+(-3*t+3*n-2*r-o)*g+r*i+t}function xJ(i,e){const t=1-i;return t*t*e}function VJ(i,e){return 2*(1-i)*i*e}function HJ(i,e){return i*i*e}function OA(i,e,t,n){return xJ(i,e)+VJ(i,t)+HJ(i,n)}function XJ(i,e){const t=1-i;return t*t*t*e}function YJ(i,e){const t=1-i;return 3*t*t*i*e}function FJ(i,e){return 3*(1-i)*i*i*e}function NJ(i,e){return i*i*i*e}function QA(i,e,t,n,s){return XJ(i,e)+YJ(i,t)+FJ(i,n)+NJ(i,s)}class GZ extends Fg{constructor(e=new Fe,t=new Fe,n=new Fe,s=new Fe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Fe){const n=t,s=this.v0,r=this.v1,o=this.v2,g=this.v3;return n.set(QA(e,s.x,r.x,o.x,g.x),QA(e,s.y,r.y,o.y,g.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class LV extends Fg{constructor(e=new E,t=new E,n=new E,s=new E){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new E){const n=t,s=this.v0,r=this.v1,o=this.v2,g=this.v3;return n.set(QA(e,s.x,r.x,o.x,g.x),QA(e,s.y,r.y,o.y,g.y),QA(e,s.z,r.z,o.z,g.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class GG extends Fg{constructor(e=new Fe,t=new Fe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Fe){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Fe;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class zV extends Fg{constructor(e=new E,t=new E){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new E){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class yZ extends Fg{constructor(e=new Fe,t=new Fe,n=new Fe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Fe){const n=t,s=this.v0,r=this.v1,o=this.v2;return n.set(OA(e,s.x,r.x,o.x),OA(e,s.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class BZ extends Fg{constructor(e=new E,t=new E,n=new E){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new E){const n=t,s=this.v0,r=this.v1,o=this.v2;return n.set(OA(e,s.x,r.x,o.x),OA(e,s.y,r.y,o.y),OA(e,s.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class vZ extends Fg{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Fe){const n=t,s=this.points,r=(s.length-1)*e,o=Math.floor(r),g=r-o,a=s[o===0?o:o-1],l=s[o],c=s[o>s.length-2?s.length-1:o+1],C=s[o>s.length-3?s.length-1:o+2];return n.set(hW(g,a.x,l.x,c.x,C.x),hW(g,a.y,l.y,c.y,C.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new Fe().fromArray(s))}return this}}var ZZ=Object.freeze({__proto__:null,ArcCurve:MV,CatmullRomCurve3:KV,CubicBezierCurve:GZ,CubicBezierCurve3:LV,EllipseCurve:bG,LineCurve:GG,LineCurve3:zV,QuadraticBezierCurve:yZ,QuadraticBezierCurve3:BZ,SplineCurve:vZ});class _V extends Fg{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new GG(t,e))}getPoint(e,t){const n=e*this.getLength(),s=this.getCurveLengths();let r=0;for(;r<s.length;){if(s[r]>=n){const o=s[r]-n,g=this.curves[r],a=g.getLength(),l=a===0?0:1-o/a;return g.getPointAt(l,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let s=0,r=this.curves;s<r.length;s++){const o=r[s],g=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(g);for(let l=0;l<a.length;l++){const c=a[l];n&&n.equals(c)||(t.push(c),n=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(new ZZ[s.type]().fromJSON(s))}return this}}class Bp extends _V{constructor(e){super(),this.type="Path",this.currentPoint=new Fe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new GG(this.currentPoint.clone(),new Fe(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){const r=new yZ(this.currentPoint.clone(),new Fe(e,t),new Fe(n,s));return this.curves.push(r),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,r,o){const g=new GZ(this.currentPoint.clone(),new Fe(e,t),new Fe(n,s),new Fe(r,o));return this.curves.push(g),this.currentPoint.set(r,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new vZ(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,r,o){const g=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+g,t+a,n,s,r,o),this}absarc(e,t,n,s,r,o){return this.absellipse(e,t,n,n,s,r,o),this}ellipse(e,t,n,s,r,o,g,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,s,r,o,g,a),this}absellipse(e,t,n,s,r,o,g,a){const l=new bG(e,t,n,s,r,o,g,a);if(this.curves.length>0){const C=l.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class qd extends zt{constructor(e=[new Fe(0,-.5),new Fe(.5,0),new Fe(0,.5)],t=12,n=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:s},t=Math.floor(t),s=Vi(s,0,Math.PI*2);const r=[],o=[],g=[],a=[],l=[],c=1/t,C=new E,h=new Fe,p=new E,m=new E,f=new E;let b=0,y=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:b=e[v+1].x-e[v].x,y=e[v+1].y-e[v].y,p.x=y*1,p.y=-b,p.z=y*0,f.copy(p),p.normalize(),a.push(p.x,p.y,p.z);break;case e.length-1:a.push(f.x,f.y,f.z);break;default:b=e[v+1].x-e[v].x,y=e[v+1].y-e[v].y,p.x=y*1,p.y=-b,p.z=y*0,m.copy(p),p.x+=f.x,p.y+=f.y,p.z+=f.z,p.normalize(),a.push(p.x,p.y,p.z),f.copy(m)}for(let v=0;v<=t;v++){const G=n+v*c*s,w=Math.sin(G),W=Math.cos(G);for(let V=0;V<=e.length-1;V++){C.x=e[V].x*w,C.y=e[V].y,C.z=e[V].x*W,o.push(C.x,C.y,C.z),h.x=v/t,h.y=V/(e.length-1),g.push(h.x,h.y);const X=a[3*V+0]*w,R=a[3*V+1],Y=a[3*V+0]*W;l.push(X,R,Y)}}for(let v=0;v<t;v++)for(let G=0;G<e.length-1;G++){const w=G+v*e.length,W=w,V=w+e.length,X=w+e.length+1,R=w+1;r.push(W,V,R),r.push(X,R,V)}this.setIndex(r),this.setAttribute("position",new pt(o,3)),this.setAttribute("uv",new pt(g,2)),this.setAttribute("normal",new pt(l,3))}static fromJSON(e){return new qd(e.points,e.segments,e.phiStart,e.phiLength)}}class Op extends qd{constructor(e=1,t=1,n=4,s=8){const r=new Bp;r.absarc(0,-t/2,e,Math.PI*1.5,0),r.absarc(0,t/2,e,0,Math.PI*.5),super(r.getPoints(n),s),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:s}}static fromJSON(e){return new Op(e.radius,e.length,e.capSegments,e.radialSegments)}}class Qp extends zt{constructor(e=1,t=32,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);const r=[],o=[],g=[],a=[],l=new E,c=new Fe;o.push(0,0,0),g.push(0,0,1),a.push(.5,.5);for(let C=0,h=3;C<=t;C++,h+=3){const p=n+C/t*s;l.x=e*Math.cos(p),l.y=e*Math.sin(p),o.push(l.x,l.y,l.z),g.push(0,0,1),c.x=(o[h]/e+1)/2,c.y=(o[h+1]/e+1)/2,a.push(c.x,c.y)}for(let C=1;C<=t;C++)r.push(C,C+1,0);this.setIndex(r),this.setAttribute("position",new pt(o,3)),this.setAttribute("normal",new pt(g,3)),this.setAttribute("uv",new pt(a,2))}static fromJSON(e){return new Qp(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Wu extends zt{constructor(e=1,t=1,n=1,s=32,r=1,o=!1,g=0,a=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:g,thetaLength:a};const l=this;s=Math.floor(s),r=Math.floor(r);const c=[],C=[],h=[],p=[];let m=0;const f=[],b=n/2;let y=0;v(),o===!1&&(e>0&&G(!0),t>0&&G(!1)),this.setIndex(c),this.setAttribute("position",new pt(C,3)),this.setAttribute("normal",new pt(h,3)),this.setAttribute("uv",new pt(p,2));function v(){const w=new E,W=new E;let V=0;const X=(t-e)/n;for(let R=0;R<=r;R++){const Y=[],M=R/r,L=M*(t-e)+e;for(let re=0;re<=s;re++){const j=re/s,$=j*a+g,ie=Math.sin($),he=Math.cos($);W.x=L*ie,W.y=-M*n+b,W.z=L*he,C.push(W.x,W.y,W.z),w.set(ie,X,he).normalize(),h.push(w.x,w.y,w.z),p.push(j,1-M),Y.push(m++)}f.push(Y)}for(let R=0;R<s;R++)for(let Y=0;Y<r;Y++){const M=f[Y][R],L=f[Y+1][R],re=f[Y+1][R+1],j=f[Y][R+1];c.push(M,L,j),c.push(L,re,j),V+=6}l.addGroup(y,V,0),y+=V}function G(w){const W=m,V=new Fe,X=new E;let R=0;const Y=w===!0?e:t,M=w===!0?1:-1;for(let re=1;re<=s;re++)C.push(0,b*M,0),h.push(0,M,0),p.push(.5,.5),m++;const L=m;for(let re=0;re<=s;re++){const $=re/s*a+g,ie=Math.cos($),he=Math.sin($);X.x=Y*he,X.y=b*M,X.z=Y*ie,C.push(X.x,X.y,X.z),h.push(0,M,0),V.x=ie*.5+.5,V.y=he*.5*M+.5,p.push(V.x,V.y),m++}for(let re=0;re<s;re++){const j=W+re,$=L+re;w===!0?c.push($,$+1,j):c.push($+1,$,j),R+=3}l.addGroup(y,R,w===!0?1:2),y+=R}}static fromJSON(e){return new Wu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class jp extends Wu{constructor(e=1,t=1,n=32,s=1,r=!1,o=0,g=Math.PI*2){super(0,e,t,n,s,r,o,g),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:g}}static fromJSON(e){return new jp(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Al extends zt{constructor(e=[],t=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};const r=[],o=[];g(s),l(n),c(),this.setAttribute("position",new pt(r,3)),this.setAttribute("normal",new pt(r.slice(),3)),this.setAttribute("uv",new pt(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function g(v){const G=new E,w=new E,W=new E;for(let V=0;V<t.length;V+=3)p(t[V+0],G),p(t[V+1],w),p(t[V+2],W),a(G,w,W,v)}function a(v,G,w,W){const V=W+1,X=[];for(let R=0;R<=V;R++){X[R]=[];const Y=v.clone().lerp(w,R/V),M=G.clone().lerp(w,R/V),L=V-R;for(let re=0;re<=L;re++)re===0&&R===V?X[R][re]=Y:X[R][re]=Y.clone().lerp(M,re/L)}for(let R=0;R<V;R++)for(let Y=0;Y<2*(V-R)-1;Y++){const M=Math.floor(Y/2);Y%2===0?(h(X[R][M+1]),h(X[R+1][M]),h(X[R][M])):(h(X[R][M+1]),h(X[R+1][M+1]),h(X[R+1][M]))}}function l(v){const G=new E;for(let w=0;w<r.length;w+=3)G.x=r[w+0],G.y=r[w+1],G.z=r[w+2],G.normalize().multiplyScalar(v),r[w+0]=G.x,r[w+1]=G.y,r[w+2]=G.z}function c(){const v=new E;for(let G=0;G<r.length;G+=3){v.x=r[G+0],v.y=r[G+1],v.z=r[G+2];const w=b(v)/2/Math.PI+.5,W=y(v)/Math.PI+.5;o.push(w,1-W)}m(),C()}function C(){for(let v=0;v<o.length;v+=6){const G=o[v+0],w=o[v+2],W=o[v+4],V=Math.max(G,w,W),X=Math.min(G,w,W);V>.9&&X<.1&&(G<.2&&(o[v+0]+=1),w<.2&&(o[v+2]+=1),W<.2&&(o[v+4]+=1))}}function h(v){r.push(v.x,v.y,v.z)}function p(v,G){const w=v*3;G.x=e[w+0],G.y=e[w+1],G.z=e[w+2]}function m(){const v=new E,G=new E,w=new E,W=new E,V=new Fe,X=new Fe,R=new Fe;for(let Y=0,M=0;Y<r.length;Y+=9,M+=6){v.set(r[Y+0],r[Y+1],r[Y+2]),G.set(r[Y+3],r[Y+4],r[Y+5]),w.set(r[Y+6],r[Y+7],r[Y+8]),V.set(o[M+0],o[M+1]),X.set(o[M+2],o[M+3]),R.set(o[M+4],o[M+5]),W.copy(v).add(G).add(w).divideScalar(3);const L=b(W);f(V,M+0,v,L),f(X,M+2,G,L),f(R,M+4,w,L)}}function f(v,G,w,W){W<0&&v.x===1&&(o[G]=v.x-1),w.x===0&&w.z===0&&(o[G]=W/2/Math.PI+.5)}function b(v){return Math.atan2(v.z,-v.x)}function y(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(e){return new Al(e.vertices,e.indices,e.radius,e.details)}}class qp extends Al{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-n,0,-s,n,0,s,-n,0,s,n,-s,-n,0,-s,n,0,s,-n,0,s,n,0,-n,0,-s,n,0,-s,-n,0,s,n,0,s],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qp(e.radius,e.detail)}}const c0=new E,I0=new E,GB=new E,u0=new To;class kV extends zt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),r=Math.cos(gu*t),o=e.getIndex(),g=e.getAttribute("position"),a=o?o.count:g.count,l=[0,0,0],c=["a","b","c"],C=new Array(3),h={},p=[];for(let m=0;m<a;m+=3){o?(l[0]=o.getX(m),l[1]=o.getX(m+1),l[2]=o.getX(m+2)):(l[0]=m,l[1]=m+1,l[2]=m+2);const{a:f,b,c:y}=u0;if(f.fromBufferAttribute(g,l[0]),b.fromBufferAttribute(g,l[1]),y.fromBufferAttribute(g,l[2]),u0.getNormal(GB),C[0]=`${Math.round(f.x*s)},${Math.round(f.y*s)},${Math.round(f.z*s)}`,C[1]=`${Math.round(b.x*s)},${Math.round(b.y*s)},${Math.round(b.z*s)}`,C[2]=`${Math.round(y.x*s)},${Math.round(y.y*s)},${Math.round(y.z*s)}`,!(C[0]===C[1]||C[1]===C[2]||C[2]===C[0]))for(let v=0;v<3;v++){const G=(v+1)%3,w=C[v],W=C[G],V=u0[c[v]],X=u0[c[G]],R=`${w}_${W}`,Y=`${W}_${w}`;Y in h&&h[Y]?(GB.dot(h[Y].normal)<=r&&(p.push(V.x,V.y,V.z),p.push(X.x,X.y,X.z)),h[Y]=null):R in h||(h[R]={index0:l[v],index1:l[G],normal:GB.clone()})}}for(const m in h)if(h[m]){const{index0:f,index1:b}=h[m];c0.fromBufferAttribute(g,f),I0.fromBufferAttribute(g,b),p.push(c0.x,c0.y,c0.z),p.push(I0.x,I0.y,I0.z)}this.setAttribute("position",new pt(p,3))}}}let cu=class extends Bp{constructor(e){super(e),this.uuid=lo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(new Bp().fromJSON(s))}return this}};const MJ={triangulate:function(i,e,t=2){const n=e&&e.length,s=n?e[0]*t:i.length;let r=TV(i,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let g,a,l,c,C,h,p;if(n&&(r=kJ(i,e,r,t)),i.length>80*t){g=l=i[0],a=c=i[1];for(let m=t;m<s;m+=t)C=i[m],h=i[m+1],C<g&&(g=C),h<a&&(a=h),C>l&&(l=C),h>c&&(c=h);p=Math.max(l-g,c-a),p=p!==0?32767/p:0}return vp(r,o,t,g,a,p,0),o}};function TV(i,e,t,n,s){let r,o;if(s===$J(i,e,t,n)>0)for(r=e;r<t;r+=n)o=AW(r,i[r],i[r+1],o);else for(r=t-n;r>=e;r-=n)o=AW(r,i[r],i[r+1],o);return o&&yG(o,o.next)&&(wp(o),o=o.next),o}function yu(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(yG(t,t.next)||gi(t.prev,t,t.next)===0)){if(wp(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function vp(i,e,t,n,s,r,o){if(!i)return;!o&&r&&UJ(i,n,s,r);let g=i,a,l;for(;i.prev!==i.next;){if(a=i.prev,l=i.next,r?LJ(i,n,s,r):KJ(i)){e.push(a.i/t|0),e.push(i.i/t|0),e.push(l.i/t|0),wp(i),i=l.next,g=l.next;continue}if(i=l,i===g){o?o===1?(i=zJ(yu(i),e,t),vp(i,e,t,n,s,r,2)):o===2&&_J(i,e,t,n,s,r):vp(yu(i),e,t,n,s,r,1);break}}}function KJ(i){const e=i.prev,t=i,n=i.next;if(gi(e,t,n)>=0)return!1;const s=e.x,r=t.x,o=n.x,g=e.y,a=t.y,l=n.y,c=s<r?s<o?s:o:r<o?r:o,C=g<a?g<l?g:l:a<l?a:l,h=s>r?s>o?s:o:r>o?r:o,p=g>a?g>l?g:l:a>l?a:l;let m=n.next;for(;m!==e;){if(m.x>=c&&m.x<=h&&m.y>=C&&m.y<=p&&sd(s,g,r,a,o,l,m.x,m.y)&&gi(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function LJ(i,e,t,n){const s=i.prev,r=i,o=i.next;if(gi(s,r,o)>=0)return!1;const g=s.x,a=r.x,l=o.x,c=s.y,C=r.y,h=o.y,p=g<a?g<l?g:l:a<l?a:l,m=c<C?c<h?c:h:C<h?C:h,f=g>a?g>l?g:l:a>l?a:l,b=c>C?c>h?c:h:C>h?C:h,y=Wv(p,m,e,t,n),v=Wv(f,b,e,t,n);let G=i.prevZ,w=i.nextZ;for(;G&&G.z>=y&&w&&w.z<=v;){if(G.x>=p&&G.x<=f&&G.y>=m&&G.y<=b&&G!==s&&G!==o&&sd(g,c,a,C,l,h,G.x,G.y)&&gi(G.prev,G,G.next)>=0||(G=G.prevZ,w.x>=p&&w.x<=f&&w.y>=m&&w.y<=b&&w!==s&&w!==o&&sd(g,c,a,C,l,h,w.x,w.y)&&gi(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;G&&G.z>=y;){if(G.x>=p&&G.x<=f&&G.y>=m&&G.y<=b&&G!==s&&G!==o&&sd(g,c,a,C,l,h,G.x,G.y)&&gi(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;w&&w.z<=v;){if(w.x>=p&&w.x<=f&&w.y>=m&&w.y<=b&&w!==s&&w!==o&&sd(g,c,a,C,l,h,w.x,w.y)&&gi(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function zJ(i,e,t){let n=i;do{const s=n.prev,r=n.next.next;!yG(s,r)&&EV(s,n,n.next,r)&&Zp(s,r)&&Zp(r,s)&&(e.push(s.i/t|0),e.push(n.i/t|0),e.push(r.i/t|0),wp(n),wp(n.next),n=i=r),n=n.next}while(n!==i);return yu(n)}function _J(i,e,t,n,s,r){let o=i;do{let g=o.next.next;for(;g!==o.prev;){if(o.i!==g.i&&QJ(o,g)){let a=DV(o,g);o=yu(o,o.next),a=yu(a,a.next),vp(o,e,t,n,s,r,0),vp(a,e,t,n,s,r,0);return}g=g.next}o=o.next}while(o!==i)}function kJ(i,e,t,n){const s=[];let r,o,g,a,l;for(r=0,o=e.length;r<o;r++)g=e[r]*n,a=r<o-1?e[r+1]*n:i.length,l=TV(i,g,a,n,!1),l===l.next&&(l.steiner=!0),s.push(OJ(l));for(s.sort(TJ),r=0;r<s.length;r++)t=EJ(s[r],t);return t}function TJ(i,e){return i.x-e.x}function EJ(i,e){const t=DJ(i,e);if(!t)return e;const n=DV(t,i);return yu(n,n.next),yu(t,t.next)}function DJ(i,e){let t=e,n=-1/0,s;const r=i.x,o=i.y;do{if(o<=t.y&&o>=t.next.y&&t.next.y!==t.y){const h=t.x+(o-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=r&&h>n&&(n=h,s=t.x<t.next.x?t:t.next,h===r))return s}t=t.next}while(t!==e);if(!s)return null;const g=s,a=s.x,l=s.y;let c=1/0,C;t=s;do r>=t.x&&t.x>=a&&r!==t.x&&sd(o<l?r:n,o,a,l,o<l?n:r,o,t.x,t.y)&&(C=Math.abs(o-t.y)/(r-t.x),Zp(t,i)&&(C<c||C===c&&(t.x>s.x||t.x===s.x&&JJ(s,t)))&&(s=t,c=C)),t=t.next;while(t!==g);return s}function JJ(i,e){return gi(i.prev,i,e.prev)<0&&gi(e.next,i,i.next)<0}function UJ(i,e,t,n){let s=i;do s.z===0&&(s.z=Wv(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,PJ(s)}function PJ(i){let e,t,n,s,r,o,g,a,l=1;do{for(t=i,i=null,r=null,o=0;t;){for(o++,n=t,g=0,e=0;e<l&&(g++,n=n.nextZ,!!n);e++);for(a=l;g>0||a>0&&n;)g!==0&&(a===0||!n||t.z<=n.z)?(s=t,t=t.nextZ,g--):(s=n,n=n.nextZ,a--),r?r.nextZ=s:i=s,s.prevZ=r,r=s;t=n}r.nextZ=null,l*=2}while(o>1);return i}function Wv(i,e,t,n,s){return i=(i-t)*s|0,e=(e-n)*s|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function OJ(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function sd(i,e,t,n,s,r,o,g){return(s-o)*(e-g)>=(i-o)*(r-g)&&(i-o)*(n-g)>=(t-o)*(e-g)&&(t-o)*(r-g)>=(s-o)*(n-g)}function QJ(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!jJ(i,e)&&(Zp(i,e)&&Zp(e,i)&&qJ(i,e)&&(gi(i.prev,i,e.prev)||gi(i,e.prev,e))||yG(i,e)&&gi(i.prev,i,i.next)>0&&gi(e.prev,e,e.next)>0)}function gi(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function yG(i,e){return i.x===e.x&&i.y===e.y}function EV(i,e,t,n){const s=d0(gi(i,e,t)),r=d0(gi(i,e,n)),o=d0(gi(t,n,i)),g=d0(gi(t,n,e));return!!(s!==r&&o!==g||s===0&&C0(i,t,e)||r===0&&C0(i,n,e)||o===0&&C0(t,i,n)||g===0&&C0(t,e,n))}function C0(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function d0(i){return i>0?1:i<0?-1:0}function jJ(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&EV(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function Zp(i,e){return gi(i.prev,i,i.next)<0?gi(i,e,i.next)>=0&&gi(i,i.prev,e)>=0:gi(i,e,i.prev)<0||gi(i,i.next,e)<0}function qJ(i,e){let t=i,n=!1;const s=(i.x+e.x)/2,r=(i.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function DV(i,e){const t=new xv(i.i,i.x,i.y),n=new xv(e.i,e.x,e.y),s=i.next,r=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,n.next=t,t.prev=n,r.next=n,n.prev=r,n}function AW(i,e,t,n){const s=new xv(i,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function wp(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function xv(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $J(i,e,t,n){let s=0;for(let r=e,o=t-n;r<t;r+=n)s+=(i[o]-i[r])*(i[r+1]+i[o+1]),o=r;return s}class ca{static area(e){const t=e.length;let n=0;for(let s=t-1,r=0;r<t;s=r++)n+=e[s].x*e[r].y-e[r].x*e[s].y;return n*.5}static isClockWise(e){return ca.area(e)<0}static triangulateShape(e,t){const n=[],s=[],r=[];pW(e),fW(n,e);let o=e.length;t.forEach(pW);for(let a=0;a<t.length;a++)s.push(o),o+=t[a].length,fW(n,t[a]);const g=MJ.triangulate(n,s);for(let a=0;a<g.length;a+=3)r.push(g.slice(a,a+3));return r}}function pW(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function fW(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class $p extends zt{constructor(e=new cu([new Fe(.5,.5),new Fe(-.5,.5),new Fe(-.5,-.5),new Fe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,s=[],r=[];for(let g=0,a=e.length;g<a;g++){const l=e[g];o(l)}this.setAttribute("position",new pt(s,3)),this.setAttribute("uv",new pt(r,2)),this.computeVertexNormals();function o(g){const a=[],l=t.curveSegments!==void 0?t.curveSegments:12,c=t.steps!==void 0?t.steps:1,C=t.depth!==void 0?t.depth:1;let h=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,m=t.bevelSize!==void 0?t.bevelSize:p-.1,f=t.bevelOffset!==void 0?t.bevelOffset:0,b=t.bevelSegments!==void 0?t.bevelSegments:3;const y=t.extrudePath,v=t.UVGenerator!==void 0?t.UVGenerator:eU;let G,w=!1,W,V,X,R;y&&(G=y.getSpacedPoints(c),w=!0,h=!1,W=y.computeFrenetFrames(c,!1),V=new E,X=new E,R=new E),h||(b=0,p=0,m=0,f=0);const Y=g.extractPoints(l);let M=Y.shape;const L=Y.holes;if(!ca.isClockWise(M)){M=M.reverse();for(let ve=0,be=L.length;ve<be;ve++){const Ve=L[ve];ca.isClockWise(Ve)&&(L[ve]=Ve.reverse())}}const j=ca.triangulateShape(M,L),$=M;for(let ve=0,be=L.length;ve<be;ve++){const Ve=L[ve];M=M.concat(Ve)}function ie(ve,be,Ve){return be||console.error("THREE.ExtrudeGeometry: vec does not exist"),be.clone().multiplyScalar(Ve).add(ve)}const he=M.length,le=j.length;function _(ve,be,Ve){let qe,Xe,Pe;const ct=ve.x-be.x,gt=ve.y-be.y,Yt=Ve.x-ve.x,Zt=Ve.y-ve.y,O=ct*ct+gt*gt,z=ct*Zt-gt*Yt;if(Math.abs(z)>Number.EPSILON){const ye=Math.sqrt(O),Le=Math.sqrt(Yt*Yt+Zt*Zt),Te=be.x-gt/ye,De=be.y+ct/ye,vt=Ve.x-Zt/Le,nt=Ve.y+Yt/Le,Ye=((vt-Te)*Zt-(nt-De)*Yt)/(ct*Zt-gt*Yt);qe=Te+ct*Ye-ve.x,Xe=De+gt*Ye-ve.y;const dt=qe*qe+Xe*Xe;if(dt<=2)return new Fe(qe,Xe);Pe=Math.sqrt(dt/2)}else{let ye=!1;ct>Number.EPSILON?Yt>Number.EPSILON&&(ye=!0):ct<-Number.EPSILON?Yt<-Number.EPSILON&&(ye=!0):Math.sign(gt)===Math.sign(Zt)&&(ye=!0),ye?(qe=-gt,Xe=ct,Pe=Math.sqrt(O)):(qe=ct,Xe=gt,Pe=Math.sqrt(O/2))}return new Fe(qe/Pe,Xe/Pe)}const ne=[];for(let ve=0,be=$.length,Ve=be-1,qe=ve+1;ve<be;ve++,Ve++,qe++)Ve===be&&(Ve=0),qe===be&&(qe=0),ne[ve]=_($[ve],$[Ve],$[qe]);const te=[];let q,se=ne.concat();for(let ve=0,be=L.length;ve<be;ve++){const Ve=L[ve];q=[];for(let qe=0,Xe=Ve.length,Pe=Xe-1,ct=qe+1;qe<Xe;qe++,Pe++,ct++)Pe===Xe&&(Pe=0),ct===Xe&&(ct=0),q[qe]=_(Ve[qe],Ve[Pe],Ve[ct]);te.push(q),se=se.concat(q)}for(let ve=0;ve<b;ve++){const be=ve/b,Ve=p*Math.cos(be*Math.PI/2),qe=m*Math.sin(be*Math.PI/2)+f;for(let Xe=0,Pe=$.length;Xe<Pe;Xe++){const ct=ie($[Xe],ne[Xe],qe);tt(ct.x,ct.y,-Ve)}for(let Xe=0,Pe=L.length;Xe<Pe;Xe++){const ct=L[Xe];q=te[Xe];for(let gt=0,Yt=ct.length;gt<Yt;gt++){const Zt=ie(ct[gt],q[gt],qe);tt(Zt.x,Zt.y,-Ve)}}}const ue=m+f;for(let ve=0;ve<he;ve++){const be=h?ie(M[ve],se[ve],ue):M[ve];w?(X.copy(W.normals[0]).multiplyScalar(be.x),V.copy(W.binormals[0]).multiplyScalar(be.y),R.copy(G[0]).add(X).add(V),tt(R.x,R.y,R.z)):tt(be.x,be.y,0)}for(let ve=1;ve<=c;ve++)for(let be=0;be<he;be++){const Ve=h?ie(M[be],se[be],ue):M[be];w?(X.copy(W.normals[ve]).multiplyScalar(Ve.x),V.copy(W.binormals[ve]).multiplyScalar(Ve.y),R.copy(G[ve]).add(X).add(V),tt(R.x,R.y,R.z)):tt(Ve.x,Ve.y,C/c*ve)}for(let ve=b-1;ve>=0;ve--){const be=ve/b,Ve=p*Math.cos(be*Math.PI/2),qe=m*Math.sin(be*Math.PI/2)+f;for(let Xe=0,Pe=$.length;Xe<Pe;Xe++){const ct=ie($[Xe],ne[Xe],qe);tt(ct.x,ct.y,C+Ve)}for(let Xe=0,Pe=L.length;Xe<Pe;Xe++){const ct=L[Xe];q=te[Xe];for(let gt=0,Yt=ct.length;gt<Yt;gt++){const Zt=ie(ct[gt],q[gt],qe);w?tt(Zt.x,Zt.y+G[c-1].y,G[c-1].x+Ve):tt(Zt.x,Zt.y,C+Ve)}}}Ae(),We();function Ae(){const ve=s.length/3;if(h){let be=0,Ve=he*be;for(let qe=0;qe<le;qe++){const Xe=j[qe];Oe(Xe[2]+Ve,Xe[1]+Ve,Xe[0]+Ve)}be=c+b*2,Ve=he*be;for(let qe=0;qe<le;qe++){const Xe=j[qe];Oe(Xe[0]+Ve,Xe[1]+Ve,Xe[2]+Ve)}}else{for(let be=0;be<le;be++){const Ve=j[be];Oe(Ve[2],Ve[1],Ve[0])}for(let be=0;be<le;be++){const Ve=j[be];Oe(Ve[0]+he*c,Ve[1]+he*c,Ve[2]+he*c)}}n.addGroup(ve,s.length/3-ve,0)}function We(){const ve=s.length/3;let be=0;me($,be),be+=$.length;for(let Ve=0,qe=L.length;Ve<qe;Ve++){const Xe=L[Ve];me(Xe,be),be+=Xe.length}n.addGroup(ve,s.length/3-ve,1)}function me(ve,be){let Ve=ve.length;for(;--Ve>=0;){const qe=Ve;let Xe=Ve-1;Xe<0&&(Xe=ve.length-1);for(let Pe=0,ct=c+b*2;Pe<ct;Pe++){const gt=he*Pe,Yt=he*(Pe+1),Zt=be+qe+gt,O=be+Xe+gt,z=be+Xe+Yt,ye=be+qe+Yt;It(Zt,O,z,ye)}}}function tt(ve,be,Ve){a.push(ve),a.push(be),a.push(Ve)}function Oe(ve,be,Ve){ke(ve),ke(be),ke(Ve);const qe=s.length/3,Xe=v.generateTopUV(n,s,qe-3,qe-2,qe-1);je(Xe[0]),je(Xe[1]),je(Xe[2])}function It(ve,be,Ve,qe){ke(ve),ke(be),ke(qe),ke(be),ke(Ve),ke(qe);const Xe=s.length/3,Pe=v.generateSideWallUV(n,s,Xe-6,Xe-3,Xe-2,Xe-1);je(Pe[0]),je(Pe[1]),je(Pe[3]),je(Pe[1]),je(Pe[2]),je(Pe[3])}function ke(ve){s.push(a[ve*3+0]),s.push(a[ve*3+1]),s.push(a[ve*3+2])}function je(ve){r.push(ve.x),r.push(ve.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return tU(t,n,e)}static fromJSON(e,t){const n=[];for(let r=0,o=e.shapes.length;r<o;r++){const g=t[e.shapes[r]];n.push(g)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new ZZ[s.type]().fromJSON(s)),new $p(n,e.options)}}const eU={generateTopUV:function(i,e,t,n,s){const r=e[t*3],o=e[t*3+1],g=e[n*3],a=e[n*3+1],l=e[s*3],c=e[s*3+1];return[new Fe(r,o),new Fe(g,a),new Fe(l,c)]},generateSideWallUV:function(i,e,t,n,s,r){const o=e[t*3],g=e[t*3+1],a=e[t*3+2],l=e[n*3],c=e[n*3+1],C=e[n*3+2],h=e[s*3],p=e[s*3+1],m=e[s*3+2],f=e[r*3],b=e[r*3+1],y=e[r*3+2];return Math.abs(g-c)<Math.abs(o-l)?[new Fe(o,1-a),new Fe(l,1-C),new Fe(h,1-m),new Fe(f,1-y)]:[new Fe(g,1-a),new Fe(c,1-C),new Fe(p,1-m),new Fe(b,1-y)]}};function tU(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const r=i[n];t.shapes.push(r.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class $d extends Al{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $d(e.radius,e.detail)}}class eh extends Al{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new eh(e.radius,e.detail)}}class ef extends zt{constructor(e=.5,t=1,n=32,s=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:s,thetaStart:r,thetaLength:o},n=Math.max(3,n),s=Math.max(1,s);const g=[],a=[],l=[],c=[];let C=e;const h=(t-e)/s,p=new E,m=new Fe;for(let f=0;f<=s;f++){for(let b=0;b<=n;b++){const y=r+b/n*o;p.x=C*Math.cos(y),p.y=C*Math.sin(y),a.push(p.x,p.y,p.z),l.push(0,0,1),m.x=(p.x/t+1)/2,m.y=(p.y/t+1)/2,c.push(m.x,m.y)}C+=h}for(let f=0;f<s;f++){const b=f*(n+1);for(let y=0;y<n;y++){const v=y+b,G=v,w=v+n+1,W=v+n+2,V=v+1;g.push(G,w,V),g.push(w,W,V)}}this.setIndex(g),this.setAttribute("position",new pt(a,3)),this.setAttribute("normal",new pt(l,3)),this.setAttribute("uv",new pt(c,2))}static fromJSON(e){return new ef(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class tf extends zt{constructor(e=new cu([new Fe(0,.5),new Fe(-.5,-.5),new Fe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],s=[],r=[],o=[];let g=0,a=0;if(Array.isArray(e)===!1)l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(g,a,c),g+=a,a=0;this.setIndex(n),this.setAttribute("position",new pt(s,3)),this.setAttribute("normal",new pt(r,3)),this.setAttribute("uv",new pt(o,2));function l(c){const C=s.length/3,h=c.extractPoints(t);let p=h.shape;const m=h.holes;ca.isClockWise(p)===!1&&(p=p.reverse());for(let b=0,y=m.length;b<y;b++){const v=m[b];ca.isClockWise(v)===!0&&(m[b]=v.reverse())}const f=ca.triangulateShape(p,m);for(let b=0,y=m.length;b<y;b++){const v=m[b];p=p.concat(v)}for(let b=0,y=p.length;b<y;b++){const v=p[b];s.push(v.x,v.y,0),r.push(0,0,1),o.push(v.x,v.y)}for(let b=0,y=f.length;b<y;b++){const v=f[b],G=v[0]+C,w=v[1]+C,W=v[2]+C;n.push(G,w,W),a+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return nU(t,e)}static fromJSON(e,t){const n=[];for(let s=0,r=e.shapes.length;s<r;s++){const o=t[e.shapes[s]];n.push(o)}return new tf(n,e.curveSegments)}}function nU(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const s=i[t];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e}class th extends zt{constructor(e=1,t=32,n=16,s=0,r=Math.PI*2,o=0,g=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:o,thetaLength:g},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+g,Math.PI);let l=0;const c=[],C=new E,h=new E,p=[],m=[],f=[],b=[];for(let y=0;y<=n;y++){const v=[],G=y/n;let w=0;y==0&&o==0?w=.5/t:y==n&&a==Math.PI&&(w=-.5/t);for(let W=0;W<=t;W++){const V=W/t;C.x=-e*Math.cos(s+V*r)*Math.sin(o+G*g),C.y=e*Math.cos(o+G*g),C.z=e*Math.sin(s+V*r)*Math.sin(o+G*g),m.push(C.x,C.y,C.z),h.copy(C).normalize(),f.push(h.x,h.y,h.z),b.push(V+w,1-G),v.push(l++)}c.push(v)}for(let y=0;y<n;y++)for(let v=0;v<t;v++){const G=c[y][v+1],w=c[y][v],W=c[y+1][v],V=c[y+1][v+1];(y!==0||o>0)&&p.push(G,w,V),(y!==n-1||a<Math.PI)&&p.push(w,W,V)}this.setIndex(p),this.setAttribute("position",new pt(m,3)),this.setAttribute("normal",new pt(f,3)),this.setAttribute("uv",new pt(b,2))}static fromJSON(e){return new th(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class nf extends Al{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new nf(e.radius,e.detail)}}class sf extends zt{constructor(e=1,t=.4,n=12,s=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:r},n=Math.floor(n),s=Math.floor(s);const o=[],g=[],a=[],l=[],c=new E,C=new E,h=new E;for(let p=0;p<=n;p++)for(let m=0;m<=s;m++){const f=m/s*r,b=p/n*Math.PI*2;C.x=(e+t*Math.cos(b))*Math.cos(f),C.y=(e+t*Math.cos(b))*Math.sin(f),C.z=t*Math.sin(b),g.push(C.x,C.y,C.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(C,c).normalize(),a.push(h.x,h.y,h.z),l.push(m/s),l.push(p/n)}for(let p=1;p<=n;p++)for(let m=1;m<=s;m++){const f=(s+1)*p+m-1,b=(s+1)*(p-1)+m-1,y=(s+1)*(p-1)+m,v=(s+1)*p+m;o.push(f,b,v),o.push(b,y,v)}this.setIndex(o),this.setAttribute("position",new pt(g,3)),this.setAttribute("normal",new pt(a,3)),this.setAttribute("uv",new pt(l,2))}static fromJSON(e){return new sf(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class rf extends zt{constructor(e=1,t=.4,n=64,s=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:s,p:r,q:o},n=Math.floor(n),s=Math.floor(s);const g=[],a=[],l=[],c=[],C=new E,h=new E,p=new E,m=new E,f=new E,b=new E,y=new E;for(let G=0;G<=n;++G){const w=G/n*r*Math.PI*2;v(w,r,o,e,p),v(w+.01,r,o,e,m),b.subVectors(m,p),y.addVectors(m,p),f.crossVectors(b,y),y.crossVectors(f,b),f.normalize(),y.normalize();for(let W=0;W<=s;++W){const V=W/s*Math.PI*2,X=-t*Math.cos(V),R=t*Math.sin(V);C.x=p.x+(X*y.x+R*f.x),C.y=p.y+(X*y.y+R*f.y),C.z=p.z+(X*y.z+R*f.z),a.push(C.x,C.y,C.z),h.subVectors(C,p).normalize(),l.push(h.x,h.y,h.z),c.push(G/n),c.push(W/s)}}for(let G=1;G<=n;G++)for(let w=1;w<=s;w++){const W=(s+1)*(G-1)+(w-1),V=(s+1)*G+(w-1),X=(s+1)*G+w,R=(s+1)*(G-1)+w;g.push(W,V,R),g.push(V,X,R)}this.setIndex(g),this.setAttribute("position",new pt(a,3)),this.setAttribute("normal",new pt(l,3)),this.setAttribute("uv",new pt(c,2));function v(G,w,W,V,X){const R=Math.cos(G),Y=Math.sin(G),M=W/w*G,L=Math.cos(M);X.x=V*(2+L)*.5*R,X.y=V*(2+L)*Y*.5,X.z=V*Math.sin(M)*.5}}static fromJSON(e){return new rf(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class of extends zt{constructor(e=new BZ(new E(-1,-1,0),new E(-1,1,0),new E(1,1,0)),t=64,n=1,s=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:s,closed:r};const o=e.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const g=new E,a=new E,l=new Fe;let c=new E;const C=[],h=[],p=[],m=[];f(),this.setIndex(m),this.setAttribute("position",new pt(C,3)),this.setAttribute("normal",new pt(h,3)),this.setAttribute("uv",new pt(p,2));function f(){for(let G=0;G<t;G++)b(G);b(r===!1?t:0),v(),y()}function b(G){c=e.getPointAt(G/t,c);const w=o.normals[G],W=o.binormals[G];for(let V=0;V<=s;V++){const X=V/s*Math.PI*2,R=Math.sin(X),Y=-Math.cos(X);a.x=Y*w.x+R*W.x,a.y=Y*w.y+R*W.y,a.z=Y*w.z+R*W.z,a.normalize(),h.push(a.x,a.y,a.z),g.x=c.x+n*a.x,g.y=c.y+n*a.y,g.z=c.z+n*a.z,C.push(g.x,g.y,g.z)}}function y(){for(let G=1;G<=t;G++)for(let w=1;w<=s;w++){const W=(s+1)*(G-1)+(w-1),V=(s+1)*G+(w-1),X=(s+1)*G+w,R=(s+1)*(G-1)+w;m.push(W,V,R),m.push(V,X,R)}}function v(){for(let G=0;G<=t;G++)for(let w=0;w<=s;w++)l.x=G/t,l.y=w/s,p.push(l.x,l.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new of(new ZZ[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class JV extends zt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,s=new E,r=new E;if(e.index!==null){const o=e.attributes.position,g=e.index;let a=e.groups;a.length===0&&(a=[{start:0,count:g.count,materialIndex:0}]);for(let l=0,c=a.length;l<c;++l){const C=a[l],h=C.start,p=C.count;for(let m=h,f=h+p;m<f;m+=3)for(let b=0;b<3;b++){const y=g.getX(m+b),v=g.getX(m+(b+1)%3);s.fromBufferAttribute(o,y),r.fromBufferAttribute(o,v),mW(s,r,n)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}}else{const o=e.attributes.position;for(let g=0,a=o.count/3;g<a;g++)for(let l=0;l<3;l++){const c=3*g+l,C=3*g+(l+1)%3;s.fromBufferAttribute(o,c),r.fromBufferAttribute(o,C),mW(s,r,n)===!0&&(t.push(s.x,s.y,s.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new pt(t,3))}}}function mW(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(s)===!0?!1:(t.add(n),t.add(s),!0)}var bW=Object.freeze({__proto__:null,BoxGeometry:hl,CapsuleGeometry:Op,CircleGeometry:Qp,ConeGeometry:jp,CylinderGeometry:Wu,DodecahedronGeometry:qp,EdgesGeometry:kV,ExtrudeGeometry:$p,IcosahedronGeometry:$d,LatheGeometry:qd,OctahedronGeometry:eh,PlaneGeometry:Pd,PolyhedronGeometry:Al,RingGeometry:ef,ShapeGeometry:tf,SphereGeometry:th,TetrahedronGeometry:nf,TorusGeometry:sf,TorusKnotGeometry:rf,TubeGeometry:of,WireframeGeometry:JV});class UV extends qn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new et(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class PV extends Xg{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class jo extends qn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new et(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zc,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class vs extends jo{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Fe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Vi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new et(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new et(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new et(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class OV extends qn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new et(16777215),this.specular=new et(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zc,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_p,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class QV extends qn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new et(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zc,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class jV extends qn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zc,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class qV extends qn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new et(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new et(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zc,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_p,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $V extends qn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new et(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=zc,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eH extends Bs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function zo(i,e,t){return wZ(i)?new i.constructor(i.subarray(e,t!==void 0?t:i.length)):i.slice(e,t)}function eu(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function wZ(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function tH(i){function e(s,r){return i[s]-i[r]}const t=i.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n}function Vv(i,e,t){const n=i.length,s=new i.constructor(n);for(let r=0,o=0;o!==n;++r){const g=t[r]*e;for(let a=0;a!==e;++a)s[o++]=i[g+a]}return s}function SZ(i,e,t,n){let s=1,r=i[0];for(;r!==void 0&&r[n]===void 0;)r=i[s++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=i[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=i[s++];while(r!==void 0);else do o=r[n],o!==void 0&&(e.push(r.time),t.push(o)),r=i[s++];while(r!==void 0)}function iU(i,e,t,n,s=30){const r=i.clone();r.name=e;const o=[];for(let a=0;a<r.tracks.length;++a){const l=r.tracks[a],c=l.getValueSize(),C=[],h=[];for(let p=0;p<l.times.length;++p){const m=l.times[p]*s;if(!(m<t||m>=n)){C.push(l.times[p]);for(let f=0;f<c;++f)h.push(l.values[p*c+f])}}C.length!==0&&(l.times=eu(C,l.times.constructor),l.values=eu(h,l.values.constructor),o.push(l))}r.tracks=o;let g=1/0;for(let a=0;a<r.tracks.length;++a)g>r.tracks[a].times[0]&&(g=r.tracks[a].times[0]);for(let a=0;a<r.tracks.length;++a)r.tracks[a].shift(-1*g);return r.resetDuration(),r}function sU(i,e=0,t=i,n=30){n<=0&&(n=30);const s=t.tracks.length,r=e/n;for(let o=0;o<s;++o){const g=t.tracks[o],a=g.ValueTypeName;if(a==="bool"||a==="string")continue;const l=i.tracks.find(function(y){return y.name===g.name&&y.ValueTypeName===a});if(l===void 0)continue;let c=0;const C=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=C/3);let h=0;const p=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=p/3);const m=g.times.length-1;let f;if(r<=g.times[0]){const y=c,v=C-c;f=zo(g.values,y,v)}else if(r>=g.times[m]){const y=m*C+c,v=y+C-c;f=zo(g.values,y,v)}else{const y=g.createInterpolant(),v=c,G=C-c;y.evaluate(r),f=zo(y.resultBuffer,v,G)}a==="quaternion"&&new jn().fromArray(f).normalize().conjugate().toArray(f);const b=l.times.length;for(let y=0;y<b;++y){const v=y*p+h;if(a==="quaternion")jn.multiplyQuaternionsFlat(l.values,v,f,0,l.values,v);else{const G=p-h*2;for(let w=0;w<G;++w)l.values[v+w]-=f[w]}}}return i.blendMode=gZ,i}var rU=Object.freeze({__proto__:null,arraySlice:zo,convertArray:eu,isTypedArray:wZ,getKeyframeOrder:tH,sortedArray:Vv,flattenJSON:SZ,subclip:iU,makeClipAdditive:sU});class xu{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,s=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<s)){for(let g=n+2;;){if(s===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===g)break;if(r=s,s=t[++n],e<s)break t}o=t.length;break n}if(!(e>=r)){const g=t[1];e<g&&(n=2,r=g);for(let a=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(s=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const g=n+o>>>1;e<t[g]?o=g:n=g+1}if(s=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,s)}return this.interpolate_(n,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class nH extends xu{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:jI,endingEnd:jI}}intervalChanged_(e,t,n){const s=this.parameterPositions;let r=e-2,o=e+1,g=s[r],a=s[o];if(g===void 0)switch(this.getSettings_().endingStart){case qI:r=e,g=2*t-n;break;case fp:r=s.length-2,g=t+s[r]-s[r+1];break;default:r=e,g=n}if(a===void 0)switch(this.getSettings_().endingEnd){case qI:o=e,a=2*n-t;break;case fp:o=1,a=n+s[1]-s[0];break;default:o=e-1,a=t}const l=(n-t)*.5,c=this.valueSize;this._weightPrev=l/(t-g),this._weightNext=l/(a-n),this._offsetPrev=r*c,this._offsetNext=o*c}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,g=this.valueSize,a=e*g,l=a-g,c=this._offsetPrev,C=this._offsetNext,h=this._weightPrev,p=this._weightNext,m=(n-t)/(s-t),f=m*m,b=f*m,y=-h*b+2*h*f-h*m,v=(1+h)*b+(-1.5-2*h)*f+(-.5+h)*m+1,G=(-1-p)*b+(1.5+p)*f+.5*m,w=p*b-p*f;for(let W=0;W!==g;++W)r[W]=y*o[c+W]+v*o[l+W]+G*o[a+W]+w*o[C+W];return r}}class RZ extends xu{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,g=this.valueSize,a=e*g,l=a-g,c=(n-t)/(s-t),C=1-c;for(let h=0;h!==g;++h)r[h]=o[l+h]*C+o[a+h]*c;return r}}class iH extends xu{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ng{constructor(e,t,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=eu(t,this.TimeBufferType),this.values=eu(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:eu(e.times,Array),values:eu(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new iH(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new RZ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new nH(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Gu:t=this.InterpolantFactoryMethodDiscrete;break;case gl:t=this.InterpolantFactoryMethodLinear;break;case j0:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Gu;case this.InterpolantFactoryMethodLinear:return gl;case this.InterpolantFactoryMethodSmooth:return j0}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const n=this.times,s=n.length;let r=0,o=s-1;for(;r!==s&&n[r]<e;)++r;for(;o!==-1&&n[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const g=this.getValueSize();this.times=zo(n,r,o),this.values=zo(this.values,r*g,o*g)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let g=0;g!==r;g++){const a=n[g];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,a),e=!1;break}if(o!==null&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,a,o),e=!1;break}o=a}if(s!==void 0&&wZ(s))for(let g=0,a=s.length;g!==a;++g){const l=s[g];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,l),e=!1;break}}return e}optimize(){const e=zo(this.times),t=zo(this.values),n=this.getValueSize(),s=this.getInterpolation()===j0,r=e.length-1;let o=1;for(let g=1;g<r;++g){let a=!1;const l=e[g],c=e[g+1];if(l!==c&&(g!==1||l!==e[0]))if(s)a=!0;else{const C=g*n,h=C-n,p=C+n;for(let m=0;m!==n;++m){const f=t[C+m];if(f!==t[h+m]||f!==t[p+m]){a=!0;break}}}if(a){if(g!==o){e[o]=e[g];const C=g*n,h=o*n;for(let p=0;p!==n;++p)t[h+p]=t[C+p]}++o}}if(r>0){e[o]=e[r];for(let g=r*n,a=o*n,l=0;l!==n;++l)t[a+l]=t[g+l];++o}return o!==e.length?(this.times=zo(e,0,o),this.values=zo(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=zo(this.times,0),t=zo(this.values,0),n=this.constructor,s=new n(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Ng.prototype.TimeBufferType=Float32Array;Ng.prototype.ValueBufferType=Float32Array;Ng.prototype.DefaultInterpolation=gl;class Vu extends Ng{}Vu.prototype.ValueTypeName="bool";Vu.prototype.ValueBufferType=Array;Vu.prototype.DefaultInterpolation=Gu;Vu.prototype.InterpolantFactoryMethodLinear=void 0;Vu.prototype.InterpolantFactoryMethodSmooth=void 0;class WZ extends Ng{}WZ.prototype.ValueTypeName="color";class Bu extends Ng{}Bu.prototype.ValueTypeName="number";class sH extends xu{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,g=this.valueSize,a=(n-t)/(s-t);let l=e*g;for(let c=l+g;l!==c;l+=4)jn.slerpFlat(r,0,o,l-g,o,l,a);return r}}class Yg extends Ng{InterpolantFactoryMethodLinear(e){return new sH(this.times,this.values,this.getValueSize(),e)}}Yg.prototype.ValueTypeName="quaternion";Yg.prototype.DefaultInterpolation=gl;Yg.prototype.InterpolantFactoryMethodSmooth=void 0;class Hu extends Ng{}Hu.prototype.ValueTypeName="string";Hu.prototype.ValueBufferType=Array;Hu.prototype.DefaultInterpolation=Gu;Hu.prototype.InterpolantFactoryMethodLinear=void 0;Hu.prototype.InterpolantFactoryMethodSmooth=void 0;class Hc extends Ng{}Hc.prototype.ValueTypeName="vector";class Xc{constructor(e,t=-1,n,s=cG){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=lo(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,s=1/(e.fps||1);for(let o=0,g=n.length;o!==g;++o)t.push(gU(n[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(Ng.toJSON(n[r]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const r=t.length,o=[];for(let g=0;g<r;g++){let a=[],l=[];a.push((g+r-1)%r,g,(g+1)%r),l.push(0,1,0);const c=tH(a);a=Vv(a,1,c),l=Vv(l,1,c),!s&&a[0]===0&&(a.push(r),l.push(l[0])),o.push(new Bu(".morphTargetInfluences["+t[g].name+"]",a,l).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},r=/^([\w-]*?)([\d]+)$/;for(let g=0,a=e.length;g<a;g++){const l=e[g],c=l.name.match(r);if(c&&c.length>1){const C=c[1];let h=s[C];h||(s[C]=h=[]),h.push(l)}}const o=[];for(const g in s)o.push(this.CreateFromMorphTargetSequence(g,s[g],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(C,h,p,m,f){if(p.length!==0){const b=[],y=[];SZ(p,b,y,m),b.length!==0&&f.push(new C(h,b,y))}},s=[],r=e.name||"default",o=e.fps||30,g=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let C=0;C<l.length;C++){const h=l[C].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const p={};let m;for(m=0;m<h.length;m++)if(h[m].morphTargets)for(let f=0;f<h[m].morphTargets.length;f++)p[h[m].morphTargets[f]]=-1;for(const f in p){const b=[],y=[];for(let v=0;v!==h[m].morphTargets.length;++v){const G=h[m];b.push(G.time),y.push(G.morphTarget===f?1:0)}s.push(new Bu(".morphTargetInfluence["+f+"]",b,y))}a=p.length*o}else{const p=".bones["+t[C].name+"]";n(Hc,p+".position",h,"pos",s),n(Yg,p+".quaternion",h,"rot",s),n(Hc,p+".scale",h,"scl",s)}}return s.length===0?null:new this(r,a,s,g)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,s=e.length;n!==s;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function oU(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Bu;case"vector":case"vector2":case"vector3":case"vector4":return Hc;case"color":return WZ;case"quaternion":return Yg;case"bool":case"boolean":return Vu;case"string":return Hu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function gU(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=oU(i.type);if(i.times===void 0){const t=[],n=[];SZ(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const vu={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class xZ{constructor(e,t,n){const s=this;let r=!1,o=0,g=0,a;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(c){g++,r===!1&&s.onStart!==void 0&&s.onStart(c,o,g),r=!0},this.itemEnd=function(c){o++,s.onProgress!==void 0&&s.onProgress(c,o,g),o===g&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(c){s.onError!==void 0&&s.onError(c)},this.resolveURL=function(c){return a?a(c):c},this.setURLModifier=function(c){return a=c,this},this.addHandler=function(c,C){return l.push(c,C),this},this.removeHandler=function(c){const C=l.indexOf(c);return C!==-1&&l.splice(C,2),this},this.getHandler=function(c){for(let C=0,h=l.length;C<h;C+=2){const p=l[C],m=l[C+1];if(p.global&&(p.lastIndex=0),p.test(c))return m}return null}}}const rd=new xZ;class Zs{constructor(e){this.manager=e!==void 0?e:rd,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,r){n.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const za={};class aU extends Error{constructor(e,t){super(e),this.response=t}}class ys extends Zs{constructor(e){super(e)}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=vu.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(za[e]!==void 0){za[e].push({onLoad:t,onProgress:n,onError:s});return}za[e]=[],za[e].push({onLoad:t,onProgress:n,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),g=this.mimeType,a=this.responseType;fetch(o).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const c=za[e],C=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),p=h?parseInt(h):0,m=p!==0;let f=0;const b=new ReadableStream({start(y){v();function v(){C.read().then(({done:G,value:w})=>{if(G)y.close();else{f+=w.byteLength;const W=new ProgressEvent("progress",{lengthComputable:m,loaded:f,total:p});for(let V=0,X=c.length;V<X;V++){const R=c[V];R.onProgress&&R.onProgress(W)}y.enqueue(w),v()}})}}});return new Response(b)}else throw new aU(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(a){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,g));case"json":return l.json();default:if(g===void 0)return l.text();{const C=/charset="?([^;"\s]*)"?/i.exec(g),h=C&&C[1]?C[1].toLowerCase():void 0,p=new TextDecoder(h);return l.arrayBuffer().then(m=>p.decode(m))}}}).then(l=>{vu.add(e,l);const c=za[e];delete za[e];for(let C=0,h=c.length;C<h;C++){const p=c[C];p.onLoad&&p.onLoad(l)}}).catch(l=>{const c=za[e];if(c===void 0)throw this.manager.itemError(e),l;delete za[e];for(let C=0,h=c.length;C<h;C++){const p=c[C];p.onError&&p.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class lU extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=this,o=new ys(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(g){try{t(r.parse(JSON.parse(g)))}catch(a){s?s(a):console.error(a),r.manager.itemError(e)}},n,s)}parse(e){const t=[];for(let n=0;n<e.length;n++){const s=Xc.parse(e[n]);t.push(s)}return t}}class cU extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=this,o=[],g=new mZ,a=new ys(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let l=0;function c(C){a.load(e[C],function(h){const p=r.parse(h,!0);o[C]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},l+=1,l===6&&(p.mipmapCount===1&&(g.minFilter=Zn),g.image=o,g.format=p.format,g.needsUpdate=!0,t&&t(g))},n,s)}if(Array.isArray(e))for(let C=0,h=e.length;C<h;++C)c(C);else a.load(e,function(C){const h=r.parse(C,!0);if(h.isCubemap){const p=h.mipmaps.length/h.mipmapCount;for(let m=0;m<p;m++){o[m]={mipmaps:[]};for(let f=0;f<h.mipmapCount;f++)o[m].mipmaps.push(h.mipmaps[m*h.mipmapCount+f]),o[m].format=h.format,o[m].width=h.width,o[m].height=h.height}g.image=o}else g.image.width=h.width,g.image.height=h.height,g.mipmaps=h.mipmaps;h.mipmapCount===1&&(g.minFilter=Zn),g.format=h.format,g.needsUpdate=!0,t&&t(g)},n,s);return g}}class Sp extends Zs{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=vu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const g=Gp("img");function a(){c(),vu.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(C){c(),s&&s(C),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){g.removeEventListener("load",a,!1),g.removeEventListener("error",l,!1)}return g.addEventListener("load",a,!1),g.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(g.crossOrigin=this.crossOrigin),r.manager.itemStart(e),g.src=e,g}}class rH extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=new Jp,o=new Sp(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let g=0;function a(l){o.load(e[l],function(c){r.images[l]=c,g++,g===6&&(r.needsUpdate=!0,t&&t(r))},void 0,s)}for(let l=0;l<e.length;++l)a(l);return r}}class oH extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=this,o=new hd,g=new ys(this.manager);return g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setPath(this.path),g.setWithCredentials(r.withCredentials),g.load(e,function(a){const l=r.parse(a);l&&(l.image!==void 0?o.image=l.image:l.data!==void 0&&(o.image.width=l.width,o.image.height=l.height,o.image.data=l.data),o.wrapS=l.wrapS!==void 0?l.wrapS:cs,o.wrapT=l.wrapT!==void 0?l.wrapT:cs,o.magFilter=l.magFilter!==void 0?l.magFilter:Zn,o.minFilter=l.minFilter!==void 0?l.minFilter:Zn,o.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.encoding!==void 0&&(o.encoding=l.encoding),l.flipY!==void 0&&(o.flipY=l.flipY),l.format!==void 0&&(o.format=l.format),l.type!==void 0&&(o.type=l.type),l.mipmaps!==void 0&&(o.mipmaps=l.mipmaps,o.minFilter=eg),l.mipmapCount===1&&(o.minFilter=Zn),l.generateMipmaps!==void 0&&(o.generateMipmaps=l.generateMipmaps),o.needsUpdate=!0,t&&t(o,l))},n,s),o}}class VZ extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=new kn,o=new Sp(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(g){r.image=g,r.needsUpdate=!0,t!==void 0&&t(r)},n,s),r}}class _c extends en{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new et(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class gH extends _c{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(en.DefaultUp),this.updateMatrix(),this.groundColor=new et(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const yB=new mt,GW=new E,yW=new E;class HZ{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Fe(512,512),this.map=null,this.mapPass=null,this.matrix=new mt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new CG,this._frameExtents=new Fe(1,1),this._viewportCount=1,this._viewports=[new wn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;GW.setFromMatrixPosition(e.matrixWorld),t.position.copy(GW),yW.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(yW),t.updateMatrixWorld(),yB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yB),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(yB)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class IU extends HZ{constructor(){super(new Dn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=bp*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class BG extends _c{constructor(e,t,n=0,s=Math.PI/3,r=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(en.DefaultUp),this.updateMatrix(),this.target=new en,this.distance=n,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new IU}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const BW=new mt,hA=new E,BB=new E;class uU extends HZ{constructor(){super(new Dn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Fe(4,2),this._viewportCount=6,this._viewports=[new wn(2,1,1,1),new wn(0,1,1,1),new wn(3,1,1,1),new wn(1,1,1,1),new wn(3,0,1,1),new wn(1,0,1,1)],this._cubeDirections=[new E(1,0,0),new E(-1,0,0),new E(0,0,1),new E(0,0,-1),new E(0,1,0),new E(0,-1,0)],this._cubeUps=[new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,1,0),new E(0,0,1),new E(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,s=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),hA.setFromMatrixPosition(e.matrixWorld),n.position.copy(hA),BB.copy(n.position),BB.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(BB),n.updateMatrixWorld(),s.makeTranslation(-hA.x,-hA.y,-hA.z),BW.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(BW)}}class vG extends _c{constructor(e,t,n=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new uU}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class CU extends HZ{constructor(){super(new co(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ZG extends _c{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(en.DefaultUp),this.updateMatrix(),this.target=new en,this.shadow=new CU}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class aH extends _c{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class lH extends _c{constructor(e,t,n=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class cH{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new E)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*r),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*s)),t.addScaledVector(o[5],1.092548*(s*r)),t.addScaledVector(o[6],.315392*(3*r*r-1)),t.addScaledVector(o[7],1.092548*(n*r)),t.addScaledVector(o[8],.546274*(n*n-s*s)),t}getIrradianceAt(e,t){const n=e.x,s=e.y,r=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*s),t.addScaledVector(o[2],2*.511664*r),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*s),t.addScaledVector(o[5],2*.429043*s*r),t.addScaledVector(o[6],.743125*r*r-.247708),t.addScaledVector(o[7],2*.429043*n*r),t.addScaledVector(o[8],.429043*(n*n-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const n=e.x,s=e.y,r=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-s*s)}}class wG extends _c{constructor(e=new cH,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class SG extends Zs{constructor(e){super(e),this.textures={}}load(e,t,n,s){const r=this,o=new ys(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(g){try{t(r.parse(JSON.parse(g)))}catch(a){s?s(a):console.error(a),r.manager.itemError(e)}},n,s)}parse(e){const t=this.textures;function n(r){return t[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),t[r]}const s=SG.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new et().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==1&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const r in e.uniforms){const o=e.uniforms[r];switch(s.uniforms[r]={},o.type){case"t":s.uniforms[r].value=n(o.value);break;case"c":s.uniforms[r].value=new et().setHex(o.value);break;case"v2":s.uniforms[r].value=new Fe().fromArray(o.value);break;case"v3":s.uniforms[r].value=new E().fromArray(o.value);break;case"v4":s.uniforms[r].value=new wn().fromArray(o.value);break;case"m3":s.uniforms[r].value=new rr().fromArray(o.value);break;case"m4":s.uniforms[r].value=new mt().fromArray(o.value);break;default:s.uniforms[r].value=o.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const r in e.extensions)s.extensions[r]=e.extensions[r];if(e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=n(e.map)),e.matcap!==void 0&&(s.matcap=n(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),s.normalScale=new Fe().fromArray(r)}return e.displacementMap!==void 0&&(s.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new Fe().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=n(e.thicknessMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=n(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:UV,SpriteMaterial:fZ,RawShaderMaterial:PV,ShaderMaterial:Xg,PointsMaterial:Pp,MeshPhysicalMaterial:vs,MeshStandardMaterial:jo,MeshPhongMaterial:OV,MeshToonMaterial:QV,MeshNormalMaterial:jV,MeshLambertMaterial:qV,MeshDepthMaterial:hZ,MeshDistanceMaterial:AZ,MeshBasicMaterial:Oi,MeshMatcapMaterial:$V,LineDashedMaterial:eH,LineBasicMaterial:Bs,Material:qn};return new t[e]}}class bs{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,s=e.length;n<s;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class IH extends zt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class uH extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=this,o=new ys(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(e,function(g){try{t(r.parse(JSON.parse(g)))}catch(a){s?s(a):console.error(a),r.manager.itemError(e)}},n,s)}parse(e){const t={},n={};function s(p,m){if(t[m]!==void 0)return t[m];const b=p.interleavedBuffers[m],y=r(p,b.buffer),v=nd(b.type,y),G=new Qd(v,b.stride);return G.uuid=b.uuid,t[m]=G,G}function r(p,m){if(n[m]!==void 0)return n[m];const b=p.arrayBuffers[m],y=new Uint32Array(b).buffer;return n[m]=y,y}const o=e.isInstancedBufferGeometry?new IH:new zt,g=e.data.index;if(g!==void 0){const p=nd(g.type,g.array);o.setIndex(new on(p,1))}const a=e.data.attributes;for(const p in a){const m=a[p];let f;if(m.isInterleavedBufferAttribute){const b=s(e.data,m.data);f=new ll(b,m.itemSize,m.offset,m.normalized)}else{const b=nd(m.type,m.array),y=m.isInstancedBufferAttribute?Fd:on;f=new y(b,m.itemSize,m.normalized)}m.name!==void 0&&(f.name=m.name),m.usage!==void 0&&f.setUsage(m.usage),m.updateRange!==void 0&&(f.updateRange.offset=m.updateRange.offset,f.updateRange.count=m.updateRange.count),o.setAttribute(p,f)}const l=e.data.morphAttributes;if(l)for(const p in l){const m=l[p],f=[];for(let b=0,y=m.length;b<y;b++){const v=m[b];let G;if(v.isInterleavedBufferAttribute){const w=s(e.data,v.data);G=new ll(w,v.itemSize,v.offset,v.normalized)}else{const w=nd(v.type,v.array);G=new on(w,v.itemSize,v.normalized)}v.name!==void 0&&(G.name=v.name),f.push(G)}o.morphAttributes[p]=f}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const C=e.data.groups||e.data.drawcalls||e.data.offsets;if(C!==void 0)for(let p=0,m=C.length;p!==m;++p){const f=C[p];o.addGroup(f.start,f.count,f.materialIndex)}const h=e.data.boundingSphere;if(h!==void 0){const p=new E;h.center!==void 0&&p.fromArray(h.center),o.boundingSphere=new dl(p,h.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class dU extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=this,o=this.path===""?bs.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const g=new ys(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function(a){let l=null;try{l=JSON.parse(a)}catch(C){s!==void 0&&s(C),console.error("THREE:ObjectLoader: Can't parse "+e+".",C.message);return}const c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}r.parse(l,t)},n,s)}async loadAsync(e,t){const n=this,s=this.path===""?bs.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const r=new ys(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t),g=JSON.parse(o),a=g.metadata;if(a===void 0||a.type===void 0||a.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(g)}parse(e,t){const n=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,s),o=this.parseImages(e.images,function(){t!==void 0&&t(l)}),g=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,g),l=this.parseObject(e.object,r,a,g,n),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),t!==void 0){let C=!1;for(const h in o)if(o[h].data instanceof HTMLImageElement){C=!0;break}C===!1&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,r),g=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,s,g,o,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(e!==void 0)for(let n=0,s=e.length;n<s;n++){const r=new cu().fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},s={};if(t.traverse(function(r){r.isBone&&(s[r.uuid]=r)}),e!==void 0)for(let r=0,o=e.length;r<o;r++){const g=new jd().fromJSON(e[r],s);n[g.uuid]=g}return n}parseGeometries(e,t){const n={};if(e!==void 0){const s=new uH;for(let r=0,o=e.length;r<o;r++){let g;const a=e[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":g=s.parse(a);break;default:a.type in bW?g=bW[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}g.uuid=a.uuid,a.name!==void 0&&(g.name=a.name),g.isBufferGeometry===!0&&a.userData!==void 0&&(g.userData=a.userData),n[a.uuid]=g}}return n}parseMaterials(e,t){const n={},s={};if(e!==void 0){const r=new SG;r.setTextures(t);for(let o=0,g=e.length;o<g;o++){const a=e[o];n[a.uuid]===void 0&&(n[a.uuid]=r.parse(a)),s[a.uuid]=n[a.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const s=e[n],r=Xc.parse(s);t[r.uuid]=r}return t}parseImages(e,t){const n=this,s={};let r;function o(a){return n.manager.itemStart(a),r.load(a,function(){n.manager.itemEnd(a)},void 0,function(){n.manager.itemError(a),n.manager.itemEnd(a)})}function g(a){if(typeof a=="string"){const l=a,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:n.resourcePath+l;return o(c)}else return a.data?{data:nd(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){const a=new xZ(t);r=new Sp(a),r.setCrossOrigin(this.crossOrigin);for(let l=0,c=e.length;l<c;l++){const C=e[l],h=C.url;if(Array.isArray(h)){const p=[];for(let m=0,f=h.length;m<f;m++){const b=h[m],y=g(b);y!==null&&(y instanceof HTMLImageElement?p.push(y):p.push(new hd(y.data,y.width,y.height)))}s[C.uuid]=new $I(p)}else{const p=g(C.url);s[C.uuid]=new $I(p)}}}return s}async parseImagesAsync(e){const t=this,n={};let s;async function r(o){if(typeof o=="string"){const g=o,a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:t.resourcePath+g;return await s.loadAsync(a)}else return o.data?{data:nd(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){s=new Sp(this.manager),s.setCrossOrigin(this.crossOrigin);for(let o=0,g=e.length;o<g;o++){const a=e[o],l=a.url;if(Array.isArray(l)){const c=[];for(let C=0,h=l.length;C<h;C++){const p=l[C],m=await r(p);m!==null&&(m instanceof HTMLImageElement?c.push(m):c.push(new hd(m.data,m.width,m.height)))}n[a.uuid]=new $I(c)}else{const c=await r(a.url);n[a.uuid]=new $I(c)}}}return n}parseTextures(e,t){function n(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const s={};if(e!==void 0)for(let r=0,o=e.length;r<o;r++){const g=e[r];g.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid),t[g.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",g.image);const a=t[g.image],l=a.data;let c;Array.isArray(l)?(c=new Jp,l.length===6&&(c.needsUpdate=!0)):(l&&l.data?c=new hd:c=new kn,l&&(c.needsUpdate=!0)),c.source=a,c.uuid=g.uuid,g.name!==void 0&&(c.name=g.name),g.mapping!==void 0&&(c.mapping=n(g.mapping,hU)),g.offset!==void 0&&c.offset.fromArray(g.offset),g.repeat!==void 0&&c.repeat.fromArray(g.repeat),g.center!==void 0&&c.center.fromArray(g.center),g.rotation!==void 0&&(c.rotation=g.rotation),g.wrap!==void 0&&(c.wrapS=n(g.wrap[0],vW),c.wrapT=n(g.wrap[1],vW)),g.format!==void 0&&(c.format=g.format),g.type!==void 0&&(c.type=g.type),g.encoding!==void 0&&(c.encoding=g.encoding),g.minFilter!==void 0&&(c.minFilter=n(g.minFilter,ZW)),g.magFilter!==void 0&&(c.magFilter=n(g.magFilter,ZW)),g.anisotropy!==void 0&&(c.anisotropy=g.anisotropy),g.flipY!==void 0&&(c.flipY=g.flipY),g.generateMipmaps!==void 0&&(c.generateMipmaps=g.generateMipmaps),g.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=g.premultiplyAlpha),g.unpackAlignment!==void 0&&(c.unpackAlignment=g.unpackAlignment),g.userData!==void 0&&(c.userData=g.userData),s[g.uuid]=c}return s}parseObject(e,t,n,s,r){let o;function g(h){return t[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",h),t[h]}function a(h){if(h!==void 0){if(Array.isArray(h)){const p=[];for(let m=0,f=h.length;m<f;m++){const b=h[m];n[b]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",b),p.push(n[b])}return p}return n[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",h),n[h]}}function l(h){return s[h]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",h),s[h]}let c,C;switch(e.type){case"Scene":o=new yp,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new et(e.background):o.background=l(e.background)),e.environment!==void 0&&(o.environment=l(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new AG(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new hG(e.fog.color,e.fog.density))),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness);break;case"PerspectiveCamera":o=new Dn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new co(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new aH(e.color,e.intensity);break;case"DirectionalLight":o=new ZG(e.color,e.intensity);break;case"PointLight":o=new vG(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new lH(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new BG(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new gH(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=new wG().fromJSON(e);break;case"SkinnedMesh":c=g(e.geometry),C=a(e.material),o=new pG(c,C),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":c=g(e.geometry),C=a(e.material),o=new mi(c,C);break;case"InstancedMesh":c=g(e.geometry),C=a(e.material);const h=e.count,p=e.instanceMatrix,m=e.instanceColor;o=new wc(c,C,h),o.instanceMatrix=new Fd(new Float32Array(p.array),16),m!==void 0&&(o.instanceColor=new Fd(new Float32Array(m.array),m.itemSize));break;case"LOD":o=new NV;break;case"Line":o=new Ca(g(e.geometry),a(e.material));break;case"LineLoop":o=new fG(g(e.geometry),a(e.material));break;case"LineSegments":o=new ng(g(e.geometry),a(e.material));break;case"PointCloud":case"Points":o=new mG(g(e.geometry),a(e.material));break;case"Sprite":o=new FV(a(e.material));break;case"Group":o=new oo;break;case"Bone":o=new Up;break;default:o=new en}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const h=e.children;for(let p=0;p<h.length;p++)o.add(this.parseObject(h[p],t,n,s,r))}if(e.animations!==void 0){const h=e.animations;for(let p=0;p<h.length;p++){const m=h[p];o.animations.push(r[m])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const h=e.levels;for(let p=0;p<h.length;p++){const m=h[p],f=o.getObjectByProperty("uuid",m.object);f!==void 0&&o.addLevel(f,m.distance,m.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const s=t[n.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(s,n.bindMatrix)}})}}const hU={UVMapping:lG,CubeReflectionMapping:rl,CubeRefractionMapping:Vc,EquirectangularReflectionMapping:xd,EquirectangularRefractionMapping:pp,CubeUVReflectionMapping:Ud},vW={RepeatWrapping:Hg,ClampToEdgeWrapping:cs,MirroredRepeatWrapping:mu},ZW={NearestFilter:oi,NearestMipmapNearestFilter:Vd,NearestMipmapLinearFilter:ru,LinearFilter:Zn,LinearMipmapNearestFilter:kp,LinearMipmapLinearFilter:eg};class XZ extends Zs{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=vu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const g={};g.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",g.headers=this.requestHeader,fetch(e,g).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(a){vu.add(e,a),t&&t(a),r.manager.itemEnd(e)}).catch(function(a){s&&s(a),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}let h0;class YZ{static getContext(){return h0===void 0&&(h0=new(window.AudioContext||window.webkitAudioContext)),h0}static setContext(e){h0=e}}class AU extends Zs{constructor(e){super(e)}load(e,t,n,s){const r=this,o=new ys(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(g){try{const a=g.slice(0);YZ.getContext().decodeAudioData(a,function(c){t(c)})}catch(a){s?s(a):console.error(a),r.manager.itemError(e)}},n,s)}}class pU extends wG{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const s=new et().set(e),r=new et().set(t),o=new E(s.r,s.g,s.b),g=new E(r.r,r.g,r.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(g).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(g).multiplyScalar(l)}}class fU extends wG{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=new et().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const wW=new mt,SW=new mt,WI=new mt;class mU{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Dn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Dn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,WI.copy(e.projectionMatrix);const s=t.eyeSep/2,r=s*t.near/t.focus,o=t.near*Math.tan(gu*t.fov*.5)/t.zoom;let g,a;SW.elements[12]=-s,wW.elements[12]=s,g=-o*t.aspect+r,a=o*t.aspect+r,WI.elements[0]=2*t.near/(a-g),WI.elements[8]=(a+g)/(a-g),this.cameraL.projectionMatrix.copy(WI),g=-o*t.aspect-r,a=o*t.aspect-r,WI.elements[0]=2*t.near/(a-g),WI.elements[8]=(a+g)/(a-g),this.cameraR.projectionMatrix.copy(WI)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(SW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(wW)}}class FZ{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=RW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=RW();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function RW(){return(typeof performance>"u"?Date:performance).now()}const xI=new E,WW=new jn,bU=new E,VI=new E;class GU extends en{constructor(){super(),this.type="AudioListener",this.context=YZ.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new FZ}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(xI,WW,bU),VI.set(0,0,-1).applyQuaternion(WW),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(xI.x,s),t.positionY.linearRampToValueAtTime(xI.y,s),t.positionZ.linearRampToValueAtTime(xI.z,s),t.forwardX.linearRampToValueAtTime(VI.x,s),t.forwardY.linearRampToValueAtTime(VI.y,s),t.forwardZ.linearRampToValueAtTime(VI.z,s),t.upX.linearRampToValueAtTime(n.x,s),t.upY.linearRampToValueAtTime(n.y,s),t.upZ.linearRampToValueAtTime(n.z,s)}else t.setPosition(xI.x,xI.y,xI.z),t.setOrientation(VI.x,VI.y,VI.z,n.x,n.y,n.z)}}let CH=class extends en{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};const HI=new E,xW=new jn,yU=new E,XI=new E;class BU extends CH{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(HI,xW,yU),XI.set(0,0,1).applyQuaternion(xW);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(HI.x,n),t.positionY.linearRampToValueAtTime(HI.y,n),t.positionZ.linearRampToValueAtTime(HI.z,n),t.orientationX.linearRampToValueAtTime(XI.x,n),t.orientationY.linearRampToValueAtTime(XI.y,n),t.orientationZ.linearRampToValueAtTime(XI.z,n)}else t.setPosition(HI.x,HI.y,HI.z),t.setOrientation(XI.x,XI.y,XI.z)}}class vU{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class dH{constructor(e,t,n){this.binding=e,this.valueSize=n;let s,r,o;switch(t){case"quaternion":s=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":s=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:s=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,s=this.valueSize,r=e*s+s;let o=this.cumulativeWeight;if(o===0){for(let g=0;g!==s;++g)n[r+g]=n[g];o=t}else{o+=t;const g=t/o;this._mixBufferRegion(n,r,0,g,s)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,s=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,s=e*t+t,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,g=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const a=t*this._origIndex;this._mixBufferRegion(n,s,a,1-r,t)}o>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){g.setValue(n,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,s=n*this._origIndex;e.getValue(t,s);for(let r=n,o=s;r!==o;++r)t[r]=t[s+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,s,r){if(s>=.5)for(let o=0;o!==r;++o)e[t+o]=e[n+o]}_slerp(e,t,n,s){jn.slerpFlat(e,t,e,t,e,n,s)}_slerpAdditive(e,t,n,s,r){const o=this._workIndex*r;jn.multiplyQuaternionsFlat(e,o,e,t,e,n),jn.slerpFlat(e,t,e,t,e,o,s)}_lerp(e,t,n,s,r){const o=1-s;for(let g=0;g!==r;++g){const a=t+g;e[a]=e[a]*o+e[n+g]*s}}_lerpAdditive(e,t,n,s,r){for(let o=0;o!==r;++o){const g=t+o;e[g]=e[g]+e[n+o]*s}}}const NZ="\\[\\]\\.:\\/",ZU=new RegExp("["+NZ+"]","g"),MZ="[^"+NZ+"]",wU="[^"+NZ.replace("\\.","")+"]",SU=/((?:WC+[\/:])*)/.source.replace("WC",MZ),RU=/(WCOD+)?/.source.replace("WCOD",wU),WU=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",MZ),xU=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",MZ),VU=new RegExp("^"+SU+RU+WU+xU+"$"),HU=["material","materials","bones","map"];class XU{constructor(e,t,n){const s=n||un.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=n.length;s!==r;++s)n[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class un{constructor(e,t,n){this.path=t,this.parsedPath=n||un.parseTrackName(t),this.node=un.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new un.Composite(e,t,n):new un(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(ZU,"")}static parseTrackName(e){const t=VU.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=n.nodeName.substring(s+1);HU.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(r){for(let o=0;o<r.length;o++){const g=r[o];if(g.name===t||g.uuid===t)return g;const a=n(g.children);if(a)return a}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=un.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let l=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}const o=e[s];if(o===void 0){const l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+s+" but it wasn't found.",e);return}let g=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?g=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(g=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][g]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}un.Composite=XU;un.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};un.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};un.prototype.GetterByBindingType=[un.prototype._getValue_direct,un.prototype._getValue_array,un.prototype._getValue_arrayElement,un.prototype._getValue_toArray];un.prototype.SetterByBindingTypeAndVersioning=[[un.prototype._setValue_direct,un.prototype._setValue_direct_setNeedsUpdate,un.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[un.prototype._setValue_array,un.prototype._setValue_array_setNeedsUpdate,un.prototype._setValue_array_setMatrixWorldNeedsUpdate],[un.prototype._setValue_arrayElement,un.prototype._setValue_arrayElement_setNeedsUpdate,un.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[un.prototype._setValue_fromArray,un.prototype._setValue_fromArray_setNeedsUpdate,un.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class YU{constructor(){this.isAnimationObjectGroup=!0,this.uuid=lo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,s=arguments.length;n!==s;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,s=this._parsedPaths,r=this._bindings,o=r.length;let g,a=e.length,l=this.nCachedObjects_;for(let c=0,C=arguments.length;c!==C;++c){const h=arguments[c],p=h.uuid;let m=t[p];if(m===void 0){m=a++,t[p]=m,e.push(h);for(let f=0,b=o;f!==b;++f)r[f].push(new un(h,n[f],s[f]))}else if(m<l){g=e[m];const f=--l,b=e[f];t[b.uuid]=m,e[m]=b,t[p]=f,e[f]=h;for(let y=0,v=o;y!==v;++y){const G=r[y],w=G[f];let W=G[m];G[m]=w,W===void 0&&(W=new un(h,n[y],s[y])),G[f]=W}}else e[m]!==g&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let r=this.nCachedObjects_;for(let o=0,g=arguments.length;o!==g;++o){const a=arguments[o],l=a.uuid,c=t[l];if(c!==void 0&&c>=r){const C=r++,h=e[C];t[h.uuid]=c,e[c]=h,t[l]=C,e[C]=a;for(let p=0,m=s;p!==m;++p){const f=n[p],b=f[C],y=f[c];f[c]=b,f[C]=y}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let r=this.nCachedObjects_,o=e.length;for(let g=0,a=arguments.length;g!==a;++g){const l=arguments[g],c=l.uuid,C=t[c];if(C!==void 0)if(delete t[c],C<r){const h=--r,p=e[h],m=--o,f=e[m];t[p.uuid]=C,e[C]=p,t[f.uuid]=h,e[h]=f,e.pop();for(let b=0,y=s;b!==y;++b){const v=n[b],G=v[h],w=v[m];v[C]=G,v[h]=w,v.pop()}}else{const h=--o,p=e[h];h>0&&(t[p.uuid]=C),e[C]=p,e.pop();for(let m=0,f=s;m!==f;++m){const b=n[m];b[C]=b[h],b.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let s=n[e];const r=this._bindings;if(s!==void 0)return r[s];const o=this._paths,g=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,C=new Array(l);s=r.length,n[e]=s,o.push(e),g.push(t),r.push(C);for(let h=c,p=a.length;h!==p;++h){const m=a[h];C[h]=new un(m,e,t)}return C}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const s=this._paths,r=this._parsedPaths,o=this._bindings,g=o.length-1,a=o[g],l=e[g];t[l]=n,o[n]=a,o.pop(),r[n]=r[g],r.pop(),s[n]=s[g],s.pop()}}}class FU{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;const r=t.tracks,o=r.length,g=new Array(o),a={endingStart:jI,endingEnd:jI};for(let l=0;l!==o;++l){const c=r[l].createInterpolant(null);g[l]=c,c.settings=a}this._interpolantSettings=a,this._interpolants=g,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=uV,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const s=this._clip.duration,r=e._clip.duration,o=r/s,g=s/r;e.warp(1,o,t),this.warp(g,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const s=this._mixer,r=s.time,o=this.timeScale;let g=this._timeScaleInterpolant;g===null&&(g=s._lendControlInterpolant(),this._timeScaleInterpolant=g);const a=g.parameterPositions,l=g.sampleValues;return a[0]=r,a[1]=r+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled){this._updateWeight(e);return}const r=this._startTime;if(r!==null){const a=(e-r)*n;a<0||n===0?t=0:(this._startTime=null,t=n*a)}t*=this._updateTimeScale(e);const o=this._updateTime(t),g=this._updateWeight(e);if(g>0){const a=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case gZ:for(let c=0,C=a.length;c!==C;++c)a[c].evaluate(o),l[c].accumulateAdditive(g);break;case cG:default:for(let c=0,C=a.length;c!==C;++c)a[c].evaluate(o),l[c].accumulate(s,g)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let s=this.time+e,r=this._loopCount;const o=n===CV;if(e===0)return r===-1?s:o&&(r&1)===1?t-s:s;if(n===IV){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(r===-1&&(e>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){const g=Math.floor(s/t);s-=t*g,r+=Math.abs(g);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(a===1){const l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g})}}else this.time=s;if(o&&(r&1)===1)return t-s}return s}_setEndings(e,t,n){const s=this._interpolantSettings;n?(s.endingStart=qI,s.endingEnd=qI):(e?s.endingStart=this.zeroSlopeAtStart?qI:jI:s.endingStart=fp,t?s.endingEnd=this.zeroSlopeAtEnd?qI:jI:s.endingEnd=fp)}_scheduleFading(e,t,n){const s=this._mixer,r=s.time;let o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);const g=o.parameterPositions,a=o.sampleValues;return g[0]=r,a[0]=t,g[1]=r+e,a[1]=n,this}}const NU=new Float32Array(1);class hH extends ha{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,s=e._clip.tracks,r=s.length,o=e._propertyBindings,g=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let c=l[a];c===void 0&&(c={},l[a]=c);for(let C=0;C!==r;++C){const h=s[C],p=h.name;let m=c[p];if(m!==void 0)++m.referenceCount,o[C]=m;else{if(m=o[C],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,a,p));continue}const f=t&&t._propertyBindings[C].binding.parsedPath;m=new dH(un.create(n,p,f),h.ValueTypeName,h.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,a,p),o[C]=m}g[C].resultBuffer=m.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,s=e._clip.uuid,r=this._actionsByClip[s];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,s,n)}const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const s=this._actions,r=this._actionsByClip;let o=r[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o;else{const g=o.knownActions;e._byClipCacheIndex=g.length,g.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],s=e._cacheIndex;n._cacheIndex=s,t[s]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,o=this._actionsByClip,g=o[r],a=g.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;const C=g.actionByRoot,h=(e._localRoot||this._root).uuid;delete C[h],a.length===0&&delete o[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const r=t[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,s=this._nActiveActions++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,s=--this._nActiveActions,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const s=this._bindingsByRootAndName,r=this._bindings;let o=s[t];o===void 0&&(o={},s[t]=o),o[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,s=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,g=o[s],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete g[r],Object.keys(g).length===0&&delete o[s]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,s=this._nActiveBindings++,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,s=--this._nActiveBindings,r=t[s];e._cacheIndex=s,t[s]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new RZ(new Float32Array(2),new Float32Array(2),1,NU),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,s=--this._nActiveControlInterpolants,r=t[s];e.__cacheIndex=s,t[s]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const s=t||this._root,r=s.uuid;let o=typeof e=="string"?Xc.findByName(s,e):e;const g=o!==null?o.uuid:e,a=this._actionsByClip[g];let l=null;if(n===void 0&&(o!==null?n=o.blendMode:n=cG),a!==void 0){const C=a.actionByRoot[r];if(C!==void 0&&C.blendMode===n)return C;l=a.knownActions[0],o===null&&(o=l._clip)}if(o===null)return null;const c=new FU(this,o,t,n);return this._bindAction(c,l),this._addInactiveAction(c,g,r),c}existingAction(e,t){const n=t||this._root,s=n.uuid,r=typeof e=="string"?Xc.findByName(n,e):e,o=r?r.uuid:e,g=this._actionsByClip[o];return g!==void 0&&g.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,s=this.time+=e,r=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==n;++l)t[l]._update(s,e,r,o);const g=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)g[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,s=this._actionsByClip,r=s[n];if(r!==void 0){const o=r.knownActions;for(let g=0,a=o.length;g!==a;++g){const l=o[g];this._deactivateAction(l);const c=l._cacheIndex,C=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,C._cacheIndex=c,t[c]=C,t.pop(),this._removeInactiveBindingsForAction(l)}delete s[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const g=n[o].actionByRoot,a=g[t];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const s=this._bindingsByRootAndName,r=s[t];if(r!==void 0)for(const o in r){const g=r[o];g.restoreOriginalState(),this._removeInactiveBinding(g)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class KZ{constructor(e){this.value=e}clone(){return new KZ(this.value.clone===void 0?this.value:this.value.clone())}}let MU=0;class KU extends ha{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:MU++}),this.name="",this.usage=mp,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,s=t.length;n<s;n++)this.uniforms.push(t[n].clone());return this}clone(){return new this.constructor().copy(this)}}class LU extends Qd{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class zU{constructor(e,t,n,s,r){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=s,this.count=r,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class LZ{constructor(e,t,n=0,s=1/0){this.ray=new Ep(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new lu,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Hv(e,this,n,t),n.sort(VW),n}intersectObjects(e,t=!0,n=[]){for(let s=0,r=e.length;s<r;s++)Hv(e[s],this,n,t);return n.sort(VW),n}}function VW(i,e){return i.distance-e.distance}function Hv(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const s=i.children;for(let r=0,o=s.length;r<o;r++)Hv(s[r],e,t,!0)}}class Xv{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Vi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class _U{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const HW=new Fe;class kU{constructor(e=new Fe(1/0,1/0),t=new Fe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=HW.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return HW.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const XW=new E,A0=new E;class TU{constructor(e=new E,t=new E){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){XW.subVectors(e,this.start),A0.subVectors(this.end,this.start);const n=A0.dot(A0);let r=A0.dot(XW)/n;return t&&(r=Vi(r,0,1)),r}closestPointToPoint(e,t,n){const s=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const YW=new E;class EU extends en{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new zt,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,g=1,a=32;o<a;o++,g++){const l=o/a*Math.PI*2,c=g/a*Math.PI*2;s.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}n.setAttribute("position",new pt(s,3));const r=new Bs({fog:!1,toneMapped:!1});this.cone=new ng(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),YW.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(YW),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ec=new E,p0=new mt,vB=new mt;class AH extends ng{constructor(e){const t=pH(e),n=new zt,s=[],r=[],o=new et(0,0,1),g=new et(0,1,0);for(let l=0;l<t.length;l++){const c=t[l];c.parent&&c.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),r.push(o.r,o.g,o.b),r.push(g.r,g.g,g.b))}n.setAttribute("position",new pt(s,3)),n.setAttribute("color",new pt(r,3));const a=new Bs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,s=n.getAttribute("position");vB.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<t.length;r++){const g=t[r];g.parent&&g.parent.isBone&&(p0.multiplyMatrices(vB,g.matrixWorld),ec.setFromMatrixPosition(p0),s.setXYZ(o,ec.x,ec.y,ec.z),p0.multiplyMatrices(vB,g.parent.matrixWorld),ec.setFromMatrixPosition(p0),s.setXYZ(o+1,ec.x,ec.y,ec.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function pH(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,pH(i.children[t]));return e}class DU extends mi{constructor(e,t,n){const s=new th(t,4,2),r=new Oi({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const JU=new E,FW=new et,NW=new et;class UU extends en{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const s=new eh(t);s.rotateY(Math.PI*.5),this.material=new Oi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new on(o,3)),this.add(new mi(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");FW.copy(this.light.color),NW.copy(this.light.groundColor);for(let n=0,s=t.count;n<s;n++){const r=n<s/2?FW:NW;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(JU.setFromMatrixPosition(this.light.matrixWorld).negate())}}class PU extends ng{constructor(e=10,t=10,n=4473924,s=8947848){n=new et(n),s=new et(s);const r=t/2,o=e/t,g=e/2,a=[],l=[];for(let h=0,p=0,m=-g;h<=t;h++,m+=o){a.push(-g,0,m,g,0,m),a.push(m,0,-g,m,0,g);const f=h===r?n:s;f.toArray(l,p),p+=3,f.toArray(l,p),p+=3,f.toArray(l,p),p+=3,f.toArray(l,p),p+=3}const c=new zt;c.setAttribute("position",new pt(a,3)),c.setAttribute("color",new pt(l,3));const C=new Bs({vertexColors:!0,toneMapped:!1});super(c,C),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class OU extends ng{constructor(e=10,t=16,n=8,s=64,r=4473924,o=8947848){r=new et(r),o=new et(o);const g=[],a=[];if(t>1)for(let C=0;C<t;C++){const h=C/t*(Math.PI*2),p=Math.sin(h)*e,m=Math.cos(h)*e;g.push(0,0,0),g.push(p,0,m);const f=C&1?r:o;a.push(f.r,f.g,f.b),a.push(f.r,f.g,f.b)}for(let C=0;C<n;C++){const h=C&1?r:o,p=e-e/n*C;for(let m=0;m<s;m++){let f=m/s*(Math.PI*2),b=Math.sin(f)*p,y=Math.cos(f)*p;g.push(b,0,y),a.push(h.r,h.g,h.b),f=(m+1)/s*(Math.PI*2),b=Math.sin(f)*p,y=Math.cos(f)*p,g.push(b,0,y),a.push(h.r,h.g,h.b)}}const l=new zt;l.setAttribute("position",new pt(g,3)),l.setAttribute("color",new pt(a,3));const c=new Bs({vertexColors:!0,toneMapped:!1});super(l,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const MW=new E,f0=new E,KW=new E;class QU extends en{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new zt;s.setAttribute("position",new pt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Bs({fog:!1,toneMapped:!1});this.lightPlane=new Ca(s,r),this.add(this.lightPlane),s=new zt,s.setAttribute("position",new pt([0,0,0,0,0,1],3)),this.targetLine=new Ca(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),MW.setFromMatrixPosition(this.light.matrixWorld),f0.setFromMatrixPosition(this.light.target.matrixWorld),KW.subVectors(f0,MW),this.lightPlane.lookAt(f0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(f0),this.targetLine.scale.z=KW.length()}}const m0=new E,Ai=new Dp;class jU extends ng{constructor(e){const t=new zt,n=new Bs({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};g("n1","n2"),g("n2","n4"),g("n4","n3"),g("n3","n1"),g("f1","f2"),g("f2","f4"),g("f4","f3"),g("f3","f1"),g("n1","f1"),g("n2","f2"),g("n3","f3"),g("n4","f4"),g("p","n1"),g("p","n2"),g("p","n3"),g("p","n4"),g("u1","u2"),g("u2","u3"),g("u3","u1"),g("c","t"),g("p","c"),g("cn1","cn2"),g("cn3","cn4"),g("cf1","cf2"),g("cf3","cf4");function g(m,f){a(m),a(f)}function a(m){s.push(0,0,0),r.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(s.length/3-1)}t.setAttribute("position",new pt(s,3)),t.setAttribute("color",new pt(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const l=new et(16755200),c=new et(16711680),C=new et(43775),h=new et(16777215),p=new et(3355443);this.setColors(l,c,C,h,p)}setColors(e,t,n,s,r){const g=this.geometry.getAttribute("color");g.setXYZ(0,e.r,e.g,e.b),g.setXYZ(1,e.r,e.g,e.b),g.setXYZ(2,e.r,e.g,e.b),g.setXYZ(3,e.r,e.g,e.b),g.setXYZ(4,e.r,e.g,e.b),g.setXYZ(5,e.r,e.g,e.b),g.setXYZ(6,e.r,e.g,e.b),g.setXYZ(7,e.r,e.g,e.b),g.setXYZ(8,e.r,e.g,e.b),g.setXYZ(9,e.r,e.g,e.b),g.setXYZ(10,e.r,e.g,e.b),g.setXYZ(11,e.r,e.g,e.b),g.setXYZ(12,e.r,e.g,e.b),g.setXYZ(13,e.r,e.g,e.b),g.setXYZ(14,e.r,e.g,e.b),g.setXYZ(15,e.r,e.g,e.b),g.setXYZ(16,e.r,e.g,e.b),g.setXYZ(17,e.r,e.g,e.b),g.setXYZ(18,e.r,e.g,e.b),g.setXYZ(19,e.r,e.g,e.b),g.setXYZ(20,e.r,e.g,e.b),g.setXYZ(21,e.r,e.g,e.b),g.setXYZ(22,e.r,e.g,e.b),g.setXYZ(23,e.r,e.g,e.b),g.setXYZ(24,t.r,t.g,t.b),g.setXYZ(25,t.r,t.g,t.b),g.setXYZ(26,t.r,t.g,t.b),g.setXYZ(27,t.r,t.g,t.b),g.setXYZ(28,t.r,t.g,t.b),g.setXYZ(29,t.r,t.g,t.b),g.setXYZ(30,t.r,t.g,t.b),g.setXYZ(31,t.r,t.g,t.b),g.setXYZ(32,n.r,n.g,n.b),g.setXYZ(33,n.r,n.g,n.b),g.setXYZ(34,n.r,n.g,n.b),g.setXYZ(35,n.r,n.g,n.b),g.setXYZ(36,n.r,n.g,n.b),g.setXYZ(37,n.r,n.g,n.b),g.setXYZ(38,s.r,s.g,s.b),g.setXYZ(39,s.r,s.g,s.b),g.setXYZ(40,r.r,r.g,r.b),g.setXYZ(41,r.r,r.g,r.b),g.setXYZ(42,r.r,r.g,r.b),g.setXYZ(43,r.r,r.g,r.b),g.setXYZ(44,r.r,r.g,r.b),g.setXYZ(45,r.r,r.g,r.b),g.setXYZ(46,r.r,r.g,r.b),g.setXYZ(47,r.r,r.g,r.b),g.setXYZ(48,r.r,r.g,r.b),g.setXYZ(49,r.r,r.g,r.b),g.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,s=1;Ai.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ri("c",t,e,Ai,0,0,-1),Ri("t",t,e,Ai,0,0,1),Ri("n1",t,e,Ai,-n,-s,-1),Ri("n2",t,e,Ai,n,-s,-1),Ri("n3",t,e,Ai,-n,s,-1),Ri("n4",t,e,Ai,n,s,-1),Ri("f1",t,e,Ai,-n,-s,1),Ri("f2",t,e,Ai,n,-s,1),Ri("f3",t,e,Ai,-n,s,1),Ri("f4",t,e,Ai,n,s,1),Ri("u1",t,e,Ai,n*.7,s*1.1,-1),Ri("u2",t,e,Ai,-n*.7,s*1.1,-1),Ri("u3",t,e,Ai,0,s*2,-1),Ri("cf1",t,e,Ai,-n,0,1),Ri("cf2",t,e,Ai,n,0,1),Ri("cf3",t,e,Ai,0,-s,1),Ri("cf4",t,e,Ai,0,s,1),Ri("cn1",t,e,Ai,-n,0,-1),Ri("cn2",t,e,Ai,n,0,-1),Ri("cn3",t,e,Ai,0,-s,-1),Ri("cn4",t,e,Ai,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ri(i,e,t,n,s,r,o){m0.set(s,r,o).unproject(n);const g=e[i];if(g!==void 0){const a=t.getAttribute("position");for(let l=0,c=g.length;l<c;l++)a.setXYZ(g[l],m0.x,m0.y,m0.z)}}const b0=new Cl;class qU extends ng{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),r=new zt;r.setIndex(new on(n,1)),r.setAttribute("position",new on(s,3)),super(r,new Bs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&b0.setFromObject(this.object),b0.isEmpty())return;const t=b0.min,n=b0.max,s=this.geometry.attributes.position,r=s.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class $U extends ng{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new zt;r.setIndex(new on(n,1)),r.setAttribute("position",new pt(s,3)),super(r,new Bs({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class e8 extends Ca{constructor(e,t=1,n=16776960){const s=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new zt;o.setAttribute("position",new pt(r,3)),o.computeBoundingSphere(),super(o,new Bs({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const g=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new zt;a.setAttribute("position",new pt(g,3)),a.computeBoundingSphere(),this.add(new mi(a,new Oi({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const LW=new E;let G0,ZB;class t8 extends en{constructor(e=new E(0,0,1),t=new E(0,0,0),n=1,s=16776960,r=n*.2,o=r*.2){super(),this.type="ArrowHelper",G0===void 0&&(G0=new zt,G0.setAttribute("position",new pt([0,0,0,0,1,0],3)),ZB=new Wu(0,.5,1,5,1),ZB.translate(0,-.5,0)),this.position.copy(t),this.line=new Ca(G0,new Bs({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new mi(ZB,new Oi({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{LW.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(LW,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class n8 extends ng{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new zt;s.setAttribute("position",new pt(t,3)),s.setAttribute("color",new pt(n,3));const r=new Bs({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(e,t,n){const s=new et,r=this.geometry.attributes.color.array;return s.set(e),s.toArray(r,0),s.toArray(r,3),s.set(t),s.toArray(r,6),s.toArray(r,9),s.set(n),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class i8{constructor(){this.type="ShapePath",this.color=new et,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Bp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,s){return this.currentPath.quadraticCurveTo(e,t,n,s),this}bezierCurveTo(e,t,n,s,r,o){return this.currentPath.bezierCurveTo(e,t,n,s,r,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(y){const v=[];for(let G=0,w=y.length;G<w;G++){const W=y[G],V=new cu;V.curves=W.curves,v.push(V)}return v}function n(y,v){const G=v.length;let w=!1;for(let W=G-1,V=0;V<G;W=V++){let X=v[W],R=v[V],Y=R.x-X.x,M=R.y-X.y;if(Math.abs(M)>Number.EPSILON){if(M<0&&(X=v[V],Y=-Y,R=v[W],M=-M),y.y<X.y||y.y>R.y)continue;if(y.y===X.y){if(y.x===X.x)return!0}else{const L=M*(y.x-X.x)-Y*(y.y-X.y);if(L===0)return!0;if(L<0)continue;w=!w}}else{if(y.y!==X.y)continue;if(R.x<=y.x&&y.x<=X.x||X.x<=y.x&&y.x<=R.x)return!0}}return w}const s=ca.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,g,a;const l=[];if(r.length===1)return g=r[0],a=new cu,a.curves=g.curves,l.push(a),l;let c=!s(r[0].getPoints());c=e?!c:c;const C=[],h=[];let p=[],m=0,f;h[m]=void 0,p[m]=[];for(let y=0,v=r.length;y<v;y++)g=r[y],f=g.getPoints(),o=s(f),o=e?!o:o,o?(!c&&h[m]&&m++,h[m]={s:new cu,p:f},h[m].s.curves=g.curves,c&&m++,p[m]=[]):p[m].push({h:g,p:f[0]});if(!h[0])return t(r);if(h.length>1){let y=!1,v=0;for(let G=0,w=h.length;G<w;G++)C[G]=[];for(let G=0,w=h.length;G<w;G++){const W=p[G];for(let V=0;V<W.length;V++){const X=W[V];let R=!0;for(let Y=0;Y<h.length;Y++)n(X.p,h[Y].p)&&(G!==Y&&v++,R?(R=!1,C[Y].push(X)):y=!0);R&&C[G].push(X)}}v>0&&y===!1&&(p=C)}let b;for(let y=0,v=h.length;y<v;y++){a=h[y].s,l.push(a),b=p[y];for(let G=0,w=b.length;G<w;G++)a.holes.push(b[G].h)}return l}}const Ja=s8();function s8(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),s=new Uint32Array(512);for(let a=0;a<256;++a){const l=a-127;l<-27?(n[a]=0,n[a|256]=32768,s[a]=24,s[a|256]=24):l<-14?(n[a]=1024>>-l-14,n[a|256]=1024>>-l-14|32768,s[a]=-l-1,s[a|256]=-l-1):l<=15?(n[a]=l+15<<10,n[a|256]=l+15<<10|32768,s[a]=13,s[a|256]=13):l<128?(n[a]=31744,n[a|256]=64512,s[a]=24,s[a|256]=24):(n[a]=31744,n[a|256]=64512,s[a]=13,s[a|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),g=new Uint32Array(64);for(let a=1;a<1024;++a){let l=a<<13,c=0;for(;!(l&8388608);)l<<=1,c-=8388608;l&=-8388609,c+=947912704,r[a]=l|c}for(let a=1024;a<2048;++a)r[a]=939524096+(a-1024<<13);for(let a=1;a<31;++a)o[a]=a<<23;o[31]=1199570944,o[32]=2147483648;for(let a=33;a<63;++a)o[a]=2147483648+(a-32<<23);o[63]=3347054592;for(let a=1;a<64;++a)a!==32&&(g[a]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:s,mantissaTable:r,exponentTable:o,offsetTable:g}}function r8(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=Vi(i,-65504,65504),Ja.floatView[0]=i;const e=Ja.uint32View[0],t=e>>23&511;return Ja.baseTable[t]+((e&8388607)>>Ja.shiftTable[t])}function o8(i){const e=i>>10;return Ja.uint32View[0]=Ja.mantissaTable[Ja.offsetTable[e]+(i&1023)]+Ja.exponentTable[e],Ja.floatView[0]}var FA=Object.freeze({__proto__:null,toHalfFloat:r8,fromHalfFloat:o8});function g8(){console.error("THREE.ImmediateRenderObject has been removed.")}class a8 extends Co{constructor(e,t,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,n),this.samples=4}}class l8 extends Tp{constructor(e,t,n,s){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,n,s)}}class c8 extends uG{constructor(e,t,n,s){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,n,s)}}class I8 extends hl{constructor(e,t,n,s,r,o){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,s,r,o)}}class u8 extends Op{constructor(e,t,n,s){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,s)}}class C8 extends Qp{constructor(e,t,n,s){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,s)}}class d8 extends jp{constructor(e,t,n,s,r,o,g){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,s,r,o,g)}}class h8 extends Wu{constructor(e,t,n,s,r,o,g,a){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,s,r,o,g,a)}}class A8 extends qp{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class p8 extends $p{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class f8 extends $d{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class m8 extends qd{constructor(e,t,n,s){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,s)}}class b8 extends eh{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class G8 extends Pd{constructor(e,t,n,s){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,s)}}class y8 extends Al{constructor(e,t,n,s){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,s)}}class B8 extends ef{constructor(e,t,n,s,r,o){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,s,r,o)}}class v8 extends tf{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class Z8 extends th{constructor(e,t,n,s,r,o,g){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,s,r,o,g)}}class w8 extends nf{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class S8 extends sf{constructor(e,t,n,s,r){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,s,r)}}class R8 extends rf{constructor(e,t,n,s,r,o){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,s,r,o)}}class W8 extends of{constructor(e,t,n,s,r){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,s,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:zp}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=zp);const x8=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:rZ,AddEquation:TI,AddOperation:Dx,AdditiveAnimationBlendMode:gZ,AdditiveBlending:q2,AlphaFormat:tV,AlwaysDepth:Kx,AlwaysStencilFunc:fV,AmbientLight:aH,AmbientLightProbe:fU,AnimationClip:Xc,AnimationLoader:lU,AnimationMixer:hH,AnimationObjectGroup:YU,AnimationUtils:rU,ArcCurve:MV,ArrayCamera:VV,ArrowHelper:t8,Audio:CH,AudioAnalyser:vU,AudioContext:YZ,AudioListener:GU,AudioLoader:AU,AxesHelper:n8,BackSide:ao,BasicDepthPacking:hV,BasicShadowMap:vx,Bone:Up,BooleanKeyframeTrack:Vu,Box2:kU,Box3:Cl,Box3Helper:$U,BoxBufferGeometry:I8,BoxGeometry:hl,BoxHelper:qU,BufferAttribute:on,BufferGeometry:zt,BufferGeometryLoader:uH,ByteType:Qx,Cache:vu,Camera:Dp,CameraHelper:jU,CanvasTexture:WJ,CapsuleBufferGeometry:u8,CapsuleGeometry:Op,CatmullRomCurve3:KV,CineonToneMapping:Px,CircleBufferGeometry:C8,CircleGeometry:Qp,ClampToEdgeWrapping:cs,Clock:FZ,Color:et,ColorKeyframeTrack:WZ,ColorManagement:Fs,CompressedArrayTexture:RJ,CompressedTexture:mZ,CompressedTextureLoader:cU,ConeBufferGeometry:d8,ConeGeometry:jp,CubeCamera:vV,CubeReflectionMapping:rl,CubeRefractionMapping:Vc,CubeTexture:Jp,CubeTextureLoader:rH,CubeUVReflectionMapping:Ud,CubicBezierCurve:GZ,CubicBezierCurve3:LV,CubicInterpolant:nH,CullFaceBack:j2,CullFaceFront:Bx,CullFaceFrontBack:N_,CullFaceNone:yx,Curve:Fg,CurvePath:_V,CustomBlending:Zx,CustomToneMapping:Ox,CylinderBufferGeometry:h8,CylinderGeometry:Wu,Cylindrical:_U,Data3DTexture:uG,DataArrayTexture:Tp,DataTexture:hd,DataTexture2DArray:l8,DataTexture3D:c8,DataTextureLoader:oH,DataUtils:FA,DecrementStencilOp:D_,DecrementWrapStencilOp:U_,DefaultLoadingManager:rd,DepthFormat:Zc,DepthStencilFormat:bu,DepthTexture:HV,DirectionalLight:ZG,DirectionalLightHelper:QU,DiscreteInterpolant:iH,DodecahedronBufferGeometry:A8,DodecahedronGeometry:qp,DoubleSide:Lc,DstAlphaFactor:Hx,DstColorFactor:Yx,DynamicCopyUsage:gk,DynamicDrawUsage:Hb,DynamicReadUsage:sk,EdgesGeometry:kV,EllipseCurve:bG,EqualDepth:zx,EqualStencilFunc:j_,EquirectangularReflectionMapping:xd,EquirectangularRefractionMapping:pp,Euler:Ru,EventDispatcher:ha,ExtrudeBufferGeometry:p8,ExtrudeGeometry:$p,FileLoader:ys,Float16BufferAttribute:_k,Float32BufferAttribute:pt,Float64BufferAttribute:kk,FloatType:Do,Fog:AG,FogExp2:hG,FramebufferTexture:SJ,FrontSide:ua,Frustum:CG,GLBufferAttribute:zU,GLSL1:lk,GLSL3:vv,GreaterDepth:kx,GreaterEqualDepth:_x,GreaterEqualStencilFunc:tk,GreaterStencilFunc:$_,GridHelper:PU,Group:oo,HalfFloatType:Jo,HemisphereLight:gH,HemisphereLightHelper:UU,HemisphereLightProbe:pU,IcosahedronBufferGeometry:f8,IcosahedronGeometry:$d,ImageBitmapLoader:XZ,ImageLoader:Sp,ImageUtils:cZ,ImmediateRenderObject:g8,IncrementStencilOp:E_,IncrementWrapStencilOp:J_,InstancedBufferAttribute:Fd,InstancedBufferGeometry:IH,InstancedInterleavedBuffer:LU,InstancedMesh:wc,Int16BufferAttribute:Lk,Int32BufferAttribute:zk,Int8BufferAttribute:Nk,IntType:qx,InterleavedBuffer:Qd,InterleavedBufferAttribute:ll,Interpolant:xu,InterpolateDiscrete:Gu,InterpolateLinear:gl,InterpolateSmooth:j0,InvertStencilOp:P_,KeepStencilOp:q0,KeyframeTrack:Ng,LOD:NV,LatheBufferGeometry:m8,LatheGeometry:qd,Layers:lu,LessDepth:Lx,LessEqualDepth:Vb,LessEqualStencilFunc:q_,LessStencilFunc:Q_,Light:_c,LightProbe:wG,Line:Ca,Line3:TU,LineBasicMaterial:Bs,LineCurve:GG,LineCurve3:zV,LineDashedMaterial:eH,LineLoop:fG,LineSegments:ng,LinearEncoding:al,LinearFilter:Zn,LinearInterpolant:RZ,LinearMipMapLinearFilter:z_,LinearMipMapNearestFilter:L_,LinearMipmapLinearFilter:eg,LinearMipmapNearestFilter:kp,LinearSRGBColorSpace:Xd,LinearToneMapping:Jx,Loader:Zs,LoaderUtils:bs,LoadingManager:xZ,LoopOnce:IV,LoopPingPong:CV,LoopRepeat:uV,LuminanceAlphaFormat:sV,LuminanceFormat:iV,MOUSE:LI,Material:qn,MaterialLoader:SG,MathUtils:lZ,Matrix3:rr,Matrix4:mt,MaxEquation:nv,Mesh:mi,MeshBasicMaterial:Oi,MeshDepthMaterial:hZ,MeshDistanceMaterial:AZ,MeshLambertMaterial:qV,MeshMatcapMaterial:$V,MeshNormalMaterial:jV,MeshPhongMaterial:OV,MeshPhysicalMaterial:vs,MeshStandardMaterial:jo,MeshToonMaterial:QV,MinEquation:tv,MirroredRepeatWrapping:mu,MixOperation:Ex,MultiplyBlending:ev,MultiplyOperation:_p,NearestFilter:oi,NearestMipMapLinearFilter:K_,NearestMipMapNearestFilter:M_,NearestMipmapLinearFilter:ru,NearestMipmapNearestFilter:Vd,NeverDepth:Mx,NeverStencilFunc:O_,NoBlending:el,NoColorSpace:__,NoToneMapping:Wg,NormalAnimationBlendMode:cG,NormalBlending:su,NotEqualDepth:Tx,NotEqualStencilFunc:ek,NumberKeyframeTrack:Bu,Object3D:en,ObjectLoader:dU,ObjectSpaceNormalMap:pV,OctahedronBufferGeometry:b8,OctahedronGeometry:eh,OneFactor:Wx,OneMinusDstAlphaFactor:Xx,OneMinusDstColorFactor:Fx,OneMinusSrcAlphaFactor:sZ,OneMinusSrcColorFactor:Vx,OrthographicCamera:co,PCFShadowMap:aG,PCFSoftShadowMap:UA,PMREMGenerator:wv,Path:Bp,PerspectiveCamera:Dn,Plane:rc,PlaneBufferGeometry:G8,PlaneGeometry:Pd,PlaneHelper:e8,PointLight:vG,PointLightHelper:DU,Points:mG,PointsMaterial:Pp,PolarGridHelper:OU,PolyhedronBufferGeometry:y8,PolyhedronGeometry:Al,PositionalAudio:BU,PropertyBinding:un,PropertyMixer:dH,QuadraticBezierCurve:yZ,QuadraticBezierCurve3:BZ,Quaternion:jn,QuaternionKeyframeTrack:Yg,QuaternionLinearInterpolant:sH,REVISION:zp,RGBADepthPacking:AV,RGBAFormat:Zr,RGBAIntegerFormat:lV,RGBA_ASTC_10x10_Format:bv,RGBA_ASTC_10x5_Format:pv,RGBA_ASTC_10x6_Format:fv,RGBA_ASTC_10x8_Format:mv,RGBA_ASTC_12x10_Format:Gv,RGBA_ASTC_12x12_Format:yv,RGBA_ASTC_4x4_Format:lv,RGBA_ASTC_5x4_Format:cv,RGBA_ASTC_5x5_Format:Iv,RGBA_ASTC_6x5_Format:uv,RGBA_ASTC_6x6_Format:Cv,RGBA_ASTC_8x5_Format:dv,RGBA_ASTC_8x6_Format:hv,RGBA_ASTC_8x8_Format:Av,RGBA_BPTC_Format:Bv,RGBA_ETC2_EAC_Format:av,RGBA_PVRTC_2BPPV1_Format:ov,RGBA_PVRTC_4BPPV1_Format:rv,RGBA_S3TC_DXT1_Format:P0,RGBA_S3TC_DXT3_Format:O0,RGBA_S3TC_DXT5_Format:Q0,RGBFormat:nV,RGB_ETC1_Format:cV,RGB_ETC2_Format:gv,RGB_PVRTC_2BPPV1_Format:sv,RGB_PVRTC_4BPPV1_Format:iv,RGB_S3TC_DXT1_Format:U0,RGFormat:gV,RGIntegerFormat:aV,RawShaderMaterial:PV,Ray:Ep,Raycaster:LZ,RectAreaLight:lH,RedFormat:rV,RedIntegerFormat:oV,ReinhardToneMapping:Ux,RepeatWrapping:Hg,ReplaceStencilOp:T_,ReverseSubtractEquation:Sx,RingBufferGeometry:B8,RingGeometry:ef,SRGBColorSpace:vg,Scene:yp,ShaderChunk:$t,ShaderLib:wg,ShaderMaterial:Xg,ShadowMaterial:UV,Shape:cu,ShapeBufferGeometry:v8,ShapeGeometry:tf,ShapePath:i8,ShapeUtils:ca,ShortType:jx,Skeleton:jd,SkeletonHelper:AH,SkinnedMesh:pG,Source:$I,Sphere:dl,SphereBufferGeometry:Z8,SphereGeometry:th,Spherical:Xv,SphericalHarmonics3:cH,SplineCurve:vZ,SpotLight:BG,SpotLightHelper:EU,Sprite:FV,SpriteMaterial:fZ,SrcAlphaFactor:iZ,SrcAlphaSaturateFactor:Nx,SrcColorFactor:xx,StaticCopyUsage:ok,StaticDrawUsage:mp,StaticReadUsage:ik,StereoCamera:mU,StreamCopyUsage:ak,StreamDrawUsage:nk,StreamReadUsage:rk,StringKeyframeTrack:Hu,SubtractEquation:wx,SubtractiveBlending:$2,TOUCH:zI,TangentSpaceNormalMap:zc,TetrahedronBufferGeometry:w8,TetrahedronGeometry:nf,Texture:kn,TextureLoader:VZ,TorusBufferGeometry:S8,TorusGeometry:sf,TorusKnotBufferGeometry:R8,TorusKnotGeometry:rf,Triangle:To,TriangleFanDrawMode:Hd,TriangleStripDrawMode:IG,TrianglesDrawMode:dV,TubeBufferGeometry:W8,TubeGeometry:of,TwoPassDoubleSide:XA,UVMapping:lG,Uint16BufferAttribute:IZ,Uint32BufferAttribute:uZ,Uint8BufferAttribute:Mk,Uint8ClampedBufferAttribute:Kk,Uniform:KZ,UniformsGroup:KU,UniformsLib:it,UniformsUtils:BV,UnsignedByteType:ol,UnsignedInt248Type:ou,UnsignedIntType:Cc,UnsignedShort4444Type:$x,UnsignedShort5551Type:eV,UnsignedShortType:oZ,VSMShadowMap:QI,Vector2:Fe,Vector3:E,Vector4:wn,VectorKeyframeTrack:Hc,VideoTexture:wJ,WebGL1Renderer:XV,WebGL3DRenderTarget:wk,WebGLArrayRenderTarget:Zk,WebGLCubeRenderTarget:CZ,WebGLMultipleRenderTargets:Sk,WebGLMultisampleRenderTarget:a8,WebGLRenderTarget:Co,WebGLRenderer:pZ,WebGLUtils:xV,WireframeGeometry:JV,WrapAroundEnding:fp,ZeroCurvatureEnding:jI,ZeroFactor:Rx,ZeroSlopeEnding:qI,ZeroStencilOp:k_,_SRGBAFormat:Xb,sRGBEncoding:bn},Symbol.toStringTag,{value:"Module"}));var fH={exports:{}},Xu={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */Xu.ConcurrentRoot=1;Xu.ContinuousEventPriority=4;Xu.DefaultEventPriority=16;Xu.DiscreteEventPriority=1;Xu.IdleEventPriority=536870912;Xu.LegacyRoot=0;fH.exports=Xu;var od=fH.exports;function V8(i){let e;const t=new Set,n=(l,c)=>{const C=typeof l=="function"?l(e):l;if(C!==e){const h=e;e=c?C:Object.assign({},e,C),t.forEach(p=>p(e,h))}},s=()=>e,r=(l,c=s,C=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let h=c(e);function p(){const m=c(e);if(!C(h,m)){const f=h;l(h=m,f)}}return t.add(p),()=>t.delete(p)},a={setState:n,getState:s,subscribe:(l,c,C)=>c||C?r(l,c,C):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=i(n,s,a),a}const H8=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),zW=H8?T.useEffect:T.useLayoutEffect;function gf(i){const e=typeof i=="function"?V8(i):i,t=(n=e.getState,s=Object.is)=>{const[,r]=T.useReducer(b=>b+1,0),o=e.getState(),g=T.useRef(o),a=T.useRef(n),l=T.useRef(s),c=T.useRef(!1),C=T.useRef();C.current===void 0&&(C.current=n(o));let h,p=!1;(g.current!==o||a.current!==n||l.current!==s||c.current)&&(h=n(o),p=!s(C.current,h)),zW(()=>{p&&(C.current=h),g.current=o,a.current=n,l.current=s,c.current=!1});const m=T.useRef(o);zW(()=>{const b=()=>{try{const v=e.getState(),G=a.current(v);l.current(C.current,G)||(g.current=v,C.current=G,r())}catch{c.current=!0,r()}},y=e.subscribe(b);return e.getState()!==m.current&&b(),y},[]);const f=p?h:C.current;return T.useDebugValue(f),f};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const s=n.length<=0;return{value:n.shift(),done:s}}}},t}var mH={exports:{}},bH={exports:{}},GH={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(_,ne){var te=_.length;_.push(ne);e:for(;0<te;){var q=te-1>>>1,se=_[q];if(0<s(se,ne))_[q]=ne,_[te]=se,te=q;else break e}}function t(_){return _.length===0?null:_[0]}function n(_){if(_.length===0)return null;var ne=_[0],te=_.pop();if(te!==ne){_[0]=te;e:for(var q=0,se=_.length,ue=se>>>1;q<ue;){var Ae=2*(q+1)-1,We=_[Ae],me=Ae+1,tt=_[me];if(0>s(We,te))me<se&&0>s(tt,We)?(_[q]=tt,_[me]=te,q=me):(_[q]=We,_[Ae]=te,q=Ae);else if(me<se&&0>s(tt,te))_[q]=tt,_[me]=te,q=me;else break e}}return ne}function s(_,ne){var te=_.sortIndex-ne.sortIndex;return te!==0?te:_.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var o=Date,g=o.now();i.unstable_now=function(){return o.now()-g}}var a=[],l=[],c=1,C=null,h=3,p=!1,m=!1,f=!1,b=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(_){for(var ne=t(l);ne!==null;){if(ne.callback===null)n(l);else if(ne.startTime<=_)n(l),ne.sortIndex=ne.expirationTime,e(a,ne);else break;ne=t(l)}}function w(_){if(f=!1,G(_),!m)if(t(a)!==null)m=!0,he(W);else{var ne=t(l);ne!==null&&le(w,ne.startTime-_)}}function W(_,ne){m=!1,f&&(f=!1,y(R),R=-1),p=!0;var te=h;try{for(G(ne),C=t(a);C!==null&&(!(C.expirationTime>ne)||_&&!L());){var q=C.callback;if(typeof q=="function"){C.callback=null,h=C.priorityLevel;var se=q(C.expirationTime<=ne);ne=i.unstable_now(),typeof se=="function"?C.callback=se:C===t(a)&&n(a),G(ne)}else n(a);C=t(a)}if(C!==null)var ue=!0;else{var Ae=t(l);Ae!==null&&le(w,Ae.startTime-ne),ue=!1}return ue}finally{C=null,h=te,p=!1}}var V=!1,X=null,R=-1,Y=5,M=-1;function L(){return!(i.unstable_now()-M<Y)}function re(){if(X!==null){var _=i.unstable_now();M=_;var ne=!0;try{ne=X(!0,_)}finally{ne?j():(V=!1,X=null)}}else V=!1}var j;if(typeof v=="function")j=function(){v(re)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,ie=$.port2;$.port1.onmessage=re,j=function(){ie.postMessage(null)}}else j=function(){b(re,0)};function he(_){X=_,V||(V=!0,j())}function le(_,ne){R=b(function(){_(i.unstable_now())},ne)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(_){_.callback=null},i.unstable_continueExecution=function(){m||p||(m=!0,he(W))},i.unstable_forceFrameRate=function(_){0>_||125<_?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<_?Math.floor(1e3/_):5},i.unstable_getCurrentPriorityLevel=function(){return h},i.unstable_getFirstCallbackNode=function(){return t(a)},i.unstable_next=function(_){switch(h){case 1:case 2:case 3:var ne=3;break;default:ne=h}var te=h;h=ne;try{return _()}finally{h=te}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(_,ne){switch(_){case 1:case 2:case 3:case 4:case 5:break;default:_=3}var te=h;h=_;try{return ne()}finally{h=te}},i.unstable_scheduleCallback=function(_,ne,te){var q=i.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?q+te:q):te=q,_){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=te+se,_={id:c++,callback:ne,priorityLevel:_,startTime:te,expirationTime:se,sortIndex:-1},te>q?(_.sortIndex=te,e(l,_),t(a)===null&&_===t(l)&&(f?(y(R),R=-1):f=!0,le(w,te-q))):(_.sortIndex=se,e(a,_),m||p||(m=!0,he(W))),_},i.unstable_shouldYield=L,i.unstable_wrapCallback=function(_){var ne=h;return function(){var te=h;h=ne;try{return _.apply(this,arguments)}finally{h=te}}}})(GH);bH.exports=GH;var Yv=bH.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X8=function(e){var t={},n=T,s=Yv,r=Object.assign;function o(u){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+u,B=1;B<arguments.length;B++)d+="&args[]="+encodeURIComponent(arguments[B]);return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,a=Symbol.for("react.element"),l=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),m=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),v=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),w=Symbol.for("react.offscreen"),W=Symbol.iterator;function V(u){return u===null||typeof u!="object"?null:(u=W&&u[W]||u["@@iterator"],typeof u=="function"?u:null)}function X(u){if(u==null)return null;if(typeof u=="function")return u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case c:return"Fragment";case l:return"Portal";case h:return"Profiler";case C:return"StrictMode";case b:return"Suspense";case y:return"SuspenseList"}if(typeof u=="object")switch(u.$$typeof){case m:return(u.displayName||"Context")+".Consumer";case p:return(u._context.displayName||"Context")+".Provider";case f:var d=u.render;return u=u.displayName,u||(u=d.displayName||d.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case v:return d=u.displayName||null,d!==null?d:X(u.type)||"Memo";case G:d=u._payload,u=u._init;try{return X(u(d))}catch{}}return null}function R(u){var d=u.type;switch(u.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return u=d.render,u=u.displayName||u.name||"",d.displayName||(u!==""?"ForwardRef("+u+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return X(d);case 8:return d===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function Y(u){var d=u,B=u;if(u.alternate)for(;d.return;)d=d.return;else{u=d;do d=u,d.flags&4098&&(B=d.return),u=d.return;while(u)}return d.tag===3?B:null}function M(u){if(Y(u)!==u)throw Error(o(188))}function L(u){var d=u.alternate;if(!d){if(d=Y(u),d===null)throw Error(o(188));return d!==u?null:u}for(var B=u,S=d;;){var x=B.return;if(x===null)break;var F=x.alternate;if(F===null){if(S=x.return,S!==null){B=S;continue}break}if(x.child===F.child){for(F=x.child;F;){if(F===B)return M(x),u;if(F===S)return M(x),d;F=F.sibling}throw Error(o(188))}if(B.return!==S.return)B=x,S=F;else{for(var Q=!1,ce=x.child;ce;){if(ce===B){Q=!0,B=x,S=F;break}if(ce===S){Q=!0,S=x,B=F;break}ce=ce.sibling}if(!Q){for(ce=F.child;ce;){if(ce===B){Q=!0,B=F,S=x;break}if(ce===S){Q=!0,S=F,B=x;break}ce=ce.sibling}if(!Q)throw Error(o(189))}}if(B.alternate!==S)throw Error(o(190))}if(B.tag!==3)throw Error(o(188));return B.stateNode.current===B?u:d}function re(u){return u=L(u),u!==null?j(u):null}function j(u){if(u.tag===5||u.tag===6)return u;for(u=u.child;u!==null;){var d=j(u);if(d!==null)return d;u=u.sibling}return null}function $(u){if(u.tag===5||u.tag===6)return u;for(u=u.child;u!==null;){if(u.tag!==4){var d=$(u);if(d!==null)return d}u=u.sibling}return null}var ie=Array.isArray,he=e.getPublicInstance,le=e.getRootHostContext,_=e.getChildHostContext,ne=e.prepareForCommit,te=e.resetAfterCommit,q=e.createInstance,se=e.appendInitialChild,ue=e.finalizeInitialChildren,Ae=e.prepareUpdate,We=e.shouldSetTextContent,me=e.createTextInstance,tt=e.scheduleTimeout,Oe=e.cancelTimeout,It=e.noTimeout,ke=e.isPrimaryRenderer,je=e.supportsMutation,ve=e.supportsPersistence,be=e.supportsHydration,Ve=e.getInstanceFromNode,qe=e.preparePortalMount,Xe=e.getCurrentEventPriority,Pe=e.detachDeletedInstance,ct=e.supportsMicrotasks,gt=e.scheduleMicrotask,Yt=e.supportsTestSelectors,Zt=e.findFiberRoot,O=e.getBoundingRect,z=e.getTextContent,ye=e.isHiddenSubtree,Le=e.matchAccessibilityRole,Te=e.setFocusIfFocusable,De=e.setupIntersectionObserver,vt=e.appendChild,nt=e.appendChildToContainer,Ye=e.commitTextUpdate,dt=e.commitMount,oe=e.commitUpdate,we=e.insertBefore,Ee=e.insertInContainerBefore,Qe=e.removeChild,wt=e.removeChildFromContainer,Ot=e.resetTextContent,Vn=e.hideInstance,Ie=e.hideTextInstance,Se=e.unhideInstance,ze=e.unhideTextInstance,at=e.clearContainer,bt=e.cloneInstance,cn=e.createContainerChildSet,$n=e.appendChildToContainerChildSet,Hi=e.finalizeContainerChildren,Nr=e.replaceContainerChildren,Bn=e.cloneHiddenInstance,lr=e.cloneHiddenTextInstance,ws=e.canHydrateInstance,pl=e.canHydrateTextInstance,nh=e.canHydrateSuspenseInstance,fl=e.isSuspenseInstancePending,Tc=e.isSuspenseInstanceFallback,J=e.registerSuspenseInstanceRetry,Ge=e.getNextHydratableSibling,He=e.getFirstHydratableChild,pe=e.getFirstHydratableChildWithinContainer,Ne=e.getFirstHydratableChildWithinSuspenseInstance,St=e.hydrateInstance,Nt=e.hydrateTextInstance,_t=e.hydrateSuspenseInstance,Qt=e.getNextHydratableInstanceAfterSuspenseInstance,sn=e.commitHydratedContainer,tn=e.commitHydratedSuspenseInstance,nn=e.clearSuspenseBoundary,Un=e.clearSuspenseBoundaryFromContainer,Cs=e.shouldDeleteUnhydratedTailInstances,Ss=e.didNotMatchHydratedContainerTextInstance,rg=e.didNotMatchHydratedTextInstance,vn;function Dt(u){if(vn===void 0)try{throw Error()}catch(B){var d=B.stack.trim().match(/\n( *(at )?)/);vn=d&&d[1]||""}return`
`+vn+u}var pa=!1;function Pn(u,d){if(!u||pa)return"";pa=!0;var B=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(Je){var S=Je}Reflect.construct(u,[],d)}else{try{d.call()}catch(Je){S=Je}u.call(d.prototype)}else{try{throw Error()}catch(Je){S=Je}u()}}catch(Je){if(Je&&S&&typeof Je.stack=="string"){for(var x=Je.stack.split(`
`),F=S.stack.split(`
`),Q=x.length-1,ce=F.length-1;1<=Q&&0<=ce&&x[Q]!==F[ce];)ce--;for(;1<=Q&&0<=ce;Q--,ce--)if(x[Q]!==F[ce]){if(Q!==1||ce!==1)do if(Q--,ce--,0>ce||x[Q]!==F[ce]){var Re=`
`+x[Q].replace(" at new "," at ");return u.displayName&&Re.includes("<anonymous>")&&(Re=Re.replace("<anonymous>",u.displayName)),Re}while(1<=Q&&0<=ce);break}}}finally{pa=!1,Error.prepareStackTrace=B}return(u=u?u.displayName||u.name:"")?Dt(u):""}var fo=Object.prototype.hasOwnProperty,fa=[],Es=-1;function cr(u){return{current:u}}function kt(u){0>Es||(u.current=fa[Es],fa[Es]=null,Es--)}function gn(u,d){Es++,fa[Es]=u.current,u.current=d}var Ir={},An=cr(Ir),Gi=cr(!1),mo=Ir;function Mr(u,d){var B=u.type.contextTypes;if(!B)return Ir;var S=u.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===d)return S.__reactInternalMemoizedMaskedChildContext;var x={},F;for(F in B)x[F]=d[F];return S&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=d,u.__reactInternalMemoizedMaskedChildContext=x),x}function Rs(u){return u=u.childContextTypes,u!=null}function Ec(){kt(Gi),kt(An)}function Dc(u,d,B){if(An.current!==Ir)throw Error(o(168));gn(An,d),gn(Gi,B)}function ih(u,d,B){var S=u.stateNode;if(d=d.childContextTypes,typeof S.getChildContext!="function")return B;S=S.getChildContext();for(var x in S)if(!(x in d))throw Error(o(108,R(u)||"Unknown",x));return r({},B,S)}function Nu(u){return u=(u=u.stateNode)&&u.__reactInternalMemoizedMergedChildContext||Ir,mo=An.current,gn(An,u),gn(Gi,Gi.current),!0}function sh(u,d,B){var S=u.stateNode;if(!S)throw Error(o(169));B?(u=ih(u,d,mo),S.__reactInternalMemoizedMergedChildContext=u,kt(Gi),kt(An),gn(An,u)):kt(Gi),gn(Gi,B)}var ur=Math.clz32?Math.clz32:Cf,rh=Math.log,XG=Math.LN2;function Cf(u){return u>>>=0,u===0?32:31-(rh(u)/XG|0)|0}var ml=64,bl=4194304;function bo(u){switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return u&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return u}}function Jc(u,d){var B=u.pendingLanes;if(B===0)return 0;var S=0,x=u.suspendedLanes,F=u.pingedLanes,Q=B&268435455;if(Q!==0){var ce=Q&~x;ce!==0?S=bo(ce):(F&=Q,F!==0&&(S=bo(F)))}else Q=B&~x,Q!==0?S=bo(Q):F!==0&&(S=bo(F));if(S===0)return 0;if(d!==0&&d!==S&&!(d&x)&&(x=S&-S,F=d&-d,x>=F||x===16&&(F&4194240)!==0))return d;if(S&4&&(S|=B&16),d=u.entangledLanes,d!==0)for(u=u.entanglements,d&=S;0<d;)B=31-ur(d),x=1<<B,S|=u[B],d&=~x;return S}function df(u,d){switch(u){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function YG(u,d){for(var B=u.suspendedLanes,S=u.pingedLanes,x=u.expirationTimes,F=u.pendingLanes;0<F;){var Q=31-ur(F),ce=1<<Q,Re=x[Q];Re===-1?(!(ce&B)||ce&S)&&(x[Q]=df(ce,d)):Re<=d&&(u.expiredLanes|=ce),F&=~ce}}function Mu(u){return u=u.pendingLanes&-1073741825,u!==0?u:u&1073741824?1073741824:0}function Ku(u){for(var d=[],B=0;31>B;B++)d.push(u);return d}function Gl(u,d,B){u.pendingLanes|=d,d!==536870912&&(u.suspendedLanes=0,u.pingedLanes=0),u=u.eventTimes,d=31-ur(d),u[d]=B}function hf(u,d){var B=u.pendingLanes&~d;u.pendingLanes=d,u.suspendedLanes=0,u.pingedLanes=0,u.expiredLanes&=d,u.mutableReadLanes&=d,u.entangledLanes&=d,d=u.entanglements;var S=u.eventTimes;for(u=u.expirationTimes;0<B;){var x=31-ur(B),F=1<<x;d[x]=0,S[x]=-1,u[x]=-1,B&=~F}}function oh(u,d){var B=u.entangledLanes|=d;for(u=u.entanglements;B;){var S=31-ur(B),x=1<<S;x&d|u[S]&d&&(u[S]|=d),B&=~x}}var hn=0;function Af(u){return u&=-u,1<u?4<u?u&268435455?16:536870912:4:1}var Lu=s.unstable_scheduleCallback,pf=s.unstable_cancelCallback,FG=s.unstable_shouldYield,NG=s.unstable_requestPaint,Xi=s.unstable_now,Uc=s.unstable_ImmediatePriority,MG=s.unstable_UserBlockingPriority,gh=s.unstable_NormalPriority,KG=s.unstable_IdlePriority,zu=null,Go=null;function Hn(u){if(Go&&typeof Go.onCommitFiberRoot=="function")try{Go.onCommitFiberRoot(zu,u,void 0,(u.current.flags&128)===128)}catch{}}function Rn(u,d){return u===d&&(u!==0||1/u===1/d)||u!==u&&d!==d}var yo=typeof Object.is=="function"?Object.is:Rn,og=null,_u=!1,ah=!1;function ff(u){og===null?og=[u]:og.push(u)}function LG(u){_u=!0,ff(u)}function Kr(){if(!ah&&og!==null){ah=!0;var u=0,d=hn;try{var B=og;for(hn=1;u<B.length;u++){var S=B[u];do S=S(!0);while(S!==null)}og=null,_u=!1}catch(x){throw og!==null&&(og=og.slice(u+1)),Lu(Uc,Kr),x}finally{hn=d,ah=!1}}return null}var zG=g.ReactCurrentBatchConfig;function Ii(u,d){if(yo(u,d))return!0;if(typeof u!="object"||u===null||typeof d!="object"||d===null)return!1;var B=Object.keys(u),S=Object.keys(d);if(B.length!==S.length)return!1;for(S=0;S<B.length;S++){var x=B[S];if(!fo.call(d,x)||!yo(u[x],d[x]))return!1}return!0}function lh(u){switch(u.tag){case 5:return Dt(u.type);case 16:return Dt("Lazy");case 13:return Dt("Suspense");case 19:return Dt("SuspenseList");case 0:case 2:case 15:return u=Pn(u.type,!1),u;case 11:return u=Pn(u.type.render,!1),u;case 1:return u=Pn(u.type,!0),u;default:return""}}function zi(u,d){if(u&&u.defaultProps){d=r({},d),u=u.defaultProps;for(var B in u)d[B]===void 0&&(d[B]=u[B]);return d}return d}var Pc=cr(null),yl=null,_i=null,ku=null;function Tu(){ku=_i=yl=null}function ch(u,d,B){ke?(gn(Pc,d._currentValue),d._currentValue=B):(gn(Pc,d._currentValue2),d._currentValue2=B)}function Eu(u){var d=Pc.current;kt(Pc),ke?u._currentValue=d:u._currentValue2=d}function Du(u,d,B){for(;u!==null;){var S=u.alternate;if((u.childLanes&d)!==d?(u.childLanes|=d,S!==null&&(S.childLanes|=d)):S!==null&&(S.childLanes&d)!==d&&(S.childLanes|=d),u===B)break;u=u.return}}function ma(u,d){yl=u,ku=_i=null,u=u.dependencies,u!==null&&u.firstContext!==null&&(u.lanes&d&&(Js=!0),u.firstContext=null)}function Ln(u){var d=ke?u._currentValue:u._currentValue2;if(ku!==u)if(u={context:u,memoizedValue:d,next:null},_i===null){if(yl===null)throw Error(o(308));_i=u,yl.dependencies={lanes:0,firstContext:u}}else _i=_i.next=u;return d}var Bo=null,yi=!1;function Ih(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uh(u,d){u=u.updateQueue,d.updateQueue===u&&(d.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,effects:u.effects})}function qi(u,d){return{eventTime:u,lane:d,tag:0,payload:null,callback:null,next:null}}function Lr(u,d){var B=u.updateQueue;B!==null&&(B=B.shared,ui!==null&&u.mode&1&&!(Jt&2)?(u=B.interleaved,u===null?(d.next=d,Bo===null?Bo=[B]:Bo.push(B)):(d.next=u.next,u.next=d),B.interleaved=d):(u=B.pending,u===null?d.next=d:(d.next=u.next,u.next=d),B.pending=d))}function Bl(u,d,B){if(d=d.updateQueue,d!==null&&(d=d.shared,(B&4194240)!==0)){var S=d.lanes;S&=u.pendingLanes,B|=S,d.lanes=B,oh(u,B)}}function Xn(u,d){var B=u.updateQueue,S=u.alternate;if(S!==null&&(S=S.updateQueue,B===S)){var x=null,F=null;if(B=B.firstBaseUpdate,B!==null){do{var Q={eventTime:B.eventTime,lane:B.lane,tag:B.tag,payload:B.payload,callback:B.callback,next:null};F===null?x=F=Q:F=F.next=Q,B=B.next}while(B!==null);F===null?x=F=d:F=F.next=d}else x=F=d;B={baseState:S.baseState,firstBaseUpdate:x,lastBaseUpdate:F,shared:S.shared,effects:S.effects},u.updateQueue=B;return}u=B.lastBaseUpdate,u===null?B.firstBaseUpdate=d:u.next=d,B.lastBaseUpdate=d}function zr(u,d,B,S){var x=u.updateQueue;yi=!1;var F=x.firstBaseUpdate,Q=x.lastBaseUpdate,ce=x.shared.pending;if(ce!==null){x.shared.pending=null;var Re=ce,Je=Re.next;Re.next=null,Q===null?F=Je:Q.next=Je,Q=Re;var ut=u.alternate;ut!==null&&(ut=ut.updateQueue,ce=ut.lastBaseUpdate,ce!==Q&&(ce===null?ut.firstBaseUpdate=Je:ce.next=Je,ut.lastBaseUpdate=Re))}if(F!==null){var Mt=x.baseState;Q=0,ut=Je=Re=null,ce=F;do{var Bt=ce.lane,Gn=ce.eventTime;if((S&Bt)===Bt){ut!==null&&(ut=ut.next={eventTime:Gn,lane:0,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null});e:{var ht=u,os=ce;switch(Bt=d,Gn=B,os.tag){case 1:if(ht=os.payload,typeof ht=="function"){Mt=ht.call(Gn,Mt,Bt);break e}Mt=ht;break e;case 3:ht.flags=ht.flags&-65537|128;case 0:if(ht=os.payload,Bt=typeof ht=="function"?ht.call(Gn,Mt,Bt):ht,Bt==null)break e;Mt=r({},Mt,Bt);break e;case 2:yi=!0}}ce.callback!==null&&ce.lane!==0&&(u.flags|=64,Bt=x.effects,Bt===null?x.effects=[ce]:Bt.push(ce))}else Gn={eventTime:Gn,lane:Bt,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null},ut===null?(Je=ut=Gn,Re=Mt):ut=ut.next=Gn,Q|=Bt;if(ce=ce.next,ce===null){if(ce=x.shared.pending,ce===null)break;Bt=ce,ce=Bt.next,Bt.next=null,x.lastBaseUpdate=Bt,x.shared.pending=null}}while(1);if(ut===null&&(Re=Mt),x.baseState=Re,x.firstBaseUpdate=Je,x.lastBaseUpdate=ut,d=x.shared.interleaved,d!==null){x=d;do Q|=x.lane,x=x.next;while(x!==d)}else F===null&&(x.shared.lanes=0);El|=Q,u.lanes=Q,u.memoizedState=Mt}}function Ju(u,d,B){if(u=d.effects,d.effects=null,u!==null)for(d=0;d<u.length;d++){var S=u[d],x=S.callback;if(x!==null){if(S.callback=null,S=B,typeof x!="function")throw Error(o(191,x));x.call(S)}}}var mf=new n.Component().refs;function Oc(u,d,B,S){d=u.memoizedState,B=B(S,d),B=B==null?d:r({},d,B),u.memoizedState=B,u.lanes===0&&(u.updateQueue.baseState=B)}var Uu={isMounted:function(u){return(u=u._reactInternals)?Y(u)===u:!1},enqueueSetState:function(u,d,B){u=u._reactInternals;var S=ns(),x=xo(u),F=qi(S,x);F.payload=d,B!=null&&(F.callback=B),Lr(u,F),d=dr(u,x,S),d!==null&&Bl(d,u,x)},enqueueReplaceState:function(u,d,B){u=u._reactInternals;var S=ns(),x=xo(u),F=qi(S,x);F.tag=1,F.payload=d,B!=null&&(F.callback=B),Lr(u,F),d=dr(u,x,S),d!==null&&Bl(d,u,x)},enqueueForceUpdate:function(u,d){u=u._reactInternals;var B=ns(),S=xo(u),x=qi(B,S);x.tag=2,d!=null&&(x.callback=d),Lr(u,x),d=dr(u,S,B),d!==null&&Bl(d,u,S)}};function bf(u,d,B,S,x,F,Q){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(S,F,Q):d.prototype&&d.prototype.isPureReactComponent?!Ii(B,S)||!Ii(x,F):!0}function Gf(u,d,B){var S=!1,x=Ir,F=d.contextType;return typeof F=="object"&&F!==null?F=Ln(F):(x=Rs(d)?mo:An.current,S=d.contextTypes,F=(S=S!=null)?Mr(u,x):Ir),d=new d(B,F),u.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Uu,u.stateNode=d,d._reactInternals=u,S&&(u=u.stateNode,u.__reactInternalMemoizedUnmaskedChildContext=x,u.__reactInternalMemoizedMaskedChildContext=F),d}function Ch(u,d,B,S){u=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(B,S),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(B,S),d.state!==u&&Uu.enqueueReplaceState(d,d.state,null)}function vl(u,d,B,S){var x=u.stateNode;x.props=B,x.state=u.memoizedState,x.refs=mf,Ih(u);var F=d.contextType;typeof F=="object"&&F!==null?x.context=Ln(F):(F=Rs(d)?mo:An.current,x.context=Mr(u,F)),x.state=u.memoizedState,F=d.getDerivedStateFromProps,typeof F=="function"&&(Oc(u,d,F,B),x.state=u.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(d=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),d!==x.state&&Uu.enqueueReplaceState(x,x.state,null),zr(u,B,x,S),x.state=u.memoizedState),typeof x.componentDidMount=="function"&&(u.flags|=4194308)}var _r=[],Zl=0,Qc=null,jc=0,Ws=[],xs=0,Mg=null,gg=1,kr="";function ag(u,d){_r[Zl++]=jc,_r[Zl++]=Qc,Qc=u,jc=d}function yf(u,d,B){Ws[xs++]=gg,Ws[xs++]=kr,Ws[xs++]=Mg,Mg=u;var S=gg;u=kr;var x=32-ur(S)-1;S&=~(1<<x),B+=1;var F=32-ur(d)+x;if(30<F){var Q=x-x%5;F=(S&(1<<Q)-1).toString(32),S>>=Q,x-=Q,gg=1<<32-ur(d)+x|B<<x|S,kr=F+u}else gg=1<<F|B<<x|S,kr=u}function Pu(u){u.return!==null&&(ag(u,1),yf(u,1,0))}function ds(u){for(;u===Qc;)Qc=_r[--Zl],_r[Zl]=null,jc=_r[--Zl],_r[Zl]=null;for(;u===Mg;)Mg=Ws[--xs],Ws[xs]=null,kr=Ws[--xs],Ws[xs]=null,gg=Ws[--xs],Ws[xs]=null}var hs=null,ki=null,Yn=!1,wl=!1,Tr=null;function Bf(u,d){var B=hr(5,null,null,0);B.elementType="DELETED",B.stateNode=d,B.return=u,d=u.deletions,d===null?(u.deletions=[B],u.flags|=16):d.push(B)}function vf(u,d){switch(u.tag){case 5:return d=ws(d,u.type,u.pendingProps),d!==null?(u.stateNode=d,hs=u,ki=He(d),!0):!1;case 6:return d=pl(d,u.pendingProps),d!==null?(u.stateNode=d,hs=u,ki=null,!0):!1;case 13:if(d=nh(d),d!==null){var B=Mg!==null?{id:gg,overflow:kr}:null;return u.memoizedState={dehydrated:d,treeContext:B,retryLane:1073741824},B=hr(18,null,null,0),B.stateNode=d,B.return=u,u.child=B,hs=u,ki=null,!0}return!1;default:return!1}}function dh(u){return(u.mode&1)!==0&&(u.flags&128)===0}function hh(u){if(Yn){var d=ki;if(d){var B=d;if(!vf(u,d)){if(dh(u))throw Error(o(418));d=Ge(B);var S=hs;d&&vf(u,d)?Bf(S,B):(u.flags=u.flags&-4097|2,Yn=!1,hs=u)}}else{if(dh(u))throw Error(o(418));u.flags=u.flags&-4097|2,Yn=!1,hs=u}}}function ba(u){for(u=u.return;u!==null&&u.tag!==5&&u.tag!==3&&u.tag!==13;)u=u.return;hs=u}function qc(u){if(!be||u!==hs)return!1;if(!Yn)return ba(u),Yn=!0,!1;if(u.tag!==3&&(u.tag!==5||Cs(u.type)&&!We(u.type,u.memoizedProps))){var d=ki;if(d){if(dh(u)){for(u=ki;u;)u=Ge(u);throw Error(o(418))}for(;d;)Bf(u,d),d=Ge(d)}}if(ba(u),u.tag===13){if(!be)throw Error(o(316));if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));ki=Qt(u)}else ki=hs?Ge(u.stateNode):null;return!0}function Sl(){be&&(ki=hs=null,wl=Yn=!1)}function $c(u){Tr===null?Tr=[u]:Tr.push(u)}function Rl(u,d,B){if(u=B.ref,u!==null&&typeof u!="function"&&typeof u!="object"){if(B._owner){if(B=B._owner,B){if(B.tag!==1)throw Error(o(309));var S=B.stateNode}if(!S)throw Error(o(147,u));var x=S,F=""+u;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===F?d.ref:(d=function(Q){var ce=x.refs;ce===mf&&(ce=x.refs={}),Q===null?delete ce[F]:ce[F]=Q},d._stringRef=F,d)}if(typeof u!="string")throw Error(o(284));if(!B._owner)throw Error(o(290,u))}return u}function Er(u,d){throw u=Object.prototype.toString.call(d),Error(o(31,u==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":u))}function eI(u){var d=u._init;return d(u._payload)}function Zf(u){function d(fe,Ce){if(u){var Ze=fe.deletions;Ze===null?(fe.deletions=[Ce],fe.flags|=16):Ze.push(Ce)}}function B(fe,Ce){if(!u)return null;for(;Ce!==null;)d(fe,Ce),Ce=Ce.sibling;return null}function S(fe,Ce){for(fe=new Map;Ce!==null;)Ce.key!==null?fe.set(Ce.key,Ce):fe.set(Ce.index,Ce),Ce=Ce.sibling;return fe}function x(fe,Ce){return fe=Cg(fe,Ce),fe.index=0,fe.sibling=null,fe}function F(fe,Ce,Ze){return fe.index=Ze,u?(Ze=fe.alternate,Ze!==null?(Ze=Ze.index,Ze<Ce?(fe.flags|=2,Ce):Ze):(fe.flags|=2,Ce)):(fe.flags|=1048576,Ce)}function Q(fe){return u&&fe.alternate===null&&(fe.flags|=2),fe}function ce(fe,Ce,Ze,ot){return Ce===null||Ce.tag!==6?(Ce=rs(Ze,fe.mode,ot),Ce.return=fe,Ce):(Ce=x(Ce,Ze),Ce.return=fe,Ce)}function Re(fe,Ce,Ze,ot){var At=Ze.type;return At===c?ut(fe,Ce,Ze.props.children,ot,Ze.key):Ce!==null&&(Ce.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===G&&eI(At)===Ce.type)?(ot=x(Ce,Ze.props),ot.ref=Rl(fe,Ce,Ze),ot.return=fe,ot):(ot=dC(Ze.type,Ze.key,Ze.props,null,fe.mode,ot),ot.ref=Rl(fe,Ce,Ze),ot.return=fe,ot)}function Je(fe,Ce,Ze,ot){return Ce===null||Ce.tag!==4||Ce.stateNode.containerInfo!==Ze.containerInfo||Ce.stateNode.implementation!==Ze.implementation?(Ce=Ar(Ze,fe.mode,ot),Ce.return=fe,Ce):(Ce=x(Ce,Ze.children||[]),Ce.return=fe,Ce)}function ut(fe,Ce,Ze,ot,At){return Ce===null||Ce.tag!==7?(Ce=jg(Ze,fe.mode,ot,At),Ce.return=fe,Ce):(Ce=x(Ce,Ze),Ce.return=fe,Ce)}function Mt(fe,Ce,Ze){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return Ce=rs(""+Ce,fe.mode,Ze),Ce.return=fe,Ce;if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case a:return Ze=dC(Ce.type,Ce.key,Ce.props,null,fe.mode,Ze),Ze.ref=Rl(fe,null,Ce),Ze.return=fe,Ze;case l:return Ce=Ar(Ce,fe.mode,Ze),Ce.return=fe,Ce;case G:var ot=Ce._init;return Mt(fe,ot(Ce._payload),Ze)}if(ie(Ce)||V(Ce))return Ce=jg(Ce,fe.mode,Ze,null),Ce.return=fe,Ce;Er(fe,Ce)}return null}function Bt(fe,Ce,Ze,ot){var At=Ce!==null?Ce.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return At!==null?null:ce(fe,Ce,""+Ze,ot);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case a:return Ze.key===At?Re(fe,Ce,Ze,ot):null;case l:return Ze.key===At?Je(fe,Ce,Ze,ot):null;case G:return At=Ze._init,Bt(fe,Ce,At(Ze._payload),ot)}if(ie(Ze)||V(Ze))return At!==null?null:ut(fe,Ce,Ze,ot,null);Er(fe,Ze)}return null}function Gn(fe,Ce,Ze,ot,At){if(typeof ot=="string"&&ot!==""||typeof ot=="number")return fe=fe.get(Ze)||null,ce(Ce,fe,""+ot,At);if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case a:return fe=fe.get(ot.key===null?Ze:ot.key)||null,Re(Ce,fe,ot,At);case l:return fe=fe.get(ot.key===null?Ze:ot.key)||null,Je(Ce,fe,ot,At);case G:var Ut=ot._init;return Gn(fe,Ce,Ze,Ut(ot._payload),At)}if(ie(ot)||V(ot))return fe=fe.get(Ze)||null,ut(Ce,fe,ot,At,null);Er(Ce,ot)}return null}function ht(fe,Ce,Ze,ot){for(var At=null,Ut=null,Kt=Ce,Pt=Ce=0,di=null;Kt!==null&&Pt<Ze.length;Pt++){Kt.index>Pt?(di=Kt,Kt=null):di=Kt.sibling;var an=Bt(fe,Kt,Ze[Pt],ot);if(an===null){Kt===null&&(Kt=di);break}u&&Kt&&an.alternate===null&&d(fe,Kt),Ce=F(an,Ce,Pt),Ut===null?At=an:Ut.sibling=an,Ut=an,Kt=di}if(Pt===Ze.length)return B(fe,Kt),Yn&&ag(fe,Pt),At;if(Kt===null){for(;Pt<Ze.length;Pt++)Kt=Mt(fe,Ze[Pt],ot),Kt!==null&&(Ce=F(Kt,Ce,Pt),Ut===null?At=Kt:Ut.sibling=Kt,Ut=Kt);return Yn&&ag(fe,Pt),At}for(Kt=S(fe,Kt);Pt<Ze.length;Pt++)di=Gn(Kt,fe,Pt,Ze[Pt],ot),di!==null&&(u&&di.alternate!==null&&Kt.delete(di.key===null?Pt:di.key),Ce=F(di,Ce,Pt),Ut===null?At=di:Ut.sibling=di,Ut=di);return u&&Kt.forEach(function(Ho){return d(fe,Ho)}),Yn&&ag(fe,Pt),At}function os(fe,Ce,Ze,ot){var At=V(Ze);if(typeof At!="function")throw Error(o(150));if(Ze=At.call(Ze),Ze==null)throw Error(o(151));for(var Ut=At=null,Kt=Ce,Pt=Ce=0,di=null,an=Ze.next();Kt!==null&&!an.done;Pt++,an=Ze.next()){Kt.index>Pt?(di=Kt,Kt=null):di=Kt.sibling;var Ho=Bt(fe,Kt,an.value,ot);if(Ho===null){Kt===null&&(Kt=di);break}u&&Kt&&Ho.alternate===null&&d(fe,Kt),Ce=F(Ho,Ce,Pt),Ut===null?At=Ho:Ut.sibling=Ho,Ut=Ho,Kt=di}if(an.done)return B(fe,Kt),Yn&&ag(fe,Pt),At;if(Kt===null){for(;!an.done;Pt++,an=Ze.next())an=Mt(fe,an.value,ot),an!==null&&(Ce=F(an,Ce,Pt),Ut===null?At=an:Ut.sibling=an,Ut=an);return Yn&&ag(fe,Pt),At}for(Kt=S(fe,Kt);!an.done;Pt++,an=Ze.next())an=Gn(Kt,fe,Pt,an.value,ot),an!==null&&(u&&an.alternate!==null&&Kt.delete(an.key===null?Pt:an.key),Ce=F(an,Ce,Pt),Ut===null?At=an:Ut.sibling=an,Ut=an);return u&&Kt.forEach(function(AC){return d(fe,AC)}),Yn&&ag(fe,Pt),At}function js(fe,Ce,Ze,ot){if(typeof Ze=="object"&&Ze!==null&&Ze.type===c&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case a:e:{for(var At=Ze.key,Ut=Ce;Ut!==null;){if(Ut.key===At){if(At=Ze.type,At===c){if(Ut.tag===7){B(fe,Ut.sibling),Ce=x(Ut,Ze.props.children),Ce.return=fe,fe=Ce;break e}}else if(Ut.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===G&&eI(At)===Ut.type){B(fe,Ut.sibling),Ce=x(Ut,Ze.props),Ce.ref=Rl(fe,Ut,Ze),Ce.return=fe,fe=Ce;break e}B(fe,Ut);break}else d(fe,Ut);Ut=Ut.sibling}Ze.type===c?(Ce=jg(Ze.props.children,fe.mode,ot,Ze.key),Ce.return=fe,fe=Ce):(ot=dC(Ze.type,Ze.key,Ze.props,null,fe.mode,ot),ot.ref=Rl(fe,Ce,Ze),ot.return=fe,fe=ot)}return Q(fe);case l:e:{for(Ut=Ze.key;Ce!==null;){if(Ce.key===Ut)if(Ce.tag===4&&Ce.stateNode.containerInfo===Ze.containerInfo&&Ce.stateNode.implementation===Ze.implementation){B(fe,Ce.sibling),Ce=x(Ce,Ze.children||[]),Ce.return=fe,fe=Ce;break e}else{B(fe,Ce);break}else d(fe,Ce);Ce=Ce.sibling}Ce=Ar(Ze,fe.mode,ot),Ce.return=fe,fe=Ce}return Q(fe);case G:return Ut=Ze._init,js(fe,Ce,Ut(Ze._payload),ot)}if(ie(Ze))return ht(fe,Ce,Ze,ot);if(V(Ze))return os(fe,Ce,Ze,ot);Er(fe,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,Ce!==null&&Ce.tag===6?(B(fe,Ce.sibling),Ce=x(Ce,Ze),Ce.return=fe,fe=Ce):(B(fe,Ce),Ce=rs(Ze,fe.mode,ot),Ce.return=fe,fe=Ce),Q(fe)):B(fe,Ce)}return js}var Wl=Zf(!0),wf=Zf(!1),vo={},On=cr(vo),xl=cr(vo),Vl=cr(vo);function Zo(u){if(u===vo)throw Error(o(174));return u}function Ah(u,d){gn(Vl,d),gn(xl,u),gn(On,vo),u=le(d),kt(On),gn(On,u)}function Hl(){kt(On),kt(xl),kt(Vl)}function Sf(u){var d=Zo(Vl.current),B=Zo(On.current);d=_(B,u.type,d),B!==d&&(gn(xl,u),gn(On,d))}function Kg(u){xl.current===u&&(kt(On),kt(xl))}var ae=cr(0);function xe(u){for(var d=u;d!==null;){if(d.tag===13){var B=d.memoizedState;if(B!==null&&(B=B.dehydrated,B===null||fl(B)||Tc(B)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if(d.flags&128)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var Be=[];function lt(){for(var u=0;u<Be.length;u++){var d=Be[u];ke?d._workInProgressVersionPrimary=null:d._workInProgressVersionSecondary=null}Be.length=0}var Ft=g.ReactCurrentDispatcher,Lt=g.ReactCurrentBatchConfig,zn=0,Vt=null,Yi=null,Fi=null,As=!1,Lg=!1,tI=0,Xl=0;function Bi(){throw Error(o(321))}function Yl(u,d){if(d===null)return!1;for(var B=0;B<d.length&&B<u.length;B++)if(!yo(u[B],d[B]))return!1;return!0}function pn(u,d,B,S,x,F){if(zn=F,Vt=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Ft.current=u===null||u.memoizedState===null?lI:Bh,u=B(S,x),Lg){F=0;do{if(Lg=!1,tI=0,25<=F)throw Error(o(301));F+=1,Fi=Yi=null,d.updateQueue=null,Ft.current=Ml,u=B(S,x)}while(Lg)}if(Ft.current=Nl,d=Yi!==null&&Yi.next!==null,zn=0,Fi=Yi=Vt=null,As=!1,d)throw Error(o(300));return u}function ph(){var u=tI!==0;return tI=0,u}function wo(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fi===null?Vt.memoizedState=Fi=u:Fi=Fi.next=u,Fi}function Ds(){if(Yi===null){var u=Vt.alternate;u=u!==null?u.memoizedState:null}else u=Yi.next;var d=Fi===null?Vt.memoizedState:Fi.next;if(d!==null)Fi=d,Yi=u;else{if(u===null)throw Error(o(310));Yi=u,u={memoizedState:Yi.memoizedState,baseState:Yi.baseState,baseQueue:Yi.baseQueue,queue:Yi.queue,next:null},Fi===null?Vt.memoizedState=Fi=u:Fi=Fi.next=u}return Fi}function Ga(u,d){return typeof d=="function"?d(u):d}function Ou(u){var d=Ds(),B=d.queue;if(B===null)throw Error(o(311));B.lastRenderedReducer=u;var S=Yi,x=S.baseQueue,F=B.pending;if(F!==null){if(x!==null){var Q=x.next;x.next=F.next,F.next=Q}S.baseQueue=x=F,B.pending=null}if(x!==null){F=x.next,S=S.baseState;var ce=Q=null,Re=null,Je=F;do{var ut=Je.lane;if((zn&ut)===ut)Re!==null&&(Re=Re.next={lane:0,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null}),S=Je.hasEagerState?Je.eagerState:u(S,Je.action);else{var Mt={lane:ut,action:Je.action,hasEagerState:Je.hasEagerState,eagerState:Je.eagerState,next:null};Re===null?(ce=Re=Mt,Q=S):Re=Re.next=Mt,Vt.lanes|=ut,El|=ut}Je=Je.next}while(Je!==null&&Je!==F);Re===null?Q=S:Re.next=ce,yo(S,d.memoizedState)||(Js=!0),d.memoizedState=S,d.baseState=Q,d.baseQueue=Re,B.lastRenderedState=S}if(u=B.interleaved,u!==null){x=u;do F=x.lane,Vt.lanes|=F,El|=F,x=x.next;while(x!==u)}else x===null&&(B.lanes=0);return[d.memoizedState,B.dispatch]}function Qu(u){var d=Ds(),B=d.queue;if(B===null)throw Error(o(311));B.lastRenderedReducer=u;var S=B.dispatch,x=B.pending,F=d.memoizedState;if(x!==null){B.pending=null;var Q=x=x.next;do F=u(F,Q.action),Q=Q.next;while(Q!==x);yo(F,d.memoizedState)||(Js=!0),d.memoizedState=F,d.baseQueue===null&&(d.baseState=F),B.lastRenderedState=F}return[F,S]}function nI(){}function lg(u,d){var B=Vt,S=Ds(),x=d(),F=!yo(S.memoizedState,x);if(F&&(S.memoizedState=x,Js=!0),S=S.queue,rI(sI.bind(null,B,S,u),[u]),S.getSnapshot!==d||F||Fi!==null&&Fi.memoizedState.tag&1){if(B.flags|=2048,zg(9,fh.bind(null,B,S,x,d),void 0,null),ui===null)throw Error(o(349));zn&30||iI(B,d,x)}return x}function iI(u,d,B){u.flags|=16384,u={getSnapshot:d,value:B},d=Vt.updateQueue,d===null?(d={lastEffect:null,stores:null},Vt.updateQueue=d,d.stores=[u]):(B=d.stores,B===null?d.stores=[u]:B.push(u))}function fh(u,d,B,S){d.value=B,d.getSnapshot=S,mh(d)&&dr(u,1,-1)}function sI(u,d,B){return B(function(){mh(d)&&dr(u,1,-1)})}function mh(u){var d=u.getSnapshot;u=u.value;try{var B=d();return!yo(u,B)}catch{return!0}}function ju(u){var d=wo();return typeof u=="function"&&(u=u()),d.memoizedState=d.baseState=u,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ga,lastRenderedState:u},d.queue=u,u=u.dispatch=$i.bind(null,Vt,u),[d.memoizedState,u]}function zg(u,d,B,S){return u={tag:u,create:d,destroy:B,deps:S,next:null},d=Vt.updateQueue,d===null?(d={lastEffect:null,stores:null},Vt.updateQueue=d,d.lastEffect=u.next=u):(B=d.lastEffect,B===null?d.lastEffect=u.next=u:(S=B.next,B.next=u,u.next=S,d.lastEffect=u)),u}function bh(){return Ds().memoizedState}function _g(u,d,B,S){var x=wo();Vt.flags|=u,x.memoizedState=zg(1|d,B,void 0,S===void 0?null:S)}function So(u,d,B,S){var x=Ds();S=S===void 0?null:S;var F=void 0;if(Yi!==null){var Q=Yi.memoizedState;if(F=Q.destroy,S!==null&&Yl(S,Q.deps)){x.memoizedState=zg(d,B,F,S);return}}Vt.flags|=u,x.memoizedState=zg(1|d,B,F,S)}function Fl(u,d){return _g(8390656,8,u,d)}function rI(u,d){return So(2048,8,u,d)}function Rf(u,d){return So(4,2,u,d)}function Wf(u,d){return So(4,4,u,d)}function oI(u,d){if(typeof d=="function")return u=u(),d(u),function(){d(null)};if(d!=null)return u=u(),d.current=u,function(){d.current=null}}function gI(u,d,B){return B=B!=null?B.concat([u]):null,So(4,4,oI.bind(null,d,u),B)}function aI(){}function xf(u,d){var B=Ds();d=d===void 0?null:d;var S=B.memoizedState;return S!==null&&d!==null&&Yl(d,S[1])?S[0]:(B.memoizedState=[u,d],u)}function Gh(u,d){var B=Ds();d=d===void 0?null:d;var S=B.memoizedState;return S!==null&&d!==null&&Yl(d,S[1])?S[0]:(u=u(),B.memoizedState=[u,d],u)}function _G(u,d){var B=hn;hn=B!==0&&4>B?B:4,u(!0);var S=Lt.transition;Lt.transition={};try{u(!1),d()}finally{hn=B,Lt.transition=S}}function Vf(){return Ds().memoizedState}function vi(u,d,B){var S=xo(u);B={lane:S,action:B,hasEagerState:!1,eagerState:null,next:null},Hf(u)?Xf(d,B):(yh(u,d,B),B=ns(),u=dr(u,S,B),u!==null&&Yf(u,d,S))}function $i(u,d,B){var S=xo(u),x={lane:S,action:B,hasEagerState:!1,eagerState:null,next:null};if(Hf(u))Xf(d,x);else{yh(u,d,x);var F=u.alternate;if(u.lanes===0&&(F===null||F.lanes===0)&&(F=d.lastRenderedReducer,F!==null))try{var Q=d.lastRenderedState,ce=F(Q,B);if(x.hasEagerState=!0,x.eagerState=ce,yo(ce,Q))return}catch{}finally{}B=ns(),u=dr(u,S,B),u!==null&&Yf(u,d,S)}}function Hf(u){var d=u.alternate;return u===Vt||d!==null&&d===Vt}function Xf(u,d){Lg=As=!0;var B=u.pending;B===null?d.next=d:(d.next=B.next,B.next=d),u.pending=d}function yh(u,d,B){ui!==null&&u.mode&1&&!(Jt&2)?(u=d.interleaved,u===null?(B.next=B,Bo===null?Bo=[d]:Bo.push(d)):(B.next=u.next,u.next=B),d.interleaved=B):(u=d.pending,u===null?B.next=B:(B.next=u.next,u.next=B),d.pending=B)}function Yf(u,d,B){if(B&4194240){var S=d.lanes;S&=u.pendingLanes,B|=S,d.lanes=B,oh(u,B)}}var Nl={readContext:Ln,useCallback:Bi,useContext:Bi,useEffect:Bi,useImperativeHandle:Bi,useInsertionEffect:Bi,useLayoutEffect:Bi,useMemo:Bi,useReducer:Bi,useRef:Bi,useState:Bi,useDebugValue:Bi,useDeferredValue:Bi,useTransition:Bi,useMutableSource:Bi,useSyncExternalStore:Bi,useId:Bi,unstable_isNewReconciler:!1},lI={readContext:Ln,useCallback:function(u,d){return wo().memoizedState=[u,d===void 0?null:d],u},useContext:Ln,useEffect:Fl,useImperativeHandle:function(u,d,B){return B=B!=null?B.concat([u]):null,_g(4194308,4,oI.bind(null,d,u),B)},useLayoutEffect:function(u,d){return _g(4194308,4,u,d)},useInsertionEffect:function(u,d){return _g(4,2,u,d)},useMemo:function(u,d){var B=wo();return d=d===void 0?null:d,u=u(),B.memoizedState=[u,d],u},useReducer:function(u,d,B){var S=wo();return d=B!==void 0?B(d):d,S.memoizedState=S.baseState=d,u={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:d},S.queue=u,u=u.dispatch=vi.bind(null,Vt,u),[S.memoizedState,u]},useRef:function(u){var d=wo();return u={current:u},d.memoizedState=u},useState:ju,useDebugValue:aI,useDeferredValue:function(u){var d=ju(u),B=d[0],S=d[1];return Fl(function(){var x=Lt.transition;Lt.transition={};try{S(u)}finally{Lt.transition=x}},[u]),B},useTransition:function(){var u=ju(!1),d=u[0];return u=_G.bind(null,u[1]),wo().memoizedState=u,[d,u]},useMutableSource:function(){},useSyncExternalStore:function(u,d,B){var S=Vt,x=wo();if(Yn){if(B===void 0)throw Error(o(407));B=B()}else{if(B=d(),ui===null)throw Error(o(349));zn&30||iI(S,d,B)}x.memoizedState=B;var F={value:B,getSnapshot:d};return x.queue=F,Fl(sI.bind(null,S,F,u),[u]),S.flags|=2048,zg(9,fh.bind(null,S,F,B,d),void 0,null),B},useId:function(){var u=wo(),d=ui.identifierPrefix;if(Yn){var B=kr,S=gg;B=(S&~(1<<32-ur(S)-1)).toString(32)+B,d=":"+d+"R"+B,B=tI++,0<B&&(d+="H"+B.toString(32)),d+=":"}else B=Xl++,d=":"+d+"r"+B.toString(32)+":";return u.memoizedState=d},unstable_isNewReconciler:!1},Bh={readContext:Ln,useCallback:xf,useContext:Ln,useEffect:rI,useImperativeHandle:gI,useInsertionEffect:Rf,useLayoutEffect:Wf,useMemo:Gh,useReducer:Ou,useRef:bh,useState:function(){return Ou(Ga)},useDebugValue:aI,useDeferredValue:function(u){var d=Ou(Ga),B=d[0],S=d[1];return rI(function(){var x=Lt.transition;Lt.transition={};try{S(u)}finally{Lt.transition=x}},[u]),B},useTransition:function(){var u=Ou(Ga)[0],d=Ds().memoizedState;return[u,d]},useMutableSource:nI,useSyncExternalStore:lg,useId:Vf,unstable_isNewReconciler:!1},Ml={readContext:Ln,useCallback:xf,useContext:Ln,useEffect:rI,useImperativeHandle:gI,useInsertionEffect:Rf,useLayoutEffect:Wf,useMemo:Gh,useReducer:Qu,useRef:bh,useState:function(){return Qu(Ga)},useDebugValue:aI,useDeferredValue:function(u){var d=Qu(Ga),B=d[0],S=d[1];return rI(function(){var x=Lt.transition;Lt.transition={};try{S(u)}finally{Lt.transition=x}},[u]),B},useTransition:function(){var u=Qu(Ga)[0],d=Ds().memoizedState;return[u,d]},useMutableSource:nI,useSyncExternalStore:lg,useId:Vf,unstable_isNewReconciler:!1};function ya(u,d){try{var B="",S=d;do B+=lh(S),S=S.return;while(S);var x=B}catch(F){x=`
Error generating stack: `+F.message+`
`+F.stack}return{value:u,source:d,stack:x}}function Ba(u,d){try{console.error(d.value)}catch(B){setTimeout(function(){throw B})}}var qu=typeof WeakMap=="function"?WeakMap:Map;function va(u,d,B){B=qi(-1,B),B.tag=3,B.payload={element:null};var S=d.value;return B.callback=function(){pI||(pI=!0,oC=S),Ba(u,d)},B}function Ff(u,d,B){B=qi(-1,B),B.tag=3;var S=u.type.getDerivedStateFromError;if(typeof S=="function"){var x=d.value;B.payload=function(){return S(x)},B.callback=function(){Ba(u,d)}}var F=u.stateNode;return F!==null&&typeof F.componentDidCatch=="function"&&(B.callback=function(){Ba(u,d),typeof S!="function"&&(Or===null?Or=new Set([this]):Or.add(this));var Q=d.stack;this.componentDidCatch(d.value,{componentStack:Q!==null?Q:""})}),B}function Nf(u,d,B){var S=u.pingCache;if(S===null){S=u.pingCache=new qu;var x=new Set;S.set(d,x)}else x=S.get(d),x===void 0&&(x=new Set,S.set(d,x));x.has(B)||(x.add(B),u=Og.bind(null,u,d,B),d.then(u,u))}function Mf(u){do{var d;if((d=u.tag===13)&&(d=u.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return u;u=u.return}while(u!==null);return null}function Kf(u,d,B,S,x){return u.mode&1?(u.flags|=65536,u.lanes=x,u):(u===d?u.flags|=65536:(u.flags|=128,B.flags|=131072,B.flags&=-52805,B.tag===1&&(B.alternate===null?B.tag=17:(d=qi(-1,1),d.tag=2,Lr(B,d))),B.lanes|=1),u)}function Ro(u){u.flags|=4}function cI(u,d){if(u!==null&&u.child===d.child)return!0;if(d.flags&16)return!1;for(u=d.child;u!==null;){if(u.flags&12854||u.subtreeFlags&12854)return!1;u=u.sibling}return!0}var cg,Kl,K,Ig;if(je)cg=function(u,d){for(var B=d.child;B!==null;){if(B.tag===5||B.tag===6)se(u,B.stateNode);else if(B.tag!==4&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===d)break;for(;B.sibling===null;){if(B.return===null||B.return===d)return;B=B.return}B.sibling.return=B.return,B=B.sibling}},Kl=function(){},K=function(u,d,B,S,x){if(u=u.memoizedProps,u!==S){var F=d.stateNode,Q=Zo(On.current);B=Ae(F,B,u,S,x,Q),(d.updateQueue=B)&&Ro(d)}},Ig=function(u,d,B,S){B!==S&&Ro(d)};else if(ve){cg=function(u,d,B,S){for(var x=d.child;x!==null;){if(x.tag===5){var F=x.stateNode;B&&S&&(F=Bn(F,x.type,x.memoizedProps,x)),se(u,F)}else if(x.tag===6)F=x.stateNode,B&&S&&(F=lr(F,x.memoizedProps,x)),se(u,F);else if(x.tag!==4){if(x.tag===22&&x.memoizedState!==null)F=x.child,F!==null&&(F.return=x),cg(u,x,!0,!0);else if(x.child!==null){x.child.return=x,x=x.child;continue}}if(x===d)break;for(;x.sibling===null;){if(x.return===null||x.return===d)return;x=x.return}x.sibling.return=x.return,x=x.sibling}};var II=function(u,d,B,S){for(var x=d.child;x!==null;){if(x.tag===5){var F=x.stateNode;B&&S&&(F=Bn(F,x.type,x.memoizedProps,x)),$n(u,F)}else if(x.tag===6)F=x.stateNode,B&&S&&(F=lr(F,x.memoizedProps,x)),$n(u,F);else if(x.tag!==4){if(x.tag===22&&x.memoizedState!==null)F=x.child,F!==null&&(F.return=x),II(u,x,!0,!0);else if(x.child!==null){x.child.return=x,x=x.child;continue}}if(x===d)break;for(;x.sibling===null;){if(x.return===null||x.return===d)return;x=x.return}x.sibling.return=x.return,x=x.sibling}};Kl=function(u,d){var B=d.stateNode;if(!cI(u,d)){u=B.containerInfo;var S=cn(u);II(S,d,!1,!1),B.pendingChildren=S,Ro(d),Hi(u,S)}},K=function(u,d,B,S,x){var F=u.stateNode,Q=u.memoizedProps;if((u=cI(u,d))&&Q===S)d.stateNode=F;else{var ce=d.stateNode,Re=Zo(On.current),Je=null;Q!==S&&(Je=Ae(ce,B,Q,S,x,Re)),u&&Je===null?d.stateNode=F:(F=bt(F,Je,B,Q,S,d,u,ce),ue(F,B,S,x,Re)&&Ro(d),d.stateNode=F,u?Ro(d):cg(F,d,!1,!1))}},Ig=function(u,d,B,S){B!==S?(u=Zo(Vl.current),B=Zo(On.current),d.stateNode=me(S,u,B,d),Ro(d)):d.stateNode=u.stateNode}}else Kl=function(){},K=function(){},Ig=function(){};function es(u,d){if(!Yn)switch(u.tailMode){case"hidden":d=u.tail;for(var B=null;d!==null;)d.alternate!==null&&(B=d),d=d.sibling;B===null?u.tail=null:B.sibling=null;break;case"collapsed":B=u.tail;for(var S=null;B!==null;)B.alternate!==null&&(S=B),B=B.sibling;S===null?d||u.tail===null?u.tail=null:u.tail.sibling=null:S.sibling=null}}function Wt(u){var d=u.alternate!==null&&u.alternate.child===u.child,B=0,S=0;if(d)for(var x=u.child;x!==null;)B|=x.lanes|x.childLanes,S|=x.subtreeFlags&14680064,S|=x.flags&14680064,x.return=u,x=x.sibling;else for(x=u.child;x!==null;)B|=x.lanes|x.childLanes,S|=x.subtreeFlags,S|=x.flags,x.return=u,x=x.sibling;return u.subtreeFlags|=S,u.childLanes=B,d}function kG(u,d,B){var S=d.pendingProps;switch(ds(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(d),null;case 1:return Rs(d.type)&&Ec(),Wt(d),null;case 3:return S=d.stateNode,Hl(),kt(Gi),kt(An),lt(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(u===null||u.child===null)&&(qc(d)?Ro(d):u===null||u.memoizedState.isDehydrated&&!(d.flags&256)||(d.flags|=1024,Tr!==null&&(Wa(Tr),Tr=null))),Kl(u,d),Wt(d),null;case 5:Kg(d),B=Zo(Vl.current);var x=d.type;if(u!==null&&d.stateNode!=null)K(u,d,x,S,B),u.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!S){if(d.stateNode===null)throw Error(o(166));return Wt(d),null}if(u=Zo(On.current),qc(d)){if(!be)throw Error(o(175));u=St(d.stateNode,d.type,d.memoizedProps,B,u,d,!wl),d.updateQueue=u,u!==null&&Ro(d)}else{var F=q(x,S,B,u,d);cg(F,d,!1,!1),d.stateNode=F,ue(F,x,S,B,u)&&Ro(d)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return Wt(d),null;case 6:if(u&&d.stateNode!=null)Ig(u,d,u.memoizedProps,S);else{if(typeof S!="string"&&d.stateNode===null)throw Error(o(166));if(u=Zo(Vl.current),B=Zo(On.current),qc(d)){if(!be)throw Error(o(176));if(u=d.stateNode,S=d.memoizedProps,(B=Nt(u,S,d,!wl))&&(x=hs,x!==null))switch(F=(x.mode&1)!==0,x.tag){case 3:Ss(x.stateNode.containerInfo,u,S,F);break;case 5:rg(x.type,x.memoizedProps,x.stateNode,u,S,F)}B&&Ro(d)}else d.stateNode=me(S,u,B,d)}return Wt(d),null;case 13:if(kt(ae),S=d.memoizedState,Yn&&ki!==null&&d.mode&1&&!(d.flags&128)){for(u=ki;u;)u=Ge(u);return Sl(),d.flags|=98560,d}if(S!==null&&S.dehydrated!==null){if(S=qc(d),u===null){if(!S)throw Error(o(318));if(!be)throw Error(o(344));if(u=d.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));_t(u,d)}else Sl(),!(d.flags&128)&&(d.memoizedState=null),d.flags|=4;return Wt(d),null}return Tr!==null&&(Wa(Tr),Tr=null),d.flags&128?(d.lanes=B,d):(S=S!==null,B=!1,u===null?qc(d):B=u.memoizedState!==null,S&&!B&&(d.child.flags|=8192,d.mode&1&&(u===null||ae.current&1?ni===0&&(ni=3):IC())),d.updateQueue!==null&&(d.flags|=4),Wt(d),null);case 4:return Hl(),Kl(u,d),u===null&&qe(d.stateNode.containerInfo),Wt(d),null;case 10:return Eu(d.type._context),Wt(d),null;case 17:return Rs(d.type)&&Ec(),Wt(d),null;case 19:if(kt(ae),x=d.memoizedState,x===null)return Wt(d),null;if(S=(d.flags&128)!==0,F=x.rendering,F===null)if(S)es(x,!1);else{if(ni!==0||u!==null&&u.flags&128)for(u=d.child;u!==null;){if(F=xe(u),F!==null){for(d.flags|=128,es(x,!1),u=F.updateQueue,u!==null&&(d.updateQueue=u,d.flags|=4),d.subtreeFlags=0,u=B,S=d.child;S!==null;)B=S,x=u,B.flags&=14680066,F=B.alternate,F===null?(B.childLanes=0,B.lanes=x,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=F.childLanes,B.lanes=F.lanes,B.child=F.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=F.memoizedProps,B.memoizedState=F.memoizedState,B.updateQueue=F.updateQueue,B.type=F.type,x=F.dependencies,B.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext}),S=S.sibling;return gn(ae,ae.current&1|2),d.child}u=u.sibling}x.tail!==null&&Xi()>AI&&(d.flags|=128,S=!0,es(x,!1),d.lanes=4194304)}else{if(!S)if(u=xe(F),u!==null){if(d.flags|=128,S=!0,u=u.updateQueue,u!==null&&(d.updateQueue=u,d.flags|=4),es(x,!0),x.tail===null&&x.tailMode==="hidden"&&!F.alternate&&!Yn)return Wt(d),null}else 2*Xi()-x.renderingStartTime>AI&&B!==1073741824&&(d.flags|=128,S=!0,es(x,!1),d.lanes=4194304);x.isBackwards?(F.sibling=d.child,d.child=F):(u=x.last,u!==null?u.sibling=F:d.child=F,x.last=F)}return x.tail!==null?(d=x.tail,x.rendering=d,x.tail=d.sibling,x.renderingStartTime=Xi(),d.sibling=null,u=ae.current,gn(ae,S?u&1|2:u&1),d):(Wt(d),null);case 22:case 23:return Lh(),S=d.memoizedState!==null,u!==null&&u.memoizedState!==null!==S&&(d.flags|=8192),S&&d.mode&1?Os&1073741824&&(Wt(d),je&&d.subtreeFlags&6&&(d.flags|=8192)):Wt(d),null;case 24:return null;case 25:return null}throw Error(o(156,d.tag))}var TG=g.ReactCurrentOwner,Js=!1;function ei(u,d,B,S){d.child=u===null?wf(d,null,B,S):Wl(d,u.child,B,S)}function Lf(u,d,B,S,x){B=B.render;var F=d.ref;return ma(d,x),S=pn(u,d,B,S,F,x),B=ph(),u!==null&&!Js?(d.updateQueue=u.updateQueue,d.flags&=-2053,u.lanes&=~x,Zi(u,d,x)):(Yn&&B&&Pu(d),d.flags|=1,ei(u,d,S,x),d.child)}function zf(u,d,B,S,x){if(u===null){var F=B.type;return typeof F=="function"&&!Dh(F)&&F.defaultProps===void 0&&B.compare===null&&B.defaultProps===void 0?(d.tag=15,d.type=F,_f(u,d,F,S,x)):(u=dC(B.type,null,S,d,d.mode,x),u.ref=d.ref,u.return=d,d.child=u)}if(F=u.child,!(u.lanes&x)){var Q=F.memoizedProps;if(B=B.compare,B=B!==null?B:Ii,B(Q,S)&&u.ref===d.ref)return Zi(u,d,x)}return d.flags|=1,u=Cg(F,S),u.ref=d.ref,u.return=d,d.child=u}function _f(u,d,B,S,x){if(u!==null&&Ii(u.memoizedProps,S)&&u.ref===d.ref)if(Js=!1,(u.lanes&x)!==0)u.flags&131072&&(Js=!0);else return d.lanes=u.lanes,Zi(u,d,x);return Dr(u,d,B,S,x)}function kf(u,d,B){var S=d.pendingProps,x=S.children,F=u!==null?u.memoizedState:null;if(S.mode==="hidden")if(!(d.mode&1))d.memoizedState={baseLanes:0,cachePool:null},gn(kl,Os),Os|=B;else if(B&1073741824)d.memoizedState={baseLanes:0,cachePool:null},S=F!==null?F.baseLanes:B,gn(kl,Os),Os|=S;else return u=F!==null?F.baseLanes|B:B,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:u,cachePool:null},d.updateQueue=null,gn(kl,Os),Os|=u,null;else F!==null?(S=F.baseLanes|B,d.memoizedState=null):S=B,gn(kl,Os),Os|=S;return ei(u,d,x,B),d.child}function Tf(u,d){var B=d.ref;(u===null&&B!==null||u!==null&&u.ref!==B)&&(d.flags|=512,d.flags|=2097152)}function Dr(u,d,B,S,x){var F=Rs(B)?mo:An.current;return F=Mr(d,F),ma(d,x),B=pn(u,d,B,S,F,x),S=ph(),u!==null&&!Js?(d.updateQueue=u.updateQueue,d.flags&=-2053,u.lanes&=~x,Zi(u,d,x)):(Yn&&S&&Pu(d),d.flags|=1,ei(u,d,B,x),d.child)}function Ef(u,d,B,S,x){if(Rs(B)){var F=!0;Nu(d)}else F=!1;if(ma(d,x),d.stateNode===null)u!==null&&(u.alternate=null,d.alternate=null,d.flags|=2),Gf(d,B,S),vl(d,B,S,x),S=!0;else if(u===null){var Q=d.stateNode,ce=d.memoizedProps;Q.props=ce;var Re=Q.context,Je=B.contextType;typeof Je=="object"&&Je!==null?Je=Ln(Je):(Je=Rs(B)?mo:An.current,Je=Mr(d,Je));var ut=B.getDerivedStateFromProps,Mt=typeof ut=="function"||typeof Q.getSnapshotBeforeUpdate=="function";Mt||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(ce!==S||Re!==Je)&&Ch(d,Q,S,Je),yi=!1;var Bt=d.memoizedState;Q.state=Bt,zr(d,S,Q,x),Re=d.memoizedState,ce!==S||Bt!==Re||Gi.current||yi?(typeof ut=="function"&&(Oc(d,B,ut,S),Re=d.memoizedState),(ce=yi||bf(d,B,ce,S,Bt,Re,Je))?(Mt||typeof Q.UNSAFE_componentWillMount!="function"&&typeof Q.componentWillMount!="function"||(typeof Q.componentWillMount=="function"&&Q.componentWillMount(),typeof Q.UNSAFE_componentWillMount=="function"&&Q.UNSAFE_componentWillMount()),typeof Q.componentDidMount=="function"&&(d.flags|=4194308)):(typeof Q.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=S,d.memoizedState=Re),Q.props=S,Q.state=Re,Q.context=Je,S=ce):(typeof Q.componentDidMount=="function"&&(d.flags|=4194308),S=!1)}else{Q=d.stateNode,uh(u,d),ce=d.memoizedProps,Je=d.type===d.elementType?ce:zi(d.type,ce),Q.props=Je,Mt=d.pendingProps,Bt=Q.context,Re=B.contextType,typeof Re=="object"&&Re!==null?Re=Ln(Re):(Re=Rs(B)?mo:An.current,Re=Mr(d,Re));var Gn=B.getDerivedStateFromProps;(ut=typeof Gn=="function"||typeof Q.getSnapshotBeforeUpdate=="function")||typeof Q.UNSAFE_componentWillReceiveProps!="function"&&typeof Q.componentWillReceiveProps!="function"||(ce!==Mt||Bt!==Re)&&Ch(d,Q,S,Re),yi=!1,Bt=d.memoizedState,Q.state=Bt,zr(d,S,Q,x);var ht=d.memoizedState;ce!==Mt||Bt!==ht||Gi.current||yi?(typeof Gn=="function"&&(Oc(d,B,Gn,S),ht=d.memoizedState),(Je=yi||bf(d,B,Je,S,Bt,ht,Re)||!1)?(ut||typeof Q.UNSAFE_componentWillUpdate!="function"&&typeof Q.componentWillUpdate!="function"||(typeof Q.componentWillUpdate=="function"&&Q.componentWillUpdate(S,ht,Re),typeof Q.UNSAFE_componentWillUpdate=="function"&&Q.UNSAFE_componentWillUpdate(S,ht,Re)),typeof Q.componentDidUpdate=="function"&&(d.flags|=4),typeof Q.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof Q.componentDidUpdate!="function"||ce===u.memoizedProps&&Bt===u.memoizedState||(d.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||ce===u.memoizedProps&&Bt===u.memoizedState||(d.flags|=1024),d.memoizedProps=S,d.memoizedState=ht),Q.props=S,Q.state=ht,Q.context=Re,S=Je):(typeof Q.componentDidUpdate!="function"||ce===u.memoizedProps&&Bt===u.memoizedState||(d.flags|=4),typeof Q.getSnapshotBeforeUpdate!="function"||ce===u.memoizedProps&&Bt===u.memoizedState||(d.flags|=1024),S=!1)}return vh(u,d,B,S,F,x)}function vh(u,d,B,S,x,F){Tf(u,d);var Q=(d.flags&128)!==0;if(!S&&!Q)return x&&sh(d,B,!1),Zi(u,d,F);S=d.stateNode,TG.current=d;var ce=Q&&typeof B.getDerivedStateFromError!="function"?null:S.render();return d.flags|=1,u!==null&&Q?(d.child=Wl(d,u.child,null,F),d.child=Wl(d,null,ce,F)):ei(u,d,ce,F),d.memoizedState=S.state,x&&sh(d,B,!0),d.child}function Df(u){var d=u.stateNode;d.pendingContext?Dc(u,d.pendingContext,d.pendingContext!==d.context):d.context&&Dc(u,d.context,!1),Ah(u,d.containerInfo)}function Jf(u,d,B,S,x){return Sl(),$c(x),d.flags|=256,ei(u,d,B,S),d.child}var $u={dehydrated:null,treeContext:null,retryLane:0};function Cr(u){return{baseLanes:u,cachePool:null}}function Uf(u,d,B){var S=d.pendingProps,x=ae.current,F=!1,Q=(d.flags&128)!==0,ce;if((ce=Q)||(ce=u!==null&&u.memoizedState===null?!1:(x&2)!==0),ce?(F=!0,d.flags&=-129):(u===null||u.memoizedState!==null)&&(x|=1),gn(ae,x&1),u===null)return hh(d),u=d.memoizedState,u!==null&&(u=u.dehydrated,u!==null)?(d.mode&1?Tc(u)?d.lanes=8:d.lanes=1073741824:d.lanes=1,null):(x=S.children,u=S.fallback,F?(S=d.mode,F=d.child,x={mode:"hidden",children:x},!(S&1)&&F!==null?(F.childLanes=0,F.pendingProps=x):F=GI(x,S,0,null),u=jg(u,S,B,null),F.return=d,u.return=d,F.sibling=u,d.child=F,d.child.memoizedState=Cr(B),d.memoizedState=$u,u):Zh(d,x));if(x=u.memoizedState,x!==null){if(ce=x.dehydrated,ce!==null){if(Q)return d.flags&256?(d.flags&=-257,eC(u,d,B,Error(o(422)))):d.memoizedState!==null?(d.child=u.child,d.flags|=128,null):(F=S.fallback,x=d.mode,S=GI({mode:"visible",children:S.children},x,0,null),F=jg(F,x,B,null),F.flags|=2,S.return=d,F.return=d,S.sibling=F,d.child=S,d.mode&1&&Wl(d,u.child,null,B),d.child.memoizedState=Cr(B),d.memoizedState=$u,F);if(!(d.mode&1))d=eC(u,d,B,null);else if(Tc(ce))d=eC(u,d,B,Error(o(419)));else if(S=(B&u.childLanes)!==0,Js||S){if(S=ui,S!==null){switch(B&-B){case 4:F=2;break;case 16:F=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:F=32;break;case 536870912:F=268435456;break;default:F=0}S=F&(S.suspendedLanes|B)?0:F,S!==0&&S!==x.retryLane&&(x.retryLane=S,dr(u,S,-1))}IC(),d=eC(u,d,B,Error(o(421)))}else fl(ce)?(d.flags|=128,d.child=u.child,d=Qg.bind(null,u),J(ce,d),d=null):(B=x.treeContext,be&&(ki=Ne(ce),hs=d,Yn=!0,Tr=null,wl=!1,B!==null&&(Ws[xs++]=gg,Ws[xs++]=kr,Ws[xs++]=Mg,gg=B.id,kr=B.overflow,Mg=d)),d=Zh(d,d.pendingProps.children),d.flags|=4096);return d}return F?(S=Of(u,d,S.children,S.fallback,B),F=d.child,x=u.child.memoizedState,F.memoizedState=x===null?Cr(B):{baseLanes:x.baseLanes|B,cachePool:null},F.childLanes=u.childLanes&~B,d.memoizedState=$u,S):(B=Pf(u,d,S.children,B),d.memoizedState=null,B)}return F?(S=Of(u,d,S.children,S.fallback,B),F=d.child,x=u.child.memoizedState,F.memoizedState=x===null?Cr(B):{baseLanes:x.baseLanes|B,cachePool:null},F.childLanes=u.childLanes&~B,d.memoizedState=$u,S):(B=Pf(u,d,S.children,B),d.memoizedState=null,B)}function Zh(u,d){return d=GI({mode:"visible",children:d},u.mode,0,null),d.return=u,u.child=d}function Pf(u,d,B,S){var x=u.child;return u=x.sibling,B=Cg(x,{mode:"visible",children:B}),!(d.mode&1)&&(B.lanes=S),B.return=d,B.sibling=null,u!==null&&(S=d.deletions,S===null?(d.deletions=[u],d.flags|=16):S.push(u)),d.child=B}function Of(u,d,B,S,x){var F=d.mode;u=u.child;var Q=u.sibling,ce={mode:"hidden",children:B};return!(F&1)&&d.child!==u?(B=d.child,B.childLanes=0,B.pendingProps=ce,d.deletions=null):(B=Cg(u,ce),B.subtreeFlags=u.subtreeFlags&14680064),Q!==null?S=Cg(Q,S):(S=jg(S,F,x,null),S.flags|=2),S.return=d,B.return=d,B.sibling=S,d.child=B,S}function eC(u,d,B,S){return S!==null&&$c(S),Wl(d,u.child,null,B),u=Zh(d,d.pendingProps.children),u.flags|=2,d.memoizedState=null,u}function kg(u,d,B){u.lanes|=d;var S=u.alternate;S!==null&&(S.lanes|=d),Du(u.return,d,B)}function wh(u,d,B,S,x){var F=u.memoizedState;F===null?u.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:S,tail:B,tailMode:x}:(F.isBackwards=d,F.rendering=null,F.renderingStartTime=0,F.last=S,F.tail=B,F.tailMode=x)}function Qf(u,d,B){var S=d.pendingProps,x=S.revealOrder,F=S.tail;if(ei(u,d,S.children,B),S=ae.current,S&2)S=S&1|2,d.flags|=128;else{if(u!==null&&u.flags&128)e:for(u=d.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&kg(u,B,d);else if(u.tag===19)kg(u,B,d);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===d)break e;for(;u.sibling===null;){if(u.return===null||u.return===d)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}S&=1}if(gn(ae,S),!(d.mode&1))d.memoizedState=null;else switch(x){case"forwards":for(B=d.child,x=null;B!==null;)u=B.alternate,u!==null&&xe(u)===null&&(x=B),B=B.sibling;B=x,B===null?(x=d.child,d.child=null):(x=B.sibling,B.sibling=null),wh(d,!1,x,B,F);break;case"backwards":for(B=null,x=d.child,d.child=null;x!==null;){if(u=x.alternate,u!==null&&xe(u)===null){d.child=x;break}u=x.sibling,x.sibling=B,B=x,x=u}wh(d,!0,B,null,F);break;case"together":wh(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Zi(u,d,B){if(u!==null&&(d.dependencies=u.dependencies),El|=d.lanes,!(B&d.childLanes))return null;if(u!==null&&d.child!==u.child)throw Error(o(153));if(d.child!==null){for(u=d.child,B=Cg(u,u.pendingProps),d.child=B,B.return=d;u.sibling!==null;)u=u.sibling,B=B.sibling=Cg(u,u.pendingProps),B.return=d;B.sibling=null}return d.child}function EG(u,d,B){switch(d.tag){case 3:Df(d),Sl();break;case 5:Sf(d);break;case 1:Rs(d.type)&&Nu(d);break;case 4:Ah(d,d.stateNode.containerInfo);break;case 10:ch(d,d.type._context,d.memoizedProps.value);break;case 13:var S=d.memoizedState;if(S!==null)return S.dehydrated!==null?(gn(ae,ae.current&1),d.flags|=128,null):B&d.child.childLanes?Uf(u,d,B):(gn(ae,ae.current&1),u=Zi(u,d,B),u!==null?u.sibling:null);gn(ae,ae.current&1);break;case 19:if(S=(B&d.childLanes)!==0,u.flags&128){if(S)return Qf(u,d,B);d.flags|=128}var x=d.memoizedState;if(x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),gn(ae,ae.current),S)break;return null;case 22:case 23:return d.lanes=0,kf(u,d,B)}return Zi(u,d,B)}function DG(u,d){switch(ds(d),d.tag){case 1:return Rs(d.type)&&Ec(),u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 3:return Hl(),kt(Gi),kt(An),lt(),u=d.flags,u&65536&&!(u&128)?(d.flags=u&-65537|128,d):null;case 5:return Kg(d),null;case 13:if(kt(ae),u=d.memoizedState,u!==null&&u.dehydrated!==null){if(d.alternate===null)throw Error(o(340));Sl()}return u=d.flags,u&65536?(d.flags=u&-65537|128,d):null;case 19:return kt(ae),null;case 4:return Hl(),null;case 10:return Eu(d.type._context),null;case 22:case 23:return Lh(),null;case 24:return null;default:return null}}var tC=!1,Za=!1,JG=typeof WeakSet=="function"?WeakSet:Set,st=null;function uI(u,d){var B=u.ref;if(B!==null)if(typeof B=="function")try{B(null)}catch(S){ss(u,d,S)}else B.current=null}function Sh(u,d,B){try{B()}catch(S){ss(u,d,S)}}var jf=!1;function Rh(u,d){for(ne(u.containerInfo),st=d;st!==null;)if(u=st,d=u.child,(u.subtreeFlags&1028)!==0&&d!==null)d.return=u,st=d;else for(;st!==null;){u=st;try{var B=u.alternate;if(u.flags&1024)switch(u.tag){case 0:case 11:case 15:break;case 1:if(B!==null){var S=B.memoizedProps,x=B.memoizedState,F=u.stateNode,Q=F.getSnapshotBeforeUpdate(u.elementType===u.type?S:zi(u.type,S),x);F.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:je&&at(u.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(ce){ss(u,u.return,ce)}if(d=u.sibling,d!==null){d.return=u.return,st=d;break}st=u.return}return B=jf,jf=!1,B}function Jr(u,d,B){var S=d.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var x=S=S.next;do{if((x.tag&u)===u){var F=x.destroy;x.destroy=void 0,F!==void 0&&Sh(d,B,F)}x=x.next}while(x!==S)}}function Tg(u,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var B=d=d.next;do{if((B.tag&u)===u){var S=B.create;B.destroy=S()}B=B.next}while(B!==d)}}function Wh(u){var d=u.ref;if(d!==null){var B=u.stateNode;switch(u.tag){case 5:u=he(B);break;default:u=B}typeof d=="function"?d(u):d.current=u}}function xh(u,d,B){if(Go&&typeof Go.onCommitFiberUnmount=="function")try{Go.onCommitFiberUnmount(zu,d)}catch{}switch(d.tag){case 0:case 11:case 14:case 15:if(u=d.updateQueue,u!==null&&(u=u.lastEffect,u!==null)){var S=u=u.next;do{var x=S,F=x.destroy;x=x.tag,F!==void 0&&(x&2||x&4)&&Sh(d,B,F),S=S.next}while(S!==u)}break;case 1:if(uI(d,B),u=d.stateNode,typeof u.componentWillUnmount=="function")try{u.props=d.memoizedProps,u.state=d.memoizedState,u.componentWillUnmount()}catch(Q){ss(d,B,Q)}break;case 5:uI(d,B);break;case 4:je?Hh(u,d,B):ve&&ve&&(d=d.stateNode.containerInfo,B=cn(d),Nr(d,B))}}function qf(u,d,B){for(var S=d;;)if(xh(u,S,B),S.child===null||je&&S.tag===4){if(S===d)break;for(;S.sibling===null;){if(S.return===null||S.return===d)return;S=S.return}S.sibling.return=S.return,S=S.sibling}else S.child.return=S,S=S.child}function Wo(u){var d=u.alternate;d!==null&&(u.alternate=null,Wo(d)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(d=u.stateNode,d!==null&&Pe(d)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}function nC(u){return u.tag===5||u.tag===3||u.tag===4}function Eg(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||nC(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function Us(u){if(je){e:{for(var d=u.return;d!==null;){if(nC(d))break e;d=d.return}throw Error(o(160))}var B=d;switch(B.tag){case 5:d=B.stateNode,B.flags&32&&(Ot(d),B.flags&=-33),B=Eg(u),iC(u,B,d);break;case 3:case 4:d=B.stateNode.containerInfo,B=Eg(u),Vh(u,B,d);break;default:throw Error(o(161))}}}function Vh(u,d,B){var S=u.tag;if(S===5||S===6)u=u.stateNode,d?Ee(B,u,d):nt(B,u);else if(S!==4&&(u=u.child,u!==null))for(Vh(u,d,B),u=u.sibling;u!==null;)Vh(u,d,B),u=u.sibling}function iC(u,d,B){var S=u.tag;if(S===5||S===6)u=u.stateNode,d?we(B,u,d):vt(B,u);else if(S!==4&&(u=u.child,u!==null))for(iC(u,d,B),u=u.sibling;u!==null;)iC(u,d,B),u=u.sibling}function Hh(u,d,B){for(var S=d,x=!1,F,Q;;){if(!x){x=S.return;e:for(;;){if(x===null)throw Error(o(160));switch(F=x.stateNode,x.tag){case 5:Q=!1;break e;case 3:F=F.containerInfo,Q=!0;break e;case 4:F=F.containerInfo,Q=!0;break e}x=x.return}x=!0}if(S.tag===5||S.tag===6)qf(u,S,B),Q?wt(F,S.stateNode):Qe(F,S.stateNode);else if(S.tag===18)Q?Un(F,S.stateNode):nn(F,S.stateNode);else if(S.tag===4){if(S.child!==null){F=S.stateNode.containerInfo,Q=!0,S.child.return=S,S=S.child;continue}}else if(xh(u,S,B),S.child!==null){S.child.return=S,S=S.child;continue}if(S===d)break;for(;S.sibling===null;){if(S.return===null||S.return===d)return;S=S.return,S.tag===4&&(x=!1)}S.sibling.return=S.return,S=S.sibling}}function wa(u,d){if(je){switch(d.tag){case 0:case 11:case 14:case 15:Jr(3,d,d.return),Tg(3,d),Jr(5,d,d.return);return;case 1:return;case 5:var B=d.stateNode;if(B!=null){var S=d.memoizedProps;u=u!==null?u.memoizedProps:S;var x=d.type,F=d.updateQueue;d.updateQueue=null,F!==null&&oe(B,F,x,u,S,d)}return;case 6:if(d.stateNode===null)throw Error(o(162));B=d.memoizedProps,Ye(d.stateNode,u!==null?u.memoizedProps:B,B);return;case 3:be&&u!==null&&u.memoizedState.isDehydrated&&sn(d.stateNode.containerInfo);return;case 12:return;case 13:Ur(d);return;case 19:Ur(d);return;case 17:return}throw Error(o(163))}switch(d.tag){case 0:case 11:case 14:case 15:Jr(3,d,d.return),Tg(3,d),Jr(5,d,d.return);return;case 12:return;case 13:Ur(d);return;case 19:Ur(d);return;case 3:be&&u!==null&&u.memoizedState.isDehydrated&&sn(d.stateNode.containerInfo);break;case 22:case 23:return}e:if(ve){switch(d.tag){case 1:case 5:case 6:break e;case 3:case 4:d=d.stateNode,Nr(d.containerInfo,d.pendingChildren);break e}throw Error(o(163))}}function Ur(u){var d=u.updateQueue;if(d!==null){u.updateQueue=null;var B=u.stateNode;B===null&&(B=u.stateNode=new JG),d.forEach(function(S){var x=om.bind(null,u,S);B.has(S)||(B.add(S),S.then(x,x))})}}function $f(u,d){for(st=d;st!==null;){d=st;var B=d.deletions;if(B!==null)for(var S=0;S<B.length;S++){var x=B[S];try{var F=u;je?Hh(F,x,d):qf(F,x,d);var Q=x.alternate;Q!==null&&(Q.return=null),x.return=null}catch(At){ss(x,d,At)}}if(B=d.child,d.subtreeFlags&12854&&B!==null)B.return=d,st=B;else for(;st!==null;){d=st;try{var ce=d.flags;if(ce&32&&je&&Ot(d.stateNode),ce&512){var Re=d.alternate;if(Re!==null){var Je=Re.ref;Je!==null&&(typeof Je=="function"?Je(null):Je.current=null)}}if(ce&8192)switch(d.tag){case 13:if(d.memoizedState!==null){var ut=d.alternate;(ut===null||ut.memoizedState===null)&&(Mh=Xi())}break;case 22:var Mt=d.memoizedState!==null,Bt=d.alternate,Gn=Bt!==null&&Bt.memoizedState!==null;if(B=d,je){e:if(S=B,x=Mt,F=null,je)for(var ht=S;;){if(ht.tag===5){if(F===null){F=ht;var os=ht.stateNode;x?Vn(os):Se(ht.stateNode,ht.memoizedProps)}}else if(ht.tag===6){if(F===null){var js=ht.stateNode;x?Ie(js):ze(js,ht.memoizedProps)}}else if((ht.tag!==22&&ht.tag!==23||ht.memoizedState===null||ht===S)&&ht.child!==null){ht.child.return=ht,ht=ht.child;continue}if(ht===S)break;for(;ht.sibling===null;){if(ht.return===null||ht.return===S)break e;F===ht&&(F=null),ht=ht.return}F===ht&&(F=null),ht.sibling.return=ht.return,ht=ht.sibling}}if(Mt&&!Gn&&B.mode&1){st=B;for(var fe=B.child;fe!==null;){for(B=st=fe;st!==null;){S=st;var Ce=S.child;switch(S.tag){case 0:case 11:case 14:case 15:Jr(4,S,S.return);break;case 1:uI(S,S.return);var Ze=S.stateNode;if(typeof Ze.componentWillUnmount=="function"){var ot=S.return;try{Ze.props=S.memoizedProps,Ze.state=S.memoizedState,Ze.componentWillUnmount()}catch(At){ss(S,ot,At)}}break;case 5:uI(S,S.return);break;case 22:if(S.memoizedState!==null){Xh(B);continue}}Ce!==null?(Ce.return=S,st=Ce):Xh(B)}fe=fe.sibling}}}switch(ce&4102){case 2:Us(d),d.flags&=-3;break;case 6:Us(d),d.flags&=-3,wa(d.alternate,d);break;case 4096:d.flags&=-4097;break;case 4100:d.flags&=-4097,wa(d.alternate,d);break;case 4:wa(d.alternate,d)}}catch(At){ss(d,d.return,At)}if(B=d.sibling,B!==null){B.return=d.return,st=B;break}st=d.return}}}function UG(u,d,B){st=u,CI(u)}function CI(u,d,B){for(var S=(u.mode&1)!==0;st!==null;){var x=st,F=x.child;if(x.tag===22&&S){var Q=x.memoizedState!==null||tC;if(!Q){var ce=x.alternate,Re=ce!==null&&ce.memoizedState!==null||Za;ce=tC;var Je=Za;if(tC=Q,(Za=Re)&&!Je)for(st=x;st!==null;)Q=st,Re=Q.child,Q.tag===22&&Q.memoizedState!==null?Ni(x):Re!==null?(Re.return=Q,st=Re):Ni(x);for(;F!==null;)st=F,CI(F),F=F.sibling;st=x,tC=ce,Za=Je}em(u)}else x.subtreeFlags&8772&&F!==null?(F.return=x,st=F):em(u)}}function em(u){for(;st!==null;){var d=st;if(d.flags&8772){var B=d.alternate;try{if(d.flags&8772)switch(d.tag){case 0:case 11:case 15:Za||Tg(5,d);break;case 1:var S=d.stateNode;if(d.flags&4&&!Za)if(B===null)S.componentDidMount();else{var x=d.elementType===d.type?B.memoizedProps:zi(d.type,B.memoizedProps);S.componentDidUpdate(x,B.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var F=d.updateQueue;F!==null&&Ju(d,F,S);break;case 3:var Q=d.updateQueue;if(Q!==null){if(B=null,d.child!==null)switch(d.child.tag){case 5:B=he(d.child.stateNode);break;case 1:B=d.child.stateNode}Ju(d,Q,B)}break;case 5:var ce=d.stateNode;B===null&&d.flags&4&&dt(ce,d.type,d.memoizedProps,d);break;case 6:break;case 4:break;case 12:break;case 13:if(be&&d.memoizedState===null){var Re=d.alternate;if(Re!==null){var Je=Re.memoizedState;if(Je!==null){var ut=Je.dehydrated;ut!==null&&tn(ut)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}Za||d.flags&512&&Wh(d)}catch(Mt){ss(d,d.return,Mt)}}if(d===u){st=null;break}if(B=d.sibling,B!==null){B.return=d.return,st=B;break}st=d.return}}function Xh(u){for(;st!==null;){var d=st;if(d===u){st=null;break}var B=d.sibling;if(B!==null){B.return=d.return,st=B;break}st=d.return}}function Ni(u){for(;st!==null;){var d=st;try{switch(d.tag){case 0:case 11:case 15:var B=d.return;try{Tg(4,d)}catch(Re){ss(d,B,Re)}break;case 1:var S=d.stateNode;if(typeof S.componentDidMount=="function"){var x=d.return;try{S.componentDidMount()}catch(Re){ss(d,x,Re)}}var F=d.return;try{Wh(d)}catch(Re){ss(d,F,Re)}break;case 5:var Q=d.return;try{Wh(d)}catch(Re){ss(d,Q,Re)}}}catch(Re){ss(d,d.return,Re)}if(d===u){st=null;break}var ce=d.sibling;if(ce!==null){ce.return=d.return,st=ce;break}st=d.return}}var Ll=0,dI=1,Ps=2,zl=3,Sa=4;if(typeof Symbol=="function"&&Symbol.for){var Pr=Symbol.for;Ll=Pr("selector.component"),dI=Pr("selector.has_pseudo_class"),Ps=Pr("selector.role"),zl=Pr("selector.test_id"),Sa=Pr("selector.text")}function sC(u){var d=Ve(u);if(d!=null){if(typeof d.memoizedProps["data-testname"]!="string")throw Error(o(364));return d}if(u=Zt(u),u===null)throw Error(o(362));return u.stateNode.current}function Ti(u,d){switch(d.$$typeof){case Ll:if(u.type===d.value)return!0;break;case dI:e:{d=d.value,u=[u,0];for(var B=0;B<u.length;){var S=u[B++],x=u[B++],F=d[x];if(S.tag!==5||!ye(S)){for(;F!=null&&Ti(S,F);)x++,F=d[x];if(x===d.length){d=!0;break e}else for(S=S.child;S!==null;)u.push(S,x),S=S.sibling}}d=!1}return d;case Ps:if(u.tag===5&&Le(u.stateNode,d.value))return!0;break;case Sa:if((u.tag===5||u.tag===6)&&(u=z(u),u!==null&&0<=u.indexOf(d.value)))return!0;break;case zl:if(u.tag===5&&(u=u.memoizedProps["data-testname"],typeof u=="string"&&u.toLowerCase()===d.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function hI(u){switch(u.$$typeof){case Ll:return"<"+(X(u.value)||"Unknown")+">";case dI:return":has("+(hI(u)||"")+")";case Ps:return'[role="'+u.value+'"]';case Sa:return'"'+u.value+'"';case zl:return'[data-testname="'+u.value+'"]';default:throw Error(o(365))}}function tm(u,d){var B=[];u=[u,0];for(var S=0;S<u.length;){var x=u[S++],F=u[S++],Q=d[F];if(x.tag!==5||!ye(x)){for(;Q!=null&&Ti(x,Q);)F++,Q=d[F];if(F===d.length)B.push(x);else for(x=x.child;x!==null;)u.push(x,F),x=x.sibling}}return B}function Yh(u,d){if(!Yt)throw Error(o(363));u=sC(u),u=tm(u,d),d=[],u=Array.from(u);for(var B=0;B<u.length;){var S=u[B++];if(S.tag===5)ye(S)||d.push(S.stateNode);else for(S=S.child;S!==null;)u.push(S),S=S.sibling}return d}var PG=Math.ceil,_l=g.ReactCurrentDispatcher,Fh=g.ReactCurrentOwner,Fn=g.ReactCurrentBatchConfig,Jt=0,ui=null,Ci=null,ti=0,Os=0,kl=cr(0),ni=0,Tl=null,El=0,rC=0,Nh=0,Dl=null,ts=null,Mh=0,AI=1/0;function Ra(){AI=Xi()+500}var pI=!1,oC=null,Or=null,gC=!1,ug=null,fI=0,mI=0,aC=null,lC=-1,Jl=0;function ns(){return Jt&6?Xi():lC!==-1?lC:lC=Xi()}function xo(u){return u.mode&1?Jt&2&&ti!==0?ti&-ti:zG.transition!==null?(Jl===0&&(u=ml,ml<<=1,!(ml&4194240)&&(ml=64),Jl=u),Jl):(u=hn,u!==0?u:Xe()):1}function dr(u,d,B){if(50<mI)throw mI=0,aC=null,Error(o(185));var S=Ul(u,d);return S===null?null:(Gl(S,d,B),(!(Jt&2)||S!==ui)&&(S===ui&&(!(Jt&2)&&(rC|=d),ni===4&&Dg(S,ti)),Rt(S,B),d===1&&Jt===0&&!(u.mode&1)&&(Ra(),_u&&Kr())),S)}function Ul(u,d){u.lanes|=d;var B=u.alternate;for(B!==null&&(B.lanes|=d),B=u,u=u.return;u!==null;)u.childLanes|=d,B=u.alternate,B!==null&&(B.childLanes|=d),B=u,u=u.return;return B.tag===3?B.stateNode:null}function Rt(u,d){var B=u.callbackNode;YG(u,d);var S=Jc(u,u===ui?ti:0);if(S===0)B!==null&&pf(B),u.callbackNode=null,u.callbackPriority=0;else if(d=S&-S,u.callbackPriority!==d){if(B!=null&&pf(B),d===1)u.tag===0?LG(sm.bind(null,u)):ff(sm.bind(null,u)),ct?gt(function(){Jt===0&&Kr()}):Lu(Uc,Kr),B=null;else{switch(Af(S)){case 1:B=Uc;break;case 4:B=MG;break;case 16:B=gh;break;case 536870912:B=KG;break;default:B=gh}B=CC(B,nm.bind(null,u))}u.callbackPriority=d,u.callbackNode=B}}function nm(u,d){if(lC=-1,Jl=0,Jt&6)throw Error(o(327));var B=u.callbackNode;if(Pg()&&u.callbackNode!==B)return null;var S=Jc(u,u===ui?ti:0);if(S===0)return null;if(S&30||S&u.expiredLanes||d)d=is(u,S);else{d=S;var x=Jt;Jt|=2;var F=zh();(ui!==u||ti!==d)&&(Ra(),Vo(u,d));do try{_h();break}catch(ce){cC(u,ce)}while(1);Tu(),_l.current=F,Jt=x,Ci!==null?d=0:(ui=null,ti=0,d=ni)}if(d!==0){if(d===2&&(x=Mu(u),x!==0&&(S=x,d=Kh(u,x))),d===1)throw B=Tl,Vo(u,0),Dg(u,S),Rt(u,Xi()),B;if(d===6)Dg(u,S);else{if(x=u.current.alternate,!(S&30)&&!im(x)&&(d=is(u,S),d===2&&(F=Mu(u),F!==0&&(S=F,d=Kh(u,F))),d===1))throw B=Tl,Vo(u,0),Dg(u,S),Rt(u,Xi()),B;switch(u.finishedWork=x,u.finishedLanes=S,d){case 0:case 1:throw Error(o(345));case 2:Ug(u,ts);break;case 3:if(Dg(u,S),(S&130023424)===S&&(d=Mh+500-Xi(),10<d)){if(Jc(u,0)!==0)break;if(x=u.suspendedLanes,(x&S)!==S){ns(),u.pingedLanes|=u.suspendedLanes&x;break}u.timeoutHandle=tt(Ug.bind(null,u,ts),d);break}Ug(u,ts);break;case 4:if(Dg(u,S),(S&4194240)===S)break;for(d=u.eventTimes,x=-1;0<S;){var Q=31-ur(S);F=1<<Q,Q=d[Q],Q>x&&(x=Q),S&=~F}if(S=x,S=Xi()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*PG(S/1960))-S,10<S){u.timeoutHandle=tt(Ug.bind(null,u,ts),S);break}Ug(u,ts);break;case 5:Ug(u,ts);break;default:throw Error(o(329))}}}return Rt(u,Xi()),u.callbackNode===B?nm.bind(null,u):null}function Kh(u,d){var B=Dl;return u.current.memoizedState.isDehydrated&&(Vo(u,d).flags|=256),u=is(u,d),u!==2&&(d=ts,ts=B,d!==null&&Wa(d)),u}function Wa(u){ts===null?ts=u:ts.push.apply(ts,u)}function im(u){for(var d=u;;){if(d.flags&16384){var B=d.updateQueue;if(B!==null&&(B=B.stores,B!==null))for(var S=0;S<B.length;S++){var x=B[S],F=x.getSnapshot;x=x.value;try{if(!yo(F(),x))return!1}catch{return!1}}}if(B=d.child,d.subtreeFlags&16384&&B!==null)B.return=d,d=B;else{if(d===u)break;for(;d.sibling===null;){if(d.return===null||d.return===u)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Dg(u,d){for(d&=~Nh,d&=~rC,u.suspendedLanes|=d,u.pingedLanes&=~d,u=u.expirationTimes;0<d;){var B=31-ur(d),S=1<<B;u[B]=-1,d&=~S}}function sm(u){if(Jt&6)throw Error(o(327));Pg();var d=Jc(u,0);if(!(d&1))return Rt(u,Xi()),null;var B=is(u,d);if(u.tag!==0&&B===2){var S=Mu(u);S!==0&&(d=S,B=Kh(u,S))}if(B===1)throw B=Tl,Vo(u,0),Dg(u,d),Rt(u,Xi()),B;if(B===6)throw Error(o(345));return u.finishedWork=u.current.alternate,u.finishedLanes=d,Ug(u,ts),Rt(u,Xi()),null}function Qs(u){ug!==null&&ug.tag===0&&!(Jt&6)&&Pg();var d=Jt;Jt|=1;var B=Fn.transition,S=hn;try{if(Fn.transition=null,hn=1,u)return u()}finally{hn=S,Fn.transition=B,Jt=d,!(Jt&6)&&Kr()}}function Lh(){Os=kl.current,kt(kl)}function Vo(u,d){u.finishedWork=null,u.finishedLanes=0;var B=u.timeoutHandle;if(B!==It&&(u.timeoutHandle=It,Oe(B)),Ci!==null)for(B=Ci.return;B!==null;){var S=B;switch(ds(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&Ec();break;case 3:Hl(),kt(Gi),kt(An),lt();break;case 5:Kg(S);break;case 4:Hl();break;case 13:kt(ae);break;case 19:kt(ae);break;case 10:Eu(S.type._context);break;case 22:case 23:Lh()}B=B.return}if(ui=u,Ci=u=Cg(u.current,null),ti=Os=d,ni=0,Tl=null,Nh=rC=El=0,ts=Dl=null,Bo!==null){for(d=0;d<Bo.length;d++)if(B=Bo[d],S=B.interleaved,S!==null){B.interleaved=null;var x=S.next,F=B.pending;if(F!==null){var Q=F.next;F.next=x,S.next=Q}B.pending=S}Bo=null}return u}function cC(u,d){do{var B=Ci;try{if(Tu(),Ft.current=Nl,As){for(var S=Vt.memoizedState;S!==null;){var x=S.queue;x!==null&&(x.pending=null),S=S.next}As=!1}if(zn=0,Fi=Yi=Vt=null,Lg=!1,tI=0,Fh.current=null,B===null||B.return===null){ni=1,Tl=d,Ci=null;break}e:{var F=u,Q=B.return,ce=B,Re=d;if(d=ti,ce.flags|=32768,Re!==null&&typeof Re=="object"&&typeof Re.then=="function"){var Je=Re,ut=ce,Mt=ut.tag;if(!(ut.mode&1)&&(Mt===0||Mt===11||Mt===15)){var Bt=ut.alternate;Bt?(ut.updateQueue=Bt.updateQueue,ut.memoizedState=Bt.memoizedState,ut.lanes=Bt.lanes):(ut.updateQueue=null,ut.memoizedState=null)}var Gn=Mf(Q);if(Gn!==null){Gn.flags&=-257,Kf(Gn,Q,ce,F,d),Gn.mode&1&&Nf(F,Je,d),d=Gn,Re=Je;var ht=d.updateQueue;if(ht===null){var os=new Set;os.add(Re),d.updateQueue=os}else ht.add(Re);break e}else{if(!(d&1)){Nf(F,Je,d),IC();break e}Re=Error(o(426))}}else if(Yn&&ce.mode&1){var js=Mf(Q);if(js!==null){!(js.flags&65536)&&(js.flags|=256),Kf(js,Q,ce,F,d),$c(Re);break e}}F=Re,ni!==4&&(ni=2),Dl===null?Dl=[F]:Dl.push(F),Re=ya(Re,ce),ce=Q;do{switch(ce.tag){case 3:ce.flags|=65536,d&=-d,ce.lanes|=d;var fe=va(ce,Re,d);Xn(ce,fe);break e;case 1:F=Re;var Ce=ce.type,Ze=ce.stateNode;if(!(ce.flags&128)&&(typeof Ce.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(Or===null||!Or.has(Ze)))){ce.flags|=65536,d&=-d,ce.lanes|=d;var ot=Ff(ce,F,d);Xn(ce,ot);break e}}ce=ce.return}while(ce!==null)}bI(B)}catch(At){d=At,Ci===B&&B!==null&&(Ci=B=B.return);continue}break}while(1)}function zh(){var u=_l.current;return _l.current=Nl,u===null?Nl:u}function IC(){(ni===0||ni===3||ni===2)&&(ni=4),ui===null||!(El&268435455)&&!(rC&268435455)||Dg(ui,ti)}function is(u,d){var B=Jt;Jt|=2;var S=zh();ui===u&&ti===d||Vo(u,d);do try{Jg();break}catch(x){cC(u,x)}while(1);if(Tu(),Jt=B,_l.current=S,Ci!==null)throw Error(o(261));return ui=null,ti=0,ni}function Jg(){for(;Ci!==null;)kh(Ci)}function _h(){for(;Ci!==null&&!FG();)kh(Ci)}function kh(u){var d=Eh(u.alternate,u,Os);u.memoizedProps=u.pendingProps,d===null?bI(u):Ci=d,Fh.current=null}function bI(u){var d=u;do{var B=d.alternate;if(u=d.return,d.flags&32768){if(B=DG(B,d),B!==null){B.flags&=32767,Ci=B;return}if(u!==null)u.flags|=32768,u.subtreeFlags=0,u.deletions=null;else{ni=6,Ci=null;return}}else if(B=kG(B,d,Os),B!==null){Ci=B;return}if(d=d.sibling,d!==null){Ci=d;return}Ci=d=u}while(d!==null);ni===0&&(ni=5)}function Ug(u,d){var B=hn,S=Fn.transition;try{Fn.transition=null,hn=1,Th(u,d,B)}finally{Fn.transition=S,hn=B}return null}function Th(u,d,B){do Pg();while(ug!==null);if(Jt&6)throw Error(o(327));var S=u.finishedWork,x=u.finishedLanes;if(S===null)return null;if(u.finishedWork=null,u.finishedLanes=0,S===u.current)throw Error(o(177));u.callbackNode=null,u.callbackPriority=0;var F=S.lanes|S.childLanes;if(hf(u,F),u===ui&&(Ci=ui=null,ti=0),!(S.subtreeFlags&2064)&&!(S.flags&2064)||gC||(gC=!0,CC(gh,function(){return Pg(),null})),F=(S.flags&15990)!==0,S.subtreeFlags&15990||F){F=Fn.transition,Fn.transition=null;var Q=hn;hn=1;var ce=Jt;Jt|=4,Fh.current=null,Rh(u,S),$f(u,S),te(u.containerInfo),u.current=S,UG(S),NG(),Jt=ce,hn=Q,Fn.transition=F}else u.current=S;if(gC&&(gC=!1,ug=u,fI=x),F=u.pendingLanes,F===0&&(Or=null),Hn(S.stateNode),Rt(u,Xi()),d!==null)for(B=u.onRecoverableError,S=0;S<d.length;S++)B(d[S]);if(pI)throw pI=!1,u=oC,oC=null,u;return fI&1&&u.tag!==0&&Pg(),F=u.pendingLanes,F&1?u===aC?mI++:(mI=0,aC=u):mI=0,Kr(),null}function Pg(){if(ug!==null){var u=Af(fI),d=Fn.transition,B=hn;try{if(Fn.transition=null,hn=16>u?16:u,ug===null)var S=!1;else{if(u=ug,ug=null,fI=0,Jt&6)throw Error(o(331));var x=Jt;for(Jt|=4,st=u.current;st!==null;){var F=st,Q=F.child;if(st.flags&16){var ce=F.deletions;if(ce!==null){for(var Re=0;Re<ce.length;Re++){var Je=ce[Re];for(st=Je;st!==null;){var ut=st;switch(ut.tag){case 0:case 11:case 15:Jr(8,ut,F)}var Mt=ut.child;if(Mt!==null)Mt.return=ut,st=Mt;else for(;st!==null;){ut=st;var Bt=ut.sibling,Gn=ut.return;if(Wo(ut),ut===Je){st=null;break}if(Bt!==null){Bt.return=Gn,st=Bt;break}st=Gn}}}var ht=F.alternate;if(ht!==null){var os=ht.child;if(os!==null){ht.child=null;do{var js=os.sibling;os.sibling=null,os=js}while(os!==null)}}st=F}}if(F.subtreeFlags&2064&&Q!==null)Q.return=F,st=Q;else e:for(;st!==null;){if(F=st,F.flags&2048)switch(F.tag){case 0:case 11:case 15:Jr(9,F,F.return)}var fe=F.sibling;if(fe!==null){fe.return=F.return,st=fe;break e}st=F.return}}var Ce=u.current;for(st=Ce;st!==null;){Q=st;var Ze=Q.child;if(Q.subtreeFlags&2064&&Ze!==null)Ze.return=Q,st=Ze;else e:for(Q=Ce;st!==null;){if(ce=st,ce.flags&2048)try{switch(ce.tag){case 0:case 11:case 15:Tg(9,ce)}}catch(At){ss(ce,ce.return,At)}if(ce===Q){st=null;break e}var ot=ce.sibling;if(ot!==null){ot.return=ce.return,st=ot;break e}st=ce.return}}if(Jt=x,Kr(),Go&&typeof Go.onPostCommitFiberRoot=="function")try{Go.onPostCommitFiberRoot(zu,u)}catch{}S=!0}return S}finally{hn=B,Fn.transition=d}}return!1}function uC(u,d,B){d=ya(B,d),d=va(u,d,1),Lr(u,d),d=ns(),u=Ul(u,1),u!==null&&(Gl(u,1,d),Rt(u,d))}function ss(u,d,B){if(u.tag===3)uC(u,u,B);else for(;d!==null;){if(d.tag===3){uC(d,u,B);break}else if(d.tag===1){var S=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Or===null||!Or.has(S))){u=ya(B,u),u=Ff(d,u,1),Lr(d,u),u=ns(),d=Ul(d,1),d!==null&&(Gl(d,1,u),Rt(d,u));break}}d=d.return}}function Og(u,d,B){var S=u.pingCache;S!==null&&S.delete(d),d=ns(),u.pingedLanes|=u.suspendedLanes&B,ui===u&&(ti&B)===B&&(ni===4||ni===3&&(ti&130023424)===ti&&500>Xi()-Mh?Vo(u,0):Nh|=B),Rt(u,d)}function rm(u,d){d===0&&(u.mode&1?(d=bl,bl<<=1,!(bl&130023424)&&(bl=4194304)):d=1);var B=ns();u=Ul(u,d),u!==null&&(Gl(u,d,B),Rt(u,B))}function Qg(u){var d=u.memoizedState,B=0;d!==null&&(B=d.retryLane),rm(u,B)}function om(u,d){var B=0;switch(u.tag){case 13:var S=u.stateNode,x=u.memoizedState;x!==null&&(B=x.retryLane);break;case 19:S=u.stateNode;break;default:throw Error(o(314))}S!==null&&S.delete(d),rm(u,B)}var Eh;Eh=function(u,d,B){if(u!==null)if(u.memoizedProps!==d.pendingProps||Gi.current)Js=!0;else{if(!(u.lanes&B)&&!(d.flags&128))return Js=!1,EG(u,d,B);Js=!!(u.flags&131072)}else Js=!1,Yn&&d.flags&1048576&&yf(d,jc,d.index);switch(d.lanes=0,d.tag){case 2:var S=d.type;u!==null&&(u.alternate=null,d.alternate=null,d.flags|=2),u=d.pendingProps;var x=Mr(d,An.current);ma(d,B),x=pn(null,d,S,u,x,B);var F=ph();return d.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,Rs(S)?(F=!0,Nu(d)):F=!1,d.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,Ih(d),x.updater=Uu,d.stateNode=x,x._reactInternals=d,vl(d,S,u,B),d=vh(null,d,S,!0,F,B)):(d.tag=0,Yn&&F&&Pu(d),ei(null,d,x,B),d=d.child),d;case 16:S=d.elementType;e:{switch(u!==null&&(u.alternate=null,d.alternate=null,d.flags|=2),u=d.pendingProps,x=S._init,S=x(S._payload),d.type=S,x=d.tag=gm(S),u=zi(S,u),x){case 0:d=Dr(null,d,S,u,B);break e;case 1:d=Ef(null,d,S,u,B);break e;case 11:d=Lf(null,d,S,u,B);break e;case 14:d=zf(null,d,S,zi(S.type,u),B);break e}throw Error(o(306,S,""))}return d;case 0:return S=d.type,x=d.pendingProps,x=d.elementType===S?x:zi(S,x),Dr(u,d,S,x,B);case 1:return S=d.type,x=d.pendingProps,x=d.elementType===S?x:zi(S,x),Ef(u,d,S,x,B);case 3:e:{if(Df(d),u===null)throw Error(o(387));S=d.pendingProps,F=d.memoizedState,x=F.element,uh(u,d),zr(d,S,null,B);var Q=d.memoizedState;if(S=Q.element,be&&F.isDehydrated)if(F={element:S,isDehydrated:!1,cache:Q.cache,transitions:Q.transitions},d.updateQueue.baseState=F,d.memoizedState=F,d.flags&256){x=Error(o(423)),d=Jf(u,d,S,B,x);break e}else if(S!==x){x=Error(o(424)),d=Jf(u,d,S,B,x);break e}else for(be&&(ki=pe(d.stateNode.containerInfo),hs=d,Yn=!0,Tr=null,wl=!1),B=wf(d,null,S,B),d.child=B;B;)B.flags=B.flags&-3|4096,B=B.sibling;else{if(Sl(),S===x){d=Zi(u,d,B);break e}ei(u,d,S,B)}d=d.child}return d;case 5:return Sf(d),u===null&&hh(d),S=d.type,x=d.pendingProps,F=u!==null?u.memoizedProps:null,Q=x.children,We(S,x)?Q=null:F!==null&&We(S,F)&&(d.flags|=32),Tf(u,d),ei(u,d,Q,B),d.child;case 6:return u===null&&hh(d),null;case 13:return Uf(u,d,B);case 4:return Ah(d,d.stateNode.containerInfo),S=d.pendingProps,u===null?d.child=Wl(d,null,S,B):ei(u,d,S,B),d.child;case 11:return S=d.type,x=d.pendingProps,x=d.elementType===S?x:zi(S,x),Lf(u,d,S,x,B);case 7:return ei(u,d,d.pendingProps,B),d.child;case 8:return ei(u,d,d.pendingProps.children,B),d.child;case 12:return ei(u,d,d.pendingProps.children,B),d.child;case 10:e:{if(S=d.type._context,x=d.pendingProps,F=d.memoizedProps,Q=x.value,ch(d,S,Q),F!==null)if(yo(F.value,Q)){if(F.children===x.children&&!Gi.current){d=Zi(u,d,B);break e}}else for(F=d.child,F!==null&&(F.return=d);F!==null;){var ce=F.dependencies;if(ce!==null){Q=F.child;for(var Re=ce.firstContext;Re!==null;){if(Re.context===S){if(F.tag===1){Re=qi(-1,B&-B),Re.tag=2;var Je=F.updateQueue;if(Je!==null){Je=Je.shared;var ut=Je.pending;ut===null?Re.next=Re:(Re.next=ut.next,ut.next=Re),Je.pending=Re}}F.lanes|=B,Re=F.alternate,Re!==null&&(Re.lanes|=B),Du(F.return,B,d),ce.lanes|=B;break}Re=Re.next}}else if(F.tag===10)Q=F.type===d.type?null:F.child;else if(F.tag===18){if(Q=F.return,Q===null)throw Error(o(341));Q.lanes|=B,ce=Q.alternate,ce!==null&&(ce.lanes|=B),Du(Q,B,d),Q=F.sibling}else Q=F.child;if(Q!==null)Q.return=F;else for(Q=F;Q!==null;){if(Q===d){Q=null;break}if(F=Q.sibling,F!==null){F.return=Q.return,Q=F;break}Q=Q.return}F=Q}ei(u,d,x.children,B),d=d.child}return d;case 9:return x=d.type,S=d.pendingProps.children,ma(d,B),x=Ln(x),S=S(x),d.flags|=1,ei(u,d,S,B),d.child;case 14:return S=d.type,x=zi(S,d.pendingProps),x=zi(S.type,x),zf(u,d,S,x,B);case 15:return _f(u,d,d.type,d.pendingProps,B);case 17:return S=d.type,x=d.pendingProps,x=d.elementType===S?x:zi(S,x),u!==null&&(u.alternate=null,d.alternate=null,d.flags|=2),d.tag=1,Rs(S)?(u=!0,Nu(d)):u=!1,ma(d,B),Gf(d,S,x),vl(d,S,x,B),vh(null,d,S,!0,u,B);case 19:return Qf(u,d,B);case 22:return kf(u,d,B)}throw Error(o(156,d.tag))};function CC(u,d){return Lu(u,d)}function OG(u,d,B,S){this.tag=u,this.key=B,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hr(u,d,B,S){return new OG(u,d,B,S)}function Dh(u){return u=u.prototype,!(!u||!u.isReactComponent)}function gm(u){if(typeof u=="function")return Dh(u)?1:0;if(u!=null){if(u=u.$$typeof,u===f)return 11;if(u===v)return 14}return 2}function Cg(u,d){var B=u.alternate;return B===null?(B=hr(u.tag,d,u.key,u.mode),B.elementType=u.elementType,B.type=u.type,B.stateNode=u.stateNode,B.alternate=u,u.alternate=B):(B.pendingProps=d,B.type=u.type,B.flags=0,B.subtreeFlags=0,B.deletions=null),B.flags=u.flags&14680064,B.childLanes=u.childLanes,B.lanes=u.lanes,B.child=u.child,B.memoizedProps=u.memoizedProps,B.memoizedState=u.memoizedState,B.updateQueue=u.updateQueue,d=u.dependencies,B.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},B.sibling=u.sibling,B.index=u.index,B.ref=u.ref,B}function dC(u,d,B,S,x,F){var Q=2;if(S=u,typeof u=="function")Dh(u)&&(Q=1);else if(typeof u=="string")Q=5;else e:switch(u){case c:return jg(B.children,x,F,d);case C:Q=8,x|=8;break;case h:return u=hr(12,B,d,x|2),u.elementType=h,u.lanes=F,u;case b:return u=hr(13,B,d,x),u.elementType=b,u.lanes=F,u;case y:return u=hr(19,B,d,x),u.elementType=y,u.lanes=F,u;case w:return GI(B,x,F,d);default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case p:Q=10;break e;case m:Q=9;break e;case f:Q=11;break e;case v:Q=14;break e;case G:Q=16,S=null;break e}throw Error(o(130,u==null?u:typeof u,""))}return d=hr(Q,B,d,x),d.elementType=u,d.type=S,d.lanes=F,d}function jg(u,d,B,S){return u=hr(7,u,S,d),u.lanes=B,u}function GI(u,d,B,S){return u=hr(22,u,S,d),u.elementType=w,u.lanes=B,u.stateNode={},u}function rs(u,d,B){return u=hr(6,u,null,d),u.lanes=B,u}function Ar(u,d,B){return d=hr(4,u.children!==null?u.children:[],u.key,d),d.lanes=B,d.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},d}function QG(u,d,B,S,x){this.tag=d,this.containerInfo=u,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=It,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ku(0),this.expirationTimes=Ku(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ku(0),this.identifierPrefix=S,this.onRecoverableError=x,be&&(this.mutableSourceEagerHydrationData=null)}function am(u,d,B,S,x,F,Q,ce,Re){return u=new QG(u,d,B,ce,Re),d===1?(d=1,F===!0&&(d|=8)):d=0,F=hr(3,null,null,d),u.current=F,F.stateNode=u,F.memoizedState={element:S,isDehydrated:B,cache:null,transitions:null},Ih(F),u}function yI(u){if(!u)return Ir;u=u._reactInternals;e:{if(Y(u)!==u||u.tag!==1)throw Error(o(170));var d=u;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(Rs(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(o(171))}if(u.tag===1){var B=u.type;if(Rs(B))return ih(u,B,d)}return d}function xa(u){var d=u._reactInternals;if(d===void 0)throw typeof u.render=="function"?Error(o(188)):(u=Object.keys(u).join(","),Error(o(268,u)));return u=re(d),u===null?null:u.stateNode}function Jh(u,d){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var B=u.retryLane;u.retryLane=B!==0&&B<d?B:d}}function hC(u,d){Jh(u,d),(u=u.alternate)&&Jh(u,d)}function jG(u){return u=re(u),u===null?null:u.stateNode}function lm(){return null}return t.attemptContinuousHydration=function(u){if(u.tag===13){var d=ns();dr(u,134217728,d),hC(u,134217728)}},t.attemptHydrationAtCurrentPriority=function(u){if(u.tag===13){var d=ns(),B=xo(u);dr(u,B,d),hC(u,B)}},t.attemptSynchronousHydration=function(u){switch(u.tag){case 3:var d=u.stateNode;if(d.current.memoizedState.isDehydrated){var B=bo(d.pendingLanes);B!==0&&(oh(d,B|1),Rt(d,Xi()),!(Jt&6)&&(Ra(),Kr()))}break;case 13:var S=ns();Qs(function(){return dr(u,1,S)}),hC(u,1)}},t.batchedUpdates=function(u,d){var B=Jt;Jt|=1;try{return u(d)}finally{Jt=B,Jt===0&&(Ra(),_u&&Kr())}},t.createComponentSelector=function(u){return{$$typeof:Ll,value:u}},t.createContainer=function(u,d,B,S,x,F,Q){return am(u,d,!1,null,B,S,x,F,Q)},t.createHasPseudoClassSelector=function(u){return{$$typeof:dI,value:u}},t.createHydrationContainer=function(u,d,B,S,x,F,Q,ce,Re){return u=am(B,S,!0,u,x,F,Q,ce,Re),u.context=yI(null),B=u.current,S=ns(),x=xo(B),F=qi(S,x),F.callback=d??null,Lr(B,F),u.current.lanes=x,Gl(u,x,S),Rt(u,S),u},t.createPortal=function(u,d,B){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:S==null?null:""+S,children:u,containerInfo:d,implementation:B}},t.createRoleSelector=function(u){return{$$typeof:Ps,value:u}},t.createTestNameSelector=function(u){return{$$typeof:zl,value:u}},t.createTextSelector=function(u){return{$$typeof:Sa,value:u}},t.deferredUpdates=function(u){var d=hn,B=Fn.transition;try{return Fn.transition=null,hn=16,u()}finally{hn=d,Fn.transition=B}},t.discreteUpdates=function(u,d,B,S,x){var F=hn,Q=Fn.transition;try{return Fn.transition=null,hn=1,u(d,B,S,x)}finally{hn=F,Fn.transition=Q,Jt===0&&Ra()}},t.findAllNodes=Yh,t.findBoundingRects=function(u,d){if(!Yt)throw Error(o(363));d=Yh(u,d),u=[];for(var B=0;B<d.length;B++)u.push(O(d[B]));for(d=u.length-1;0<d;d--){B=u[d];for(var S=B.x,x=S+B.width,F=B.y,Q=F+B.height,ce=d-1;0<=ce;ce--)if(d!==ce){var Re=u[ce],Je=Re.x,ut=Je+Re.width,Mt=Re.y,Bt=Mt+Re.height;if(S>=Je&&F>=Mt&&x<=ut&&Q<=Bt){u.splice(d,1);break}else if(S!==Je||B.width!==Re.width||Bt<F||Mt>Q){if(!(F!==Mt||B.height!==Re.height||ut<S||Je>x)){Je>S&&(Re.width+=Je-S,Re.x=S),ut<x&&(Re.width=x-Je),u.splice(d,1);break}}else{Mt>F&&(Re.height+=Mt-F,Re.y=F),Bt<Q&&(Re.height=Q-Mt),u.splice(d,1);break}}}return u},t.findHostInstance=xa,t.findHostInstanceWithNoPortals=function(u){return u=L(u),u=u!==null?$(u):null,u===null?null:u.stateNode},t.findHostInstanceWithWarning=function(u){return xa(u)},t.flushControlled=function(u){var d=Jt;Jt|=1;var B=Fn.transition,S=hn;try{Fn.transition=null,hn=1,u()}finally{hn=S,Fn.transition=B,Jt=d,Jt===0&&(Ra(),Kr())}},t.flushPassiveEffects=Pg,t.flushSync=Qs,t.focusWithin=function(u,d){if(!Yt)throw Error(o(363));for(u=sC(u),d=tm(u,d),d=Array.from(d),u=0;u<d.length;){var B=d[u++];if(!ye(B)){if(B.tag===5&&Te(B.stateNode))return!0;for(B=B.child;B!==null;)d.push(B),B=B.sibling}}return!1},t.getCurrentUpdatePriority=function(){return hn},t.getFindAllNodesFailureDescription=function(u,d){if(!Yt)throw Error(o(363));var B=0,S=[];u=[sC(u),0];for(var x=0;x<u.length;){var F=u[x++],Q=u[x++],ce=d[Q];if((F.tag!==5||!ye(F))&&(Ti(F,ce)&&(S.push(hI(ce)),Q++,Q>B&&(B=Q)),Q<d.length))for(F=F.child;F!==null;)u.push(F,Q),F=F.sibling}if(B<d.length){for(u=[];B<d.length;B++)u.push(hI(d[B]));return`findAllNodes was able to match part of the selector:
  `+(S.join(" > ")+`

No matching component was found for:
  `)+u.join(" > ")}return null},t.getPublicRootInstance=function(u){if(u=u.current,!u.child)return null;switch(u.child.tag){case 5:return he(u.child.stateNode);default:return u.child.stateNode}},t.injectIntoDevTools=function(u){if(u={bundleType:u.bundleType,version:u.version,rendererPackageName:u.rendererPackageName,rendererConfig:u.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:g.ReactCurrentDispatcher,findHostInstanceByFiber:jG,findFiberByHostInstance:u.findFiberByHostInstance||lm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")u=!1;else{var d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(d.isDisabled||!d.supportsFiber)u=!0;else{try{zu=d.inject(u),Go=d}catch{}u=!!d.checkDCE}}return u},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(u,d,B,S){if(!Yt)throw Error(o(363));u=Yh(u,d);var x=De(u,B,S).disconnect;return{disconnect:function(){x()}}},t.registerMutableSourceForHydration=function(u,d){var B=d._getVersion;B=B(d._source),u.mutableSourceEagerHydrationData==null?u.mutableSourceEagerHydrationData=[d,B]:u.mutableSourceEagerHydrationData.push(d,B)},t.runWithPriority=function(u,d){var B=hn;try{return hn=u,d()}finally{hn=B}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(u,d,B,S){var x=d.current,F=ns(),Q=xo(x);return B=yI(B),d.context===null?d.context=B:d.pendingContext=B,d=qi(F,Q),d.payload={element:u},S=S===void 0?null:S,S!==null&&(d.callback=S),Lr(x,d),u=dr(x,Q,F),u!==null&&Bl(u,x,Q),Q},t};mH.exports=X8;var Y8=mH.exports;const F8=Db(Y8);function yH(i,e,t=(n,s)=>n===s){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let s=0;s<n;s++)if(!t(i[s],e[s]))return!1;return!0}const Ua=[];function BH(i,e,t=!1,n={}){for(const r of Ua)if(yH(e,r.keys,r.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(r,"error"))throw r.error;if(Object.prototype.hasOwnProperty.call(r,"response"))return r.response;if(!t)throw r.promise}const s={keys:e,equal:n.equal,promise:i(...e).then(r=>s.response=r).then(()=>{n.lifespan&&n.lifespan>0&&setTimeout(()=>{const r=Ua.indexOf(s);r!==-1&&Ua.splice(r,1)},n.lifespan)}).catch(r=>s.error=r)};if(Ua.push(s),!t)throw s.promise}const vH=(i,e,t)=>BH(i,e,!1,t),N8=(i,e,t)=>void BH(i,e,!0,t),M8=i=>{if(i===void 0||i.length===0)Ua.splice(0,Ua.length);else{const e=Ua.find(t=>yH(i,t.keys,t.equal));if(e){const t=Ua.indexOf(e);t!==-1&&Ua.splice(t,1)}}},zZ={},_Z=i=>void Object.assign(zZ,i);function K8(i,e){function t(c,{args:C=[],attach:h,...p},m){let f=`${c[0].toUpperCase()}${c.slice(1)}`,b;if(c==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const y=p.object;b=kC(y,{type:c,root:m,attach:h,primitive:!0})}else{const y=zZ[f];if(!y)throw new Error(`R3F: ${f} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(C))throw new Error("R3F: The args prop must be an array!");b=kC(new y(...C),{type:c,root:m,attach:h,memoizedProps:{args:C}})}return b.__r3f.attach===void 0&&(b instanceof zt?b.__r3f.attach="geometry":b instanceof qn&&(b.__r3f.attach="material")),f!=="inject"&&RB(b,p),b}function n(c,C){let h=!1;if(C){var p,m;(p=C.__r3f)!=null&&p.attach?SB(c,C,C.__r3f.attach):C.isObject3D&&c.isObject3D&&(c.add(C),h=!0),h||(m=c.__r3f)==null||m.objects.push(C),C.__r3f||kC(C,{}),C.__r3f.parent=c,Nv(C),TC(C)}}function s(c,C,h){let p=!1;if(C){var m,f;if((m=C.__r3f)!=null&&m.attach)SB(c,C,C.__r3f.attach);else if(C.isObject3D&&c.isObject3D){C.parent=c,C.dispatchEvent({type:"added"});const b=c.children.filter(v=>v!==C),y=b.indexOf(h);c.children=[...b.slice(0,y),C,...b.slice(y)],p=!0}p||(f=c.__r3f)==null||f.objects.push(C),C.__r3f||kC(C,{}),C.__r3f.parent=c,Nv(C),TC(C)}}function r(c,C,h=!1){c&&[...c].forEach(p=>o(C,p,h))}function o(c,C,h){if(C){var p,m,f;if(C.__r3f&&(C.__r3f.parent=null),(p=c.__r3f)!=null&&p.objects&&(c.__r3f.objects=c.__r3f.objects.filter(w=>w!==C)),(m=C.__r3f)!=null&&m.attach)DW(c,C,C.__r3f.attach);else if(C.isObject3D&&c.isObject3D){var b;c.remove(C),(b=C.__r3f)!=null&&b.root&&D8(C.__r3f.root,C)}const v=(f=C.__r3f)==null?void 0:f.primitive,G=h===void 0?C.dispose!==null&&!v:h;if(!v){var y;r((y=C.__r3f)==null?void 0:y.objects,C,G),r(C.children,C,G)}C.__r3f&&(delete C.__r3f.root,delete C.__r3f.objects,delete C.__r3f.handlers,delete C.__r3f.memoizedProps,v||delete C.__r3f),G&&C.dispose&&C.type!=="Scene"&&Yv.unstable_scheduleCallback(Yv.unstable_IdlePriority,()=>{try{C.dispose()}catch{}}),TC(c)}}function g(c,C,h,p){var m;const f=(m=c.__r3f)==null?void 0:m.parent;if(!f)return;const b=t(C,h,c.__r3f.root);if(c.children){for(const y of c.children)y.__r3f&&n(b,y);c.children=c.children.filter(y=>!y.__r3f)}c.__r3f.objects.forEach(y=>n(b,y)),c.__r3f.objects=[],c.__r3f.autoRemovedBeforeAppend||o(f,c),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),n(f,b),b.raycast&&b.__r3f.eventCount&&b.__r3f.root.getState().internal.interaction.push(b),[p,p.alternate].forEach(y=>{y!==null&&(y.stateNode=b,y.ref&&(typeof y.ref=="function"?y.ref(b):y.ref.current=b))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:F8({createInstance:t,removeChild:o,appendChild:n,appendInitialChild:n,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(c,C)=>{if(!C)return;const h=c.getState().scene;h.__r3f&&(h.__r3f.root=c,n(h,C))},removeChildFromContainer:(c,C)=>{C&&o(c.getState().scene,C)},insertInContainerBefore:(c,C,h)=>{if(!C||!h)return;const p=c.getState().scene;p.__r3f&&s(p,C,h)},getRootHostContext:()=>null,getChildHostContext:c=>c,finalizeInitialChildren(c){var C;return!!((C=c==null?void 0:c.__r3f)!=null?C:{}).handlers},prepareUpdate(c,C,h,p){if(c.__r3f.primitive&&p.object&&p.object!==c)return[!0];{const{args:m=[],children:f,...b}=p,{args:y=[],children:v,...G}=h;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((W,V)=>W!==y[V]))return[!0];const w=VH(c,b,G,!0);return w.changes.length?[!1,w]:null}},commitUpdate(c,[C,h],p,m,f,b){C?g(c,p,f,b):RB(c,h)},commitMount(c,C,h,p){var m;const f=(m=c.__r3f)!=null?m:{};c.raycast&&f.handlers&&f.eventCount&&c.__r3f.root.getState().internal.interaction.push(c)},getPublicInstance:c=>c,prepareForCommit:()=>null,preparePortalMount:c=>kC(c.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(c){var C;const{attach:h,parent:p}=(C=c.__r3f)!=null?C:{};h&&p&&DW(p,c,h),c.isObject3D&&(c.visible=!1),TC(c)},unhideInstance(c,C){var h;const{attach:p,parent:m}=(h=c.__r3f)!=null?h:{};p&&m&&SB(m,c,p),(c.isObject3D&&C.visible==null||C.visible)&&(c.visible=!0),TC(c)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>e?e():od.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&En.fun(performance.now)?performance.now:En.fun(Date.now)?Date.now:()=>0,scheduleTimeout:En.fun(setTimeout)?setTimeout:void 0,cancelTimeout:En.fun(clearTimeout)?clearTimeout:void 0}),applyProps:RB}}var _W,kW;const wB=i=>"colorSpace"in i||"outputColorSpace"in i,ZH=()=>{var i;return(i=zZ.ColorManagement)!=null?i:null},wH=i=>i&&i.isOrthographicCamera,L8=i=>i&&i.hasOwnProperty("current"),af=typeof window<"u"&&((_W=window.document)!=null&&_W.createElement||((kW=window.navigator)==null?void 0:kW.product)==="ReactNative")?T.useLayoutEffect:T.useEffect;function SH(i){const e=T.useRef(i);return af(()=>void(e.current=i),[i]),e}function z8({set:i}){return af(()=>(i(new Promise(()=>null)),()=>i(!1)),[i]),null}class RH extends T.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}RH.getDerivedStateFromError=()=>({error:!0});const WH="__default",TW=new Map,_8=i=>i&&!!i.memoized&&!!i.changes;function xH(i){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(i)?Math.min(Math.max(i[0],t),i[1]):i}const AA=i=>{var e;return(e=i.__r3f)==null?void 0:e.root.getState()},En={obj:i=>i===Object(i)&&!En.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",boo:i=>typeof i=="boolean",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e,{arrays:t="shallow",objects:n="reference",strict:s=!0}={}){if(typeof i!=typeof e||!!i!=!!e)return!1;if(En.str(i)||En.num(i))return i===e;const r=En.obj(i);if(r&&n==="reference")return i===e;const o=En.arr(i);if(o&&t==="reference")return i===e;if((o||r)&&i===e)return!0;let g;for(g in i)if(!(g in e))return!1;if(r&&t==="shallow"&&n==="shallow"){for(g in s?e:i)if(!En.equ(i[g],e[g],{strict:s,objects:"reference"}))return!1}else for(g in s?e:i)if(i[g]!==e[g])return!1;if(En.und(g)){if(o&&i.length===0&&e.length===0||r&&Object.keys(i).length===0&&Object.keys(e).length===0)return!0;if(i!==e)return!1}return!0}};function k8(i){const e={nodes:{},materials:{}};return i&&i.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function T8(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const e in i)e.dispose==null||e.dispose(),delete i[e]}function kC(i,e){const t=i;return(e!=null&&e.primitive||!t.__r3f)&&(t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e}),i}function Fv(i,e){let t=i;if(e.includes("-")){const n=e.split("-"),s=n.pop();return t=n.reduce((r,o)=>r[o],i),{target:t,key:s}}else return{target:t,key:e}}const EW=/-\d+$/;function SB(i,e,t){if(En.str(t)){if(EW.test(t)){const r=t.replace(EW,""),{target:o,key:g}=Fv(i,r);Array.isArray(o[g])||(o[g]=[])}const{target:n,key:s}=Fv(i,t);e.__r3f.previousAttach=n[s],n[s]=e}else e.__r3f.previousAttach=t(i,e)}function DW(i,e,t){var n,s;if(En.str(t)){const{target:r,key:o}=Fv(i,t),g=e.__r3f.previousAttach;g===void 0?delete r[o]:r[o]=g}else(n=e.__r3f)==null||n.previousAttach==null||n.previousAttach(i,e);(s=e.__r3f)==null||delete s.previousAttach}function VH(i,{children:e,key:t,ref:n,...s},{children:r,key:o,ref:g,...a}={},l=!1){var c;const C=(c=i==null?void 0:i.__r3f)!=null?c:{},h=Object.entries(s),p=[];if(l){const f=Object.keys(a);for(let b=0;b<f.length;b++)s.hasOwnProperty(f[b])||h.unshift([f[b],WH+"remove"])}h.forEach(([f,b])=>{var y;if((y=i.__r3f)!=null&&y.primitive&&f==="object"||En.equ(b,a[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return p.push([f,b,!0,[]]);let v=[];f.includes("-")&&(v=f.split("-")),p.push([f,b,!1,v]);for(const G in s){const w=s[G];G.startsWith(`${f}-`)&&p.push([G,w,!1,G.split("-")])}});const m={...s};return C.memoizedProps&&C.memoizedProps.args&&(m.args=C.memoizedProps.args),C.memoizedProps&&C.memoizedProps.attach&&(m.attach=C.memoizedProps.attach),{memoized:m,changes:p}}function RB(i,e){var t,n,s;const r=(t=i.__r3f)!=null?t:{},o=r.root,g=(n=o==null||o.getState==null?void 0:o.getState())!=null?n:{},{memoized:a,changes:l}=_8(e)?e:VH(i,e),c=r.eventCount;i.__r3f&&(i.__r3f.memoizedProps=a);for(let h=0;h<l.length;h++){let[p,m,f,b]=l[h];if(wB(i)){const w="srgb",W="srgb-linear";p==="encoding"?(p="colorSpace",m=m===3001?w:W):p==="outputEncoding"&&(p="outputColorSpace",m=m===3001?w:W)}let y=i,v=y[p];if(b.length&&(v=b.reduce((G,w)=>G[w],i),!(v&&v.set))){const[G,...w]=b.reverse();y=w.reverse().reduce((W,V)=>W[V],i),p=G}if(m===WH+"remove")if(y.constructor){let G=TW.get(y.constructor);G||(G=new y.constructor,TW.set(y.constructor,G)),m=G[p]}else m=0;if(f)m?r.handlers[p]=m:delete r.handlers[p],r.eventCount=Object.keys(r.handlers).length;else if(v&&v.set&&(v.copy||v instanceof lu)){if(Array.isArray(m))v.fromArray?v.fromArray(m):v.set(...m);else if(v.copy&&m&&m.constructor&&v.constructor===m.constructor)v.copy(m);else if(m!==void 0){const G=v instanceof et;!G&&v.setScalar?v.setScalar(m):v instanceof lu&&m instanceof lu?v.mask=m.mask:v.set(m),!ZH()&&!g.linear&&G&&v.convertSRGBToLinear()}}else if(y[p]=m,y[p]instanceof kn&&y[p].format===Zr&&y[p].type===ol){const G=y[p];wB(G)&&wB(g.gl)?G.colorSpace=g.gl.outputColorSpace:G.encoding=g.gl.outputEncoding}TC(i)}if(r.parent&&g.internal&&i.raycast&&c!==r.eventCount){const h=g.internal.interaction.indexOf(i);h>-1&&g.internal.interaction.splice(h,1),r.eventCount&&g.internal.interaction.push(i)}return!(l.length===1&&l[0][0]==="onUpdate")&&l.length&&(s=i.__r3f)!=null&&s.parent&&Nv(i),i}function TC(i){var e,t;const n=(e=i.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function Nv(i){i.onUpdate==null||i.onUpdate(i)}function HH(i,e){i.manual||(wH(i)?(i.left=e.width/-2,i.right=e.width/2,i.top=e.height/2,i.bottom=e.height/-2):i.aspect=e.width/e.height,i.updateProjectionMatrix(),i.updateMatrixWorld())}function y0(i){return(i.eventObject||i.object).uuid+"/"+i.index+i.instanceId}function E8(){var i;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return od.DefaultEventPriority;switch((i=e.event)==null?void 0:i.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return od.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return od.ContinuousEventPriority;default:return od.DefaultEventPriority}}function XH(i,e,t,n){const s=t.get(e);s&&(t.delete(e),t.size===0&&(i.delete(n),s.target.releasePointerCapture(n)))}function D8(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,s)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(s)}),t.capturedMap.forEach((n,s)=>{XH(t.capturedMap,e,n,s)})}function J8(i){function e(a){const{internal:l}=i.getState(),c=a.offsetX-l.initialClick[0],C=a.offsetY-l.initialClick[1];return Math.round(Math.sqrt(c*c+C*C))}function t(a){return a.filter(l=>["Move","Over","Enter","Out","Leave"].some(c=>{var C;return(C=l.__r3f)==null?void 0:C.handlers["onPointer"+c]}))}function n(a,l){const c=i.getState(),C=new Set,h=[],p=l?l(c.internal.interaction):c.internal.interaction;for(let y=0;y<p.length;y++){const v=AA(p[y]);v&&(v.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(a,c);function m(y){const v=AA(y);if(!v||!v.events.enabled||v.raycaster.camera===null)return[];if(v.raycaster.camera===void 0){var G;v.events.compute==null||v.events.compute(a,v,(G=v.previousRoot)==null?void 0:G.getState()),v.raycaster.camera===void 0&&(v.raycaster.camera=null)}return v.raycaster.camera?v.raycaster.intersectObject(y,!0):[]}let f=p.flatMap(m).sort((y,v)=>{const G=AA(y.object),w=AA(v.object);return!G||!w?y.distance-v.distance:w.events.priority-G.events.priority||y.distance-v.distance}).filter(y=>{const v=y0(y);return C.has(v)?!1:(C.add(v),!0)});c.events.filter&&(f=c.events.filter(f,c));for(const y of f){let v=y.object;for(;v;){var b;(b=v.__r3f)!=null&&b.eventCount&&h.push({...y,eventObject:v}),v=v.parent}}if("pointerId"in a&&c.internal.capturedMap.has(a.pointerId))for(let y of c.internal.capturedMap.get(a.pointerId).values())C.has(y0(y.intersection))||h.push(y.intersection);return h}function s(a,l,c,C){const h=i.getState();if(a.length){const p={stopped:!1};for(const m of a){const f=AA(m.object)||h,{raycaster:b,pointer:y,camera:v,internal:G}=f,w=new E(y.x,y.y,0).unproject(v),W=M=>{var L,re;return(L=(re=G.capturedMap.get(M))==null?void 0:re.has(m.eventObject))!=null?L:!1},V=M=>{const L={intersection:m,target:l.target};G.capturedMap.has(M)?G.capturedMap.get(M).set(m.eventObject,L):G.capturedMap.set(M,new Map([[m.eventObject,L]])),l.target.setPointerCapture(M)},X=M=>{const L=G.capturedMap.get(M);L&&XH(G.capturedMap,m.eventObject,L,M)};let R={};for(let M in l){let L=l[M];typeof L!="function"&&(R[M]=L)}let Y={...m,...R,pointer:y,intersections:a,stopped:p.stopped,delta:c,unprojectedPoint:w,ray:b.ray,camera:v,stopPropagation(){const M="pointerId"in l&&G.capturedMap.get(l.pointerId);if((!M||M.has(m.eventObject))&&(Y.stopped=p.stopped=!0,G.hovered.size&&Array.from(G.hovered.values()).find(L=>L.eventObject===m.eventObject))){const L=a.slice(0,a.indexOf(m));r([...L,m])}},target:{hasPointerCapture:W,setPointerCapture:V,releasePointerCapture:X},currentTarget:{hasPointerCapture:W,setPointerCapture:V,releasePointerCapture:X},nativeEvent:l};if(C(Y),p.stopped===!0)break}}return a}function r(a){const{internal:l}=i.getState();for(const c of l.hovered.values())if(!a.length||!a.find(C=>C.object===c.object&&C.index===c.index&&C.instanceId===c.instanceId)){const h=c.eventObject.__r3f,p=h==null?void 0:h.handlers;if(l.hovered.delete(y0(c)),h!=null&&h.eventCount){const m={...c,intersections:a};p.onPointerOut==null||p.onPointerOut(m),p.onPointerLeave==null||p.onPointerLeave(m)}}}function o(a,l){for(let c=0;c<l.length;c++){const C=l[c].__r3f;C==null||C.handlers.onPointerMissed==null||C.handlers.onPointerMissed(a)}}function g(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>r([]);case"onLostPointerCapture":return l=>{const{internal:c}=i.getState();"pointerId"in l&&c.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(l.pointerId)&&(c.capturedMap.delete(l.pointerId),r([]))})}}return function(c){const{onPointerMissed:C,internal:h}=i.getState();h.lastEvent.current=c;const p=a==="onPointerMove",m=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",b=n(c,p?t:void 0),y=m?e(c):0;a==="onPointerDown"&&(h.initialClick=[c.offsetX,c.offsetY],h.initialHits=b.map(G=>G.eventObject)),m&&!b.length&&y<=2&&(o(c,h.interaction),C&&C(c)),p&&r(b);function v(G){const w=G.eventObject,W=w.__r3f,V=W==null?void 0:W.handlers;if(W!=null&&W.eventCount)if(p){if(V.onPointerOver||V.onPointerEnter||V.onPointerOut||V.onPointerLeave){const X=y0(G),R=h.hovered.get(X);R?R.stopped&&G.stopPropagation():(h.hovered.set(X,G),V.onPointerOver==null||V.onPointerOver(G),V.onPointerEnter==null||V.onPointerEnter(G))}V.onPointerMove==null||V.onPointerMove(G)}else{const X=V[a];X?(!m||h.initialHits.includes(w))&&(o(c,h.interaction.filter(R=>!h.initialHits.includes(R))),X(G)):m&&h.initialHits.includes(w)&&o(c,h.interaction.filter(R=>!h.initialHits.includes(R)))}}s(b,c,y,v)}}return{handlePointer:g}}const U8=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],YH=i=>!!(i!=null&&i.render),kZ=T.createContext(null),P8=(i,e)=>{const t=gf((g,a)=>{const l=new E,c=new E,C=new E;function h(y=a().camera,v=c,G=a().size){const{width:w,height:W,top:V,left:X}=G,R=w/W;v instanceof E?C.copy(v):C.set(...v);const Y=y.getWorldPosition(l).distanceTo(C);if(wH(y))return{width:w/y.zoom,height:W/y.zoom,top:V,left:X,factor:1,distance:Y,aspect:R};{const M=y.fov*Math.PI/180,L=2*Math.tan(M/2)*Y,re=L*(w/W);return{width:re,height:L,top:V,left:X,factor:w/re,distance:Y,aspect:R}}}let p;const m=y=>g(v=>({performance:{...v.performance,current:y}})),f=new Fe;return{set:g,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(y=1)=>i(a(),y),advance:(y,v)=>e(y,v,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new FZ,pointer:f,mouse:f,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const y=a();p&&clearTimeout(p),y.performance.current!==y.performance.min&&m(y.performance.min),p=setTimeout(()=>m(a().performance.max),y.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:h},setEvents:y=>g(v=>({...v,events:{...v.events,...y}})),setSize:(y,v,G,w,W)=>{const V=a().camera,X={width:y,height:v,top:w||0,left:W||0,updateStyle:G};g(R=>({size:X,viewport:{...R.viewport,...h(V,c,X)}}))},setDpr:y=>g(v=>{const G=xH(y);return{viewport:{...v.viewport,dpr:G,initialDpr:v.viewport.initialDpr||G}}}),setFrameloop:(y="always")=>{const v=a().clock;v.stop(),v.elapsedTime=0,y!=="never"&&(v.start(),v.elapsedTime=0),g(()=>({frameloop:y}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:T.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(y,v,G)=>{const w=a().internal;return w.priority=w.priority+(v>0?1:0),w.subscribers.push({ref:y,priority:v,store:G}),w.subscribers=w.subscribers.sort((W,V)=>W.priority-V.priority),()=>{const W=a().internal;W!=null&&W.subscribers&&(W.priority=W.priority-(v>0?1:0),W.subscribers=W.subscribers.filter(V=>V.ref!==y))}}}}}),n=t.getState();let s=n.size,r=n.viewport.dpr,o=n.camera;return t.subscribe(()=>{const{camera:g,size:a,viewport:l,gl:c,set:C}=t.getState();if(a!==s||l.dpr!==r){var h;s=a,r=l.dpr,HH(g,a),c.setPixelRatio(l.dpr);const p=(h=a.updateStyle)!=null?h:typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(a.width,a.height,p)}g!==o&&(o=g,C(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(g)}})))}),t.subscribe(g=>i(g)),t};function O8(i,e){const t={callback:i};return e.add(t),()=>void e.delete(t)}let B0,FH=new Set,Q8=new Set,j8=new Set;const q8=i=>O8(i,FH);function WB(i,e){if(i.size)for(const{callback:t}of i.values())t(e)}function pA(i,e){switch(i){case"before":return WB(FH,e);case"after":return WB(Q8,e);case"tail":return WB(j8,e)}}let xB,VB;function HB(i,e,t){let n=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(n=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),xB=e.internal.subscribers,B0=0;B0<xB.length;B0++)VB=xB[B0],VB.ref.current(VB.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function $8(i){let e=!1,t,n,s;function r(a){n=requestAnimationFrame(r),e=!0,t=0,pA("before",a);for(const c of i.values()){var l;s=c.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((l=s.gl.xr)!=null&&l.isPresenting)&&(t+=HB(a,s))}if(pA("after",a),t===0)return pA("tail",a),e=!1,cancelAnimationFrame(n)}function o(a,l=1){var c;if(!a)return i.forEach(C=>o(C.store.getState()),l);(c=a.gl.xr)!=null&&c.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+l),e||(e=!0,requestAnimationFrame(r)))}function g(a,l=!0,c,C){if(l&&pA("before",a),c)HB(a,c,C);else for(const h of i.values())HB(a,h.store.getState());l&&pA("after",a)}return{loop:r,invalidate:o,advance:g}}function TZ(){const i=T.useContext(kZ);if(!i)throw new Error("R3F: Hooks can only be used within the Canvas component!");return i}function Ui(i=t=>t,e){return TZ()(i,e)}function Aa(i,e=0){const t=TZ(),n=t.getState().internal.subscribe,s=SH(i);return af(()=>n(s,e,t),[e,n,t]),null}function NH(i,e){return function(t,...n){const s=new t;return i&&i(s),Promise.all(n.map(r=>new Promise((o,g)=>s.load(r,a=>{a.scene&&Object.assign(a,k8(a.scene)),o(a)},e,a=>g(new Error(`Could not load ${r}: ${a.message})`))))))}}function Yu(i,e,t,n){const s=Array.isArray(e)?e:[e],r=vH(NH(t,n),[i,...s],{equal:En.equ});return Array.isArray(e)?r:r[0]}Yu.preload=function(i,e,t){const n=Array.isArray(e)?e:[e];return N8(NH(t),[i,...n])};Yu.clear=function(i,e){const t=Array.isArray(e)?e:[e];return M8([i,...t])};const Nd=new Map,{invalidate:JW,advance:UW}=$8(Nd),{reconciler:Rp,applyProps:LC}=K8(Nd,E8),zC={objects:"shallow",strict:!1},eP=(i,e)=>{const t=typeof i=="function"?i(e):i;return YH(t)?t:new pZ({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...i})};function tP(i,e){if(e)return e;if(typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement&&i.parentElement){const{width:t,height:n,top:s,left:r}=i.parentElement.getBoundingClientRect();return{width:t,height:n,top:s,left:r}}else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas)return{width:i.width,height:i.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function nP(i){const e=Nd.get(i),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,r=n||P8(JW,UW),o=t||Rp.createContainer(r,od.ConcurrentRoot,null,!1,null,"",s,null);e||Nd.set(i,{fiber:o,store:r});let g,a=!1,l;return{configure(c={}){let{gl:C,size:h,scene:p,events:m,onCreated:f,shadows:b=!1,linear:y=!1,flat:v=!1,legacy:G=!1,orthographic:w=!1,frameloop:W="always",dpr:V=[1,2],performance:X,raycaster:R,camera:Y,onPointerMissed:M}=c,L=r.getState(),re=L.gl;L.gl||L.set({gl:re=eP(C,i)});let j=L.raycaster;j||L.set({raycaster:j=new LZ});const{params:$,...ie}=R||{};if(En.equ(ie,j,zC)||LC(j,{...ie}),En.equ($,j.params,zC)||LC(j,{params:{...j.params,...$}}),!L.camera||L.camera===l&&!En.equ(l,Y,zC)){l=Y;const q=Y instanceof Dp,se=q?Y:w?new co(0,0,0,0,.1,1e3):new Dn(75,0,.1,1e3);q||(se.position.z=5,Y&&LC(se,Y),!L.camera&&!(Y!=null&&Y.rotation)&&se.lookAt(0,0,0)),L.set({camera:se})}if(!L.scene){let q;p instanceof yp?q=p:(q=new yp,p&&LC(q,p)),L.set({scene:kC(q)})}if(!L.xr){const q=(Ae,We)=>{const me=r.getState();me.frameloop!=="never"&&UW(Ae,!0,me,We)},se=()=>{const Ae=r.getState();Ae.gl.xr.enabled=Ae.gl.xr.isPresenting,Ae.gl.xr.setAnimationLoop(Ae.gl.xr.isPresenting?q:null),Ae.gl.xr.isPresenting||JW(Ae)},ue={connect(){const Ae=r.getState().gl;Ae.xr.addEventListener("sessionstart",se),Ae.xr.addEventListener("sessionend",se)},disconnect(){const Ae=r.getState().gl;Ae.xr.removeEventListener("sessionstart",se),Ae.xr.removeEventListener("sessionend",se)}};re.xr&&ue.connect(),L.set({xr:ue})}if(re.shadowMap){const q=re.shadowMap.enabled,se=re.shadowMap.type;if(re.shadowMap.enabled=!!b,En.boo(b))re.shadowMap.type=UA;else if(En.str(b)){var he;const ue={basic:vx,percentage:aG,soft:UA,variance:QI};re.shadowMap.type=(he=ue[b])!=null?he:UA}else En.obj(b)&&Object.assign(re.shadowMap,b);(q!==re.shadowMap.enabled||se!==re.shadowMap.type)&&(re.shadowMap.needsUpdate=!0)}const le=ZH();le&&("enabled"in le?le.enabled=!G:"legacyMode"in le&&(le.legacyMode=G)),LC(re,{outputEncoding:y?3e3:3001,toneMapping:v?Wg:rZ}),L.legacy!==G&&L.set(()=>({legacy:G})),L.linear!==y&&L.set(()=>({linear:y})),L.flat!==v&&L.set(()=>({flat:v})),C&&!En.fun(C)&&!YH(C)&&!En.equ(C,re,zC)&&LC(re,C),m&&!L.events.handlers&&L.set({events:m(r)});const te=tP(i,h);return En.equ(te,L.size,zC)||L.setSize(te.width,te.height,te.updateStyle,te.top,te.left),V&&L.viewport.dpr!==xH(V)&&L.setDpr(V),L.frameloop!==W&&L.setFrameloop(W),L.onPointerMissed||L.set({onPointerMissed:M}),X&&!En.equ(X,L.performance,zC)&&L.set(q=>({performance:{...q.performance,...X}})),g=f,a=!0,this},render(c){return a||this.configure(),Rp.updateContainer(T.createElement(iP,{store:r,children:c,onCreated:g,rootElement:i}),o,null,()=>{}),r},unmount(){MH(i)}}}function iP({store:i,children:e,onCreated:t,rootElement:n}){return af(()=>{const s=i.getState();s.set(r=>({internal:{...r.internal,active:!0}})),t&&t(s),i.getState().events.connected||s.events.connect==null||s.events.connect(n)},[]),T.createElement(kZ.Provider,{value:i},e)}function MH(i,e){const t=Nd.get(i),n=t==null?void 0:t.fiber;if(n){const s=t==null?void 0:t.store.getState();s&&(s.internal.active=!1),Rp.updateContainer(null,n,null,()=>{s&&setTimeout(()=>{try{var r,o,g,a;s.events.disconnect==null||s.events.disconnect(),(r=s.gl)==null||(o=r.renderLists)==null||o.dispose==null||o.dispose(),(g=s.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),T8(s),Nd.delete(i),e&&e(i)}catch{}},500)})}}function sP(i,e,t){return T.createElement(rP,{key:e.uuid,children:i,container:e,state:t})}function rP({state:i={},children:e,container:t}){const{events:n,size:s,...r}=i,o=TZ(),[g]=T.useState(()=>new LZ),[a]=T.useState(()=>new Fe),l=T.useCallback((C,h)=>{const p={...C};Object.keys(C).forEach(f=>{(U8.includes(f)||C[f]!==h[f]&&h[f])&&delete p[f]});let m;if(h&&s){const f=h.camera;m=C.viewport.getCurrentViewport(f,new E,s),f!==C.camera&&HH(f,s)}return{...p,scene:t,raycaster:g,pointer:a,mouse:a,previousRoot:o,events:{...C.events,...h==null?void 0:h.events,...n},size:{...C.size,...s},viewport:{...C.viewport,...m},...r}},[i]),[c]=T.useState(()=>{const C=o.getState();return gf((p,m)=>({...C,scene:t,raycaster:g,pointer:a,mouse:a,previousRoot:o,events:{...C.events,...n},size:{...C.size,...s},...r,set:p,get:m,setEvents:f=>p(b=>({...b,events:{...b.events,...f}}))}))});return T.useEffect(()=>{const C=o.subscribe(h=>c.setState(p=>l(h,p)));return()=>{C(),c.destroy()}},[]),T.useEffect(()=>{c.setState(C=>l(o.getState(),C))},[l]),T.createElement(T.Fragment,null,Rp.createPortal(T.createElement(kZ.Provider,{value:c},e),c,null))}Rp.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:T.version});function Ls(){return Ls=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Ls.apply(this,arguments)}function Mv(i,e,t){var n,s,r,o,g;e==null&&(e=100);function a(){var c=Date.now()-o;c<e&&c>=0?n=setTimeout(a,e-c):(n=null,t||(g=i.apply(r,s),r=s=null))}var l=function(){r=this,s=arguments,o=Date.now();var c=t&&!n;return n||(n=setTimeout(a,e)),c&&(g=i.apply(r,s),r=s=null),g};return l.clear=function(){n&&(clearTimeout(n),n=null)},l.flush=function(){n&&(g=i.apply(r,s),r=s=null,clearTimeout(n),n=null)},l}Mv.debounce=Mv;var oP=Mv;const PW=Db(oP);function gP(i){let{debounce:e,scroll:t,polyfill:n,offsetSize:s}=i===void 0?{debounce:0,scroll:!1,offsetSize:!1}:i;const r=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,g]=T.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=T.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o}),l=e?typeof e=="number"?e:e.scroll:null,c=e?typeof e=="number"?e:e.resize:null,C=T.useRef(!1);T.useEffect(()=>(C.current=!0,()=>void(C.current=!1)));const[h,p,m]=T.useMemo(()=>{const v=()=>{if(!a.current.element)return;const{left:G,top:w,width:W,height:V,bottom:X,right:R,x:Y,y:M}=a.current.element.getBoundingClientRect(),L={left:G,top:w,width:W,height:V,bottom:X,right:R,x:Y,y:M};a.current.element instanceof HTMLElement&&s&&(L.height=a.current.element.offsetHeight,L.width=a.current.element.offsetWidth),Object.freeze(L),C.current&&!IP(a.current.lastBounds,L)&&g(a.current.lastBounds=L)};return[v,c?PW(v,c):v,l?PW(v,l):v]},[g,s,l,c]);function f(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(v=>v.removeEventListener("scroll",m,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null)}function b(){a.current.element&&(a.current.resizeObserver=new r(m),a.current.resizeObserver.observe(a.current.element),t&&a.current.scrollContainers&&a.current.scrollContainers.forEach(v=>v.addEventListener("scroll",m,{capture:!0,passive:!0})))}const y=v=>{!v||v===a.current.element||(f(),a.current.element=v,a.current.scrollContainers=KH(v),b())};return lP(m,!!t),aP(p),T.useEffect(()=>{f(),b()},[t,m,p]),T.useEffect(()=>f,[]),[y,o,h]}function aP(i){T.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function lP(i,e){T.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function KH(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:s}=window.getComputedStyle(i);return[t,n,s].some(r=>r==="auto"||r==="scroll")&&e.push(i),[...e,...KH(i.parentElement)]}const cP=["x","y","top","bottom","left","right","width","height"],IP=(i,e)=>cP.every(t=>i[t]===e[t]);var uP=Object.defineProperty,CP=Object.defineProperties,dP=Object.getOwnPropertyDescriptors,OW=Object.getOwnPropertySymbols,hP=Object.prototype.hasOwnProperty,AP=Object.prototype.propertyIsEnumerable,QW=(i,e,t)=>e in i?uP(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,jW=(i,e)=>{for(var t in e||(e={}))hP.call(e,t)&&QW(i,t,e[t]);if(OW)for(var t of OW(e))AP.call(e,t)&&QW(i,t,e[t]);return i},pP=(i,e)=>CP(i,dP(e));function LH(i,e,t){if(!i)return;if(t(i)===!0)return i;let n=e?i.return:i.child;for(;n;){const s=LH(n,e,t);if(s)return s;n=e?null:n.sibling}}function zH(i){try{return Object.defineProperties(i,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return i}}const EZ=zH(T.createContext(null));class _H extends T.Component{render(){return T.createElement(EZ.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:qW,ReactCurrentDispatcher:$W}=T.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function fP(){const i=T.useContext(EZ);if(i===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=T.useId();return T.useMemo(()=>{for(const n of[qW==null?void 0:qW.current,i,i==null?void 0:i.alternate]){if(!n)continue;const s=LH(n,!1,r=>{let o=r.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(s)return s}},[i,e])}function mP(){var i,e;const t=fP(),[n]=T.useState(()=>new Map);n.clear();let s=t;for(;s;){const r=(i=s.type)==null?void 0:i._context;r&&r!==EZ&&!n.has(r)&&n.set(r,(e=$W==null?void 0:$W.current)==null?void 0:e.readContext(zH(r))),s=s.return}return n}function bP(){const i=mP();return T.useMemo(()=>Array.from(i.keys()).reduce((e,t)=>n=>T.createElement(e,null,T.createElement(t.Provider,pP(jW({},n),{value:i.get(t)}))),e=>T.createElement(_H,jW({},e))),[i])}const XB={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function GP(i){const{handlePointer:e}=J8(i);return{priority:1,enabled:!0,compute(t,n,s){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(XB).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:s}=i.getState();(t=s.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(s.lastEvent.current)},connect:t=>{var n;const{set:s,events:r}=i.getState();r.disconnect==null||r.disconnect(),s(o=>({events:{...o.events,connected:t}})),Object.entries((n=r.handlers)!=null?n:[]).forEach(([o,g])=>{const[a,l]=XB[o];t.addEventListener(a,g,{passive:l})})},disconnect:()=>{const{set:t,events:n}=i.getState();if(n.connected){var s;Object.entries((s=n.handlers)!=null?s:[]).forEach(([r,o])=>{if(n&&n.connected instanceof HTMLElement){const[g]=XB[r];n.connected.removeEventListener(g,o)}}),t(r=>({events:{...r.events,connected:void 0}}))}}}}const yP=T.forwardRef(function({children:e,fallback:t,resize:n,style:s,gl:r,events:o=GP,eventSource:g,eventPrefix:a,shadows:l,linear:c,flat:C,legacy:h,orthographic:p,frameloop:m,dpr:f,performance:b,raycaster:y,camera:v,onPointerMissed:G,onCreated:w,...W},V){T.useMemo(()=>_Z(x8),[]);const X=bP(),[R,Y]=gP({scroll:!0,debounce:{scroll:50,resize:0},...n}),M=T.useRef(null),L=T.useRef(null);T.useImperativeHandle(V,()=>M.current);const re=SH(G),[j,$]=T.useState(!1),[ie,he]=T.useState(!1);if(j)throw j;if(ie)throw ie;const le=T.useRef(null);af(()=>{const ne=M.current;Y.width>0&&Y.height>0&&ne&&(le.current||(le.current=nP(ne)),le.current.configure({gl:r,events:o,shadows:l,linear:c,flat:C,legacy:h,orthographic:p,frameloop:m,dpr:f,performance:b,raycaster:y,camera:v,size:Y,onPointerMissed:(...te)=>re.current==null?void 0:re.current(...te),onCreated:te=>{te.events.connect==null||te.events.connect(g?L8(g)?g.current:g:L.current),a&&te.setEvents({compute:(q,se)=>{const ue=q[a+"X"],Ae=q[a+"Y"];se.pointer.set(ue/se.size.width*2-1,-(Ae/se.size.height)*2+1),se.raycaster.setFromCamera(se.pointer,se.camera)}}),w==null||w(te)}}),le.current.render(T.createElement(X,null,T.createElement(RH,{set:he},T.createElement(T.Suspense,{fallback:T.createElement(z8,{set:$})},e)))))}),T.useEffect(()=>{const ne=M.current;if(ne)return()=>MH(ne)},[]);const _=g?"none":"auto";return T.createElement("div",Ls({ref:L,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:_,...s}},W),T.createElement("div",{ref:R,style:{width:"100%",height:"100%"}},T.createElement("canvas",{ref:M,style:{display:"block"}},t)))}),BP=T.forwardRef(function(e,t){return T.createElement(_H,null,T.createElement(yP,Ls({},e,{ref:t})))});function ka(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function kH(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}/*!
 * GSAP 3.11.5
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Io={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Md={duration:.5,overwrite:!1,delay:0},DZ,_s,Ki,Uo=1e8,Kn=1/Uo,Kv=Math.PI*2,vP=Kv/4,ZP=0,TH=Math.sqrt,wP=Math.cos,SP=Math.sin,us=function(e){return typeof e=="string"},bi=function(e){return typeof e=="function"},cl=function(e){return typeof e=="number"},JZ=function(e){return typeof e>"u"},da=function(e){return typeof e=="object"},Hr=function(e){return e!==!1},UZ=function(){return typeof window<"u"},v0=function(e){return bi(e)||us(e)},EH=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ks=Array.isArray,Lv=/(?:-?\.?\d|\.)+/gi,DH=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,gd=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,YB=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,JH=/[+-]=-?[.\d]+/,UH=/[^,'"\[\]\s]+/gi,RP=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,ri,Mo,zv,PZ,ho={},Fb={},PH,OH=function(e){return(Fb=Zu(e,ho))&&Fr},OZ=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Nb=function(e,t){return!t&&console.warn(e)},QH=function(e,t){return e&&(ho[e]=t)&&Fb&&(Fb[e]=t)||ho},Wp=function(){return 0},WP={suppressEvents:!0,isStart:!0,kill:!1},tb={suppressEvents:!0,kill:!1},xP={suppressEvents:!0},QZ={},Sc=[],_v={},jH,no={},FB={},e3=30,nb=[],jZ="",qZ=function(e){var t=e[0],n,s;if(da(t)||bi(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(s=nb.length;s--&&!nb[s].targetTest(t););n=nb[s]}for(s=e.length;s--;)e[s]&&(e[s]._gsap||(e[s]._gsap=new GX(e[s],n)))||e.splice(s,1);return e},Iu=function(e){return e._gsap||qZ(Po(e))[0]._gsap},qH=function(e,t,n){return(n=e[t])&&bi(n)?e[t]():JZ(n)&&e.getAttribute&&e.getAttribute(t)||n},Xr=function(e,t){return(e=e.split(",")).forEach(t)||e},Wi=function(e){return Math.round(e*1e5)/1e5||0},fs=function(e){return Math.round(e*1e7)/1e7||0},Ad=function(e,t){var n=t.charAt(0),s=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+s:n==="-"?e-s:n==="*"?e*s:e/s},VP=function(e,t){for(var n=t.length,s=0;e.indexOf(t[s])<0&&++s<n;);return s<n},Mb=function(){var e=Sc.length,t=Sc.slice(0),n,s;for(_v={},Sc.length=0,n=0;n<e;n++)s=t[n],s&&s._lazy&&(s.render(s._lazy[0],s._lazy[1],!0)._lazy=0)},$H=function(e,t,n,s){Sc.length&&!_s&&Mb(),e.render(t,n,s||_s&&t<0&&(e._initted||e._startAt)),Sc.length&&!_s&&Mb()},eX=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(UH).length<2?t:us(e)?e.trim():e},tX=function(e){return e},tg=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},HP=function(e){return function(t,n){for(var s in n)s in t||s==="duration"&&e||s==="ease"||(t[s]=n[s])}},Zu=function(e,t){for(var n in t)e[n]=t[n];return e},t3=function i(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=da(t[n])?i(e[n]||(e[n]={}),t[n]):t[n]);return e},Kb=function(e,t){var n={},s;for(s in e)s in t||(n[s]=e[s]);return n},jA=function(e){var t=e.parent||ri,n=e.keyframes?HP(ks(e.keyframes)):tg;if(Hr(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},XP=function(e,t){for(var n=e.length,s=n===t.length;s&&n--&&e[n]===t[n];);return n<0},nX=function(e,t,n,s,r){n===void 0&&(n="_first"),s===void 0&&(s="_last");var o=e[s],g;if(r)for(g=t[r];o&&o[r]>g;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[s]=t,t._prev=o,t.parent=t._dp=e,t},RG=function(e,t,n,s){n===void 0&&(n="_first"),s===void 0&&(s="_last");var r=t._prev,o=t._next;r?r._next=o:e[n]===t&&(e[n]=o),o?o._prev=r:e[s]===t&&(e[s]=r),t._next=t._prev=t.parent=null},Yc=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},uu=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},YP=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},kv=function(e,t,n,s){return e._startAt&&(_s?e._startAt.revert(tb):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,s))},FP=function i(e){return!e||e._ts&&i(e.parent)},n3=function(e){return e._repeat?Kd(e._tTime,e=e.duration()+e._rDelay)*e:0},Kd=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},Lb=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},WG=function(e){return e._end=fs(e._start+(e._tDur/Math.abs(e._ts||e._rts||Kn)||0))},xG=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=fs(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),WG(e),n._dirty||uu(n,e)),e},iX=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=Lb(e.rawTime(),t),(!t._dur||lf(0,t.totalDuration(),n)-t._tTime>Kn)&&t.render(n,!0)),uu(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-Kn}},oa=function(e,t,n,s){return t.parent&&Yc(t),t._start=fs((cl(n)?n:n||e!==ri?No(e,n,t):e._time)+t._delay),t._end=fs(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),nX(e,t,"_first","_last",e._sort?"_start":0),Tv(t)||(e._recent=t),s||iX(e,t),e._ts<0&&xG(e,e._tTime),e},sX=function(e,t){return(ho.ScrollTrigger||OZ("scrollTrigger",t))&&ho.ScrollTrigger.create(t,e)},rX=function(e,t,n,s,r){if(ew(e,t,r),!e._initted)return 1;if(!n&&e._pt&&!_s&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&jH!==so.frame)return Sc.push(e),e._lazy=[r,s],1},NP=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},Tv=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},MP=function(e,t,n,s){var r=e.ratio,o=t<0||!t&&(!e._start&&NP(e)&&!(!e._initted&&Tv(e))||(e._ts<0||e._dp._ts<0)&&!Tv(e))?0:1,g=e._rDelay,a=0,l,c,C;if(g&&e._repeat&&(a=lf(0,e._tDur,t),c=Kd(a,g),e._yoyo&&c&1&&(o=1-o),c!==Kd(e._tTime,g)&&(r=1-o,e.vars.repeatRefresh&&e._initted&&e.invalidate())),o!==r||_s||s||e._zTime===Kn||!t&&e._zTime){if(!e._initted&&rX(e,t,s,n,a))return;for(C=e._zTime,e._zTime=t||(n?Kn:0),n||(n=t&&!C),e.ratio=o,e._from&&(o=1-o),e._time=0,e._tTime=a,l=e._pt;l;)l.r(o,l.d),l=l._next;t<0&&kv(e,t,n,!0),e._onUpdate&&!n&&Oo(e,"onUpdate"),a&&e._repeat&&!n&&e.parent&&Oo(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===o&&(o&&Yc(e,1),!n&&!_s&&(Oo(e,o?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},KP=function(e,t,n){var s;if(n>t)for(s=e._first;s&&s._start<=n;){if(s.data==="isPause"&&s._start>t)return s;s=s._next}else for(s=e._last;s&&s._start>=n;){if(s.data==="isPause"&&s._start<t)return s;s=s._prev}},Ld=function(e,t,n,s){var r=e._repeat,o=fs(t)||0,g=e._tTime/e._tDur;return g&&!s&&(e._time*=o/e._dur),e._dur=o,e._tDur=r?r<0?1e10:fs(o*(r+1)+e._rDelay*r):o,g>0&&!s&&xG(e,e._tTime=e._tDur*g),e.parent&&WG(e),n||uu(e.parent,e),e},i3=function(e){return e instanceof wr?uu(e):Ld(e,e._dur)},LP={_start:0,endTime:Wp,totalDuration:Wp},No=function i(e,t,n){var s=e.labels,r=e._recent||LP,o=e.duration()>=Uo?r.endTime(!1):e._dur,g,a,l;return us(t)&&(isNaN(t)||t in s)?(a=t.charAt(0),l=t.substr(-1)==="%",g=t.indexOf("="),a==="<"||a===">"?(g>=0&&(t=t.replace(/=/,"")),(a==="<"?r._start:r.endTime(r._repeat>=0))+(parseFloat(t.substr(1))||0)*(l?(g<0?r:n).totalDuration()/100:1)):g<0?(t in s||(s[t]=o),s[t]):(a=parseFloat(t.charAt(g-1)+t.substr(g+1)),l&&n&&(a=a/100*(ks(n)?n[0]:n).totalDuration()),g>1?i(e,t.substr(0,g-1),n)+a:o+a)):t==null?o:+t},qA=function(e,t,n){var s=cl(t[1]),r=(s?2:1)+(e<2?0:1),o=t[r],g,a;if(s&&(o.duration=t[1]),o.parent=n,e){for(g=o,a=n;a&&!("immediateRender"in g);)g=a.vars.defaults||{},a=Hr(a.vars.inherit)&&a.parent;o.immediateRender=Hr(g.immediateRender),e<2?o.runBackwards=1:o.startAt=t[r-1]}return new Ji(t[0],o,t[r+1])},kc=function(e,t){return e||e===0?t(e):t},lf=function(e,t,n){return n<e?e:n>t?t:n},zs=function(e,t){return!us(e)||!(t=RP.exec(e))?"":t[1]},zP=function(e,t,n){return kc(n,function(s){return lf(e,t,s)})},Ev=[].slice,oX=function(e,t){return e&&da(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&da(e[0]))&&!e.nodeType&&e!==Mo},_P=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(s){var r;return us(s)&&!t||oX(s,1)?(r=n).push.apply(r,Po(s)):n.push(s)})||n},Po=function(e,t,n){return Ki&&!t&&Ki.selector?Ki.selector(e):us(e)&&!n&&(zv||!zd())?Ev.call((t||PZ).querySelectorAll(e),0):ks(e)?_P(e,n):oX(e)?Ev.call(e,0):e?[e]:[]},Dv=function(e){return e=Po(e)[0]||Nb("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Po(t,n.querySelectorAll?n:n===e?Nb("Invalid scope")||PZ.createElement("div"):e)}},gX=function(e){return e.sort(function(){return .5-Math.random()})},aX=function(e){if(bi(e))return e;var t=da(e)?e:{each:e},n=Cu(t.ease),s=t.from||0,r=parseFloat(t.base)||0,o={},g=s>0&&s<1,a=isNaN(s)||g,l=t.axis,c=s,C=s;return us(s)?c=C={center:.5,edges:.5,end:1}[s]||0:!g&&a&&(c=s[0],C=s[1]),function(h,p,m){var f=(m||t).length,b=o[f],y,v,G,w,W,V,X,R,Y;if(!b){if(Y=t.grid==="auto"?0:(t.grid||[1,Uo])[1],!Y){for(X=-Uo;X<(X=m[Y++].getBoundingClientRect().left)&&Y<f;);Y--}for(b=o[f]=[],y=a?Math.min(Y,f)*c-.5:s%Y,v=Y===Uo?0:a?f*C/Y-.5:s/Y|0,X=0,R=Uo,V=0;V<f;V++)G=V%Y-y,w=v-(V/Y|0),b[V]=W=l?Math.abs(l==="y"?w:G):TH(G*G+w*w),W>X&&(X=W),W<R&&(R=W);s==="random"&&gX(b),b.max=X-R,b.min=R,b.v=f=(parseFloat(t.amount)||parseFloat(t.each)*(Y>f?f-1:l?l==="y"?f/Y:Y:Math.max(Y,f/Y))||0)*(s==="edges"?-1:1),b.b=f<0?r-f:r,b.u=zs(t.amount||t.each)||0,n=n&&f<0?fX(n):n}return f=(b[h]-b.min)/b.max||0,fs(b.b+(n?n(f):f)*b.v)+b.u}},Jv=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var s=fs(Math.round(parseFloat(n)/e)*e*t);return(s-s%1)/t+(cl(n)?0:zs(n))}},lX=function(e,t){var n=ks(e),s,r;return!n&&da(e)&&(s=n=e.radius||Uo,e.values?(e=Po(e.values),(r=!cl(e[0]))&&(s*=s)):e=Jv(e.increment)),kc(t,n?bi(e)?function(o){return r=e(o),Math.abs(r-o)<=s?r:o}:function(o){for(var g=parseFloat(r?o.x:o),a=parseFloat(r?o.y:0),l=Uo,c=0,C=e.length,h,p;C--;)r?(h=e[C].x-g,p=e[C].y-a,h=h*h+p*p):h=Math.abs(e[C]-g),h<l&&(l=h,c=C);return c=!s||l<=s?e[c]:o,r||c===o||cl(o)?c:c+zs(o)}:Jv(e))},cX=function(e,t,n,s){return kc(ks(e)?!t:n===!0?!!(n=0):!s,function(){return ks(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(s=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*s)/s})},kP=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){return t.reduce(function(r,o){return o(r)},s)}},TP=function(e,t){return function(n){return e(parseFloat(n))+(t||zs(n))}},EP=function(e,t,n){return uX(e,t,0,1,n)},IX=function(e,t,n){return kc(n,function(s){return e[~~t(s)]})},DP=function i(e,t,n){var s=t-e;return ks(e)?IX(e,i(0,e.length),t):kc(n,function(r){return(s+(r-e)%s)%s+e})},JP=function i(e,t,n){var s=t-e,r=s*2;return ks(e)?IX(e,i(0,e.length-1),t):kc(n,function(o){return o=(r+(o-e)%r)%r||0,e+(o>s?r-o:o)})},xp=function(e){for(var t=0,n="",s,r,o,g;~(s=e.indexOf("random(",t));)o=e.indexOf(")",s),g=e.charAt(s+7)==="[",r=e.substr(s+7,o-s-7).match(g?UH:Lv),n+=e.substr(t,s-t)+cX(g?r:+r[0],g?0:+r[1],+r[2]||1e-5),t=o+1;return n+e.substr(t,e.length-t)},uX=function(e,t,n,s,r){var o=t-e,g=s-n;return kc(r,function(a){return n+((a-e)/o*g||0)})},UP=function i(e,t,n,s){var r=isNaN(e+t)?0:function(p){return(1-p)*e+p*t};if(!r){var o=us(e),g={},a,l,c,C,h;if(n===!0&&(s=1)&&(n=null),o)e={p:e},t={p:t};else if(ks(e)&&!ks(t)){for(c=[],C=e.length,h=C-2,l=1;l<C;l++)c.push(i(e[l-1],e[l]));C--,r=function(m){m*=C;var f=Math.min(h,~~m);return c[f](m-f)},n=t}else s||(e=Zu(ks(e)?[]:{},e));if(!c){for(a in t)$Z.call(g,e,a,"get",t[a]);r=function(m){return iw(m,g)||(o?e.p:e)}}}return kc(n,r)},s3=function(e,t,n){var s=e.labels,r=Uo,o,g,a;for(o in s)g=s[o]-t,g<0==!!n&&g&&r>(g=Math.abs(g))&&(a=o,r=g);return a},Oo=function(e,t,n){var s=e.vars,r=s[t],o=Ki,g=e._ctx,a,l,c;if(r)return a=s[t+"Params"],l=s.callbackScope||e,n&&Sc.length&&Mb(),g&&(Ki=g),c=a?r.apply(l,a):r.call(l),Ki=o,c},NA=function(e){return Yc(e),e.scrollTrigger&&e.scrollTrigger.kill(!!_s),e.progress()<1&&Oo(e,"onInterrupt"),e},ad,CX=[],dX=function(e){if(!UZ()){CX.push(e);return}e=!e.name&&e.default||e;var t=e.name,n=bi(e),s=t&&!n&&e.init?function(){this._props=[]}:e,r={init:Wp,render:iw,add:$Z,kill:l7,modifier:a7,rawVars:0},o={targetTest:0,get:0,getSetter:nw,aliases:{},register:0};if(zd(),e!==s){if(no[t])return;tg(s,tg(Kb(e,r),o)),Zu(s.prototype,Zu(r,Kb(e,o))),no[s.prop=t]=s,e.targetTest&&(nb.push(s),QZ[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}QH(t,s),e.register&&e.register(Fr,s,Yr)},Nn=255,MA={aqua:[0,Nn,Nn],lime:[0,Nn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Nn],navy:[0,0,128],white:[Nn,Nn,Nn],olive:[128,128,0],yellow:[Nn,Nn,0],orange:[Nn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Nn,0,0],pink:[Nn,192,203],cyan:[0,Nn,Nn],transparent:[Nn,Nn,Nn,0]},NB=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Nn+.5|0},hX=function(e,t,n){var s=e?cl(e)?[e>>16,e>>8&Nn,e&Nn]:0:MA.black,r,o,g,a,l,c,C,h,p,m;if(!s){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),MA[e])s=MA[e];else if(e.charAt(0)==="#"){if(e.length<6&&(r=e.charAt(1),o=e.charAt(2),g=e.charAt(3),e="#"+r+r+o+o+g+g+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return s=parseInt(e.substr(1,6),16),[s>>16,s>>8&Nn,s&Nn,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),s=[e>>16,e>>8&Nn,e&Nn]}else if(e.substr(0,3)==="hsl"){if(s=m=e.match(Lv),!t)a=+s[0]%360/360,l=+s[1]/100,c=+s[2]/100,o=c<=.5?c*(l+1):c+l-c*l,r=c*2-o,s.length>3&&(s[3]*=1),s[0]=NB(a+1/3,r,o),s[1]=NB(a,r,o),s[2]=NB(a-1/3,r,o);else if(~e.indexOf("="))return s=e.match(DH),n&&s.length<4&&(s[3]=1),s}else s=e.match(Lv)||MA.transparent;s=s.map(Number)}return t&&!m&&(r=s[0]/Nn,o=s[1]/Nn,g=s[2]/Nn,C=Math.max(r,o,g),h=Math.min(r,o,g),c=(C+h)/2,C===h?a=l=0:(p=C-h,l=c>.5?p/(2-C-h):p/(C+h),a=C===r?(o-g)/p+(o<g?6:0):C===o?(g-r)/p+2:(r-o)/p+4,a*=60),s[0]=~~(a+.5),s[1]=~~(l*100+.5),s[2]=~~(c*100+.5)),n&&s.length<4&&(s[3]=1),s},AX=function(e){var t=[],n=[],s=-1;return e.split(Rc).forEach(function(r){var o=r.match(gd)||[];t.push.apply(t,o),n.push(s+=o.length+1)}),t.c=n,t},r3=function(e,t,n){var s="",r=(e+s).match(Rc),o=t?"hsla(":"rgba(",g=0,a,l,c,C;if(!r)return e;if(r=r.map(function(h){return(h=hX(h,t,1))&&o+(t?h[0]+","+h[1]+"%,"+h[2]+"%,"+h[3]:h.join(","))+")"}),n&&(c=AX(e),a=n.c,a.join(s)!==c.c.join(s)))for(l=e.replace(Rc,"1").split(gd),C=l.length-1;g<C;g++)s+=l[g]+(~a.indexOf(g)?r.shift()||o+"0,0,0,0)":(c.length?c:r.length?r:n).shift());if(!l)for(l=e.split(Rc),C=l.length-1;g<C;g++)s+=l[g]+r[g];return s+l[C]},Rc=function(){var i="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in MA)i+="|"+e+"\\b";return new RegExp(i+")","gi")}(),PP=/hsl[a]?\(/,pX=function(e){var t=e.join(" "),n;if(Rc.lastIndex=0,Rc.test(t))return n=PP.test(t),e[1]=r3(e[1],n),e[0]=r3(e[0],n,AX(e[1])),!0},Vp,so=function(){var i=Date.now,e=500,t=33,n=i(),s=n,r=1e3/240,o=r,g=[],a,l,c,C,h,p,m=function f(b){var y=i()-s,v=b===!0,G,w,W,V;if(y>e&&(n+=y-t),s+=y,W=s-n,G=W-o,(G>0||v)&&(V=++C.frame,h=W-C.time*1e3,C.time=W=W/1e3,o+=G+(G>=r?4:r-G),w=1),v||(a=l(f)),w)for(p=0;p<g.length;p++)g[p](W,h,V,b)};return C={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(b){return h/(1e3/(b||60))},wake:function(){PH&&(!zv&&UZ()&&(Mo=zv=window,PZ=Mo.document||{},ho.gsap=Fr,(Mo.gsapVersions||(Mo.gsapVersions=[])).push(Fr.version),OH(Fb||Mo.GreenSockGlobals||!Mo.gsap&&Mo||{}),c=Mo.requestAnimationFrame,CX.forEach(dX)),a&&C.sleep(),l=c||function(b){return setTimeout(b,o-C.time*1e3+1|0)},Vp=1,m(2))},sleep:function(){(c?Mo.cancelAnimationFrame:clearTimeout)(a),Vp=0,l=Wp},lagSmoothing:function(b,y){e=b||1/0,t=Math.min(y||33,e)},fps:function(b){r=1e3/(b||240),o=C.time*1e3+r},add:function(b,y,v){var G=y?function(w,W,V,X){b(w,W,V,X),C.remove(G)}:b;return C.remove(b),g[v?"unshift":"push"](G),zd(),G},remove:function(b,y){~(y=g.indexOf(b))&&g.splice(y,1)&&p>=y&&p--},_listeners:g},C}(),zd=function(){return!Vp&&so.wake()},dn={},OP=/^[\d.\-M][\d.\-,\s]/,QP=/["']/g,jP=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),s=n[0],r=1,o=n.length,g,a,l;r<o;r++)a=n[r],g=r!==o-1?a.lastIndexOf(","):a.length,l=a.substr(0,g),t[s]=isNaN(l)?l.replace(QP,"").trim():+l,s=a.substr(g+1).trim();return t},qP=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),s=e.indexOf("(",t);return e.substring(t,~s&&s<n?e.indexOf(")",n+1):n)},$P=function(e){var t=(e+"").split("("),n=dn[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[jP(t[1])]:qP(e).split(",").map(eX)):dn._CE&&OP.test(e)?dn._CE("",e):n},fX=function(e){return function(t){return 1-e(1-t)}},mX=function i(e,t){for(var n=e._first,s;n;)n instanceof wr?i(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?i(n.timeline,t):(s=n._ease,n._ease=n._yEase,n._yEase=s,n._yoyo=t)),n=n._next},Cu=function(e,t){return e&&(bi(e)?e:dn[e]||$P(e))||t},Fu=function(e,t,n,s){n===void 0&&(n=function(a){return 1-t(1-a)}),s===void 0&&(s=function(a){return a<.5?t(a*2)/2:1-t((1-a)*2)/2});var r={easeIn:t,easeOut:n,easeInOut:s},o;return Xr(e,function(g){dn[g]=ho[g]=r,dn[o=g.toLowerCase()]=n;for(var a in r)dn[o+(a==="easeIn"?".in":a==="easeOut"?".out":".inOut")]=dn[g+"."+a]=r[a]}),r},bX=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},MB=function i(e,t,n){var s=t>=1?t:1,r=(n||(e?.3:.45))/(t<1?t:1),o=r/Kv*(Math.asin(1/s)||0),g=function(c){return c===1?1:s*Math.pow(2,-10*c)*SP((c-o)*r)+1},a=e==="out"?g:e==="in"?function(l){return 1-g(1-l)}:bX(g);return r=Kv/r,a.config=function(l,c){return i(e,l,c)},a},KB=function i(e,t){t===void 0&&(t=1.70158);var n=function(o){return o?--o*o*((t+1)*o+t)+1:0},s=e==="out"?n:e==="in"?function(r){return 1-n(1-r)}:bX(n);return s.config=function(r){return i(e,r)},s};Xr("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;Fu(i+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});dn.Linear.easeNone=dn.none=dn.Linear.easeIn;Fu("Elastic",MB("in"),MB("out"),MB());(function(i,e){var t=1/e,n=2*t,s=2.5*t,r=function(g){return g<t?i*g*g:g<n?i*Math.pow(g-1.5/e,2)+.75:g<s?i*(g-=2.25/e)*g+.9375:i*Math.pow(g-2.625/e,2)+.984375};Fu("Bounce",function(o){return 1-r(1-o)},r)})(7.5625,2.75);Fu("Expo",function(i){return i?Math.pow(2,10*(i-1)):0});Fu("Circ",function(i){return-(TH(1-i*i)-1)});Fu("Sine",function(i){return i===1?1:-wP(i*vP)+1});Fu("Back",KB("in"),KB("out"),KB());dn.SteppedEase=dn.steps=ho.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,s=e+(t?0:1),r=t?1:0,o=1-Kn;return function(g){return((s*lf(0,o,g)|0)+r)*n}}};Md.ease=dn["quad.out"];Xr("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return jZ+=i+","+i+"Params,"});var GX=function(e,t){this.id=ZP++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:qH,this.set=t?t.getSetter:nw},_d=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Ld(this,+t.duration,1,1),this.data=t.data,Ki&&(this._ctx=Ki,Ki.data.push(this)),Vp||so.wake()}var e=i.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,Ld(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,s){if(zd(),!arguments.length)return this._tTime;var r=this._dp;if(r&&r.smoothChildTiming&&this._ts){for(xG(this,n),!r._dp||r.parent||iX(r,this);r&&r.parent;)r.parent._time!==r._start+(r._ts>=0?r._tTime/r._ts:(r.totalDuration()-r._tTime)/-r._ts)&&r.totalTime(r._tTime,!0),r=r.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&oa(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!s||this._initted&&Math.abs(this._zTime)===Kn||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),$H(this,n,s)),this},e.time=function(n,s){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+n3(this))%(this._dur+this._rDelay)||(n?this._dur:0),s):this._time},e.totalProgress=function(n,s){return arguments.length?this.totalTime(this.totalDuration()*n,s):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(n,s){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+n3(this),s):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(n,s){var r=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*r,s):this._repeat?Kd(this._tTime,r)+1:1},e.timeScale=function(n){if(!arguments.length)return this._rts===-Kn?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?Lb(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-Kn?0:this._rts,this.totalTime(lf(-Math.abs(this._delay),this._tDur,s),!0),WG(this),YP(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(zd(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Kn&&(this._tTime-=Kn)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var s=this.parent||this._dp;return s&&(s._sort||!this.parent)&&oa(s,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(Hr(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var s=this.parent||this._dp;return s?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Lb(s.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=xP);var s=_s;return _s=n,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),_s=s,this},e.globalTime=function(n){for(var s=this,r=arguments.length?n:s.rawTime();s;)r=s._start+r/(s._ts||1),s=s._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(n):r},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,i3(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var s=this._time;return this._rDelay=n,i3(this),s?this.time(s):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,s){return this.totalTime(No(this,n),Hr(s))},e.restart=function(n,s){return this.play().totalTime(n?-this._delay:0,Hr(s))},e.play=function(n,s){return n!=null&&this.seek(n,s),this.reversed(!1).paused(!1)},e.reverse=function(n,s){return n!=null&&this.seek(n||this.totalDuration(),s),this.reversed(!0).paused(!1)},e.pause=function(n,s){return n!=null&&this.seek(n,s),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-Kn:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Kn,this},e.isActive=function(){var n=this.parent||this._dp,s=this._start,r;return!!(!n||this._ts&&this._initted&&n.isActive()&&(r=n.rawTime(!0))>=s&&r<this.endTime(!0)-Kn)},e.eventCallback=function(n,s,r){var o=this.vars;return arguments.length>1?(s?(o[n]=s,r&&(o[n+"Params"]=r),n==="onUpdate"&&(this._onUpdate=s)):delete o[n],this):o[n]},e.then=function(n){var s=this;return new Promise(function(r){var o=bi(n)?n:tX,g=function(){var l=s.then;s.then=null,bi(o)&&(o=o(s))&&(o.then||o===s)&&(s.then=l),r(o),s.then=l};s._initted&&s.totalProgress()===1&&s._ts>=0||!s._tTime&&s._ts<0?g():s._prom=g})},e.kill=function(){NA(this)},i}();tg(_d.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Kn,_prom:0,_ps:!1,_rts:1});var wr=function(i){kH(e,i);function e(n,s){var r;return n===void 0&&(n={}),r=i.call(this,n)||this,r.labels={},r.smoothChildTiming=!!n.smoothChildTiming,r.autoRemoveChildren=!!n.autoRemoveChildren,r._sort=Hr(n.sortChildren),ri&&oa(n.parent||ri,ka(r),s),n.reversed&&r.reverse(),n.paused&&r.paused(!0),n.scrollTrigger&&sX(ka(r),n.scrollTrigger),r}var t=e.prototype;return t.to=function(s,r,o){return qA(0,arguments,this),this},t.from=function(s,r,o){return qA(1,arguments,this),this},t.fromTo=function(s,r,o,g){return qA(2,arguments,this),this},t.set=function(s,r,o){return r.duration=0,r.parent=this,jA(r).repeatDelay||(r.repeat=0),r.immediateRender=!!r.immediateRender,new Ji(s,r,No(this,o),1),this},t.call=function(s,r,o){return oa(this,Ji.delayedCall(0,s,r),o)},t.staggerTo=function(s,r,o,g,a,l,c){return o.duration=r,o.stagger=o.stagger||g,o.onComplete=l,o.onCompleteParams=c,o.parent=this,new Ji(s,o,No(this,a)),this},t.staggerFrom=function(s,r,o,g,a,l,c){return o.runBackwards=1,jA(o).immediateRender=Hr(o.immediateRender),this.staggerTo(s,r,o,g,a,l,c)},t.staggerFromTo=function(s,r,o,g,a,l,c,C){return g.startAt=o,jA(g).immediateRender=Hr(g.immediateRender),this.staggerTo(s,r,g,a,l,c,C)},t.render=function(s,r,o){var g=this._time,a=this._dirty?this.totalDuration():this._tDur,l=this._dur,c=s<=0?0:fs(s),C=this._zTime<0!=s<0&&(this._initted||!l),h,p,m,f,b,y,v,G,w,W,V,X;if(this!==ri&&c>a&&s>=0&&(c=a),c!==this._tTime||o||C){if(g!==this._time&&l&&(c+=this._time-g,s+=this._time-g),h=c,w=this._start,G=this._ts,y=!G,C&&(l||(g=this._zTime),(s||!r)&&(this._zTime=s)),this._repeat){if(V=this._yoyo,b=l+this._rDelay,this._repeat<-1&&s<0)return this.totalTime(b*100+s,r,o);if(h=fs(c%b),c===a?(f=this._repeat,h=l):(f=~~(c/b),f&&f===c/b&&(h=l,f--),h>l&&(h=l)),W=Kd(this._tTime,b),!g&&this._tTime&&W!==f&&this._tTime-W*b-this._dur<=0&&(W=f),V&&f&1&&(h=l-h,X=1),f!==W&&!this._lock){var R=V&&W&1,Y=R===(V&&f&1);if(f<W&&(R=!R),g=R?0:l,this._lock=1,this.render(g||(X?0:fs(f*b)),r,!l)._lock=0,this._tTime=c,!r&&this.parent&&Oo(this,"onRepeat"),this.vars.repeatRefresh&&!X&&(this.invalidate()._lock=1),g&&g!==this._time||y!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,a=this._tDur,Y&&(this._lock=2,g=R?l:-1e-4,this.render(g,!0),this.vars.repeatRefresh&&!X&&this.invalidate()),this._lock=0,!this._ts&&!y)return this;mX(this,X)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(v=KP(this,fs(g),fs(h)),v&&(c-=h-(h=v._start))),this._tTime=c,this._time=h,this._act=!G,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=s,g=0),!g&&h&&!r&&!f&&(Oo(this,"onStart"),this._tTime!==c))return this;if(h>=g&&s>=0)for(p=this._first;p;){if(m=p._next,(p._act||h>=p._start)&&p._ts&&v!==p){if(p.parent!==this)return this.render(s,r,o);if(p.render(p._ts>0?(h-p._start)*p._ts:(p._dirty?p.totalDuration():p._tDur)+(h-p._start)*p._ts,r,o),h!==this._time||!this._ts&&!y){v=0,m&&(c+=this._zTime=-Kn);break}}p=m}else{p=this._last;for(var M=s<0?s:h;p;){if(m=p._prev,(p._act||M<=p._end)&&p._ts&&v!==p){if(p.parent!==this)return this.render(s,r,o);if(p.render(p._ts>0?(M-p._start)*p._ts:(p._dirty?p.totalDuration():p._tDur)+(M-p._start)*p._ts,r,o||_s&&(p._initted||p._startAt)),h!==this._time||!this._ts&&!y){v=0,m&&(c+=this._zTime=M?-Kn:Kn);break}}p=m}}if(v&&!r&&(this.pause(),v.render(h>=g?0:-Kn)._zTime=h>=g?1:-1,this._ts))return this._start=w,WG(this),this.render(s,r,o);this._onUpdate&&!r&&Oo(this,"onUpdate",!0),(c===a&&this._tTime>=this.totalDuration()||!c&&g)&&(w===this._start||Math.abs(G)!==Math.abs(this._ts))&&(this._lock||((s||!l)&&(c===a&&this._ts>0||!c&&this._ts<0)&&Yc(this,1),!r&&!(s<0&&!g)&&(c||g||!a)&&(Oo(this,c===a&&s>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(c<a&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(s,r){var o=this;if(cl(r)||(r=No(this,r,s)),!(s instanceof _d)){if(ks(s))return s.forEach(function(g){return o.add(g,r)}),this;if(us(s))return this.addLabel(s,r);if(bi(s))s=Ji.delayedCall(0,s);else return this}return this!==s?oa(this,s,r):this},t.getChildren=function(s,r,o,g){s===void 0&&(s=!0),r===void 0&&(r=!0),o===void 0&&(o=!0),g===void 0&&(g=-Uo);for(var a=[],l=this._first;l;)l._start>=g&&(l instanceof Ji?r&&a.push(l):(o&&a.push(l),s&&a.push.apply(a,l.getChildren(!0,r,o)))),l=l._next;return a},t.getById=function(s){for(var r=this.getChildren(1,1,1),o=r.length;o--;)if(r[o].vars.id===s)return r[o]},t.remove=function(s){return us(s)?this.removeLabel(s):bi(s)?this.killTweensOf(s):(RG(this,s),s===this._recent&&(this._recent=this._last),uu(this))},t.totalTime=function(s,r){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=fs(so.time-(this._ts>0?s/this._ts:(this.totalDuration()-s)/-this._ts))),i.prototype.totalTime.call(this,s,r),this._forcing=0,this):this._tTime},t.addLabel=function(s,r){return this.labels[s]=No(this,r),this},t.removeLabel=function(s){return delete this.labels[s],this},t.addPause=function(s,r,o){var g=Ji.delayedCall(0,r||Wp,o);return g.data="isPause",this._hasPause=1,oa(this,g,No(this,s))},t.removePause=function(s){var r=this._first;for(s=No(this,s);r;)r._start===s&&r.data==="isPause"&&Yc(r),r=r._next},t.killTweensOf=function(s,r,o){for(var g=this.getTweensOf(s,o),a=g.length;a--;)dc!==g[a]&&g[a].kill(s,r);return this},t.getTweensOf=function(s,r){for(var o=[],g=Po(s),a=this._first,l=cl(r),c;a;)a instanceof Ji?VP(a._targets,g)&&(l?(!dc||a._initted&&a._ts)&&a.globalTime(0)<=r&&a.globalTime(a.totalDuration())>r:!r||a.isActive())&&o.push(a):(c=a.getTweensOf(g,r)).length&&o.push.apply(o,c),a=a._next;return o},t.tweenTo=function(s,r){r=r||{};var o=this,g=No(o,s),a=r,l=a.startAt,c=a.onStart,C=a.onStartParams,h=a.immediateRender,p,m=Ji.to(o,tg({ease:r.ease||"none",lazy:!1,immediateRender:!1,time:g,overwrite:"auto",duration:r.duration||Math.abs((g-(l&&"time"in l?l.time:o._time))/o.timeScale())||Kn,onStart:function(){if(o.pause(),!p){var b=r.duration||Math.abs((g-(l&&"time"in l?l.time:o._time))/o.timeScale());m._dur!==b&&Ld(m,b,0,1).render(m._time,!0,!0),p=1}c&&c.apply(m,C||[])}},r));return h?m.render(0):m},t.tweenFromTo=function(s,r,o){return this.tweenTo(r,tg({startAt:{time:No(this,s)}},o))},t.recent=function(){return this._recent},t.nextLabel=function(s){return s===void 0&&(s=this._time),s3(this,No(this,s))},t.previousLabel=function(s){return s===void 0&&(s=this._time),s3(this,No(this,s),1)},t.currentLabel=function(s){return arguments.length?this.seek(s,!0):this.previousLabel(this._time+Kn)},t.shiftChildren=function(s,r,o){o===void 0&&(o=0);for(var g=this._first,a=this.labels,l;g;)g._start>=o&&(g._start+=s,g._end+=s),g=g._next;if(r)for(l in a)a[l]>=o&&(a[l]+=s);return uu(this)},t.invalidate=function(s){var r=this._first;for(this._lock=0;r;)r.invalidate(s),r=r._next;return i.prototype.invalidate.call(this,s)},t.clear=function(s){s===void 0&&(s=!0);for(var r=this._first,o;r;)o=r._next,this.remove(r),r=o;return this._dp&&(this._time=this._tTime=this._pTime=0),s&&(this.labels={}),uu(this)},t.totalDuration=function(s){var r=0,o=this,g=o._last,a=Uo,l,c,C;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-s:s));if(o._dirty){for(C=o.parent;g;)l=g._prev,g._dirty&&g.totalDuration(),c=g._start,c>a&&o._sort&&g._ts&&!o._lock?(o._lock=1,oa(o,g,c-g._delay,1)._lock=0):a=c,c<0&&g._ts&&(r-=c,(!C&&!o._dp||C&&C.smoothChildTiming)&&(o._start+=c/o._ts,o._time-=c,o._tTime-=c),o.shiftChildren(-c,!1,-1/0),a=0),g._end>r&&g._ts&&(r=g._end),g=l;Ld(o,o===ri&&o._time>r?o._time:r,1,1),o._dirty=0}return o._tDur},e.updateRoot=function(s){if(ri._ts&&($H(ri,Lb(s,ri)),jH=so.frame),so.frame>=e3){e3+=Io.autoSleep||120;var r=ri._first;if((!r||!r._ts)&&Io.autoSleep&&so._listeners.length<2){for(;r&&!r._ts;)r=r._next;r||so.sleep()}}},e}(_d);tg(wr.prototype,{_lock:0,_hasPause:0,_forcing:0});var e7=function(e,t,n,s,r,o,g){var a=new Yr(this._pt,e,t,0,1,SX,null,r),l=0,c=0,C,h,p,m,f,b,y,v;for(a.b=n,a.e=s,n+="",s+="",(y=~s.indexOf("random("))&&(s=xp(s)),o&&(v=[n,s],o(v,e,t),n=v[0],s=v[1]),h=n.match(YB)||[];C=YB.exec(s);)m=C[0],f=s.substring(l,C.index),p?p=(p+1)%5:f.substr(-5)==="rgba("&&(p=1),m!==h[c++]&&(b=parseFloat(h[c-1])||0,a._pt={_next:a._pt,p:f||c===1?f:",",s:b,c:m.charAt(1)==="="?Ad(b,m)-b:parseFloat(m)-b,m:p&&p<4?Math.round:0},l=YB.lastIndex);return a.c=l<s.length?s.substring(l,s.length):"",a.fp=g,(JH.test(s)||y)&&(a.e=0),this._pt=a,a},$Z=function(e,t,n,s,r,o,g,a,l,c){bi(s)&&(s=s(r||0,e,o));var C=e[t],h=n!=="get"?n:bi(C)?l?e[t.indexOf("set")||!bi(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():C,p=bi(C)?l?r7:ZX:tw,m;if(us(s)&&(~s.indexOf("random(")&&(s=xp(s)),s.charAt(1)==="="&&(m=Ad(h,s)+(zs(h)||0),(m||m===0)&&(s=m))),!c||h!==s||Uv)return!isNaN(h*s)&&s!==""?(m=new Yr(this._pt,e,t,+h||0,s-(h||0),typeof C=="boolean"?g7:wX,0,p),l&&(m.fp=l),g&&m.modifier(g,this,e),this._pt=m):(!C&&!(t in e)&&OZ(t,s),e7.call(this,e,t,h,s,p,a||Io.stringFilter,l))},t7=function(e,t,n,s,r){if(bi(e)&&(e=$A(e,r,t,n,s)),!da(e)||e.style&&e.nodeType||ks(e)||EH(e))return us(e)?$A(e,r,t,n,s):e;var o={},g;for(g in e)o[g]=$A(e[g],r,t,n,s);return o},yX=function(e,t,n,s,r,o){var g,a,l,c;if(no[e]&&(g=new no[e]).init(r,g.rawVars?t[e]:t7(t[e],s,r,o,n),n,s,o)!==!1&&(n._pt=a=new Yr(n._pt,r,e,0,1,g.render,g,0,g.priority),n!==ad))for(l=n._ptLookup[n._targets.indexOf(r)],c=g._props.length;c--;)l[g._props[c]]=a;return g},dc,Uv,ew=function i(e,t,n){var s=e.vars,r=s.ease,o=s.startAt,g=s.immediateRender,a=s.lazy,l=s.onUpdate,c=s.onUpdateParams,C=s.callbackScope,h=s.runBackwards,p=s.yoyoEase,m=s.keyframes,f=s.autoRevert,b=e._dur,y=e._startAt,v=e._targets,G=e.parent,w=G&&G.data==="nested"?G.vars.targets:v,W=e._overwrite==="auto"&&!DZ,V=e.timeline,X,R,Y,M,L,re,j,$,ie,he,le,_,ne;if(V&&(!m||!r)&&(r="none"),e._ease=Cu(r,Md.ease),e._yEase=p?fX(Cu(p===!0?r:p,Md.ease)):0,p&&e._yoyo&&!e._repeat&&(p=e._yEase,e._yEase=e._ease,e._ease=p),e._from=!V&&!!s.runBackwards,!V||m&&!s.stagger){if($=v[0]?Iu(v[0]).harness:0,_=$&&s[$.prop],X=Kb(s,QZ),y&&(y._zTime<0&&y.progress(1),t<0&&h&&g&&!f?y.render(-1,!0):y.revert(h&&b?tb:WP),y._lazy=0),o){if(Yc(e._startAt=Ji.set(v,tg({data:"isStart",overwrite:!1,parent:G,immediateRender:!0,lazy:!y&&Hr(a),startAt:null,delay:0,onUpdate:l,onUpdateParams:c,callbackScope:C,stagger:0},o))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(_s||!g&&!f)&&e._startAt.revert(tb),g&&b&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(h&&b&&!y){if(t&&(g=!1),Y=tg({overwrite:!1,data:"isFromStart",lazy:g&&!y&&Hr(a),immediateRender:g,stagger:0,parent:G},X),_&&(Y[$.prop]=_),Yc(e._startAt=Ji.set(v,Y)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(_s?e._startAt.revert(tb):e._startAt.render(-1,!0)),e._zTime=t,!g)i(e._startAt,Kn,Kn);else if(!t)return}for(e._pt=e._ptCache=0,a=b&&Hr(a)||a&&!b,R=0;R<v.length;R++){if(L=v[R],j=L._gsap||qZ(v)[R]._gsap,e._ptLookup[R]=he={},_v[j.id]&&Sc.length&&Mb(),le=w===v?R:w.indexOf(L),$&&(ie=new $).init(L,_||X,e,le,w)!==!1&&(e._pt=M=new Yr(e._pt,L,ie.name,0,1,ie.render,ie,0,ie.priority),ie._props.forEach(function(te){he[te]=M}),ie.priority&&(re=1)),!$||_)for(Y in X)no[Y]&&(ie=yX(Y,X,e,le,L,w))?ie.priority&&(re=1):he[Y]=M=$Z.call(e,L,Y,"get",X[Y],le,w,0,s.stringFilter);e._op&&e._op[R]&&e.kill(L,e._op[R]),W&&e._pt&&(dc=e,ri.killTweensOf(L,he,e.globalTime(t)),ne=!e.parent,dc=0),e._pt&&a&&(_v[j.id]=1)}re&&RX(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!ne,m&&t<=0&&V.render(Uo,!0,!0)},n7=function(e,t,n,s,r,o,g){var a=(e._pt&&e._ptCache||(e._ptCache={}))[t],l,c,C,h;if(!a)for(a=e._ptCache[t]=[],C=e._ptLookup,h=e._targets.length;h--;){if(l=C[h][t],l&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return Uv=1,e.vars[t]="+=0",ew(e,g),Uv=0,1;a.push(l)}for(h=a.length;h--;)c=a[h],l=c._pt||c,l.s=(s||s===0)&&!r?s:l.s+(s||0)+o*l.c,l.c=n-l.s,c.e&&(c.e=Wi(n)+zs(c.e)),c.b&&(c.b=l.s+zs(c.b))},i7=function(e,t){var n=e[0]?Iu(e[0]).harness:0,s=n&&n.aliases,r,o,g,a;if(!s)return t;r=Zu({},t);for(o in s)if(o in r)for(a=s[o].split(","),g=a.length;g--;)r[a[g]]=r[o];return r},s7=function(e,t,n,s){var r=t.ease||s||"power1.inOut",o,g;if(ks(t))g=n[e]||(n[e]=[]),t.forEach(function(a,l){return g.push({t:l/(t.length-1)*100,v:a,e:r})});else for(o in t)g=n[o]||(n[o]=[]),o==="ease"||g.push({t:parseFloat(e),v:t[o],e:r})},$A=function(e,t,n,s,r){return bi(e)?e.call(t,n,s,r):us(e)&&~e.indexOf("random(")?xp(e):e},BX=jZ+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",vX={};Xr(BX+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return vX[i]=1});var Ji=function(i){kH(e,i);function e(n,s,r,o){var g;typeof s=="number"&&(r.duration=s,s=r,r=null),g=i.call(this,o?s:jA(s))||this;var a=g.vars,l=a.duration,c=a.delay,C=a.immediateRender,h=a.stagger,p=a.overwrite,m=a.keyframes,f=a.defaults,b=a.scrollTrigger,y=a.yoyoEase,v=s.parent||ri,G=(ks(n)||EH(n)?cl(n[0]):"length"in s)?[n]:Po(n),w,W,V,X,R,Y,M,L;if(g._targets=G.length?qZ(G):Nb("GSAP target "+n+" not found. https://greensock.com",!Io.nullTargetWarn)||[],g._ptLookup=[],g._overwrite=p,m||h||v0(l)||v0(c)){if(s=g.vars,w=g.timeline=new wr({data:"nested",defaults:f||{},targets:v&&v.data==="nested"?v.vars.targets:G}),w.kill(),w.parent=w._dp=ka(g),w._start=0,h||v0(l)||v0(c)){if(X=G.length,M=h&&aX(h),da(h))for(R in h)~BX.indexOf(R)&&(L||(L={}),L[R]=h[R]);for(W=0;W<X;W++)V=Kb(s,vX),V.stagger=0,y&&(V.yoyoEase=y),L&&Zu(V,L),Y=G[W],V.duration=+$A(l,ka(g),W,Y,G),V.delay=(+$A(c,ka(g),W,Y,G)||0)-g._delay,!h&&X===1&&V.delay&&(g._delay=c=V.delay,g._start+=c,V.delay=0),w.to(Y,V,M?M(W,Y,G):0),w._ease=dn.none;w.duration()?l=c=0:g.timeline=0}else if(m){jA(tg(w.vars.defaults,{ease:"none"})),w._ease=Cu(m.ease||s.ease||"none");var re=0,j,$,ie;if(ks(m))m.forEach(function(he){return w.to(G,he,">")}),w.duration();else{V={};for(R in m)R==="ease"||R==="easeEach"||s7(R,m[R],V,m.easeEach);for(R in V)for(j=V[R].sort(function(he,le){return he.t-le.t}),re=0,W=0;W<j.length;W++)$=j[W],ie={ease:$.e,duration:($.t-(W?j[W-1].t:0))/100*l},ie[R]=$.v,w.to(G,ie,re),re+=ie.duration;w.duration()<l&&w.to({},{duration:l-w.duration()})}}l||g.duration(l=w.duration())}else g.timeline=0;return p===!0&&!DZ&&(dc=ka(g),ri.killTweensOf(G),dc=0),oa(v,ka(g),r),s.reversed&&g.reverse(),s.paused&&g.paused(!0),(C||!l&&!m&&g._start===fs(v._time)&&Hr(C)&&FP(ka(g))&&v.data!=="nested")&&(g._tTime=-Kn,g.render(Math.max(0,-c)||0)),b&&sX(ka(g),b),g}var t=e.prototype;return t.render=function(s,r,o){var g=this._time,a=this._tDur,l=this._dur,c=s<0,C=s>a-Kn&&!c?a:s<Kn?0:s,h,p,m,f,b,y,v,G,w;if(!l)MP(this,s,r,o);else if(C!==this._tTime||!s||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==c){if(h=C,G=this.timeline,this._repeat){if(f=l+this._rDelay,this._repeat<-1&&c)return this.totalTime(f*100+s,r,o);if(h=fs(C%f),C===a?(m=this._repeat,h=l):(m=~~(C/f),m&&m===C/f&&(h=l,m--),h>l&&(h=l)),y=this._yoyo&&m&1,y&&(w=this._yEase,h=l-h),b=Kd(this._tTime,f),h===g&&!o&&this._initted)return this._tTime=C,this;m!==b&&(G&&this._yEase&&mX(G,y),this.vars.repeatRefresh&&!y&&!this._lock&&(this._lock=o=1,this.render(fs(f*m),!0).invalidate()._lock=0))}if(!this._initted){if(rX(this,c?s:h,o,r,C))return this._tTime=0,this;if(g!==this._time)return this;if(l!==this._dur)return this.render(s,r,o)}if(this._tTime=C,this._time=h,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=v=(w||this._ease)(h/l),this._from&&(this.ratio=v=1-v),h&&!g&&!r&&!m&&(Oo(this,"onStart"),this._tTime!==C))return this;for(p=this._pt;p;)p.r(v,p.d),p=p._next;G&&G.render(s<0?s:!h&&y?-Kn:G._dur*G._ease(h/this._dur),r,o)||this._startAt&&(this._zTime=s),this._onUpdate&&!r&&(c&&kv(this,s,r,o),Oo(this,"onUpdate")),this._repeat&&m!==b&&this.vars.onRepeat&&!r&&this.parent&&Oo(this,"onRepeat"),(C===this._tDur||!C)&&this._tTime===C&&(c&&!this._onUpdate&&kv(this,s,!0,!0),(s||!l)&&(C===this._tDur&&this._ts>0||!C&&this._ts<0)&&Yc(this,1),!r&&!(c&&!g)&&(C||g||y)&&(Oo(this,C===a?"onComplete":"onReverseComplete",!0),this._prom&&!(C<a&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(s){return(!s||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(s),i.prototype.invalidate.call(this,s)},t.resetTo=function(s,r,o,g){Vp||so.wake(),this._ts||this.play();var a=Math.min(this._dur,(this._dp._time-this._start)*this._ts),l;return this._initted||ew(this,a),l=this._ease(a/this._dur),n7(this,s,r,o,g,l,a)?this.resetTo(s,r,o,g):(xG(this,0),this.parent||nX(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(s,r){if(r===void 0&&(r="all"),!s&&(!r||r==="all"))return this._lazy=this._pt=0,this.parent?NA(this):this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(s,r,dc&&dc.vars.overwrite!==!0)._first||NA(this),this.parent&&o!==this.timeline.totalDuration()&&Ld(this,this._dur*this.timeline._tDur/o,0,1),this}var g=this._targets,a=s?Po(s):g,l=this._ptLookup,c=this._pt,C,h,p,m,f,b,y;if((!r||r==="all")&&XP(g,a))return r==="all"&&(this._pt=0),NA(this);for(C=this._op=this._op||[],r!=="all"&&(us(r)&&(f={},Xr(r,function(v){return f[v]=1}),r=f),r=i7(g,r)),y=g.length;y--;)if(~a.indexOf(g[y])){h=l[y],r==="all"?(C[y]=r,m=h,p={}):(p=C[y]=C[y]||{},m=r);for(f in m)b=h&&h[f],b&&((!("kill"in b.d)||b.d.kill(f)===!0)&&RG(this,b,"_pt"),delete h[f]),p!=="all"&&(p[f]=1)}return this._initted&&!this._pt&&c&&NA(this),this},e.to=function(s,r){return new e(s,r,arguments[2])},e.from=function(s,r){return qA(1,arguments)},e.delayedCall=function(s,r,o,g){return new e(r,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:s,onComplete:r,onReverseComplete:r,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:g})},e.fromTo=function(s,r,o){return qA(2,arguments)},e.set=function(s,r){return r.duration=0,r.repeatDelay||(r.repeat=0),new e(s,r)},e.killTweensOf=function(s,r,o){return ri.killTweensOf(s,r,o)},e}(_d);tg(Ji.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Xr("staggerTo,staggerFrom,staggerFromTo",function(i){Ji[i]=function(){var e=new wr,t=Ev.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var tw=function(e,t,n){return e[t]=n},ZX=function(e,t,n){return e[t](n)},r7=function(e,t,n,s){return e[t](s.fp,n)},o7=function(e,t,n){return e.setAttribute(t,n)},nw=function(e,t){return bi(e[t])?ZX:JZ(e[t])&&e.setAttribute?o7:tw},wX=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},g7=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},SX=function(e,t){var n=t._pt,s="";if(!e&&t.b)s=t.b;else if(e===1&&t.e)s=t.e;else{for(;n;)s=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+s,n=n._next;s+=t.c}t.set(t.t,t.p,s,t)},iw=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},a7=function(e,t,n,s){for(var r=this._pt,o;r;)o=r._next,r.p===s&&r.modifier(e,t,n),r=o},l7=function(e){for(var t=this._pt,n,s;t;)s=t._next,t.p===e&&!t.op||t.op===e?RG(this,t,"_pt"):t.dep||(n=1),t=s;return!n},c7=function(e,t,n,s){s.mSet(e,t,s.m.call(s.tween,n,s.mt),s)},RX=function(e){for(var t=e._pt,n,s,r,o;t;){for(n=t._next,s=r;s&&s.pr>t.pr;)s=s._next;(t._prev=s?s._prev:o)?t._prev._next=t:r=t,(t._next=s)?s._prev=t:o=t,t=n}e._pt=r},Yr=function(){function i(t,n,s,r,o,g,a,l,c){this.t=n,this.s=r,this.c=o,this.p=s,this.r=g||wX,this.d=a||this,this.set=l||tw,this.pr=c||0,this._next=t,t&&(t._prev=this)}var e=i.prototype;return e.modifier=function(n,s,r){this.mSet=this.mSet||this.set,this.set=c7,this.m=n,this.mt=r,this.tween=s},i}();Xr(jZ+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return QZ[i]=1});ho.TweenMax=ho.TweenLite=Ji;ho.TimelineLite=ho.TimelineMax=wr;ri=new wr({sortChildren:!1,defaults:Md,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Io.stringFilter=pX;var kd=[],ib={},I7=[],o3=0,LB=function(e){return(ib[e]||I7).map(function(t){return t()})},Pv=function(){var e=Date.now(),t=[];e-o3>2&&(LB("matchMediaInit"),kd.forEach(function(n){var s=n.queries,r=n.conditions,o,g,a,l;for(g in s)o=Mo.matchMedia(s[g]).matches,o&&(a=1),o!==r[g]&&(r[g]=o,l=1);l&&(n.revert(),a&&t.push(n))}),LB("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n)}),o3=e,LB("matchMedia"))},WX=function(){function i(t,n){this.selector=n&&Dv(n),this.data=[],this._r=[],this.isReverted=!1,t&&this.add(t)}var e=i.prototype;return e.add=function(n,s,r){bi(n)&&(r=s,s=n,n=bi);var o=this,g=function(){var l=Ki,c=o.selector,C;return l&&l!==o&&l.data.push(o),r&&(o.selector=Dv(r)),Ki=o,C=s.apply(o,arguments),bi(C)&&o._r.push(C),Ki=l,o.selector=c,o.isReverted=!1,C};return o.last=g,n===bi?g(o):n?o[n]=g:g},e.ignore=function(n){var s=Ki;Ki=null,n(this),Ki=s},e.getTweens=function(){var n=[];return this.data.forEach(function(s){return s instanceof i?n.push.apply(n,s.getTweens()):s instanceof Ji&&!(s.parent&&s.parent.data==="nested")&&n.push(s)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,s){var r=this;if(n){var o=this.getTweens();this.data.forEach(function(a){a.data==="isFlip"&&(a.revert(),a.getChildren(!0,!0,!1).forEach(function(l){return o.splice(o.indexOf(l),1)}))}),o.map(function(a){return{g:a.globalTime(0),t:a}}).sort(function(a,l){return l.g-a.g||-1}).forEach(function(a){return a.t.revert(n)}),this.data.forEach(function(a){return!(a instanceof _d)&&a.revert&&a.revert(n)}),this._r.forEach(function(a){return a(n,r)}),this.isReverted=!0}else this.data.forEach(function(a){return a.kill&&a.kill()});if(this.clear(),s){var g=kd.indexOf(this);~g&&kd.splice(g,1)}},e.revert=function(n){this.kill(n||{})},i}(),u7=function(){function i(t){this.contexts=[],this.scope=t}var e=i.prototype;return e.add=function(n,s,r){da(n)||(n={matches:n});var o=new WX(0,r||this.scope),g=o.conditions={},a,l,c;this.contexts.push(o),s=o.add("onMatch",s),o.queries=n;for(l in n)l==="all"?c=1:(a=Mo.matchMedia(n[l]),a&&(kd.indexOf(o)<0&&kd.push(o),(g[l]=a.matches)&&(c=1),a.addListener?a.addListener(Pv):a.addEventListener("change",Pv)));return c&&s(o),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(s){return s.kill(n,!0)})},i}(),zb={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(s){return dX(s)})},timeline:function(e){return new wr(e)},getTweensOf:function(e,t){return ri.getTweensOf(e,t)},getProperty:function(e,t,n,s){us(e)&&(e=Po(e)[0]);var r=Iu(e||{}).get,o=n?tX:eX;return n==="native"&&(n=""),e&&(t?o((no[t]&&no[t].get||r)(e,t,n,s)):function(g,a,l){return o((no[g]&&no[g].get||r)(e,g,a,l))})},quickSetter:function(e,t,n){if(e=Po(e),e.length>1){var s=e.map(function(c){return Fr.quickSetter(c,t,n)}),r=s.length;return function(c){for(var C=r;C--;)s[C](c)}}e=e[0]||{};var o=no[t],g=Iu(e),a=g.harness&&(g.harness.aliases||{})[t]||t,l=o?function(c){var C=new o;ad._pt=0,C.init(e,n?c+n:c,ad,0,[e]),C.render(1,C),ad._pt&&iw(1,ad)}:g.set(e,a);return o?l:function(c){return l(e,a,n?c+n:c,g,1)}},quickTo:function(e,t,n){var s,r=Fr.to(e,Zu((s={},s[t]="+=0.1",s.paused=!0,s),n||{})),o=function(a,l,c){return r.resetTo(t,a,l,c)};return o.tween=r,o},isTweening:function(e){return ri.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Cu(e.ease,Md.ease)),t3(Md,e||{})},config:function(e){return t3(Io,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,s=e.plugins,r=e.defaults,o=e.extendTimeline;(s||"").split(",").forEach(function(g){return g&&!no[g]&&!ho[g]&&Nb(t+" effect requires "+g+" plugin.")}),FB[t]=function(g,a,l){return n(Po(g),tg(a||{},r),l)},o&&(wr.prototype[t]=function(g,a,l){return this.add(FB[t](g,da(a)?a:(l=a)&&{},this),l)})},registerEase:function(e,t){dn[e]=Cu(t)},parseEase:function(e,t){return arguments.length?Cu(e,t):dn},getById:function(e){return ri.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new wr(e),s,r;for(n.smoothChildTiming=Hr(e.smoothChildTiming),ri.remove(n),n._dp=0,n._time=n._tTime=ri._time,s=ri._first;s;)r=s._next,(t||!(!s._dur&&s instanceof Ji&&s.vars.onComplete===s._targets[0]))&&oa(n,s,s._start-s._delay),s=r;return oa(ri,n,0),n},context:function(e,t){return e?new WX(e,t):Ki},matchMedia:function(e){return new u7(e)},matchMediaRefresh:function(){return kd.forEach(function(e){var t=e.conditions,n,s;for(s in t)t[s]&&(t[s]=!1,n=1);n&&e.revert()})||Pv()},addEventListener:function(e,t){var n=ib[e]||(ib[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=ib[e],s=n&&n.indexOf(t);s>=0&&n.splice(s,1)},utils:{wrap:DP,wrapYoyo:JP,distribute:aX,random:cX,snap:lX,normalize:EP,getUnit:zs,clamp:zP,splitColor:hX,toArray:Po,selector:Dv,mapRange:uX,pipe:kP,unitize:TP,interpolate:UP,shuffle:gX},install:OH,effects:FB,ticker:so,updateRoot:wr.updateRoot,plugins:no,globalTimeline:ri,core:{PropTween:Yr,globals:QH,Tween:Ji,Timeline:wr,Animation:_d,getCache:Iu,_removeLinkedListItem:RG,reverting:function(){return _s},context:function(e){return e&&Ki&&(Ki.data.push(e),e._ctx=Ki),Ki},suppressOverwrites:function(e){return DZ=e}}};Xr("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return zb[i]=Ji[i]});so.add(wr.updateRoot);ad=zb.to({},{duration:0});var C7=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},d7=function(e,t){var n=e._targets,s,r,o;for(s in t)for(r=n.length;r--;)o=e._ptLookup[r][s],o&&(o=o.d)&&(o._pt&&(o=C7(o,s)),o&&o.modifier&&o.modifier(t[s],e,n[r],s))},zB=function(e,t){return{name:e,rawVars:1,init:function(s,r,o){o._onInit=function(g){var a,l;if(us(r)&&(a={},Xr(r,function(c){return a[c]=1}),r=a),t){a={};for(l in r)a[l]=t(r[l]);r=a}d7(g,r)}}}},Fr=zb.registerPlugin({name:"attr",init:function(e,t,n,s,r){var o,g,a;this.tween=n;for(o in t)a=e.getAttribute(o)||"",g=this.add(e,"setAttribute",(a||0)+"",t[o],s,r,0,0,o),g.op=o,g.b=a,this._props.push(o)},render:function(e,t){for(var n=t._pt;n;)_s?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},zB("roundProps",Jv),zB("modifiers"),zB("snap",lX))||zb;Ji.version=wr.version=Fr.version="3.11.5";PH=1;UZ()&&zd();dn.Power0;dn.Power1;dn.Power2;dn.Power3;dn.Power4;dn.Linear;dn.Quad;dn.Cubic;dn.Quart;dn.Quint;dn.Strong;dn.Elastic;dn.Back;dn.SteppedEase;dn.Bounce;dn.Sine;dn.Expo;dn.Circ;/*!
 * CSSPlugin 3.11.5
 * https://greensock.com
 *
 * Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var g3,hc,pd,sw,tu,a3,rw,h7=function(){return typeof window<"u"},Il={},kI=180/Math.PI,fd=Math.PI/180,_C=Math.atan2,l3=1e8,ow=/([A-Z])/g,A7=/(left|right|width|margin|padding|x)/i,p7=/[\s,\(]\S/,ga={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Ov=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},f7=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},m7=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},b7=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},xX=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},VX=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},G7=function(e,t,n){return e.style[t]=n},y7=function(e,t,n){return e.style.setProperty(t,n)},B7=function(e,t,n){return e._gsap[t]=n},v7=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},Z7=function(e,t,n,s,r){var o=e._gsap;o.scaleX=o.scaleY=n,o.renderTransform(r,o)},w7=function(e,t,n,s,r){var o=e._gsap;o[t]=n,o.renderTransform(r,o)},ai="transform",xg=ai+"Origin",S7=function i(e,t){var n=this,s=this.target,r=s.style;if(e in Il){if(this.tfm=this.tfm||{},e!=="transform")e=ga[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return n.tfm[o]=Ea(s,o)}):this.tfm[e]=s._gsap.x?s._gsap[e]:Ea(s,e);else return ga.transform.split(",").forEach(function(o){return i.call(n,o,t)});if(this.props.indexOf(ai)>=0)return;s._gsap.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(xg,t,"")),e=ai}(r||t)&&this.props.push(e,t,r[e])},HX=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},R7=function(){var e=this.props,t=this.target,n=t.style,s=t._gsap,r,o;for(r=0;r<e.length;r+=3)e[r+1]?t[e[r]]=e[r+2]:e[r+2]?n[e[r]]=e[r+2]:n.removeProperty(e[r].substr(0,2)==="--"?e[r]:e[r].replace(ow,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)s[o]=this.tfm[o];s.svg&&(s.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),r=rw(),(!r||!r.isStart)&&!n[ai]&&(HX(n),s.uncache=1)}},XX=function(e,t){var n={target:e,props:[],revert:R7,save:S7};return e._gsap||Fr.core.getCache(e),t&&t.split(",").forEach(function(s){return n.save(s)}),n},YX,Qv=function(e,t){var n=hc.createElementNS?hc.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):hc.createElement(e);return n.style?n:hc.createElement(e)},Ia=function i(e,t,n){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(ow,"-$1").toLowerCase())||s.getPropertyValue(t)||!n&&i(e,Td(t)||t,1)||""},c3="O,Moz,ms,Ms,Webkit".split(","),Td=function(e,t,n){var s=t||tu,r=s.style,o=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);o--&&!(c3[o]+e in r););return o<0?null:(o===3?"ms":o>=0?c3[o]:"")+e},jv=function(){h7()&&window.document&&(g3=window,hc=g3.document,pd=hc.documentElement,tu=Qv("div")||{style:{}},Qv("div"),ai=Td(ai),xg=ai+"Origin",tu.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",YX=!!Td("perspective"),rw=Fr.core.reverting,sw=1)},_B=function i(e){var t=Qv("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,s=this.nextSibling,r=this.style.cssText,o;if(pd.appendChild(t),t.appendChild(this),this.style.display="block",e)try{o=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=i}catch{}else this._gsapBBox&&(o=this._gsapBBox());return n&&(s?n.insertBefore(this,s):n.appendChild(this)),pd.removeChild(t),this.style.cssText=r,o},I3=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},FX=function(e){var t;try{t=e.getBBox()}catch{t=_B.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===_B||(t=_B.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+I3(e,["x","cx","x1"])||0,y:+I3(e,["y","cy","y1"])||0,width:0,height:0}:t},NX=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&FX(e))},Hp=function(e,t){if(t){var n=e.style;t in Il&&t!==xg&&(t=ai),n.removeProperty?((t.substr(0,2)==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(t.replace(ow,"-$1").toLowerCase())):n.removeAttribute(t)}},Ac=function(e,t,n,s,r,o){var g=new Yr(e._pt,t,n,0,1,o?VX:xX);return e._pt=g,g.b=s,g.e=r,e._props.push(n),g},u3={deg:1,rad:1,turn:1},W7={grid:1,flex:1},Fc=function i(e,t,n,s){var r=parseFloat(n)||0,o=(n+"").trim().substr((r+"").length)||"px",g=tu.style,a=A7.test(t),l=e.tagName.toLowerCase()==="svg",c=(l?"client":"offset")+(a?"Width":"Height"),C=100,h=s==="px",p=s==="%",m,f,b,y;return s===o||!r||u3[s]||u3[o]?r:(o!=="px"&&!h&&(r=i(e,t,n,"px")),y=e.getCTM&&NX(e),(p||o==="%")&&(Il[t]||~t.indexOf("adius"))?(m=y?e.getBBox()[a?"width":"height"]:e[c],Wi(p?r/m*C:r/100*m)):(g[a?"width":"height"]=C+(h?o:s),f=~t.indexOf("adius")||s==="em"&&e.appendChild&&!l?e:e.parentNode,y&&(f=(e.ownerSVGElement||{}).parentNode),(!f||f===hc||!f.appendChild)&&(f=hc.body),b=f._gsap,b&&p&&b.width&&a&&b.time===so.time&&!b.uncache?Wi(r/b.width*C):((p||o==="%")&&!W7[Ia(f,"display")]&&(g.position=Ia(e,"position")),f===e&&(g.position="static"),f.appendChild(tu),m=tu[c],f.removeChild(tu),g.position="absolute",a&&p&&(b=Iu(f),b.time=so.time,b.width=f[c]),Wi(h?m*r/C:m&&r?C/m*r:0))))},Ea=function(e,t,n,s){var r;return sw||jv(),t in ga&&t!=="transform"&&(t=ga[t],~t.indexOf(",")&&(t=t.split(",")[0])),Il[t]&&t!=="transform"?(r=Yp(e,s),r=t!=="transformOrigin"?r[t]:r.svg?r.origin:kb(Ia(e,xg))+" "+r.zOrigin+"px"):(r=e.style[t],(!r||r==="auto"||s||~(r+"").indexOf("calc("))&&(r=_b[t]&&_b[t](e,t,n)||Ia(e,t)||qH(e,t)||(t==="opacity"?1:0))),n&&!~(r+"").trim().indexOf(" ")?Fc(e,t,r,n)+n:r},x7=function(e,t,n,s){if(!n||n==="none"){var r=Td(t,e,1),o=r&&Ia(e,r,1);o&&o!==n?(t=r,n=o):t==="borderColor"&&(n=Ia(e,"borderTopColor"))}var g=new Yr(this._pt,e.style,t,0,1,SX),a=0,l=0,c,C,h,p,m,f,b,y,v,G,w,W;if(g.b=n,g.e=s,n+="",s+="",s==="auto"&&(e.style[t]=s,s=Ia(e,t)||s,e.style[t]=n),c=[n,s],pX(c),n=c[0],s=c[1],h=n.match(gd)||[],W=s.match(gd)||[],W.length){for(;C=gd.exec(s);)b=C[0],v=s.substring(a,C.index),m?m=(m+1)%5:(v.substr(-5)==="rgba("||v.substr(-5)==="hsla(")&&(m=1),b!==(f=h[l++]||"")&&(p=parseFloat(f)||0,w=f.substr((p+"").length),b.charAt(1)==="="&&(b=Ad(p,b)+w),y=parseFloat(b),G=b.substr((y+"").length),a=gd.lastIndex-G.length,G||(G=G||Io.units[t]||w,a===s.length&&(s+=G,g.e+=G)),w!==G&&(p=Fc(e,t,f,G)||0),g._pt={_next:g._pt,p:v||l===1?v:",",s:p,c:y-p,m:m&&m<4||t==="zIndex"?Math.round:0});g.c=a<s.length?s.substring(a,s.length):""}else g.r=t==="display"&&s==="none"?VX:xX;return JH.test(s)&&(g.e=0),this._pt=g,g},C3={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},V7=function(e){var t=e.split(" "),n=t[0],s=t[1]||"50%";return(n==="top"||n==="bottom"||s==="left"||s==="right")&&(e=n,n=s,s=e),t[0]=C3[n]||n,t[1]=C3[s]||s,t.join(" ")},H7=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,s=n.style,r=t.u,o=n._gsap,g,a,l;if(r==="all"||r===!0)s.cssText="",a=1;else for(r=r.split(","),l=r.length;--l>-1;)g=r[l],Il[g]&&(a=1,g=g==="transformOrigin"?xg:ai),Hp(n,g);a&&(Hp(n,ai),o&&(o.svg&&n.removeAttribute("transform"),Yp(n,1),o.uncache=1,HX(s)))}},_b={clearProps:function(e,t,n,s,r){if(r.data!=="isFromStart"){var o=e._pt=new Yr(e._pt,t,n,0,0,H7);return o.u=s,o.pr=-10,o.tween=r,e._props.push(n),1}}},Xp=[1,0,0,1,0,0],MX={},KX=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},d3=function(e){var t=Ia(e,ai);return KX(t)?Xp:t.substr(7).match(DH).map(Wi)},gw=function(e,t){var n=e._gsap||Iu(e),s=e.style,r=d3(e),o,g,a,l;return n.svg&&e.getAttribute("transform")?(a=e.transform.baseVal.consolidate().matrix,r=[a.a,a.b,a.c,a.d,a.e,a.f],r.join(",")==="1,0,0,1,0,0"?Xp:r):(r===Xp&&!e.offsetParent&&e!==pd&&!n.svg&&(a=s.display,s.display="block",o=e.parentNode,(!o||!e.offsetParent)&&(l=1,g=e.nextElementSibling,pd.appendChild(e)),r=d3(e),a?s.display=a:Hp(e,"display"),l&&(g?o.insertBefore(e,g):o?o.appendChild(e):pd.removeChild(e))),t&&r.length>6?[r[0],r[1],r[4],r[5],r[12],r[13]]:r)},qv=function(e,t,n,s,r,o){var g=e._gsap,a=r||gw(e,!0),l=g.xOrigin||0,c=g.yOrigin||0,C=g.xOffset||0,h=g.yOffset||0,p=a[0],m=a[1],f=a[2],b=a[3],y=a[4],v=a[5],G=t.split(" "),w=parseFloat(G[0])||0,W=parseFloat(G[1])||0,V,X,R,Y;n?a!==Xp&&(X=p*b-m*f)&&(R=w*(b/X)+W*(-f/X)+(f*v-b*y)/X,Y=w*(-m/X)+W*(p/X)-(p*v-m*y)/X,w=R,W=Y):(V=FX(e),w=V.x+(~G[0].indexOf("%")?w/100*V.width:w),W=V.y+(~(G[1]||G[0]).indexOf("%")?W/100*V.height:W)),s||s!==!1&&g.smooth?(y=w-l,v=W-c,g.xOffset=C+(y*p+v*f)-y,g.yOffset=h+(y*m+v*b)-v):g.xOffset=g.yOffset=0,g.xOrigin=w,g.yOrigin=W,g.smooth=!!s,g.origin=t,g.originIsAbsolute=!!n,e.style[xg]="0px 0px",o&&(Ac(o,g,"xOrigin",l,w),Ac(o,g,"yOrigin",c,W),Ac(o,g,"xOffset",C,g.xOffset),Ac(o,g,"yOffset",h,g.yOffset)),e.setAttribute("data-svg-origin",w+" "+W)},Yp=function(e,t){var n=e._gsap||new GX(e);if("x"in n&&!t&&!n.uncache)return n;var s=e.style,r=n.scaleX<0,o="px",g="deg",a=getComputedStyle(e),l=Ia(e,xg)||"0",c,C,h,p,m,f,b,y,v,G,w,W,V,X,R,Y,M,L,re,j,$,ie,he,le,_,ne,te,q,se,ue,Ae,We;return c=C=h=f=b=y=v=G=w=0,p=m=1,n.svg=!!(e.getCTM&&NX(e)),a.translate&&((a.translate!=="none"||a.scale!=="none"||a.rotate!=="none")&&(s[ai]=(a.translate!=="none"?"translate3d("+(a.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(a.rotate!=="none"?"rotate("+a.rotate+") ":"")+(a.scale!=="none"?"scale("+a.scale.split(" ").join(",")+") ":"")+(a[ai]!=="none"?a[ai]:"")),s.scale=s.rotate=s.translate="none"),X=gw(e,n.svg),n.svg&&(n.uncache?(_=e.getBBox(),l=n.xOrigin-_.x+"px "+(n.yOrigin-_.y)+"px",le=""):le=!t&&e.getAttribute("data-svg-origin"),qv(e,le||l,!!le||n.originIsAbsolute,n.smooth!==!1,X)),W=n.xOrigin||0,V=n.yOrigin||0,X!==Xp&&(L=X[0],re=X[1],j=X[2],$=X[3],c=ie=X[4],C=he=X[5],X.length===6?(p=Math.sqrt(L*L+re*re),m=Math.sqrt($*$+j*j),f=L||re?_C(re,L)*kI:0,v=j||$?_C(j,$)*kI+f:0,v&&(m*=Math.abs(Math.cos(v*fd))),n.svg&&(c-=W-(W*L+V*j),C-=V-(W*re+V*$))):(We=X[6],ue=X[7],te=X[8],q=X[9],se=X[10],Ae=X[11],c=X[12],C=X[13],h=X[14],R=_C(We,se),b=R*kI,R&&(Y=Math.cos(-R),M=Math.sin(-R),le=ie*Y+te*M,_=he*Y+q*M,ne=We*Y+se*M,te=ie*-M+te*Y,q=he*-M+q*Y,se=We*-M+se*Y,Ae=ue*-M+Ae*Y,ie=le,he=_,We=ne),R=_C(-j,se),y=R*kI,R&&(Y=Math.cos(-R),M=Math.sin(-R),le=L*Y-te*M,_=re*Y-q*M,ne=j*Y-se*M,Ae=$*M+Ae*Y,L=le,re=_,j=ne),R=_C(re,L),f=R*kI,R&&(Y=Math.cos(R),M=Math.sin(R),le=L*Y+re*M,_=ie*Y+he*M,re=re*Y-L*M,he=he*Y-ie*M,L=le,ie=_),b&&Math.abs(b)+Math.abs(f)>359.9&&(b=f=0,y=180-y),p=Wi(Math.sqrt(L*L+re*re+j*j)),m=Wi(Math.sqrt(he*he+We*We)),R=_C(ie,he),v=Math.abs(R)>2e-4?R*kI:0,w=Ae?1/(Ae<0?-Ae:Ae):0),n.svg&&(le=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!KX(Ia(e,ai)),le&&e.setAttribute("transform",le))),Math.abs(v)>90&&Math.abs(v)<270&&(r?(p*=-1,v+=f<=0?180:-180,f+=f<=0?180:-180):(m*=-1,v+=v<=0?180:-180)),t=t||n.uncache,n.x=c-((n.xPercent=c&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-c)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+o,n.y=C-((n.yPercent=C&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-C)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+o,n.z=h+o,n.scaleX=Wi(p),n.scaleY=Wi(m),n.rotation=Wi(f)+g,n.rotationX=Wi(b)+g,n.rotationY=Wi(y)+g,n.skewX=v+g,n.skewY=G+g,n.transformPerspective=w+o,(n.zOrigin=parseFloat(l.split(" ")[2])||0)&&(s[xg]=kb(l)),n.xOffset=n.yOffset=0,n.force3D=Io.force3D,n.renderTransform=n.svg?Y7:YX?LX:X7,n.uncache=0,n},kb=function(e){return(e=e.split(" "))[0]+" "+e[1]},kB=function(e,t,n){var s=zs(t);return Wi(parseFloat(t)+parseFloat(Fc(e,"x",n+"px",s)))+s},X7=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,LX(e,t)},YI="0deg",fA="0px",FI=") ",LX=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,o=n.x,g=n.y,a=n.z,l=n.rotation,c=n.rotationY,C=n.rotationX,h=n.skewX,p=n.skewY,m=n.scaleX,f=n.scaleY,b=n.transformPerspective,y=n.force3D,v=n.target,G=n.zOrigin,w="",W=y==="auto"&&e&&e!==1||y===!0;if(G&&(C!==YI||c!==YI)){var V=parseFloat(c)*fd,X=Math.sin(V),R=Math.cos(V),Y;V=parseFloat(C)*fd,Y=Math.cos(V),o=kB(v,o,X*Y*-G),g=kB(v,g,-Math.sin(V)*-G),a=kB(v,a,R*Y*-G+G)}b!==fA&&(w+="perspective("+b+FI),(s||r)&&(w+="translate("+s+"%, "+r+"%) "),(W||o!==fA||g!==fA||a!==fA)&&(w+=a!==fA||W?"translate3d("+o+", "+g+", "+a+") ":"translate("+o+", "+g+FI),l!==YI&&(w+="rotate("+l+FI),c!==YI&&(w+="rotateY("+c+FI),C!==YI&&(w+="rotateX("+C+FI),(h!==YI||p!==YI)&&(w+="skew("+h+", "+p+FI),(m!==1||f!==1)&&(w+="scale("+m+", "+f+FI),v.style[ai]=w||"translate(0, 0)"},Y7=function(e,t){var n=t||this,s=n.xPercent,r=n.yPercent,o=n.x,g=n.y,a=n.rotation,l=n.skewX,c=n.skewY,C=n.scaleX,h=n.scaleY,p=n.target,m=n.xOrigin,f=n.yOrigin,b=n.xOffset,y=n.yOffset,v=n.forceCSS,G=parseFloat(o),w=parseFloat(g),W,V,X,R,Y;a=parseFloat(a),l=parseFloat(l),c=parseFloat(c),c&&(c=parseFloat(c),l+=c,a+=c),a||l?(a*=fd,l*=fd,W=Math.cos(a)*C,V=Math.sin(a)*C,X=Math.sin(a-l)*-h,R=Math.cos(a-l)*h,l&&(c*=fd,Y=Math.tan(l-c),Y=Math.sqrt(1+Y*Y),X*=Y,R*=Y,c&&(Y=Math.tan(c),Y=Math.sqrt(1+Y*Y),W*=Y,V*=Y)),W=Wi(W),V=Wi(V),X=Wi(X),R=Wi(R)):(W=C,R=h,V=X=0),(G&&!~(o+"").indexOf("px")||w&&!~(g+"").indexOf("px"))&&(G=Fc(p,"x",o,"px"),w=Fc(p,"y",g,"px")),(m||f||b||y)&&(G=Wi(G+m-(m*W+f*X)+b),w=Wi(w+f-(m*V+f*R)+y)),(s||r)&&(Y=p.getBBox(),G=Wi(G+s/100*Y.width),w=Wi(w+r/100*Y.height)),Y="matrix("+W+","+V+","+X+","+R+","+G+","+w+")",p.setAttribute("transform",Y),v&&(p.style[ai]=Y)},F7=function(e,t,n,s,r){var o=360,g=us(r),a=parseFloat(r)*(g&&~r.indexOf("rad")?kI:1),l=a-s,c=s+l+"deg",C,h;return g&&(C=r.split("_")[1],C==="short"&&(l%=o,l!==l%(o/2)&&(l+=l<0?o:-o)),C==="cw"&&l<0?l=(l+o*l3)%o-~~(l/o)*o:C==="ccw"&&l>0&&(l=(l-o*l3)%o-~~(l/o)*o)),e._pt=h=new Yr(e._pt,t,n,s,l,f7),h.e=c,h.u="deg",e._props.push(n),h},h3=function(e,t){for(var n in t)e[n]=t[n];return e},N7=function(e,t,n){var s=h3({},n._gsap),r="perspective,force3D,transformOrigin,svgOrigin",o=n.style,g,a,l,c,C,h,p,m;s.svg?(l=n.getAttribute("transform"),n.setAttribute("transform",""),o[ai]=t,g=Yp(n,1),Hp(n,ai),n.setAttribute("transform",l)):(l=getComputedStyle(n)[ai],o[ai]=t,g=Yp(n,1),o[ai]=l);for(a in Il)l=s[a],c=g[a],l!==c&&r.indexOf(a)<0&&(p=zs(l),m=zs(c),C=p!==m?Fc(n,a,l,m):parseFloat(l),h=parseFloat(c),e._pt=new Yr(e._pt,g,a,C,h-C,Ov),e._pt.u=m||0,e._props.push(a));h3(g,s)};Xr("padding,margin,Width,Radius",function(i,e){var t="Top",n="Right",s="Bottom",r="Left",o=(e<3?[t,n,s,r]:[t+r,t+n,s+n,s+r]).map(function(g){return e<2?i+g:"border"+g+i});_b[e>1?"border"+i:i]=function(g,a,l,c,C){var h,p;if(arguments.length<4)return h=o.map(function(m){return Ea(g,m,l)}),p=h.join(" "),p.split(h[0]).length===5?h[0]:p;h=(c+"").split(" "),p={},o.forEach(function(m,f){return p[m]=h[f]=h[f]||h[(f-1)/2|0]}),g.init(a,p,C)}});var zX={name:"css",register:jv,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,s,r){var o=this._props,g=e.style,a=n.vars.startAt,l,c,C,h,p,m,f,b,y,v,G,w,W,V,X,R;sw||jv(),this.styles=this.styles||XX(e),R=this.styles.props,this.tween=n;for(f in t)if(f!=="autoRound"&&(c=t[f],!(no[f]&&yX(f,t,n,s,e,r)))){if(p=typeof c,m=_b[f],p==="function"&&(c=c.call(n,s,e,r),p=typeof c),p==="string"&&~c.indexOf("random(")&&(c=xp(c)),m)m(this,e,f,c,n)&&(X=1);else if(f.substr(0,2)==="--")l=(getComputedStyle(e).getPropertyValue(f)+"").trim(),c+="",Rc.lastIndex=0,Rc.test(l)||(b=zs(l),y=zs(c)),y?b!==y&&(l=Fc(e,f,l,y)+y):b&&(c+=b),this.add(g,"setProperty",l,c,s,r,0,0,f),o.push(f),R.push(f,0,g[f]);else if(p!=="undefined"){if(a&&f in a?(l=typeof a[f]=="function"?a[f].call(n,s,e,r):a[f],us(l)&&~l.indexOf("random(")&&(l=xp(l)),zs(l+"")||(l+=Io.units[f]||zs(Ea(e,f))||""),(l+"").charAt(1)==="="&&(l=Ea(e,f))):l=Ea(e,f),h=parseFloat(l),v=p==="string"&&c.charAt(1)==="="&&c.substr(0,2),v&&(c=c.substr(2)),C=parseFloat(c),f in ga&&(f==="autoAlpha"&&(h===1&&Ea(e,"visibility")==="hidden"&&C&&(h=0),R.push("visibility",0,g.visibility),Ac(this,g,"visibility",h?"inherit":"hidden",C?"inherit":"hidden",!C)),f!=="scale"&&f!=="transform"&&(f=ga[f],~f.indexOf(",")&&(f=f.split(",")[0]))),G=f in Il,G){if(this.styles.save(f),w||(W=e._gsap,W.renderTransform&&!t.parseTransform||Yp(e,t.parseTransform),V=t.smoothOrigin!==!1&&W.smooth,w=this._pt=new Yr(this._pt,g,ai,0,1,W.renderTransform,W,0,-1),w.dep=1),f==="scale")this._pt=new Yr(this._pt,W,"scaleY",W.scaleY,(v?Ad(W.scaleY,v+C):C)-W.scaleY||0,Ov),this._pt.u=0,o.push("scaleY",f),f+="X";else if(f==="transformOrigin"){R.push(xg,0,g[xg]),c=V7(c),W.svg?qv(e,c,0,V,0,this):(y=parseFloat(c.split(" ")[2])||0,y!==W.zOrigin&&Ac(this,W,"zOrigin",W.zOrigin,y),Ac(this,g,f,kb(l),kb(c)));continue}else if(f==="svgOrigin"){qv(e,c,1,V,0,this);continue}else if(f in MX){F7(this,W,f,h,v?Ad(h,v+c):c);continue}else if(f==="smoothOrigin"){Ac(this,W,"smooth",W.smooth,c);continue}else if(f==="force3D"){W[f]=c;continue}else if(f==="transform"){N7(this,c,e);continue}}else f in g||(f=Td(f)||f);if(G||(C||C===0)&&(h||h===0)&&!p7.test(c)&&f in g)b=(l+"").substr((h+"").length),C||(C=0),y=zs(c)||(f in Io.units?Io.units[f]:b),b!==y&&(h=Fc(e,f,l,y)),this._pt=new Yr(this._pt,G?W:g,f,h,(v?Ad(h,v+C):C)-h,!G&&(y==="px"||f==="zIndex")&&t.autoRound!==!1?b7:Ov),this._pt.u=y||0,b!==y&&y!=="%"&&(this._pt.b=l,this._pt.r=m7);else if(f in g)x7.call(this,e,f,l,v?v+c:c);else if(f in e)this.add(e,f,l||e[f],v?v+c:c,s,r);else if(f!=="parseTransform"){OZ(f,c);continue}G||(f in g?R.push(f,0,g[f]):R.push(f,1,l||e[f])),o.push(f)}}X&&RX(this)},render:function(e,t){if(t.tween._time||!rw())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Ea,aliases:ga,getSetter:function(e,t,n){var s=ga[t];return s&&s.indexOf(",")<0&&(t=s),t in Il&&t!==xg&&(e._gsap.x||Ea(e,"x"))?n&&a3===n?t==="scale"?v7:B7:(a3=n||{})&&(t==="scale"?Z7:w7):e.style&&!JZ(e.style[t])?G7:~t.indexOf("-")?y7:nw(e,t)},core:{_removeProperty:Hp,_getMatrix:gw}};Fr.utils.checkPrefix=Td;Fr.core.getStyleSaver=XX;(function(i,e,t,n){var s=Xr(i+","+e+","+t,function(r){Il[r]=1});Xr(e,function(r){Io.units[r]="deg",MX[r]=1}),ga[s[13]]=i+","+e,Xr(n,function(r){var o=r.split(":");ga[o[1]]=s[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Xr("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){Io.units[i]="px"});Fr.registerPlugin(zX);var Wn=Fr.registerPlugin(zX)||Fr;Wn.core.Tween;const cf=new E,aw=new E,M7=new E;function K7(i,e,t){const n=cf.setFromMatrixPosition(i.matrixWorld);n.project(e);const s=t.width/2,r=t.height/2;return[n.x*s+s,-(n.y*r)+r]}function L7(i,e){const t=cf.setFromMatrixPosition(i.matrixWorld),n=aw.setFromMatrixPosition(e.matrixWorld),s=t.sub(n),r=e.getWorldDirection(M7);return s.angleTo(r)>Math.PI/2}function z7(i,e,t,n){const s=cf.setFromMatrixPosition(i.matrixWorld),r=s.clone();r.project(e),t.setFromCamera(r,e);const o=t.intersectObjects(n,!0);if(o.length){const g=o[0].distance;return s.distanceTo(t.ray.origin)<g}return!0}function _7(i,e){if(e instanceof co)return e.zoom;if(e instanceof Dn){const t=cf.setFromMatrixPosition(i.matrixWorld),n=aw.setFromMatrixPosition(e.matrixWorld),s=e.fov*Math.PI/180,r=t.distanceTo(n);return 1/(2*Math.tan(s/2)*r)}else return 1}function k7(i,e,t){if(e instanceof Dn||e instanceof co){const n=cf.setFromMatrixPosition(i.matrixWorld),s=aw.setFromMatrixPosition(e.matrixWorld),r=n.distanceTo(s),o=(t[1]-t[0])/(e.far-e.near),g=t[1]-o*e.far;return Math.round(o*r+g)}}const $v=i=>Math.abs(i)<1e-10?0:i;function _X(i,e,t=""){let n="matrix3d(";for(let s=0;s!==16;s++)n+=$v(e[s]*i.elements[s])+(s!==15?",":")");return t+n}const T7=(i=>e=>_X(e,i))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),E7=(i=>(e,t)=>_X(e,i(t),"translate(-50%,-50%)"))(i=>[1/i,1/i,1/i,1,-1/i,-1/i,-1/i,-1,1/i,1/i,1/i,1,1,1,1,1]);function D7(i){return i&&typeof i=="object"&&"current"in i}const md=T.forwardRef(({children:i,eps:e=.001,style:t,className:n,prepend:s,center:r,fullscreen:o,portal:g,distanceFactor:a,sprite:l=!1,transform:c=!1,occlude:C,onOcclude:h,castShadow:p,receiveShadow:m,material:f,geometry:b,zIndexRange:y=[16777271,0],calculatePosition:v=K7,as:G="div",wrapperClass:w,pointerEvents:W="auto",...V},X)=>{const{gl:R,camera:Y,scene:M,size:L,raycaster:re,events:j,viewport:$}=Ui(),[ie]=T.useState(()=>document.createElement(G)),he=T.useRef(),le=T.useRef(null),_=T.useRef(0),ne=T.useRef([0,0]),te=T.useRef(null),q=T.useRef(null),se=(g==null?void 0:g.current)||j.connected||R.domElement.parentNode,ue=T.useRef(null),Ae=T.useRef(!1),We=T.useMemo(()=>C&&C!=="blending"||Array.isArray(C)&&C.length&&D7(C[0]),[C]);T.useLayoutEffect(()=>{const ke=R.domElement;C?(ke.style.zIndex=`${Math.floor(y[0]/2)}`,ke.style.position="absolute",ke.style.pointerEvents="none"):(ke.style.zIndex=null,ke.style.position=null,ke.style.pointerEvents=null)},[C,We]),T.useLayoutEffect(()=>{if(le.current){const ke=he.current=nZ(ie);if(M.updateMatrixWorld(),c)ie.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const je=v(le.current,Y,L);ie.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${je[0]}px,${je[1]}px,0);transform-origin:0 0;`}return se&&(s?se.prepend(ie):se.appendChild(ie)),()=>{se&&se.removeChild(ie),ke.unmount()}}},[se,c]),T.useLayoutEffect(()=>{w&&(ie.className=w)},[w]);const me=T.useMemo(()=>c?{position:"absolute",top:0,left:0,width:L.width,height:L.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:r?"translate3d(-50%,-50%,0)":"none",...o&&{top:-L.height/2,left:-L.width/2,width:L.width,height:L.height},...t},[t,r,o,L,c]),tt=T.useMemo(()=>({position:"absolute",pointerEvents:W}),[W]);T.useLayoutEffect(()=>{if(Ae.current=!1,c){var ke;(ke=he.current)==null||ke.render(T.createElement("div",{ref:te,style:me},T.createElement("div",{ref:q,style:tt},T.createElement("div",{ref:X,className:n,style:t,children:i}))))}else{var je;(je=he.current)==null||je.render(T.createElement("div",{ref:X,style:me,className:n,children:i}))}});const Oe=T.useRef(!0);Aa(ke=>{if(le.current){Y.updateMatrixWorld(),le.current.updateWorldMatrix(!0,!1);const je=c?ne.current:v(le.current,Y,L);if(c||Math.abs(_.current-Y.zoom)>e||Math.abs(ne.current[0]-je[0])>e||Math.abs(ne.current[1]-je[1])>e){const ve=L7(le.current,Y);let be=!1;We&&(C!=="blending"?be=[M]:Array.isArray(C)&&(be=C.map(Pe=>Pe.current)));const Ve=Oe.current;if(be){const Pe=z7(le.current,Y,re,be);Oe.current=Pe&&!ve}else Oe.current=!ve;Ve!==Oe.current&&(h?h(!Oe.current):ie.style.display=Oe.current?"block":"none");const qe=Math.floor(y[0]/2),Xe=C?We?[y[0],qe]:[qe-1,0]:y;if(ie.style.zIndex=`${k7(le.current,Y,Xe)}`,c){const[Pe,ct]=[L.width/2,L.height/2],gt=Y.projectionMatrix.elements[5]*ct,{isOrthographicCamera:Yt,top:Zt,left:O,bottom:z,right:ye}=Y,Le=T7(Y.matrixWorldInverse),Te=Yt?`scale(${gt})translate(${$v(-(ye+O)/2)}px,${$v((Zt+z)/2)}px)`:`translateZ(${gt}px)`;let De=le.current.matrixWorld;l&&(De=Y.matrixWorldInverse.clone().transpose().copyPosition(De).scale(le.current.scale),De.elements[3]=De.elements[7]=De.elements[11]=0,De.elements[15]=1),ie.style.width=L.width+"px",ie.style.height=L.height+"px",ie.style.perspective=Yt?"":`${gt}px`,te.current&&q.current&&(te.current.style.transform=`${Te}${Le}translate(${Pe}px,${ct}px)`,q.current.style.transform=E7(De,1/((a||10)/400)))}else{const Pe=a===void 0?1:_7(le.current,Y)*a;ie.style.transform=`translate3d(${je[0]}px,${je[1]}px,0) scale(${Pe})`}ne.current=je,_.current=Y.zoom}}if(!We&&ue.current&&!Ae.current)if(c){if(te.current){const je=te.current.children[0];if(je!=null&&je.clientWidth&&je!=null&&je.clientHeight){const{isOrthographicCamera:ve}=Y;if(ve||b)V.scale&&(Array.isArray(V.scale)?V.scale instanceof E?ue.current.scale.copy(V.scale.clone().divideScalar(1)):ue.current.scale.set(1/V.scale[0],1/V.scale[1],1/V.scale[2]):ue.current.scale.setScalar(1/V.scale));else{const be=(a||10)/400,Ve=je.clientWidth*be,qe=je.clientHeight*be;ue.current.scale.set(Ve,qe,1)}Ae.current=!0}}}else{const je=ie.children[0];if(je!=null&&je.clientWidth&&je!=null&&je.clientHeight){const ve=1/$.factor,be=je.clientWidth*ve,Ve=je.clientHeight*ve;ue.current.scale.set(be,Ve,1),Ae.current=!0}ue.current.lookAt(ke.camera.position)}});const It=T.useMemo(()=>({vertexShader:c?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[c]);return T.createElement("group",Ls({},V,{ref:le}),C&&!We&&T.createElement("mesh",{castShadow:p,receiveShadow:m,ref:ue},b||T.createElement("planeGeometry",null),f||T.createElement("shaderMaterial",{side:Lc,vertexShader:It.vertexShader,fragmentShader:It.fragmentShader})))});let mA=0;const J7=gf(i=>(rd.onStart=(e,t,n)=>{i({active:!0,item:e,loaded:t,total:n,progress:(t-mA)/(n-mA)*100})},rd.onLoad=()=>{i({active:!1})},rd.onError=e=>i(t=>({errors:[...t.errors,e]})),rd.onProgress=(e,t,n)=>{t===n&&(mA=n),i({active:!0,item:e,loaded:t,total:n,progress:(t-mA)/(n-mA)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function lw(i){return function(e){i.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}const kX=i=>(e,t,n)=>{const s=n.subscribe;return n.subscribe=(o,g,a)=>{let l=o;if(g){const c=(a==null?void 0:a.equalityFn)||Object.is;let C=o(n.getState());l=h=>{const p=o(h);if(!c(C,p)){const m=C;g(C=p,m)}},a!=null&&a.fireImmediately&&g(C,C)}return s(l)},i(e,t,n)},TX=T.createContext(null);function U7({map:i,children:e,onChange:t,domElement:n}){const s=i.map(a=>a.name+a.keys).join("-"),r=T.useMemo(()=>gf(kX(()=>i.reduce((a,l)=>({...a,[l.name]:!1}),{}))),[s]),o=T.useMemo(()=>[r.subscribe,r.getState,r],[s]),g=r.setState;return T.useEffect(()=>{const l=i.map(({name:p,keys:m,up:f})=>({keys:m,up:f,fn:b=>{g({[p]:b}),t&&t(p,b,o[2]())}})).reduce((p,{keys:m,fn:f,up:b=!0})=>(m.forEach(y=>p[y]={fn:f,pressed:!1,up:b}),p),{}),c=({key:p,code:m})=>{const f=l[p]||l[m];if(!f)return;const{fn:b,pressed:y,up:v}=f;f.pressed=!0,(v||!y)&&b(!0)},C=({key:p,code:m})=>{const f=l[p]||l[m];if(!f)return;const{fn:b,up:y}=f;f.pressed=!1,y&&b(!1)},h=n||window;return h.addEventListener("keydown",c,{passive:!0}),h.addEventListener("keyup",C,{passive:!0}),()=>{h.removeEventListener("keydown",c),h.removeEventListener("keyup",C)}},[n,s]),T.createElement(TX.Provider,{value:o,children:e})}function EX(i){const[e,t,n]=T.useContext(TX);return i?n(i):[e,t]}function A3(i,e){if(e===dV)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),i;if(e===Hd||e===IG){let t=i.getIndex();if(t===null){const o=[],g=i.getAttribute("position");if(g!==void 0){for(let a=0;a<g.count;a++)o.push(a);i.setIndex(o),t=i.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(t)if(e===Hd)for(let o=1;o<=n;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=i.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),i}const P7=i=>i&&i.isCubeTexture;class O7 extends mi{constructor(e,t){var n,s;const r=P7(e),g=((s=r?(n=e.image[0])==null?void 0:n.width:e.image.width)!=null?s:1024)/4,a=Math.floor(Math.log2(g)),l=Math.pow(2,a),c=3*Math.max(l,16*7),C=4*l,h=[r?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/c}`,`#define CUBEUV_TEXEL_HEIGHT ${1/C}`,`#define CUBEUV_MAX_MIP ${a}.0`],p=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,m=h.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <encodings_fragment>
        }
        `,f={map:{value:e},height:{value:(t==null?void 0:t.height)||15},radius:{value:(t==null?void 0:t.radius)||100}},b=new $d(1,16),y=new Xg({uniforms:f,fragmentShader:m,vertexShader:p,side:Lc});super(b,y)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}function DX(i,e,t={}){const n=new E,s=new jn,r=new E,o=new mt,g=new mt,a=new mt;t.preserveMatrix=t.preserveMatrix!==void 0?t.preserveMatrix:!0,t.preservePosition=t.preservePosition!==void 0?t.preservePosition:!0,t.preserveHipPosition=t.preserveHipPosition!==void 0?t.preserveHipPosition:!1,t.useTargetMatrix=t.useTargetMatrix!==void 0?t.useTargetMatrix:!1,t.hip=t.hip!==void 0?t.hip:"hip",t.names=t.names||{};const l=e.isObject3D?e.skeleton.bones:Tb(e),c=i.isObject3D?i.skeleton.bones:Tb(i);let C,h,p,m,f;if(i.isObject3D?i.skeleton.pose():(t.useTargetMatrix=!0,t.preserveMatrix=!1),t.preservePosition){f=[];for(let b=0;b<c.length;b++)f.push(c[b].position.clone())}if(t.preserveMatrix){i.updateMatrixWorld(),i.matrixWorld.identity();for(let b=0;b<i.children.length;++b)i.children[b].updateMatrixWorld(!0)}if(t.offsets){C=[];for(let b=0;b<c.length;++b)h=c[b],p=t.names[h.name]||h.name,t.offsets[p]&&(h.matrix.multiply(t.offsets[p]),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld()),C.push(h.matrixWorld.clone())}for(let b=0;b<c.length;++b){if(h=c[b],p=t.names[h.name]||h.name,m=JX(p,l),a.copy(h.matrixWorld),m){if(m.updateMatrixWorld(),t.useTargetMatrix?g.copy(m.matrixWorld):(g.copy(i.matrixWorld).invert(),g.multiply(m.matrixWorld)),r.setFromMatrixScale(g),g.scale(r.set(1/r.x,1/r.y,1/r.z)),a.makeRotationFromQuaternion(s.setFromRotationMatrix(g)),i.isObject3D){const y=c.indexOf(h),v=C?C[y]:o.copy(i.skeleton.boneInverses[y]).invert();a.multiply(v)}a.copyPosition(g)}h.parent&&h.parent.isBone?(h.matrix.copy(h.parent.matrixWorld).invert(),h.matrix.multiply(a)):h.matrix.copy(a),t.preserveHipPosition&&p===t.hip&&h.matrix.setPosition(n.set(0,h.position.y,0)),h.matrix.decompose(h.position,h.quaternion,h.scale),h.updateMatrixWorld()}if(t.preservePosition)for(let b=0;b<c.length;++b)h=c[b],p=t.names[h.name]||h.name,p!==t.hip&&h.position.copy(f[b]);t.preserveMatrix&&i.updateMatrixWorld(!0)}function Q7(i,e,t,n={}){n.useFirstFramePosition=n.useFirstFramePosition!==void 0?n.useFirstFramePosition:!1,n.fps=n.fps!==void 0?n.fps:30,n.names=n.names||[],e.isObject3D||(e=q7(e));const s=Math.round(t.duration*(n.fps/1e3)*1e3),r=1/n.fps,o=[],g=new hH(e),a=Tb(i.skeleton),l=[];let c,C,h,p,m;g.clipAction(t).play(),g.update(0),e.updateMatrixWorld();for(let f=0;f<s;++f){const b=f*r;DX(i,e,n);for(let y=0;y<a.length;++y)m=n.names[a[y].name]||a[y].name,h=JX(m,e.skeleton),h&&(C=a[y],p=l[y]=l[y]||{bone:C},n.hip===m&&(p.pos||(p.pos={times:new Float32Array(s),values:new Float32Array(s*3)}),n.useFirstFramePosition&&(f===0&&(c=C.position.clone()),C.position.sub(c)),p.pos.times[f]=b,C.position.toArray(p.pos.values,f*3)),p.quat||(p.quat={times:new Float32Array(s),values:new Float32Array(s*4)}),p.quat.times[f]=b,C.quaternion.toArray(p.quat.values,f*4));g.update(r),e.updateMatrixWorld()}for(let f=0;f<l.length;++f)p=l[f],p&&(p.pos&&o.push(new Hc(".bones["+p.bone.name+"].position",p.pos.times,p.pos.values)),o.push(new Yg(".bones["+p.bone.name+"].quaternion",p.quat.times,p.quat.values)));return g.uncacheAction(t),new Xc(t.name,-1,o)}function j7(i){const e=new Map,t=new Map,n=i.clone();return UX(i,n,function(s,r){e.set(r,s),t.set(s,r)}),n.traverse(function(s){if(!s.isSkinnedMesh)return;const r=s,o=e.get(s),g=o.skeleton.bones;r.skeleton=o.skeleton.clone(),r.bindMatrix.copy(o.bindMatrix),r.skeleton.bones=g.map(function(a){return t.get(a)}),r.bind(r.skeleton,r.bindMatrix)}),n}function JX(i,e){for(let t=0,n=Tb(e);t<n.length;t++)if(i===n[t].name)return n[t]}function Tb(i){return Array.isArray(i)?i:i.bones}function q7(i){const e=new AH(i.bones[0]);return e.skeleton=i,e}function UX(i,e,t){t(i,e);for(let n=0;n<i.children.length;n++)UX(i.children[n],e.children[n],t)}const $7={retarget:DX,retargetClip:Q7,clone:j7};var eO=Object.defineProperty,tO=(i,e,t)=>e in i?eO(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Et=(i,e,t)=>(tO(i,typeof e!="symbol"?e+"":e,t),t);const p3=(i,e)=>(i%e+e)%e;let nO=class extends ha{constructor(e,t){super(),Et(this,"object"),Et(this,"domElement"),Et(this,"enabled",!0),Et(this,"target",new E),Et(this,"minDistance",0),Et(this,"maxDistance",1/0),Et(this,"minZoom",0),Et(this,"maxZoom",1/0),Et(this,"minPolarAngle",0),Et(this,"maxPolarAngle",Math.PI),Et(this,"minAzimuthAngle",-1/0),Et(this,"maxAzimuthAngle",1/0),Et(this,"enableDamping",!1),Et(this,"dampingFactor",.05),Et(this,"enableZoom",!0),Et(this,"zoomSpeed",1),Et(this,"enableRotate",!0),Et(this,"rotateSpeed",1),Et(this,"enablePan",!0),Et(this,"panSpeed",1),Et(this,"screenSpacePanning",!0),Et(this,"keyPanSpeed",7),Et(this,"autoRotate",!1),Et(this,"autoRotateSpeed",2),Et(this,"reverseOrbit",!1),Et(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Et(this,"mouseButtons",{LEFT:LI.ROTATE,MIDDLE:LI.DOLLY,RIGHT:LI.PAN}),Et(this,"touches",{ONE:zI.ROTATE,TWO:zI.DOLLY_PAN}),Et(this,"target0"),Et(this,"position0"),Et(this,"zoom0"),Et(this,"_domElementKeyEvents",null),Et(this,"getPolarAngle"),Et(this,"getAzimuthalAngle"),Et(this,"setPolarAngle"),Et(this,"setAzimuthalAngle"),Et(this,"getDistance"),Et(this,"listenToKeyEvents"),Et(this,"saveState"),Et(this,"reset"),Et(this,"update"),Et(this,"connect"),Et(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=oe=>{let we=p3(oe,2*Math.PI),Ee=c.phi;Ee<0&&(Ee+=2*Math.PI),we<0&&(we+=2*Math.PI);let Qe=Math.abs(we-Ee);2*Math.PI-Qe<Qe&&(we<Ee?we+=2*Math.PI:Ee+=2*Math.PI),C.phi=we-Ee,n.update()},this.setAzimuthalAngle=oe=>{let we=p3(oe,2*Math.PI),Ee=c.theta;Ee<0&&(Ee+=2*Math.PI),we<0&&(we+=2*Math.PI);let Qe=Math.abs(we-Ee);2*Math.PI-Qe<Qe&&(we<Ee?we+=2*Math.PI:Ee+=2*Math.PI),C.theta=we-Ee,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=oe=>{oe.addEventListener("keydown",ye),this._domElementKeyEvents=oe},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(s),n.update(),a=g.NONE},this.update=(()=>{const oe=new E,we=new jn().setFromUnitVectors(e.up,new E(0,1,0)),Ee=we.clone().invert(),Qe=new E,wt=new jn,Ot=2*Math.PI;return function(){const Ie=n.object.position;oe.copy(Ie).sub(n.target),oe.applyQuaternion(we),c.setFromVector3(oe),n.autoRotate&&a===g.NONE&&re(M()),n.enableDamping?(c.theta+=C.theta*n.dampingFactor,c.phi+=C.phi*n.dampingFactor):(c.theta+=C.theta,c.phi+=C.phi);let Se=n.minAzimuthAngle,ze=n.maxAzimuthAngle;return isFinite(Se)&&isFinite(ze)&&(Se<-Math.PI?Se+=Ot:Se>Math.PI&&(Se-=Ot),ze<-Math.PI?ze+=Ot:ze>Math.PI&&(ze-=Ot),Se<=ze?c.theta=Math.max(Se,Math.min(ze,c.theta)):c.theta=c.theta>(Se+ze)/2?Math.max(Se,c.theta):Math.min(ze,c.theta)),c.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,c.phi)),c.makeSafe(),c.radius*=h,c.radius=Math.max(n.minDistance,Math.min(n.maxDistance,c.radius)),n.enableDamping===!0?n.target.addScaledVector(p,n.dampingFactor):n.target.add(p),oe.setFromSpherical(c),oe.applyQuaternion(Ee),Ie.copy(n.target).add(oe),n.object.lookAt(n.target),n.enableDamping===!0?(C.theta*=1-n.dampingFactor,C.phi*=1-n.dampingFactor,p.multiplyScalar(1-n.dampingFactor)):(C.set(0,0,0),p.set(0,0,0)),h=1,m||Qe.distanceToSquared(n.object.position)>l||8*(1-wt.dot(n.object.quaternion))>l?(n.dispatchEvent(s),Qe.copy(n.object.position),wt.copy(n.object.quaternion),m=!1,!0):!1}})(),this.connect=oe=>{oe===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),n.domElement=oe,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",De),n.domElement.addEventListener("pointerdown",Pe),n.domElement.addEventListener("pointercancel",Yt),n.domElement.addEventListener("wheel",z)},this.dispose=()=>{var oe,we,Ee,Qe,wt,Ot;(oe=n.domElement)==null||oe.removeEventListener("contextmenu",De),(we=n.domElement)==null||we.removeEventListener("pointerdown",Pe),(Ee=n.domElement)==null||Ee.removeEventListener("pointercancel",Yt),(Qe=n.domElement)==null||Qe.removeEventListener("wheel",z),(wt=n.domElement)==null||wt.ownerDocument.removeEventListener("pointermove",ct),(Ot=n.domElement)==null||Ot.ownerDocument.removeEventListener("pointerup",gt),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",ye)};const n=this,s={type:"change"},r={type:"start"},o={type:"end"},g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=g.NONE;const l=1e-6,c=new Xv,C=new Xv;let h=1;const p=new E;let m=!1;const f=new Fe,b=new Fe,y=new Fe,v=new Fe,G=new Fe,w=new Fe,W=new Fe,V=new Fe,X=new Fe,R=[],Y={};function M(){return 2*Math.PI/60/60*n.autoRotateSpeed}function L(){return Math.pow(.95,n.zoomSpeed)}function re(oe){n.reverseOrbit?C.theta+=oe:C.theta-=oe}function j(oe){n.reverseOrbit?C.phi+=oe:C.phi-=oe}const $=(()=>{const oe=new E;return function(Ee,Qe){oe.setFromMatrixColumn(Qe,0),oe.multiplyScalar(-Ee),p.add(oe)}})(),ie=(()=>{const oe=new E;return function(Ee,Qe){n.screenSpacePanning===!0?oe.setFromMatrixColumn(Qe,1):(oe.setFromMatrixColumn(Qe,0),oe.crossVectors(n.object.up,oe)),oe.multiplyScalar(Ee),p.add(oe)}})(),he=(()=>{const oe=new E;return function(Ee,Qe){const wt=n.domElement;if(wt&&n.object instanceof Dn&&n.object.isPerspectiveCamera){const Ot=n.object.position;oe.copy(Ot).sub(n.target);let Vn=oe.length();Vn*=Math.tan(n.object.fov/2*Math.PI/180),$(2*Ee*Vn/wt.clientHeight,n.object.matrix),ie(2*Qe*Vn/wt.clientHeight,n.object.matrix)}else wt&&n.object instanceof co&&n.object.isOrthographicCamera?($(Ee*(n.object.right-n.object.left)/n.object.zoom/wt.clientWidth,n.object.matrix),ie(Qe*(n.object.top-n.object.bottom)/n.object.zoom/wt.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function le(oe){n.object instanceof Dn&&n.object.isPerspectiveCamera?h/=oe:n.object instanceof co&&n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*oe)),n.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function _(oe){n.object instanceof Dn&&n.object.isPerspectiveCamera?h*=oe:n.object instanceof co&&n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/oe)),n.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ne(oe){f.set(oe.clientX,oe.clientY)}function te(oe){W.set(oe.clientX,oe.clientY)}function q(oe){v.set(oe.clientX,oe.clientY)}function se(oe){b.set(oe.clientX,oe.clientY),y.subVectors(b,f).multiplyScalar(n.rotateSpeed);const we=n.domElement;we&&(re(2*Math.PI*y.x/we.clientHeight),j(2*Math.PI*y.y/we.clientHeight)),f.copy(b),n.update()}function ue(oe){V.set(oe.clientX,oe.clientY),X.subVectors(V,W),X.y>0?le(L()):X.y<0&&_(L()),W.copy(V),n.update()}function Ae(oe){G.set(oe.clientX,oe.clientY),w.subVectors(G,v).multiplyScalar(n.panSpeed),he(w.x,w.y),v.copy(G),n.update()}function We(oe){oe.deltaY<0?_(L()):oe.deltaY>0&&le(L()),n.update()}function me(oe){let we=!1;switch(oe.code){case n.keys.UP:he(0,n.keyPanSpeed),we=!0;break;case n.keys.BOTTOM:he(0,-n.keyPanSpeed),we=!0;break;case n.keys.LEFT:he(n.keyPanSpeed,0),we=!0;break;case n.keys.RIGHT:he(-n.keyPanSpeed,0),we=!0;break}we&&(oe.preventDefault(),n.update())}function tt(){if(R.length==1)f.set(R[0].pageX,R[0].pageY);else{const oe=.5*(R[0].pageX+R[1].pageX),we=.5*(R[0].pageY+R[1].pageY);f.set(oe,we)}}function Oe(){if(R.length==1)v.set(R[0].pageX,R[0].pageY);else{const oe=.5*(R[0].pageX+R[1].pageX),we=.5*(R[0].pageY+R[1].pageY);v.set(oe,we)}}function It(){const oe=R[0].pageX-R[1].pageX,we=R[0].pageY-R[1].pageY,Ee=Math.sqrt(oe*oe+we*we);W.set(0,Ee)}function ke(){n.enableZoom&&It(),n.enablePan&&Oe()}function je(){n.enableZoom&&It(),n.enableRotate&&tt()}function ve(oe){if(R.length==1)b.set(oe.pageX,oe.pageY);else{const Ee=dt(oe),Qe=.5*(oe.pageX+Ee.x),wt=.5*(oe.pageY+Ee.y);b.set(Qe,wt)}y.subVectors(b,f).multiplyScalar(n.rotateSpeed);const we=n.domElement;we&&(re(2*Math.PI*y.x/we.clientHeight),j(2*Math.PI*y.y/we.clientHeight)),f.copy(b)}function be(oe){if(R.length==1)G.set(oe.pageX,oe.pageY);else{const we=dt(oe),Ee=.5*(oe.pageX+we.x),Qe=.5*(oe.pageY+we.y);G.set(Ee,Qe)}w.subVectors(G,v).multiplyScalar(n.panSpeed),he(w.x,w.y),v.copy(G)}function Ve(oe){const we=dt(oe),Ee=oe.pageX-we.x,Qe=oe.pageY-we.y,wt=Math.sqrt(Ee*Ee+Qe*Qe);V.set(0,wt),X.set(0,Math.pow(V.y/W.y,n.zoomSpeed)),le(X.y),W.copy(V)}function qe(oe){n.enableZoom&&Ve(oe),n.enablePan&&be(oe)}function Xe(oe){n.enableZoom&&Ve(oe),n.enableRotate&&ve(oe)}function Pe(oe){var we,Ee;n.enabled!==!1&&(R.length===0&&((we=n.domElement)==null||we.ownerDocument.addEventListener("pointermove",ct),(Ee=n.domElement)==null||Ee.ownerDocument.addEventListener("pointerup",gt)),vt(oe),oe.pointerType==="touch"?Le(oe):Zt(oe))}function ct(oe){n.enabled!==!1&&(oe.pointerType==="touch"?Te(oe):O(oe))}function gt(oe){var we,Ee,Qe;nt(oe),R.length===0&&((we=n.domElement)==null||we.releasePointerCapture(oe.pointerId),(Ee=n.domElement)==null||Ee.ownerDocument.removeEventListener("pointermove",ct),(Qe=n.domElement)==null||Qe.ownerDocument.removeEventListener("pointerup",gt)),n.dispatchEvent(o),a=g.NONE}function Yt(oe){nt(oe)}function Zt(oe){let we;switch(oe.button){case 0:we=n.mouseButtons.LEFT;break;case 1:we=n.mouseButtons.MIDDLE;break;case 2:we=n.mouseButtons.RIGHT;break;default:we=-1}switch(we){case LI.DOLLY:if(n.enableZoom===!1)return;te(oe),a=g.DOLLY;break;case LI.ROTATE:if(oe.ctrlKey||oe.metaKey||oe.shiftKey){if(n.enablePan===!1)return;q(oe),a=g.PAN}else{if(n.enableRotate===!1)return;ne(oe),a=g.ROTATE}break;case LI.PAN:if(oe.ctrlKey||oe.metaKey||oe.shiftKey){if(n.enableRotate===!1)return;ne(oe),a=g.ROTATE}else{if(n.enablePan===!1)return;q(oe),a=g.PAN}break;default:a=g.NONE}a!==g.NONE&&n.dispatchEvent(r)}function O(oe){if(n.enabled!==!1)switch(a){case g.ROTATE:if(n.enableRotate===!1)return;se(oe);break;case g.DOLLY:if(n.enableZoom===!1)return;ue(oe);break;case g.PAN:if(n.enablePan===!1)return;Ae(oe);break}}function z(oe){n.enabled===!1||n.enableZoom===!1||a!==g.NONE&&a!==g.ROTATE||(oe.preventDefault(),n.dispatchEvent(r),We(oe),n.dispatchEvent(o))}function ye(oe){n.enabled===!1||n.enablePan===!1||me(oe)}function Le(oe){switch(Ye(oe),R.length){case 1:switch(n.touches.ONE){case zI.ROTATE:if(n.enableRotate===!1)return;tt(),a=g.TOUCH_ROTATE;break;case zI.PAN:if(n.enablePan===!1)return;Oe(),a=g.TOUCH_PAN;break;default:a=g.NONE}break;case 2:switch(n.touches.TWO){case zI.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ke(),a=g.TOUCH_DOLLY_PAN;break;case zI.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;je(),a=g.TOUCH_DOLLY_ROTATE;break;default:a=g.NONE}break;default:a=g.NONE}a!==g.NONE&&n.dispatchEvent(r)}function Te(oe){switch(Ye(oe),a){case g.TOUCH_ROTATE:if(n.enableRotate===!1)return;ve(oe),n.update();break;case g.TOUCH_PAN:if(n.enablePan===!1)return;be(oe),n.update();break;case g.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;qe(oe),n.update();break;case g.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Xe(oe),n.update();break;default:a=g.NONE}}function De(oe){n.enabled!==!1&&oe.preventDefault()}function vt(oe){R.push(oe)}function nt(oe){delete Y[oe.pointerId];for(let we=0;we<R.length;we++)if(R[we].pointerId==oe.pointerId){R.splice(we,1);return}}function Ye(oe){let we=Y[oe.pointerId];we===void 0&&(we=new Fe,Y[oe.pointerId]=we),we.set(oe.pageX,oe.pageY)}function dt(oe){const we=oe.pointerId===R[0].pointerId?R[1]:R[0];return Y[we.pointerId]}t!==void 0&&this.connect(t),this.update()}},cw=class extends Zs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new gO(t)}),this.register(function(t){return new hO(t)}),this.register(function(t){return new AO(t)}),this.register(function(t){return new pO(t)}),this.register(function(t){return new lO(t)}),this.register(function(t){return new cO(t)}),this.register(function(t){return new IO(t)}),this.register(function(t){return new uO(t)}),this.register(function(t){return new oO(t)}),this.register(function(t){return new CO(t)}),this.register(function(t){return new aO(t)}),this.register(function(t){return new dO(t)}),this.register(function(t){return new sO(t)}),this.register(function(t){return new fO(t)}),this.register(function(t){return new mO(t)})}load(e,t,n,s){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=bs.extractUrlBase(e),this.manager.itemStart(e);const g=function(l){s?s(l):console.error(l),r.manager.itemError(e),r.manager.itemEnd(e)},a=new ys(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{r.parse(l,o,function(c){t(c),r.manager.itemEnd(e)},g)}catch(c){g(c)}},n,g)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const o={},g={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(bs.decodeText(new Uint8Array(e.slice(0,4)))===PX){try{o[Cn.KHR_BINARY_GLTF]=new bO(e)}catch(c){s&&s(c);return}r=JSON.parse(o[Cn.KHR_BINARY_GLTF].content)}else r=JSON.parse(bs.decodeText(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const a=new XO(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const c=this.pluginCallbacks[l](a);g[c.name]=c,o[c.name]=!0}if(r.extensionsUsed)for(let l=0;l<r.extensionsUsed.length;++l){const c=r.extensionsUsed[l],C=r.extensionsRequired||[];switch(c){case Cn.KHR_MATERIALS_UNLIT:o[c]=new rO;break;case Cn.KHR_DRACO_MESH_COMPRESSION:o[c]=new GO(r,this.dracoLoader);break;case Cn.KHR_TEXTURE_TRANSFORM:o[c]=new yO;break;case Cn.KHR_MESH_QUANTIZATION:o[c]=new BO;break;default:C.indexOf(c)>=0&&g[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}a.setExtensions(o),a.setPlugins(g),a.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}};function iO(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const Cn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let sO=class{constructor(e){this.parser=e,this.name=Cn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,a=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let l;const c=new et(16777215);a.color!==void 0&&c.fromArray(a.color);const C=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new ZG(c),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new vG(c),l.distance=C;break;case"spot":l=new BG(c),l.distance=C,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,oc(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],g=(r.extensions&&r.extensions[this.name]||{}).light;return g===void 0?null:this._loadLight(g).then(function(a){return n._getNodeRef(t.cache,g,a)})}},rO=class{constructor(){this.name=Cn.KHR_MATERIALS_UNLIT}getMaterialType(){return Oi}extendParams(e,t,n){const s=[];e.color=new et(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,3001))}return Promise.all(s)}},oO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}},gO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const g=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Fe(g,g)}return Promise.all(r)}},aO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}},lO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new et(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,3001)),o.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}},cO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}},IO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const g=o.attenuationColor||[1,1,1];return t.attenuationColor=new et(g[0],g[1],g[2]),Promise.all(r)}},uO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}},CO=class{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const g=o.specularColorFactor||[1,1,1];return t.specularColor=new et(g[0],g[1],g[2]),o.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,3001)),Promise.all(r)}};class dO{constructor(e){this.parser=e,this.name=Cn.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(n.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}let hO=class{constructor(e){this.parser=e,this.name=Cn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}},AO=class{constructor(e){this.parser=e,this.name=Cn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],g=s.images[o.source];let a=n.textureLoader;if(g.uri){const l=n.options.manager.getHandler(g.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}};class pO{constructor(e){this.parser=e,this.name=Cn.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],g=s.images[o.source];let a=n.textureLoader;if(g.uri){const l=n.options.manager.getHandler(g.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}let fO=class{constructor(e){this.name=Cn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(g){const a=s.byteOffset||0,l=s.byteLength||0,c=s.count,C=s.byteStride,h=new Uint8Array(g,a,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(c,C,h,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(c*C);return o.decodeGltfBuffer(new Uint8Array(p),c,C,h,s.mode,s.filter),p})})}else return null}},mO=class{constructor(e){this.name=Cn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const l of s.primitives)if(l.mode!==Ko.TRIANGLES&&l.mode!==Ko.TRIANGLE_STRIP&&l.mode!==Ko.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=n.extensions[this.name].attributes,g=[],a={};for(const l in o)g.push(this.parser.getDependency("accessor",o[l]).then(c=>(a[l]=c,a[l])));return g.length<1?null:(g.push(this.parser.createNodeMesh(e)),Promise.all(g).then(l=>{const c=l.pop(),C=c.isGroup?c.children:[c],h=l[0].count,p=[];for(const m of C){const f=new mt,b=new E,y=new jn,v=new E(1,1,1),G=new wc(m.geometry,m.material,h);for(let w=0;w<h;w++)a.TRANSLATION&&b.fromBufferAttribute(a.TRANSLATION,w),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,w),a.SCALE&&v.fromBufferAttribute(a.SCALE,w),G.setMatrixAt(w,f.compose(b,y,v));for(const w in a)w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&m.geometry.setAttribute(w,a[w]);en.prototype.copy.call(G,m),this.parser.assignFinalMaterial(G),p.push(G)}return c.isGroup?(c.clear(),c.add(...p),c):p[0]}))}};const PX="glTF",bA=12,f3={JSON:1313821514,BIN:5130562};let bO=class{constructor(e){this.name=Cn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,bA);if(this.header={magic:bs.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==PX)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-bA,s=new DataView(e,bA);let r=0;for(;r<n;){const o=s.getUint32(r,!0);r+=4;const g=s.getUint32(r,!0);if(r+=4,g===f3.JSON){const a=new Uint8Array(e,bA+r,o);this.content=bs.decodeText(a)}else if(g===f3.BIN){const a=bA+r;this.body=e.slice(a,a+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},GO=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Cn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,g={},a={},l={};for(const c in o){const C=e1[c]||c.toLowerCase();g[C]=o[c]}for(const c in e.attributes){const C=e1[c]||c.toLowerCase();if(o[c]!==void 0){const h=n.accessors[e.attributes[c]],p=bd[h.componentType];l[C]=p.name,a[C]=h.normalized===!0}}return t.getDependency("bufferView",r).then(function(c){return new Promise(function(C){s.decodeDracoFile(c,function(h){for(const p in h.attributes){const m=h.attributes[p],f=a[p];f!==void 0&&(m.normalized=f)}C(h)},g,l)})})}},yO=class{constructor(){this.name=Cn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},BO=class{constructor(){this.name=Cn.KHR_MESH_QUANTIZATION}},OX=class extends xu{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,g=this.valueSize,a=g*2,l=g*3,c=s-t,C=(n-t)/c,h=C*C,p=h*C,m=e*l,f=m-l,b=-2*p+3*h,y=p-h,v=1-b,G=y-h+C;for(let w=0;w!==g;w++){const W=o[f+w+g],V=o[f+w+a]*c,X=o[m+w+g],R=o[m+w]*c;r[w]=v*W+G*V+b*X+y*R}return r}};const vO=new jn;let ZO=class extends OX{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return vO.fromArray(r).normalize().toArray(r),r}};const Ko={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},bd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},m3={9728:oi,9729:Zn,9984:Vd,9985:kp,9986:ru,9987:eg},b3={33071:cs,33648:mu,10497:Hg},TB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},e1={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...zp.replace(/\D+/g,"")>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},tc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},wO={CUBICSPLINE:void 0,LINEAR:gl,STEP:Gu},EB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function SO(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new jo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ua})),i.DefaultMaterial}function NI(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function oc(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function RO(i,e,t){let n=!1,s=!1,r=!1;for(let l=0,c=e.length;l<c;l++){const C=e[l];if(C.POSITION!==void 0&&(n=!0),C.NORMAL!==void 0&&(s=!0),C.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(i);const o=[],g=[],a=[];for(let l=0,c=e.length;l<c;l++){const C=e[l];if(n){const h=C.POSITION!==void 0?t.getDependency("accessor",C.POSITION):i.attributes.position;o.push(h)}if(s){const h=C.NORMAL!==void 0?t.getDependency("accessor",C.NORMAL):i.attributes.normal;g.push(h)}if(r){const h=C.COLOR_0!==void 0?t.getDependency("accessor",C.COLOR_0):i.attributes.color;a.push(h)}}return Promise.all([Promise.all(o),Promise.all(g),Promise.all(a)]).then(function(l){const c=l[0],C=l[1],h=l[2];return n&&(i.morphAttributes.position=c),s&&(i.morphAttributes.normal=C),r&&(i.morphAttributes.color=h),i.morphTargetsRelative=!0,i})}function WO(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function xO(i){let e;const t=i.extensions&&i.extensions[Cn.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+DB(t.attributes):e=i.indices+":"+DB(i.attributes)+":"+i.mode,i.targets!==void 0)for(let n=0,s=i.targets.length;n<s;n++)e+=":"+DB(i.targets[n]);return e}function DB(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}function t1(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function VO(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const HO=new mt;let XO=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new iO,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,r=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&r<98?this.textureLoader=new VZ(this.options.manager):this.textureLoader=new XZ(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ys(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const g={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:n,userData:{}};NI(r,g,s),oc(g,s),Promise.all(n._invokeAll(function(a){return a.afterRoot&&a.afterRoot(g)})).then(function(){e(g)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let g=0,a=o.length;g<a;g++)e[o[g]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(o,g)=>{const a=this.associations.get(o);a!=null&&this.associations.set(g,a);for(const[l,c]of o.children.entries())r(c,g.children[l])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Cn.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){n.load(bs.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=TB[s.type],g=bd[s.componentType],a=s.normalized===!0,l=new g(s.count*o);return Promise.resolve(new on(l,o,a))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const g=o[0],a=TB[s.type],l=bd[s.componentType],c=l.BYTES_PER_ELEMENT,C=c*a,h=s.byteOffset||0,p=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let f,b;if(p&&p!==C){const y=Math.floor(h/p),v="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let G=t.cache.get(v);G||(f=new l(g,y*p,s.count*p/c),G=new Qd(f,p/c),t.cache.add(v,G)),b=new ll(G,a,h%p/c,m)}else g===null?f=new l(s.count*a):f=new l(g,h,s.count*a),b=new on(f,a,m);if(s.sparse!==void 0){const y=TB.SCALAR,v=bd[s.sparse.indices.componentType],G=s.sparse.indices.byteOffset||0,w=s.sparse.values.byteOffset||0,W=new v(o[1],G,s.sparse.count*y),V=new l(o[2],w,s.sparse.count*a);g!==null&&(b=new on(b.array.slice(),b.itemSize,b.normalized));for(let X=0,R=W.length;X<R;X++){const Y=W[X];if(b.setX(Y,V[X*a]),a>=2&&b.setY(Y,V[X*a+1]),a>=3&&b.setZ(Y,V[X*a+2]),a>=4&&b.setW(Y,V[X*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let g=this.textureLoader;if(o.uri){const a=n.manager.getHandler(o.uri);a!==null&&(g=a)}return this.loadTextureImage(e,r,g)}loadTextureImage(e,t,n){const s=this,r=this.json,o=r.textures[e],g=r.images[t],a=(g.uri||g.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(c){c.flipY=!1,c.name=o.name||g.name||"",c.name===""&&typeof g.uri=="string"&&g.uri.startsWith("data:image/")===!1&&(c.name=g.uri);const h=(r.samplers||{})[o.sampler]||{};return c.magFilter=m3[h.magFilter]||Zn,c.minFilter=m3[h.minFilter]||eg,c.wrapS=b3[h.wrapS]||Hg,c.wrapT=b3[h.wrapT]||Hg,s.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(C=>C.clone());const o=s.images[e],g=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(o.bufferView!==void 0)a=n.getDependency("bufferView",o.bufferView).then(function(C){l=!0;const h=new Blob([C],{type:o.mimeType});return a=g.createObjectURL(h),a});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(a).then(function(C){return new Promise(function(h,p){let m=h;t.isImageBitmapLoader===!0&&(m=function(f){const b=new kn(f);b.needsUpdate=!0,h(b)}),t.load(bs.resolveURL(C,r.path),m,void 0,p)})}).then(function(C){return l===!0&&g.revokeObjectURL(a),C.userData.mimeType=o.mimeType||VO(o.uri),C}).catch(function(C){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),C});return this.sourceCache[e]=c,c}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),r.extensions[Cn.KHR_TEXTURE_TRANSFORM]){const g=n.extensions!==void 0?n.extensions[Cn.KHR_TEXTURE_TRANSFORM]:void 0;if(g){const a=r.associations.get(o);o=r.extensions[Cn.KHR_TEXTURE_TRANSFORM].extendTexture(o,g),r.associations.set(o,a)}}return s!==void 0&&("colorSpace"in o?o.colorSpace=s===3001?"srgb":"srgb-linear":o.encoding=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const g="PointsMaterial:"+n.uuid;let a=this.cache.get(g);a||(a=new Pp,qn.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,a.sizeAttenuation=!1,this.cache.add(g,a)),n=a}else if(e.isLine){const g="LineBasicMaterial:"+n.uuid;let a=this.cache.get(g);a||(a=new Bs,qn.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,this.cache.add(g,a)),n=a}if(s||r||o){let g="ClonedMaterial:"+n.uuid+":";s&&(g+="derivative-tangents:"),r&&(g+="vertex-colors:"),o&&(g+="flat-shading:");let a=this.cache.get(g);a||(a=n.clone(),r&&(a.vertexColors=!0),o&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(g,a),this.associations.set(a,this.associations.get(n))),n=a}e.material=n}getMaterialType(){return jo}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let o;const g={},a=r.extensions||{},l=[];if(a[Cn.KHR_MATERIALS_UNLIT]){const C=s[Cn.KHR_MATERIALS_UNLIT];o=C.getMaterialType(),l.push(C.extendParams(g,r,t))}else{const C=r.pbrMetallicRoughness||{};if(g.color=new et(1,1,1),g.opacity=1,Array.isArray(C.baseColorFactor)){const h=C.baseColorFactor;g.color.fromArray(h),g.opacity=h[3]}C.baseColorTexture!==void 0&&l.push(t.assignTexture(g,"map",C.baseColorTexture,3001)),g.metalness=C.metallicFactor!==void 0?C.metallicFactor:1,g.roughness=C.roughnessFactor!==void 0?C.roughnessFactor:1,C.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(g,"metalnessMap",C.metallicRoughnessTexture)),l.push(t.assignTexture(g,"roughnessMap",C.metallicRoughnessTexture))),o=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,g)})))}r.doubleSided===!0&&(g.side=Lc);const c=r.alphaMode||EB.OPAQUE;if(c===EB.BLEND?(g.transparent=!0,g.depthWrite=!1):(g.transparent=!1,c===EB.MASK&&(g.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Oi&&(l.push(t.assignTexture(g,"normalMap",r.normalTexture)),g.normalScale=new Fe(1,1),r.normalTexture.scale!==void 0)){const C=r.normalTexture.scale;g.normalScale.set(C,C)}return r.occlusionTexture!==void 0&&o!==Oi&&(l.push(t.assignTexture(g,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(g.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Oi&&(g.emissive=new et().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==Oi&&l.push(t.assignTexture(g,"emissiveMap",r.emissiveTexture,3001)),Promise.all(l).then(function(){const C=new o(g);return r.name&&(C.name=r.name),oc(C,r),t.associations.set(C,{materials:e}),r.extensions&&NI(s,C,r),C})}createUniqueName(e){const t=un.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(g){return n[Cn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(g,t).then(function(a){return G3(a,g,t)})}const o=[];for(let g=0,a=e.length;g<a;g++){const l=e[g],c=xO(l),C=s[c];if(C)o.push(C.promise);else{let h;l.extensions&&l.extensions[Cn.KHR_DRACO_MESH_COMPRESSION]?h=r(l):h=G3(new zt,l,t),s[c]={primitive:l,promise:h},o.push(h)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],o=r.primitives,g=[];for(let a=0,l=o.length;a<l;a++){const c=o[a].material===void 0?SO(this.cache):this.getDependency("material",o[a].material);g.push(c)}return g.push(t.loadGeometries(o)),Promise.all(g).then(function(a){const l=a.slice(0,a.length-1),c=a[a.length-1],C=[];for(let p=0,m=c.length;p<m;p++){const f=c[p],b=o[p];let y;const v=l[p];if(b.mode===Ko.TRIANGLES||b.mode===Ko.TRIANGLE_STRIP||b.mode===Ko.TRIANGLE_FAN||b.mode===void 0)y=r.isSkinnedMesh===!0?new pG(f,v):new mi(f,v),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),b.mode===Ko.TRIANGLE_STRIP?y.geometry=A3(y.geometry,IG):b.mode===Ko.TRIANGLE_FAN&&(y.geometry=A3(y.geometry,Hd));else if(b.mode===Ko.LINES)y=new ng(f,v);else if(b.mode===Ko.LINE_STRIP)y=new Ca(f,v);else if(b.mode===Ko.LINE_LOOP)y=new fG(f,v);else if(b.mode===Ko.POINTS)y=new mG(f,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(y.geometry.morphAttributes).length>0&&WO(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),oc(y,r),b.extensions&&NI(s,y,b),t.assignFinalMaterial(y),C.push(y)}for(let p=0,m=C.length;p<m;p++)t.associations.set(C[p],{meshes:e,primitives:p});if(C.length===1)return r.extensions&&NI(s,C[0],r),C[0];const h=new oo;r.extensions&&NI(s,h,r),t.associations.set(h,{meshes:e});for(let p=0,m=C.length;p<m;p++)h.add(C[p]);return h})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Dn(lZ.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new co(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),oc(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,r=t.joints.length;s<r;s++)n.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const r=s.pop(),o=s,g=[],a=[];for(let l=0,c=o.length;l<c;l++){const C=o[l];if(C){g.push(C);const h=new mt;r!==null&&h.fromArray(r.array,l*16),a.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new jd(g,a)})}loadAnimation(e){const n=this.json.animations[e],s=n.name?n.name:"animation_"+e,r=[],o=[],g=[],a=[],l=[];for(let c=0,C=n.channels.length;c<C;c++){const h=n.channels[c],p=n.samplers[h.sampler],m=h.target,f=m.node,b=n.parameters!==void 0?n.parameters[p.input]:p.input,y=n.parameters!==void 0?n.parameters[p.output]:p.output;m.node!==void 0&&(r.push(this.getDependency("node",f)),o.push(this.getDependency("accessor",b)),g.push(this.getDependency("accessor",y)),a.push(p),l.push(m))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(g),Promise.all(a),Promise.all(l)]).then(function(c){const C=c[0],h=c[1],p=c[2],m=c[3],f=c[4],b=[];for(let y=0,v=C.length;y<v;y++){const G=C[y],w=h[y],W=p[y],V=m[y],X=f[y];if(G===void 0)continue;G.updateMatrix();let R;switch(tc[X.path]){case tc.weights:R=Bu;break;case tc.rotation:R=Yg;break;case tc.position:case tc.scale:default:R=Hc;break}const Y=G.name?G.name:G.uuid,M=V.interpolation!==void 0?wO[V.interpolation]:gl,L=[];tc[X.path]===tc.weights?G.traverse(function(j){j.morphTargetInfluences&&L.push(j.name?j.name:j.uuid)}):L.push(Y);let re=W.array;if(W.normalized){const j=t1(re.constructor),$=new Float32Array(re.length);for(let ie=0,he=re.length;ie<he;ie++)$[ie]=re[ie]*j;re=$}for(let j=0,$=L.length;j<$;j++){const ie=new R(L[j]+"."+tc[X.path],w.array,re,M);V.interpolation==="CUBICSPLINE"&&(ie.createInterpolant=function(le){const _=this instanceof Yg?ZO:OX;return new _(this.times,this.values,this.getValueSize()/3,le)},ie.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),b.push(ie)}}return new Xc(s,void 0,b)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const o=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(g){if(g.isMesh)for(let a=0,l=s.weights.length;a<l;a++)g.morphTargetInfluences[a]=s.weights[a]}),o})}loadNode(e){const t=this.json,n=this,s=t.nodes[e],r=n._loadNodeShallow(e),o=[],g=s.children||[];for(let l=0,c=g.length;l<c;l++)o.push(n.getDependency("node",g[l]));const a=s.skin===void 0?Promise.resolve(null):n.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),a]).then(function(l){const c=l[0],C=l[1],h=l[2];h!==null&&c.traverse(function(p){p.isSkinnedMesh&&p.bind(h,HO)});for(let p=0,m=C.length;p<m;p++)c.add(C[p]);return c})}_loadNodeShallow(e){const t=this.json,n=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"",g=[],a=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&g.push(a),r.camera!==void 0&&g.push(s.getDependency("camera",r.camera).then(function(l){return s._getNodeRef(s.cameraCache,r.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){g.push(l)}),this.nodeCache[e]=Promise.all(g).then(function(l){let c;if(r.isBone===!0?c=new Up:l.length>1?c=new oo:l.length===1?c=l[0]:c=new en,c!==l[0])for(let C=0,h=l.length;C<h;C++)c.add(l[C]);if(r.name&&(c.userData.name=r.name,c.name=o),oc(c,r),r.extensions&&NI(n,c,r),r.matrix!==void 0){const C=new mt;C.fromArray(r.matrix),c.applyMatrix4(C)}else r.translation!==void 0&&c.position.fromArray(r.translation),r.rotation!==void 0&&c.quaternion.fromArray(r.rotation),r.scale!==void 0&&c.scale.fromArray(r.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=e,c}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,r=new oo;n.name&&(r.name=s.createUniqueName(n.name)),oc(r,n),n.extensions&&NI(t,r,n);const o=n.nodes||[],g=[];for(let a=0,l=o.length;a<l;a++)g.push(s.getDependency("node",o[a]));return Promise.all(g).then(function(a){for(let c=0,C=a.length;c<C;c++)r.add(a[c]);const l=c=>{const C=new Map;for(const[h,p]of s.associations)(h instanceof qn||h instanceof kn)&&C.set(h,p);return c.traverse(h=>{const p=s.associations.get(h);p!=null&&C.set(h,p)}),C};return s.associations=l(r),r})}};function YO(i,e,t){const n=e.attributes,s=new Cl;if(n.POSITION!==void 0){const g=t.json.accessors[n.POSITION],a=g.min,l=g.max;if(a!==void 0&&l!==void 0){if(s.set(new E(a[0],a[1],a[2]),new E(l[0],l[1],l[2])),g.normalized){const c=t1(bd[g.componentType]);s.min.multiplyScalar(c),s.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const g=new E,a=new E;for(let l=0,c=r.length;l<c;l++){const C=r[l];if(C.POSITION!==void 0){const h=t.json.accessors[C.POSITION],p=h.min,m=h.max;if(p!==void 0&&m!==void 0){if(a.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),a.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),a.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),h.normalized){const f=t1(bd[h.componentType]);a.multiplyScalar(f)}g.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(g)}i.boundingBox=s;const o=new dl;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=o}function G3(i,e,t){const n=e.attributes,s=[];function r(o,g){return t.getDependency("accessor",o).then(function(a){i.setAttribute(g,a)})}for(const o in n){const g=e1[o]||o.toLowerCase();g in i.attributes||s.push(r(n[o],g))}if(e.indices!==void 0&&!i.index){const o=t.getDependency("accessor",e.indices).then(function(g){i.setIndex(g)});s.push(o)}return oc(i,e),YO(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?RO(i,e.targets,t):i})}class FO extends oH{constructor(e){super(e),this.type=Jo}parse(e){const g=function(G,w){switch(G){case 1:console.error("THREE.RGBELoader Read Error: "+(w||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(w||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(w||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(w||""))}return-1},C=`
`,h=function(G,w,W){w=w||1024;let X=G.pos,R=-1,Y=0,M="",L=String.fromCharCode.apply(null,new Uint16Array(G.subarray(X,X+128)));for(;0>(R=L.indexOf(C))&&Y<w&&X<G.byteLength;)M+=L,Y+=L.length,X+=128,L+=String.fromCharCode.apply(null,new Uint16Array(G.subarray(X,X+128)));return-1<R?(W!==!1&&(G.pos+=Y+R+1),M+L.slice(0,R)):!1},p=function(G){const w=/^#\?(\S+)/,W=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,V=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,X=/^\s*FORMAT=(\S+)\s*$/,R=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Y={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let M,L;if(G.pos>=G.byteLength||!(M=h(G)))return g(1,"no header found");if(!(L=M.match(w)))return g(3,"bad initial token");for(Y.valid|=1,Y.programtype=L[1],Y.string+=M+`
`;M=h(G),M!==!1;){if(Y.string+=M+`
`,M.charAt(0)==="#"){Y.comments+=M+`
`;continue}if((L=M.match(W))&&(Y.gamma=parseFloat(L[1])),(L=M.match(V))&&(Y.exposure=parseFloat(L[1])),(L=M.match(X))&&(Y.valid|=2,Y.format=L[1]),(L=M.match(R))&&(Y.valid|=4,Y.height=parseInt(L[1],10),Y.width=parseInt(L[2],10)),Y.valid&2&&Y.valid&4)break}return Y.valid&2?Y.valid&4?Y:g(3,"missing image size specifier"):g(3,"missing format specifier")},m=function(G,w,W){const V=w;if(V<8||V>32767||G[0]!==2||G[1]!==2||G[2]&128)return new Uint8Array(G);if(V!==(G[2]<<8|G[3]))return g(3,"wrong scanline width");const X=new Uint8Array(4*w*W);if(!X.length)return g(4,"unable to allocate buffer space");let R=0,Y=0;const M=4*V,L=new Uint8Array(4),re=new Uint8Array(M);let j=W;for(;j>0&&Y<G.byteLength;){if(Y+4>G.byteLength)return g(1);if(L[0]=G[Y++],L[1]=G[Y++],L[2]=G[Y++],L[3]=G[Y++],L[0]!=2||L[1]!=2||(L[2]<<8|L[3])!=V)return g(3,"bad rgbe scanline format");let $=0,ie;for(;$<M&&Y<G.byteLength;){ie=G[Y++];const le=ie>128;if(le&&(ie-=128),ie===0||$+ie>M)return g(3,"bad scanline data");if(le){const _=G[Y++];for(let ne=0;ne<ie;ne++)re[$++]=_}else re.set(G.subarray(Y,Y+ie),$),$+=ie,Y+=ie}const he=V;for(let le=0;le<he;le++){let _=0;X[R]=re[le+_],_+=V,X[R+1]=re[le+_],_+=V,X[R+2]=re[le+_],_+=V,X[R+3]=re[le+_],R+=4}j--}return X},f=function(G,w,W,V){const X=G[w+3],R=Math.pow(2,X-128)/255;W[V+0]=G[w+0]*R,W[V+1]=G[w+1]*R,W[V+2]=G[w+2]*R,W[V+3]=1},b=function(G,w,W,V){const X=G[w+3],R=Math.pow(2,X-128)/255;W[V+0]=FA.toHalfFloat(Math.min(G[w+0]*R,65504)),W[V+1]=FA.toHalfFloat(Math.min(G[w+1]*R,65504)),W[V+2]=FA.toHalfFloat(Math.min(G[w+2]*R,65504)),W[V+3]=FA.toHalfFloat(1)},y=new Uint8Array(e);y.pos=0;const v=p(y);if(v!==-1){const G=v.width,w=v.height,W=m(y.subarray(y.pos),G,w);if(W!==-1){let V,X,R;switch(this.type){case Do:R=W.length/4;const Y=new Float32Array(R*4);for(let L=0;L<R;L++)f(W,L*4,Y,L*4);V=Y,X=Do;break;case Jo:R=W.length/4;const M=new Uint16Array(R*4);for(let L=0;L<R;L++)b(W,L*4,M,L*4);V=M,X=Jo;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:G,height:w,data:V,header:v.string,gamma:v.gamma,exposure:v.exposure,type:X}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,s){function r(o,g){switch(o.type){case Do:case Jo:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=Zn,o.magFilter=Zn,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,g)}return super.load(e,r,n,s)}}const JB=new WeakMap;let NO=class extends Zs{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const r=new ys(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{const g={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(o,g).then(t).catch(s)},n,s)}decodeDracoFile(e,t,n,s){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){for(const a in t.attributeTypes){const l=t.attributeTypes[a];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[a]=l.name)}const n=JSON.stringify(t);if(JB.has(e)){const a=JB.get(e);if(a.key===n)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=e.byteLength,g=this._getWorker(r,o).then(a=>(s=a,new Promise((l,c)=>{s._callbacks[r]={resolve:l,reject:c},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return g.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),JB.set(e,{key:n,promise:g}),g}_createGeometry(e){const t=new zt;e.index&&t.setIndex(new on(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],r=s.name,o=s.array,g=s.itemSize;t.setAttribute(r,new on(o,g))}return t}_loadLibrary(e,t){const n=new ys(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,r)=>{n.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=MO.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}};function MO(){let i,e;onmessage=function(o){const g=o.data;switch(g.type){case"init":i=g.decoderConfig,e=new Promise(function(c){i.onModuleLoaded=function(C){c({draco:C})},DracoDecoderModule(i)});break;case"decode":const a=g.buffer,l=g.taskConfig;e.then(c=>{const C=c.draco,h=new C.Decoder,p=new C.DecoderBuffer;p.Init(new Int8Array(a),a.byteLength);try{const m=t(C,h,p,l),f=m.attributes.map(b=>b.array.buffer);m.index&&f.push(m.index.array.buffer),self.postMessage({type:"decode",id:g.id,geometry:m},f)}catch(m){console.error(m),self.postMessage({type:"error",id:g.id,error:m.message})}finally{C.destroy(p),C.destroy(h)}});break}};function t(o,g,a,l){const c=l.attributeIDs,C=l.attributeTypes;let h,p;const m=g.GetEncodedGeometryType(a);if(m===o.TRIANGULAR_MESH)h=new o.Mesh,p=g.DecodeBufferToMesh(a,h);else if(m===o.POINT_CLOUD)h=new o.PointCloud,p=g.DecodeBufferToPointCloud(a,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const f={index:null,attributes:[]};for(const b in c){const y=self[C[b]];let v,G;if(l.useUniqueIDs)G=c[b],v=g.GetAttributeByUniqueId(h,G);else{if(G=g.GetAttributeId(h,o[c[b]]),G===-1)continue;v=g.GetAttribute(h,G)}f.attributes.push(s(o,g,h,b,y,v))}return m===o.TRIANGULAR_MESH&&(f.index=n(o,g,h)),o.destroy(h),f}function n(o,g,a){const c=a.num_faces()*3,C=c*4,h=o._malloc(C);g.GetTrianglesUInt32Array(a,C,h);const p=new Uint32Array(o.HEAPF32.buffer,h,c).slice();return o._free(h),{array:p,itemSize:1}}function s(o,g,a,l,c,C){const h=C.num_components(),m=a.num_points()*h,f=m*c.BYTES_PER_ELEMENT,b=r(o,c),y=o._malloc(f);g.GetAttributeDataArrayForAllPoints(a,C,b,f,y);const v=new c(o.HEAPF32.buffer,y,m).slice();return o._free(y),{name:l,array:v,itemSize:h}}function r(o,g){switch(g){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}let Z0;const UB=()=>{if(Z0)return Z0;const i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let s=i;WebAssembly.validate(t)&&(s=e);let r;const o=WebAssembly.instantiate(g(s),{}).then(C=>{r=C.instance,r.exports.__wasm_call_ctors()});function g(C){const h=new Uint8Array(C.length);for(let m=0;m<C.length;++m){const f=C.charCodeAt(m);h[m]=f>96?f-71:f>64?f-65:f>47?f+4:f>46?63:62}let p=0;for(let m=0;m<C.length;++m)h[p++]=h[m]<60?n[h[m]]:(h[m]-60)*64+h[++m];return h.buffer.slice(0,p)}function a(C,h,p,m,f,b){const y=r.exports.sbrk,v=p+3&-4,G=y(v*m),w=y(f.length),W=new Uint8Array(r.exports.memory.buffer);W.set(f,w);const V=C(G,p,m,w,f.length);if(V===0&&b&&b(G,v,m),h.set(W.subarray(G,G+p*m)),y(G-y(0)),V!==0)throw new Error(`Malformed buffer data: ${V}`)}const l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Z0={ready:o,supported:!0,decodeVertexBuffer(C,h,p,m,f){a(r.exports.meshopt_decodeVertexBuffer,C,h,p,m,r.exports[l[f]])},decodeIndexBuffer(C,h,p,m){a(r.exports.meshopt_decodeIndexBuffer,C,h,p,m)},decodeIndexSequence(C,h,p,m){a(r.exports.meshopt_decodeIndexSequence,C,h,p,m)},decodeGltfBuffer(C,h,p,m,f,b){a(r.exports[c[f]],C,h,p,m,r.exports[l[b]])}},Z0};var KO=1/0,LO=9007199254740991,zO="[object Arguments]",_O="[object Function]",kO="[object GeneratorFunction]",TO="[object Symbol]",EO=typeof Da=="object"&&Da&&Da.Object===Object&&Da,DO=typeof self=="object"&&self&&self.Object===Object&&self,JO=EO||DO||Function("return this")();function UO(i,e,t){switch(t.length){case 0:return i.call(e);case 1:return i.call(e,t[0]);case 2:return i.call(e,t[0],t[1]);case 3:return i.call(e,t[0],t[1],t[2])}return i.apply(e,t)}function PO(i,e){for(var t=-1,n=i?i.length:0,s=Array(n);++t<n;)s[t]=e(i[t],t,i);return s}function OO(i,e){for(var t=-1,n=e.length,s=i.length;++t<n;)i[s+t]=e[t];return i}var Iw=Object.prototype,QO=Iw.hasOwnProperty,uw=Iw.toString,y3=JO.Symbol,jO=Iw.propertyIsEnumerable,B3=y3?y3.isConcatSpreadable:void 0,v3=Math.max;function QX(i,e,t,n,s){var r=-1,o=i.length;for(t||(t=tQ),s||(s=[]);++r<o;){var g=i[r];e>0&&t(g)?e>1?QX(g,e-1,t,n,s):OO(s,g):n||(s[s.length]=g)}return s}function qO(i,e){return i=Object(i),$O(i,e,function(t,n){return n in i})}function $O(i,e,t){for(var n=-1,s=e.length,r={};++n<s;){var o=e[n],g=i[o];t(g,o)&&(r[o]=g)}return r}function eQ(i,e){return e=v3(e===void 0?i.length-1:e,0),function(){for(var t=arguments,n=-1,s=v3(t.length-e,0),r=Array(s);++n<s;)r[n]=t[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=t[n];return o[e]=r,UO(i,this,o)}}function tQ(i){return sQ(i)||iQ(i)||!!(B3&&i&&i[B3])}function nQ(i){if(typeof i=="string"||cQ(i))return i;var e=i+"";return e=="0"&&1/i==-KO?"-0":e}function iQ(i){return oQ(i)&&QO.call(i,"callee")&&(!jO.call(i,"callee")||uw.call(i)==zO)}var sQ=Array.isArray;function rQ(i){return i!=null&&aQ(i.length)&&!gQ(i)}function oQ(i){return jX(i)&&rQ(i)}function gQ(i){var e=lQ(i)?uw.call(i):"";return e==_O||e==kO}function aQ(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=LO}function lQ(i){var e=typeof i;return!!i&&(e=="object"||e=="function")}function jX(i){return!!i&&typeof i=="object"}function cQ(i){return typeof i=="symbol"||jX(i)&&uw.call(i)==TO}var IQ=eQ(function(i,e){return i==null?{}:qO(i,PO(QX(e,1),nQ))}),uQ=IQ;const CQ=Db(uQ);function dQ(i,{keys:e=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:t,inject:n,castShadow:s,receiveShadow:r}){let o=CQ(i,e);return t&&(o.geometry&&t!=="materialsOnly"&&(o.geometry=o.geometry.clone()),o.material&&t!=="geometriesOnly"&&(o.material=o.material.clone())),n&&(typeof n=="function"?o={...o,children:n(i)}:T.isValidElement(n)?o={...o,children:n}:o={...o,...n}),i instanceof mi&&(s&&(o.castShadow=!0),r&&(o.receiveShadow=!0)),o}const n1=T.forwardRef(({isChild:i=!1,object:e,children:t,deep:n,castShadow:s,receiveShadow:r,inject:o,keys:g,...a},l)=>{var c;const C={keys:g,deep:n,inject:o,castShadow:s,receiveShadow:r};if(e=T.useMemo(()=>{if(i===!1&&!Array.isArray(e)){let f=!1;if(e.traverse(b=>{b.isSkinnedMesh&&(f=!0)}),f)return $7.clone(e)}return e},[e,i]),Array.isArray(e))return T.createElement("group",Ls({},a,{ref:l}),e.map(f=>T.createElement(n1,Ls({key:f.uuid,object:f},C))),t);const{children:h,...p}=dQ(e,C),m=e.type[0].toLowerCase()+e.type.slice(1);return T.createElement(m,Ls({},p,a,{ref:l}),((c=e)==null?void 0:c.children).map(f=>f.type==="Bone"?T.createElement("primitive",Ls({key:f.uuid,object:f},C)):T.createElement(n1,Ls({key:f.uuid,object:f},C,{isChild:!0}))),t,h)});let w0=null;function qX(i,e,t){return n=>{t&&t(n),i&&(w0||(w0=new NO),w0.setDecoderPath(typeof i=="string"?i:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),n.setDRACOLoader(w0)),e&&n.setMeshoptDecoder(typeof UB=="function"?UB():UB)}}function VG(i,e=!0,t=!0,n){return Yu(cw,i,qX(e,t,n))}VG.preload=(i,e=!0,t=!0,n)=>Yu.preload(cw,i,qX(e,t,n));VG.clear=i=>Yu.clear(cw,i);function hQ(i,e,t){const{gl:n,size:s,viewport:r}=Ui(),o=typeof i=="number"?i:s.width*r.dpr,g=typeof e=="number"?e:s.height*r.dpr,a=(typeof i=="number"?t:i)||{},{samples:l,...c}=a,C=T.useMemo(()=>{let h;return h=new Co(o,g,{minFilter:Zn,magFilter:Zn,encoding:n.outputEncoding,type:Jo,...c}),h.samples=l,h},[]);return T.useLayoutEffect(()=>{C.setSize(o,g),l&&(C.samples=l)},[l,C,o,g]),T.useEffect(()=>()=>C.dispose(),[]),C}const AQ=i=>typeof i=="function",pQ=T.forwardRef(({envMap:i,resolution:e=256,frames:t=1/0,makeDefault:n,children:s,...r},o)=>{const g=Ui(({set:b})=>b),a=Ui(({camera:b})=>b),l=Ui(({size:b})=>b),c=T.useRef(null),C=T.useRef(null),h=hQ(e);T.useLayoutEffect(()=>{r.manual||(c.current.aspect=l.width/l.height)},[l,r]),T.useLayoutEffect(()=>{c.current.updateProjectionMatrix()});let p=0,m=null;const f=AQ(s);return Aa(b=>{f&&(t===1/0||p<t)&&(C.current.visible=!1,b.gl.setRenderTarget(h),m=b.scene.background,i&&(b.scene.background=i),b.gl.render(b.scene,c.current),b.scene.background=m,b.gl.setRenderTarget(null),C.current.visible=!0,p++)}),T.useLayoutEffect(()=>{if(n){const b=a;return g(()=>({camera:c.current})),()=>g(()=>({camera:b}))}},[c,n,g]),T.createElement(T.Fragment,null,T.createElement("perspectiveCamera",Ls({ref:lw([c,o])},r),!f&&s),T.createElement("group",{ref:C},f&&s(h.texture)))}),fQ=T.forwardRef(({makeDefault:i,camera:e,regress:t,domElement:n,enableDamping:s=!0,onChange:r,onStart:o,onEnd:g,...a},l)=>{const c=Ui(w=>w.invalidate),C=Ui(w=>w.camera),h=Ui(w=>w.gl),p=Ui(w=>w.events),m=Ui(w=>w.set),f=Ui(w=>w.get),b=Ui(w=>w.performance),y=e||C,v=n||p.connected||h.domElement,G=T.useMemo(()=>new nO(y),[y]);return Aa(()=>{G.enabled&&G.update()},-1),T.useEffect(()=>(G.connect(v),()=>void G.dispose()),[v,t,G,c]),T.useEffect(()=>{const w=W=>{c(),t&&b.regress(),r&&r(W)};return G.addEventListener("change",w),o&&G.addEventListener("start",o),g&&G.addEventListener("end",g),()=>{o&&G.removeEventListener("start",o),g&&G.removeEventListener("end",g),G.removeEventListener("change",w)}},[r,o,g,G,c]),T.useEffect(()=>{if(i){const w=f().controls;return m({controls:G}),()=>m({controls:w})}},[i,G]),T.createElement("primitive",Ls({ref:l,object:G,enableDamping:s},a))});function PB(i,e,t,n){return new(t||(t=Promise))(function(s,r){function o(l){try{a(n.next(l))}catch(c){r(c)}}function g(l){try{a(n.throw(l))}catch(c){r(c)}}function a(l){var c;l.done?s(l.value):(c=l.value,c instanceof t?c:new t(function(C){C(c)})).then(o,g)}a((n=n.apply(i,e||[])).next())})}const mQ=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function Z3(i){return i=i.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const $X=typeof window>"u",gc=(()=>{if($X)return;const{userAgent:i,platform:e,maxTouchPoints:t}=window.navigator,n=/(iphone|ipod|ipad)/i.test(i),s=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:s,isMobile:/android/i.test(i)||n||s,isSafari12:/Version\/12.+Safari/.test(i)}})();function bQ(i,e,t){if(!t)return[e];const n=function(l){const c=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,C=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,h=l.createShader(35633),p=l.createShader(35632),m=l.createProgram();if(!(p&&h&&m))return;l.shaderSource(h,c),l.shaderSource(p,C),l.compileShader(h),l.compileShader(p),l.attachShader(m,h),l.attachShader(m,p),l.linkProgram(m),l.detachShader(m,h),l.detachShader(m,p),l.deleteShader(h),l.deleteShader(p),l.useProgram(m);const f=l.createBuffer();l.bindBuffer(34962,f),l.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const b=l.getAttribLocation(m,"aPosition");l.vertexAttribPointer(b,3,5126,!1,0,0),l.enableVertexAttribArray(b),l.clearColor(1,1,1,1),l.clear(16384),l.viewport(0,0,1,1),l.drawArrays(4,0,3);const y=new Uint8Array(4);return l.readPixels(0,0,1,1,6408,5121,y),l.deleteProgram(m),l.deleteBuffer(f),y.join("")}(i),s="801621810",r="8016218135",o="80162181161",g=gc!=null&&gc.isIpad?[["a7",o,12],["a8",r,15],["a8x",r,15],["a9",r,15],["a9x",r,15],["a10",r,15],["a10x",r,15],["a12",s,15],["a12x",s,15],["a12z",s,15],["a14",s,15],["m1",s,15]]:[["a7",o,12],["a8",r,12],["a9",r,15],["a10",r,15],["a11",s,15],["a12",s,15],["a13",s,15],["a14",s,15]];let a;return n==="80162181255"?a=g.filter(([,,l])=>l>=14):(a=g.filter(([,l])=>l===n),a.length||(a=g)),a.map(([l])=>`apple ${l} gpu`)}class w3 extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const OB=[],S3=[];function GQ(i,e){if(i===e)return 0;const t=i;i.length>e.length&&(i=e,e=t);let n=i.length,s=e.length;for(;n>0&&i.charCodeAt(~-n)===e.charCodeAt(~-s);)n--,s--;let r,o=0;for(;o<n&&i.charCodeAt(o)===e.charCodeAt(o);)o++;if(n-=o,s-=o,n===0)return s;let g,a,l=0,c=0,C=0;for(;c<n;)S3[c]=i.charCodeAt(o+c),OB[c]=++c;for(;C<s;)for(r=e.charCodeAt(o+C),g=C++,l=C,c=0;c<n;c++)a=r===S3[c]?g:g+1,g=OB[c],l=OB[c]=g>l?a>l?l+1:a:a>g?g+1:a;return l}function yQ(i){return i!=null}const BQ=({mobileTiers:i=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:n,failIfMajorPerformanceCaveat:s=!1,benchmarksURL:r="https://unpkg.com/detect-gpu@5.0.30/dist/benchmarks"}={})=>PB(void 0,void 0,void 0,function*(){const o={};if($X)return{tier:0,type:"SSR"};const{isIpad:g=!!(gc!=null&&gc.isIpad),isMobile:a=!!(gc!=null&&gc.isMobile),screenSize:l=window.screen,loadBenchmarks:c=W=>PB(void 0,void 0,void 0,function*(){const V=yield fetch(`${r}/${W}`).then(X=>X.json());if(parseInt(V.shift().split(".")[0],10)<4)throw new w3("Detect GPU benchmark data is out of date. Please update to version 4x");return V})}=t;let{renderer:C}=t;const h=(W,V,X,R,Y)=>({device:Y,fps:R,gpu:X,isMobile:a,tier:W,type:V});let p,m="";if(C)C=Z3(C),p=[C];else{const W=n||function(X,R=!1){const Y={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:R,powerPreference:"high-performance",stencil:!1};X&&delete Y.powerPreference;const M=window.document.createElement("canvas"),L=M.getContext("webgl",Y)||M.getContext("experimental-webgl",Y);return L??void 0}(gc==null?void 0:gc.isSafari12,s);if(!W)return h(0,"WEBGL_UNSUPPORTED");const V=W.getExtension("WEBGL_debug_renderer_info");if(V&&(C=W.getParameter(V.UNMASKED_RENDERER_WEBGL)),!C)return h(1,"FALLBACK");m=C,C=Z3(C),p=function(X,R,Y){return R==="apple gpu"?bQ(X,R,Y):[R]}(W,C,a)}const f=(yield Promise.all(p.map(function(W){var V;return PB(this,void 0,void 0,function*(){const X=(ue=>{const Ae=a?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce"];for(const We of Ae)if(ue.includes(We))return We})(W);if(!X)return;const R=`${a?"m":"d"}-${X}${g?"-ipad":""}.json`,Y=o[R]=(V=o[R])!==null&&V!==void 0?V:c(R);let M;try{M=yield Y}catch(ue){if(ue instanceof w3)throw ue;return}const L=function(ue){var Ae;const We=(ue=ue.replace(/\([^)]+\)/,"")).match(/\d+/)||ue.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(Ae=We==null?void 0:We.join("").replace(/\W|amd/g,""))!==null&&Ae!==void 0?Ae:""}(W);let re=M.filter(([,ue])=>ue===L);re.length||(re=M.filter(([ue])=>ue.includes(W)));const j=re.length;if(j===0)return;const $=W.split(/[.,()\[\]/\s]/g).sort().filter((ue,Ae,We)=>Ae===0||ue!==We[Ae-1]).join(" ");let ie,[he,,,,le]=j>1?re.map(ue=>[ue,GQ($,ue[2])]).sort(([,ue],[,Ae])=>ue-Ae)[0][0]:re[0],_=Number.MAX_VALUE;const{devicePixelRatio:ne}=window,te=l.width*ne*l.height*ne;for(const ue of le){const[Ae,We]=ue,me=Ae*We,tt=Math.abs(te-me);tt<_&&(_=tt,ie=ue)}if(!ie)return;const[,,q,se]=ie;return[_,q,he,se]})}))).filter(yQ).sort(([W=Number.MAX_VALUE,V],[X=Number.MAX_VALUE,R])=>W===X?V-R:W-X);if(!f.length){const W=mQ.find(V=>C.includes(V));return W?h(0,"BLOCKLISTED",W):h(1,"FALLBACK",`${C} (${m})`)}const[,b,y,v]=f[0];if(b===-1)return h(0,"BLOCKLISTED",y,b,v);const G=a?i:e;let w=0;for(let W=0;W<G.length;W++)b>=G[W]&&(w=W);return h(w,"BENCHMARK",y,b,v)}),eY=i=>vH(()=>BQ(i),["useDetectGPU"]),QB={sunset:"venice/venice_sunset_1k.hdr",dawn:"kiara/kiara_1_dawn_1k.hdr",night:"dikhololo/dikhololo_night_1k.hdr",warehouse:"empty-wharehouse/empty_warehouse_01_1k.hdr",forest:"forrest-slope/forest_slope_1k.hdr",apartment:"lebombo/lebombo_1k.hdr",studio:"studio-small-3/studio_small_03_1k.hdr",city:"potsdamer-platz/potsdamer_platz_1k.hdr",park:"rooitou/rooitou_park_1k.hdr",lobby:"st-fagans/st_fagans_interior_1k.hdr"},vQ="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/",ZQ=i=>i.current&&i.current.isScene,wQ=i=>ZQ(i)?i.current:i;function Cw(i,e,t,n,s=0){const r=wQ(e||t),o=r.background,g=r.environment,a=r.backgroundBlurriness||0;return i!=="only"&&(r.environment=n),i&&(r.background=n),i&&r.backgroundBlurriness!==void 0&&(r.backgroundBlurriness=s),()=>{i!=="only"&&(r.environment=g),i&&(r.background=o),i&&r.backgroundBlurriness!==void 0&&(r.backgroundBlurriness=a)}}function dw({scene:i,background:e=!1,blur:t,map:n}){const s=Ui(r=>r.scene);return T.useLayoutEffect(()=>{if(n)return Cw(e,i,s,n,t)},[s,i,n,e,t]),null}function tY({files:i=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:e="",preset:t=void 0,encoding:n=void 0,extensions:s}){if(t){if(!(t in QB))throw new Error("Preset must be one of: "+Object.keys(QB).join(", "));i=QB[t],e=vQ}const r=Array.isArray(i),g=Yu(r?rH:FO,r?[i]:i,l=>{l.setPath(e),s&&s(l)}),a=r?g[0]:g;return a.mapping=r?rl:xd,a.encoding=n??r?bn:al,a}function nY({background:i=!1,scene:e,blur:t,...n}){const s=tY(n),r=Ui(o=>o.scene);return T.useLayoutEffect(()=>Cw(i,e,r,s,t),[s,i,e,r,t]),null}function SQ({children:i,near:e=1,far:t=1e3,resolution:n=256,frames:s=1,map:r,background:o=!1,blur:g,scene:a,files:l,path:c,preset:C=void 0,extensions:h}){const p=Ui(G=>G.gl),m=Ui(G=>G.scene),f=T.useRef(null),[b]=T.useState(()=>new yp),y=T.useMemo(()=>{const G=new CZ(n);return G.texture.type=Jo,G},[n]);T.useLayoutEffect(()=>(s===1&&f.current.update(p,b),Cw(o,a,m,y.texture,g)),[i,b,y.texture,a,m,o,s,p]);let v=1;return Aa(()=>{(s===1/0||v<s)&&(f.current.update(p,b),v++)}),T.createElement(T.Fragment,null,sP(T.createElement(T.Fragment,null,i,T.createElement("cubeCamera",{ref:f,args:[e,t,y]}),l||C?T.createElement(nY,{background:!0,files:l,preset:C,path:c,extensions:h}):r?T.createElement(dw,{background:!0,map:r,extensions:h}):null),b))}function RQ(i){var e,t,n,s;const r=tY(i),o=i.map||r;T.useMemo(()=>_Z({GroundProjectedEnvImpl:O7}),[]);const g=T.useMemo(()=>[o],[o]),a=(e=i.ground)==null?void 0:e.height,l=(t=i.ground)==null?void 0:t.radius,c=(n=(s=i.ground)==null?void 0:s.scale)!==null&&n!==void 0?n:1e3;return T.createElement(T.Fragment,null,T.createElement(dw,Ls({},i,{map:o})),T.createElement("groundProjectedEnvImpl",{args:g,scale:c,height:a,radius:l}))}function WQ(i){return i.ground?T.createElement(RQ,i):i.map?T.createElement(dw,i):i.children?T.createElement(SQ,i):T.createElement(nY,i)}var iY={exports:{}},xQ="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",VQ=xQ,HQ=VQ;function sY(){}function rY(){}rY.resetWarningCache=sY;var XQ=function(){function i(n,s,r,o,g,a){if(a!==HQ){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}i.isRequired=i;function e(){return i}var t={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:e,element:i,elementType:i,instanceOf:e,node:i,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:rY,resetWarningCache:sY};return t.PropTypes=t,t};iY.exports=XQ();var YQ=iY.exports;const GA=Db(YQ);GA.func.isRequired,GA.arrayOf(GA.oneOfType([GA.element,GA.func])).isRequired;const R3=new mt,W3=new mt,S0=[],yA=new mi;class FQ extends oo{constructor(){super(),this.color=new et("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return(e=this.instance.current)==null?void 0:e.geometry}raycast(e,t){const n=this.instance.current;if(!n||!n.geometry||!n.material)return;yA.geometry=n.geometry;const s=n.matrixWorld,r=n.userData.instances.indexOf(this.instanceKey);if(!(r===-1||r>n.count)){n.getMatrixAt(r,R3),W3.multiplyMatrices(s,R3),yA.matrixWorld=W3,n.material instanceof qn?yA.material.side=n.material.side:yA.material.side=n.material[0].side,yA.raycast(e,S0);for(let o=0,g=S0.length;o<g;o++){const a=S0[o];a.instanceId=r,a.object=this,t.push(a)}S0.length=0}}}const oY=T.createContext(null),x3=new mt,V3=new mt,NQ=new mt,H3=new E,X3=new jn,Y3=new E,If=T.forwardRef(({context:i,children:e,...t},n)=>{T.useMemo(()=>_Z({PositionMesh:FQ}),[]);const s=T.useRef(),{subscribe:r,getParent:o}=T.useContext(i||oY);return T.useLayoutEffect(()=>r(s),[]),T.createElement("positionMesh",Ls({instance:o(),instanceKey:s,ref:lw([n,s])},t),e)}),sb=T.forwardRef(({children:i,range:e,limit:t=1e3,frames:n=1/0,...s},r)=>{const[{context:o,instance:g}]=T.useState(()=>{const b=T.createContext(null);return{context:b,instance:T.forwardRef((y,v)=>T.createElement(If,Ls({context:b},y,{ref:v})))}}),a=T.useRef(null),[l,c]=T.useState([]),[[C,h]]=T.useState(()=>{const b=new Float32Array(t*16);for(let y=0;y<t;y++)NQ.identity().toArray(b,y*16);return[b,new Float32Array([...new Array(t*3)].map(()=>1))]});T.useEffect(()=>{a.current.instanceMatrix.needsUpdate=!0});let p=0,m=0;Aa(()=>{if(n===1/0||p<n){a.current.updateMatrix(),a.current.updateMatrixWorld(),x3.copy(a.current.matrixWorld).invert(),m=Math.min(t,e!==void 0?e:t,l.length),a.current.count=m,a.current.instanceMatrix.updateRange.count=m*16,a.current.instanceColor.updateRange.count=m*3;for(let b=0;b<l.length;b++){const y=l[b].current;y.matrixWorld.decompose(H3,X3,Y3),V3.compose(H3,X3,Y3).premultiply(x3),V3.toArray(C,b*16),a.current.instanceMatrix.needsUpdate=!0,y.color.toArray(h,b*3),a.current.instanceColor.needsUpdate=!0}p++}});const f=T.useMemo(()=>({getParent:()=>a,subscribe:b=>(c(y=>[...y,b]),()=>c(y=>y.filter(v=>v.current!==b.current)))}),[]);return T.createElement("instancedMesh",Ls({userData:{instances:l},matrixAutoUpdate:!1,ref:lw([r,a]),args:[null,null,0],raycast:()=>null},s),T.createElement("instancedBufferAttribute",{attach:"instanceMatrix",count:C.length/16,array:C,itemSize:16,usage:Hb}),T.createElement("instancedBufferAttribute",{attach:"instanceColor",count:h.length/3,array:h,itemSize:3,usage:Hb}),typeof i=="function"?T.createElement(o.Provider,{value:f},i(g)):T.createElement(oY.Provider,{value:f},i))}),MQ=T.createContext(null);function KQ({iterations:i=10,ms:e=250,threshold:t=.75,step:n=.1,factor:s=.5,flipflops:r=1/0,bounds:o=h=>h>100?[60,100]:[40,60],onIncline:g,onDecline:a,onChange:l,onFallback:c,children:C}){const h=Math.pow(10,0),[p,m]=T.useState(()=>({fps:0,index:0,factor:s,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:b=>{const y=Symbol();return p.subscriptions.set(y,b.current),()=>void p.subscriptions.delete(y)}}));let f=0;return Aa(()=>{const{frames:b,averages:y}=p;if(!p.fallback&&y.length<i){b.push(performance.now());const v=b[b.length-1]-b[0];if(v>=e){if(p.fps=Math.round(b.length/v*1e3*h)/h,p.refreshrate=Math.max(p.refreshrate,p.fps),y[p.index++%i]=p.fps,y.length===i){const[G,w]=o(p.refreshrate),W=y.filter(X=>X>=w),V=y.filter(X=>X<G);W.length>i*t&&(p.factor=Math.min(1,p.factor+n),p.flipped++,g&&g(p),p.subscriptions.forEach(X=>X.onIncline&&X.onIncline(p))),V.length>i*t&&(p.factor=Math.max(0,p.factor-n),p.flipped++,a&&a(p),p.subscriptions.forEach(X=>X.onDecline&&X.onDecline(p))),f!==p.factor&&(f=p.factor,l&&l(p),p.subscriptions.forEach(X=>X.onChange&&X.onChange(p))),p.flipped>r&&!p.fallback&&(p.fallback=!0,c&&c(p),p.subscriptions.forEach(X=>X.onFallback&&X.onFallback(p))),p.averages=[]}p.frames=[]}}}),T.createElement(MQ.Provider,{value:p},C)}function LQ(){const{scene:i}=VG("static/circuit.glb");return i.traverse(e=>{e.isMesh&&(e.material=new jo({color:"#fff",roughness:1,metalness:0,emissive:"#fff",emissiveIntensity:1}),e.castShadow=!0,e.receiveShadow=!0),e.name==="Terrain"&&(e.material=new jo({color:"#f9f9f9",roughness:1,metalness:0})),e.name==="Plane"&&(e.material=new jo({color:"#f0f0f0",roughness:1,metalness:0}))}),D(Sr,{children:D(n1,{object:i,position:[0,0,0]})})}class zQ extends Zs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new DQ(t)}),this.register(function(t){return new qQ(t)}),this.register(function(t){return new $Q(t)}),this.register(function(t){return new UQ(t)}),this.register(function(t){return new PQ(t)}),this.register(function(t){return new OQ(t)}),this.register(function(t){return new QQ(t)}),this.register(function(t){return new EQ(t)}),this.register(function(t){return new jQ(t)}),this.register(function(t){return new JQ(t)}),this.register(function(t){return new kQ(t)}),this.register(function(t){return new e6(t)}),this.register(function(t){return new t6(t)})}load(e,t,n,s){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=bs.extractUrlBase(e),this.manager.itemStart(e);const g=function(l){s?s(l):console.error(l),r.manager.itemError(e),r.manager.itemEnd(e)},a=new ys(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{r.parse(l,o,function(c){t(c),r.manager.itemEnd(e)},g)}catch(c){g(c)}},n,g)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const o={},g={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(bs.decodeText(new Uint8Array(e,0,4))===gY){try{o[fn.KHR_BINARY_GLTF]=new n6(e)}catch(c){s&&s(c);return}r=JSON.parse(o[fn.KHR_BINARY_GLTF].content)}else r=JSON.parse(bs.decodeText(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const a=new h6(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});a.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const c=this.pluginCallbacks[l](a);g[c.name]=c,o[c.name]=!0}if(r.extensionsUsed)for(let l=0;l<r.extensionsUsed.length;++l){const c=r.extensionsUsed[l],C=r.extensionsRequired||[];switch(c){case fn.KHR_MATERIALS_UNLIT:o[c]=new TQ;break;case fn.KHR_DRACO_MESH_COMPRESSION:o[c]=new i6(r,this.dracoLoader);break;case fn.KHR_TEXTURE_TRANSFORM:o[c]=new s6;break;case fn.KHR_MESH_QUANTIZATION:o[c]=new r6;break;default:C.indexOf(c)>=0&&g[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}a.setExtensions(o),a.setPlugins(g),a.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}function _Q(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const fn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class kQ{constructor(e){this.parser=e,this.name=fn.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,a=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let l;const c=new et(16777215);a.color!==void 0&&c.fromArray(a.color);const C=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new ZG(c),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new vG(c),l.distance=C;break;case"spot":l=new BG(c),l.distance=C,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,ac(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],g=(r.extensions&&r.extensions[this.name]||{}).light;return g===void 0?null:this._loadLight(g).then(function(a){return n._getNodeRef(t.cache,g,a)})}}class TQ{constructor(){this.name=fn.KHR_MATERIALS_UNLIT}getMaterialType(){return Oi}extendParams(e,t,n){const s=[];e.color=new et(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,bn))}return Promise.all(s)}}class EQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class DQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const g=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Fe(g,g)}return Promise.all(r)}}class JQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class UQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new et(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,bn)),o.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class PQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class OQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const g=o.attenuationColor||[1,1,1];return t.attenuationColor=new et(g[0],g[1],g[2]),Promise.all(r)}}class QQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class jQ{constructor(e){this.parser=e,this.name=fn.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:vs}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const g=o.specularColorFactor||[1,1,1];return t.specularColor=new et(g[0],g[1],g[2]),o.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,bn)),Promise.all(r)}}class qQ{constructor(e){this.parser=e,this.name=fn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}class $Q{constructor(e){this.parser=e,this.name=fn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],g=s.images[o.source];let a=n.textureLoader;if(g.uri){const l=n.options.manager.getHandler(g.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,o.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class e6{constructor(e){this.name=fn.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(g){const a=s.byteOffset||0,l=s.byteLength||0,c=s.count,C=s.byteStride,h=new Uint8Array(g,a,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(c,C,h,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(c*C);return o.decodeGltfBuffer(new Uint8Array(p),c,C,h,s.mode,s.filter),p})})}else return null}}class t6{constructor(e){this.name=fn.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const l of s.primitives)if(l.mode!==Lo.TRIANGLES&&l.mode!==Lo.TRIANGLE_STRIP&&l.mode!==Lo.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=n.extensions[this.name].attributes,g=[],a={};for(const l in o)g.push(this.parser.getDependency("accessor",o[l]).then(c=>(a[l]=c,a[l])));return g.length<1?null:(g.push(this.parser.createNodeMesh(e)),Promise.all(g).then(l=>{const c=l.pop(),C=c.isGroup?c.children:[c],h=l[0].count,p=[];for(const m of C){const f=new mt,b=new E,y=new jn,v=new E(1,1,1),G=new wc(m.geometry,m.material,h);for(let w=0;w<h;w++)a.TRANSLATION&&b.fromBufferAttribute(a.TRANSLATION,w),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,w),a.SCALE&&v.fromBufferAttribute(a.SCALE,w),G.setMatrixAt(w,f.compose(b,y,v));for(const w in a)w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&m.geometry.setAttribute(w,a[w]);en.prototype.copy.call(G,m),G.frustumCulled=!1,this.parser.assignFinalMaterial(G),p.push(G)}return c.isGroup?(c.clear(),c.add(...p),c):p[0]}))}}const gY="glTF",BA=12,F3={JSON:1313821514,BIN:5130562};class n6{constructor(e){this.name=fn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,BA);if(this.header={magic:bs.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gY)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-BA,s=new DataView(e,BA);let r=0;for(;r<n;){const o=s.getUint32(r,!0);r+=4;const g=s.getUint32(r,!0);if(r+=4,g===F3.JSON){const a=new Uint8Array(e,BA+r,o);this.content=bs.decodeText(a)}else if(g===F3.BIN){const a=BA+r;this.body=e.slice(a,a+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class i6{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=fn.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,g={},a={},l={};for(const c in o){const C=i1[c]||c.toLowerCase();g[C]=o[c]}for(const c in e.attributes){const C=i1[c]||c.toLowerCase();if(o[c]!==void 0){const h=n.accessors[e.attributes[c]],p=Gd[h.componentType];l[C]=p.name,a[C]=h.normalized===!0}}return t.getDependency("bufferView",r).then(function(c){return new Promise(function(C){s.decodeDracoFile(c,function(h){for(const p in h.attributes){const m=h.attributes[p],f=a[p];f!==void 0&&(m.normalized=f)}C(h)},g,l)})})}}class s6{constructor(){this.name=fn.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class r6{constructor(){this.name=fn.KHR_MESH_QUANTIZATION}}class aY extends xu{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,g=this.valueSize,a=g*2,l=g*3,c=s-t,C=(n-t)/c,h=C*C,p=h*C,m=e*l,f=m-l,b=-2*p+3*h,y=p-h,v=1-b,G=y-h+C;for(let w=0;w!==g;w++){const W=o[f+w+g],V=o[f+w+a]*c,X=o[m+w+g],R=o[m+w]*c;r[w]=v*W+G*V+b*X+y*R}return r}}const o6=new jn;class g6 extends aY{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return o6.fromArray(r).normalize().toArray(r),r}}const Lo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Gd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},N3={9728:oi,9729:Zn,9984:Vd,9985:kp,9986:ru,9987:eg},M3={33071:cs,33648:mu,10497:Hg},jB={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},i1={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},nc={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},a6={CUBICSPLINE:void 0,LINEAR:gl,STEP:Gu},qB={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function l6(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new jo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ua})),i.DefaultMaterial}function vA(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function ac(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function c6(i,e,t){let n=!1,s=!1,r=!1;for(let l=0,c=e.length;l<c;l++){const C=e[l];if(C.POSITION!==void 0&&(n=!0),C.NORMAL!==void 0&&(s=!0),C.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(i);const o=[],g=[],a=[];for(let l=0,c=e.length;l<c;l++){const C=e[l];if(n){const h=C.POSITION!==void 0?t.getDependency("accessor",C.POSITION):i.attributes.position;o.push(h)}if(s){const h=C.NORMAL!==void 0?t.getDependency("accessor",C.NORMAL):i.attributes.normal;g.push(h)}if(r){const h=C.COLOR_0!==void 0?t.getDependency("accessor",C.COLOR_0):i.attributes.color;a.push(h)}}return Promise.all([Promise.all(o),Promise.all(g),Promise.all(a)]).then(function(l){const c=l[0],C=l[1],h=l[2];return n&&(i.morphAttributes.position=c),s&&(i.morphAttributes.normal=C),r&&(i.morphAttributes.color=h),i.morphTargetsRelative=!0,i})}function I6(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function u6(i){const e=i.extensions&&i.extensions[fn.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+K3(e.attributes):t=i.indices+":"+K3(i.attributes)+":"+i.mode,t}function K3(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}function s1(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function C6(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const d6=new mt;class h6{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new _Q,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,s=!1,r=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||s&&r<98?this.textureLoader=new VZ(this.options.manager):this.textureLoader=new XZ(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ys(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const g={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:n,userData:{}};vA(r,g,s),ac(g,s),Promise.all(n._invokeAll(function(a){return a.afterRoot&&a.afterRoot(g)})).then(function(){e(g)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let g=0,a=o.length;g<a;g++)e[o[g]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=(o,g)=>{const a=this.associations.get(o);a!=null&&this.associations.set(g,a);for(const[l,c]of o.children.entries())r(c,g.children[l])};return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(t)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[fn.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){n.load(bs.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const o=jB[s.type],g=Gd[s.componentType],a=s.normalized===!0,l=new g(s.count*o);return Promise.resolve(new on(l,o,a))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const g=o[0],a=jB[s.type],l=Gd[s.componentType],c=l.BYTES_PER_ELEMENT,C=c*a,h=s.byteOffset||0,p=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let f,b;if(p&&p!==C){const y=Math.floor(h/p),v="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let G=t.cache.get(v);G||(f=new l(g,y*p,s.count*p/c),G=new Qd(f,p/c),t.cache.add(v,G)),b=new ll(G,a,h%p/c,m)}else g===null?f=new l(s.count*a):f=new l(g,h,s.count*a),b=new on(f,a,m);if(s.sparse!==void 0){const y=jB.SCALAR,v=Gd[s.sparse.indices.componentType],G=s.sparse.indices.byteOffset||0,w=s.sparse.values.byteOffset||0,W=new v(o[1],G,s.sparse.count*y),V=new l(o[2],w,s.sparse.count*a);g!==null&&(b=new on(b.array.slice(),b.itemSize,b.normalized));for(let X=0,R=W.length;X<R;X++){const Y=W[X];if(b.setX(Y,V[X*a]),a>=2&&b.setY(Y,V[X*a+1]),a>=3&&b.setZ(Y,V[X*a+2]),a>=4&&b.setW(Y,V[X*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let g=this.textureLoader;if(o.uri){const a=n.manager.getHandler(o.uri);a!==null&&(g=a)}return this.loadTextureImage(e,r,g)}loadTextureImage(e,t,n){const s=this,r=this.json,o=r.textures[e],g=r.images[t],a=(g.uri||g.bufferView)+":"+o.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(c){c.flipY=!1,c.name=o.name||g.name||"";const h=(r.samplers||{})[o.sampler]||{};return c.magFilter=N3[h.magFilter]||Zn,c.minFilter=N3[h.minFilter]||eg,c.wrapS=M3[h.wrapS]||Hg,c.wrapT=M3[h.wrapT]||Hg,s.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(C=>C.clone());const o=s.images[e],g=self.URL||self.webkitURL;let a=o.uri||"",l=!1;if(o.bufferView!==void 0)a=n.getDependency("bufferView",o.bufferView).then(function(C){l=!0;const h=new Blob([C],{type:o.mimeType});return a=g.createObjectURL(h),a});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(a).then(function(C){return new Promise(function(h,p){let m=h;t.isImageBitmapLoader===!0&&(m=function(f){const b=new kn(f);b.needsUpdate=!0,h(b)}),t.load(bs.resolveURL(C,r.path),m,void 0,p)})}).then(function(C){return l===!0&&g.revokeObjectURL(a),C.userData.mimeType=o.mimeType||C6(o.uri),C}).catch(function(C){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),C});return this.sourceCache[e]=c,c}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[fn.KHR_TEXTURE_TRANSFORM]){const g=n.extensions!==void 0?n.extensions[fn.KHR_TEXTURE_TRANSFORM]:void 0;if(g){const a=r.associations.get(o);o=r.extensions[fn.KHR_TEXTURE_TRANSFORM].extendTexture(o,g),r.associations.set(o,a)}}return s!==void 0&&(o.encoding=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const g="PointsMaterial:"+n.uuid;let a=this.cache.get(g);a||(a=new Pp,qn.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,a.sizeAttenuation=!1,this.cache.add(g,a)),n=a}else if(e.isLine){const g="LineBasicMaterial:"+n.uuid;let a=this.cache.get(g);a||(a=new Bs,qn.prototype.copy.call(a,n),a.color.copy(n.color),this.cache.add(g,a)),n=a}if(s||r||o){let g="ClonedMaterial:"+n.uuid+":";s&&(g+="derivative-tangents:"),r&&(g+="vertex-colors:"),o&&(g+="flat-shading:");let a=this.cache.get(g);a||(a=n.clone(),r&&(a.vertexColors=!0),o&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(g,a),this.associations.set(a,this.associations.get(n))),n=a}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return jo}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let o;const g={},a=r.extensions||{},l=[];if(a[fn.KHR_MATERIALS_UNLIT]){const C=s[fn.KHR_MATERIALS_UNLIT];o=C.getMaterialType(),l.push(C.extendParams(g,r,t))}else{const C=r.pbrMetallicRoughness||{};if(g.color=new et(1,1,1),g.opacity=1,Array.isArray(C.baseColorFactor)){const h=C.baseColorFactor;g.color.fromArray(h),g.opacity=h[3]}C.baseColorTexture!==void 0&&l.push(t.assignTexture(g,"map",C.baseColorTexture,bn)),g.metalness=C.metallicFactor!==void 0?C.metallicFactor:1,g.roughness=C.roughnessFactor!==void 0?C.roughnessFactor:1,C.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(g,"metalnessMap",C.metallicRoughnessTexture)),l.push(t.assignTexture(g,"roughnessMap",C.metallicRoughnessTexture))),o=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,g)})))}r.doubleSided===!0&&(g.side=Lc);const c=r.alphaMode||qB.OPAQUE;if(c===qB.BLEND?(g.transparent=!0,g.depthWrite=!1):(g.transparent=!1,c===qB.MASK&&(g.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Oi&&(l.push(t.assignTexture(g,"normalMap",r.normalTexture)),g.normalScale=new Fe(1,1),r.normalTexture.scale!==void 0)){const C=r.normalTexture.scale;g.normalScale.set(C,C)}return r.occlusionTexture!==void 0&&o!==Oi&&(l.push(t.assignTexture(g,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(g.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Oi&&(g.emissive=new et().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==Oi&&l.push(t.assignTexture(g,"emissiveMap",r.emissiveTexture,bn)),Promise.all(l).then(function(){const C=new o(g);return r.name&&(C.name=r.name),ac(C,r),t.associations.set(C,{materials:e}),r.extensions&&vA(s,C,r),C})}createUniqueName(e){const t=un.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(g){return n[fn.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(g,t).then(function(a){return L3(a,g,t)})}const o=[];for(let g=0,a=e.length;g<a;g++){const l=e[g],c=u6(l),C=s[c];if(C)o.push(C.promise);else{let h;l.extensions&&l.extensions[fn.KHR_DRACO_MESH_COMPRESSION]?h=r(l):h=L3(new zt,l,t),s[c]={primitive:l,promise:h},o.push(h)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],o=r.primitives,g=[];for(let a=0,l=o.length;a<l;a++){const c=o[a].material===void 0?l6(this.cache):this.getDependency("material",o[a].material);g.push(c)}return g.push(t.loadGeometries(o)),Promise.all(g).then(function(a){const l=a.slice(0,a.length-1),c=a[a.length-1],C=[];for(let p=0,m=c.length;p<m;p++){const f=c[p],b=o[p];let y;const v=l[p];if(b.mode===Lo.TRIANGLES||b.mode===Lo.TRIANGLE_STRIP||b.mode===Lo.TRIANGLE_FAN||b.mode===void 0)y=r.isSkinnedMesh===!0?new pG(f,v):new mi(f,v),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),b.mode===Lo.TRIANGLE_STRIP?y.geometry=z3(y.geometry,IG):b.mode===Lo.TRIANGLE_FAN&&(y.geometry=z3(y.geometry,Hd));else if(b.mode===Lo.LINES)y=new ng(f,v);else if(b.mode===Lo.LINE_STRIP)y=new Ca(f,v);else if(b.mode===Lo.LINE_LOOP)y=new fG(f,v);else if(b.mode===Lo.POINTS)y=new mG(f,v);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(y.geometry.morphAttributes).length>0&&I6(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),ac(y,r),b.extensions&&vA(s,y,b),t.assignFinalMaterial(y),C.push(y)}for(let p=0,m=C.length;p<m;p++)t.associations.set(C[p],{meshes:e,primitives:p});if(C.length===1)return C[0];const h=new oo;t.associations.set(h,{meshes:e});for(let p=0,m=C.length;p<m;p++)h.add(C[p]);return h})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Dn(lZ.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new co(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),ac(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let s=0,r=t.joints.length;s<r;s++)n.push(this.getDependency("node",t.joints[s]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(s){const r=s.pop(),o=s,g=[],a=[];for(let l=0,c=o.length;l<c;l++){const C=o[l];if(C){g.push(C);const h=new mt;r!==null&&h.fromArray(r.array,l*16),a.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new jd(g,a)})}loadAnimation(e){const n=this.json.animations[e],s=[],r=[],o=[],g=[],a=[];for(let l=0,c=n.channels.length;l<c;l++){const C=n.channels[l],h=n.samplers[C.sampler],p=C.target,m=p.node,f=n.parameters!==void 0?n.parameters[h.input]:h.input,b=n.parameters!==void 0?n.parameters[h.output]:h.output;s.push(this.getDependency("node",m)),r.push(this.getDependency("accessor",f)),o.push(this.getDependency("accessor",b)),g.push(h),a.push(p)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(o),Promise.all(g),Promise.all(a)]).then(function(l){const c=l[0],C=l[1],h=l[2],p=l[3],m=l[4],f=[];for(let y=0,v=c.length;y<v;y++){const G=c[y],w=C[y],W=h[y],V=p[y],X=m[y];if(G===void 0)continue;G.updateMatrix();let R;switch(nc[X.path]){case nc.weights:R=Bu;break;case nc.rotation:R=Yg;break;case nc.position:case nc.scale:default:R=Hc;break}const Y=G.name?G.name:G.uuid,M=V.interpolation!==void 0?a6[V.interpolation]:gl,L=[];nc[X.path]===nc.weights?G.traverse(function(j){j.morphTargetInfluences&&L.push(j.name?j.name:j.uuid)}):L.push(Y);let re=W.array;if(W.normalized){const j=s1(re.constructor),$=new Float32Array(re.length);for(let ie=0,he=re.length;ie<he;ie++)$[ie]=re[ie]*j;re=$}for(let j=0,$=L.length;j<$;j++){const ie=new R(L[j]+"."+nc[X.path],w.array,re,M);V.interpolation==="CUBICSPLINE"&&(ie.createInterpolant=function(le){const _=this instanceof Yg?g6:aY;return new _(this.times,this.values,this.getValueSize()/3,le)},ie.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),f.push(ie)}}const b=n.name?n.name:"animation_"+e;return new Xc(b,void 0,f)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const o=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(g){if(g.isMesh)for(let a=0,l=s.weights.length;a<l;a++)g.morphTargetInfluences[a]=s.weights[a]}),o})}loadNode(e){const t=this.json,n=this.extensions,s=this,r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"";return function(){const g=[],a=s._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});a&&g.push(a),r.camera!==void 0&&g.push(s.getDependency("camera",r.camera).then(function(h){return s._getNodeRef(s.cameraCache,r.camera,h)})),s._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){g.push(h)});const l=[],c=r.children||[];for(let h=0,p=c.length;h<p;h++)l.push(s.getDependency("node",c[h]));const C=r.skin===void 0?Promise.resolve(null):s.getDependency("skin",r.skin);return Promise.all([Promise.all(g),Promise.all(l),C])}().then(function(g){const a=g[0],l=g[1],c=g[2];let C;if(r.isBone===!0?C=new Up:a.length>1?C=new oo:a.length===1?C=a[0]:C=new en,C!==a[0])for(let h=0,p=a.length;h<p;h++)C.add(a[h]);if(r.name&&(C.userData.name=r.name,C.name=o),ac(C,r),r.extensions&&vA(n,C,r),r.matrix!==void 0){const h=new mt;h.fromArray(r.matrix),C.applyMatrix4(h)}else r.translation!==void 0&&C.position.fromArray(r.translation),r.rotation!==void 0&&C.quaternion.fromArray(r.rotation),r.scale!==void 0&&C.scale.fromArray(r.scale);s.associations.has(C)||s.associations.set(C,{}),s.associations.get(C).nodes=e,c!==null&&C.traverse(function(h){h.isSkinnedMesh&&h.bind(c,d6)});for(let h=0,p=l.length;h<p;h++)C.add(l[h]);return C})}loadScene(e){const t=this.extensions,n=this.json.scenes[e],s=this,r=new oo;n.name&&(r.name=s.createUniqueName(n.name)),ac(r,n),n.extensions&&vA(t,r,n);const o=n.nodes||[],g=[];for(let a=0,l=o.length;a<l;a++)g.push(s.getDependency("node",o[a]));return Promise.all(g).then(function(a){for(let c=0,C=a.length;c<C;c++)r.add(a[c]);const l=c=>{const C=new Map;for(const[h,p]of s.associations)(h instanceof qn||h instanceof kn)&&C.set(h,p);return c.traverse(h=>{const p=s.associations.get(h);p!=null&&C.set(h,p)}),C};return s.associations=l(r),r})}}function A6(i,e,t){const n=e.attributes,s=new Cl;if(n.POSITION!==void 0){const g=t.json.accessors[n.POSITION],a=g.min,l=g.max;if(a!==void 0&&l!==void 0){if(s.set(new E(a[0],a[1],a[2]),new E(l[0],l[1],l[2])),g.normalized){const c=s1(Gd[g.componentType]);s.min.multiplyScalar(c),s.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const g=new E,a=new E;for(let l=0,c=r.length;l<c;l++){const C=r[l];if(C.POSITION!==void 0){const h=t.json.accessors[C.POSITION],p=h.min,m=h.max;if(p!==void 0&&m!==void 0){if(a.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),a.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),a.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),h.normalized){const f=s1(Gd[h.componentType]);a.multiplyScalar(f)}g.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(g)}i.boundingBox=s;const o=new dl;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=o}function L3(i,e,t){const n=e.attributes,s=[];function r(o,g){return t.getDependency("accessor",o).then(function(a){i.setAttribute(g,a)})}for(const o in n){const g=i1[o]||o.toLowerCase();g in i.attributes||s.push(r(n[o],g))}if(e.indices!==void 0&&!i.index){const o=t.getDependency("accessor",e.indices).then(function(g){i.setIndex(g)});s.push(o)}return ac(i,e),A6(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?c6(i,e.targets,t):i})}function z3(i,e){let t=i.getIndex();if(t===null){const o=[],g=i.getAttribute("position");if(g!==void 0){for(let a=0;a<g.count;a++)o.push(a);i.setIndex(o),t=i.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(e===Hd)for(let o=1;o<=n;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=i.clone();return r.setIndex(s),r}const $B=new WeakMap;class p6 extends Zs{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const r=new ys(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,o=>{this.decodeDracoFile(o,t).catch(s)},n,s)}decodeDracoFile(e,t,n,s){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){const n=JSON.stringify(t);if($B.has(e)){const a=$B.get(e);if(a.key===n)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=e.byteLength,g=this._getWorker(r,o).then(a=>(s=a,new Promise((l,c)=>{s._callbacks[r]={resolve:l,reject:c},s.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return g.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),$B.set(e,{key:n,promise:g}),g}_createGeometry(e){const t=new zt;e.index&&t.setIndex(new on(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],r=s.name,o=s.array,g=s.itemSize;t.setAttribute(r,new on(o,g))}return t}_loadLibrary(e,t){const n=new ys(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,r)=>{n.load(e,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const r=f6.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function f6(){let i,e;onmessage=function(o){const g=o.data;switch(g.type){case"init":i=g.decoderConfig,e=new Promise(function(c){i.onModuleLoaded=function(C){c({draco:C})},DracoDecoderModule(i)});break;case"decode":const a=g.buffer,l=g.taskConfig;e.then(c=>{const C=c.draco,h=new C.Decoder,p=new C.DecoderBuffer;p.Init(new Int8Array(a),a.byteLength);try{const m=t(C,h,p,l),f=m.attributes.map(b=>b.array.buffer);m.index&&f.push(m.index.array.buffer),self.postMessage({type:"decode",id:g.id,geometry:m},f)}catch(m){console.error(m),self.postMessage({type:"error",id:g.id,error:m.message})}finally{C.destroy(p),C.destroy(h)}});break}};function t(o,g,a,l){const c=l.attributeIDs,C=l.attributeTypes;let h,p;const m=g.GetEncodedGeometryType(a);if(m===o.TRIANGULAR_MESH)h=new o.Mesh,p=g.DecodeBufferToMesh(a,h);else if(m===o.POINT_CLOUD)h=new o.PointCloud,p=g.DecodeBufferToPointCloud(a,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const f={index:null,attributes:[]};for(const b in c){const y=self[C[b]];let v,G;if(l.useUniqueIDs)G=c[b],v=g.GetAttributeByUniqueId(h,G);else{if(G=g.GetAttributeId(h,o[c[b]]),G===-1)continue;v=g.GetAttribute(h,G)}f.attributes.push(s(o,g,h,b,y,v))}return m===o.TRIANGULAR_MESH&&(f.index=n(o,g,h)),o.destroy(h),f}function n(o,g,a){const c=a.num_faces()*3,C=c*4,h=o._malloc(C);g.GetTrianglesUInt32Array(a,C,h);const p=new Uint32Array(o.HEAPF32.buffer,h,c).slice();return o._free(h),{array:p,itemSize:1}}function s(o,g,a,l,c,C){const h=C.num_components(),m=a.num_points()*h,f=m*c.BYTES_PER_ELEMENT,b=r(o,c),y=o._malloc(f);g.GetAttributeDataArrayForAllPoints(a,C,b,f,y);const v=new c(o.HEAPF32.buffer,y,m).slice();return o._free(y),{name:l,array:v,itemSize:h}}function r(o,g){switch(g){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}var Eb={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Eb.exports;(function(i,e){(function(){var t,n="4.17.21",s=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",g="Invalid `variable` option passed into `_.template`",a="__lodash_hash_undefined__",l=500,c="__lodash_placeholder__",C=1,h=2,p=4,m=1,f=2,b=1,y=2,v=4,G=8,w=16,W=32,V=64,X=128,R=256,Y=512,M=30,L="...",re=800,j=16,$=1,ie=2,he=3,le=1/0,_=9007199254740991,ne=17976931348623157e292,te=0/0,q=4294967295,se=q-1,ue=q>>>1,Ae=[["ary",X],["bind",b],["bindKey",y],["curry",G],["curryRight",w],["flip",Y],["partial",W],["partialRight",V],["rearg",R]],We="[object Arguments]",me="[object Array]",tt="[object AsyncFunction]",Oe="[object Boolean]",It="[object Date]",ke="[object DOMException]",je="[object Error]",ve="[object Function]",be="[object GeneratorFunction]",Ve="[object Map]",qe="[object Number]",Xe="[object Null]",Pe="[object Object]",ct="[object Promise]",gt="[object Proxy]",Yt="[object RegExp]",Zt="[object Set]",O="[object String]",z="[object Symbol]",ye="[object Undefined]",Le="[object WeakMap]",Te="[object WeakSet]",De="[object ArrayBuffer]",vt="[object DataView]",nt="[object Float32Array]",Ye="[object Float64Array]",dt="[object Int8Array]",oe="[object Int16Array]",we="[object Int32Array]",Ee="[object Uint8Array]",Qe="[object Uint8ClampedArray]",wt="[object Uint16Array]",Ot="[object Uint32Array]",Vn=/\b__p \+= '';/g,Ie=/\b(__p \+=) '' \+/g,Se=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ze=/&(?:amp|lt|gt|quot|#39);/g,at=/[&<>"']/g,bt=RegExp(ze.source),cn=RegExp(at.source),$n=/<%-([\s\S]+?)%>/g,Hi=/<%([\s\S]+?)%>/g,Nr=/<%=([\s\S]+?)%>/g,Bn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,lr=/^\w*$/,ws=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,pl=/[\\^$.*+?()[\]{}|]/g,nh=RegExp(pl.source),fl=/^\s+/,Tc=/\s/,J=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ge=/\{\n\/\* \[wrapped with (.+)\] \*/,He=/,? & /,pe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ne=/[()=,{}\[\]\/\s]/,St=/\\(\\)?/g,Nt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_t=/\w*$/,Qt=/^[-+]0x[0-9a-f]+$/i,sn=/^0b[01]+$/i,tn=/^\[object .+?Constructor\]$/,nn=/^0o[0-7]+$/i,Un=/^(?:0|[1-9]\d*)$/,Cs=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ss=/($^)/,rg=/['\n\r\u2028\u2029\\]/g,vn="\\ud800-\\udfff",Dt="\\u0300-\\u036f",pa="\\ufe20-\\ufe2f",Pn="\\u20d0-\\u20ff",fo=Dt+pa+Pn,fa="\\u2700-\\u27bf",Es="a-z\\xdf-\\xf6\\xf8-\\xff",cr="\\xac\\xb1\\xd7\\xf7",kt="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",gn="\\u2000-\\u206f",Ir=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",An="A-Z\\xc0-\\xd6\\xd8-\\xde",Gi="\\ufe0e\\ufe0f",mo=cr+kt+gn+Ir,Mr="['’]",Rs="["+vn+"]",Ec="["+mo+"]",Dc="["+fo+"]",ih="\\d+",Nu="["+fa+"]",sh="["+Es+"]",ur="[^"+vn+mo+ih+fa+Es+An+"]",rh="\\ud83c[\\udffb-\\udfff]",XG="(?:"+Dc+"|"+rh+")",Cf="[^"+vn+"]",ml="(?:\\ud83c[\\udde6-\\uddff]){2}",bl="[\\ud800-\\udbff][\\udc00-\\udfff]",bo="["+An+"]",Jc="\\u200d",df="(?:"+sh+"|"+ur+")",YG="(?:"+bo+"|"+ur+")",Mu="(?:"+Mr+"(?:d|ll|m|re|s|t|ve))?",Ku="(?:"+Mr+"(?:D|LL|M|RE|S|T|VE))?",Gl=XG+"?",hf="["+Gi+"]?",oh="(?:"+Jc+"(?:"+[Cf,ml,bl].join("|")+")"+hf+Gl+")*",hn="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Af="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lu=hf+Gl+oh,pf="(?:"+[Nu,ml,bl].join("|")+")"+Lu,FG="(?:"+[Cf+Dc+"?",Dc,ml,bl,Rs].join("|")+")",NG=RegExp(Mr,"g"),Xi=RegExp(Dc,"g"),Uc=RegExp(rh+"(?="+rh+")|"+FG+Lu,"g"),MG=RegExp([bo+"?"+sh+"+"+Mu+"(?="+[Ec,bo,"$"].join("|")+")",YG+"+"+Ku+"(?="+[Ec,bo+df,"$"].join("|")+")",bo+"?"+df+"+"+Mu,bo+"+"+Ku,Af,hn,ih,pf].join("|"),"g"),gh=RegExp("["+Jc+vn+fo+Gi+"]"),KG=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,zu=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Go=-1,Hn={};Hn[nt]=Hn[Ye]=Hn[dt]=Hn[oe]=Hn[we]=Hn[Ee]=Hn[Qe]=Hn[wt]=Hn[Ot]=!0,Hn[We]=Hn[me]=Hn[De]=Hn[Oe]=Hn[vt]=Hn[It]=Hn[je]=Hn[ve]=Hn[Ve]=Hn[qe]=Hn[Pe]=Hn[Yt]=Hn[Zt]=Hn[O]=Hn[Le]=!1;var Rn={};Rn[We]=Rn[me]=Rn[De]=Rn[vt]=Rn[Oe]=Rn[It]=Rn[nt]=Rn[Ye]=Rn[dt]=Rn[oe]=Rn[we]=Rn[Ve]=Rn[qe]=Rn[Pe]=Rn[Yt]=Rn[Zt]=Rn[O]=Rn[z]=Rn[Ee]=Rn[Qe]=Rn[wt]=Rn[Ot]=!0,Rn[je]=Rn[ve]=Rn[Le]=!1;var yo={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},og={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_u={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ah={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ff=parseFloat,LG=parseInt,Kr=typeof Da=="object"&&Da&&Da.Object===Object&&Da,zG=typeof self=="object"&&self&&self.Object===Object&&self,Ii=Kr||zG||Function("return this")(),lh=e&&!e.nodeType&&e,zi=lh&&!0&&i&&!i.nodeType&&i,Pc=zi&&zi.exports===lh,yl=Pc&&Kr.process,_i=function(){try{var ae=zi&&zi.require&&zi.require("util").types;return ae||yl&&yl.binding&&yl.binding("util")}catch{}}(),ku=_i&&_i.isArrayBuffer,Tu=_i&&_i.isDate,ch=_i&&_i.isMap,Eu=_i&&_i.isRegExp,Du=_i&&_i.isSet,ma=_i&&_i.isTypedArray;function Ln(ae,xe,Be){switch(Be.length){case 0:return ae.call(xe);case 1:return ae.call(xe,Be[0]);case 2:return ae.call(xe,Be[0],Be[1]);case 3:return ae.call(xe,Be[0],Be[1],Be[2])}return ae.apply(xe,Be)}function Bo(ae,xe,Be,lt){for(var Ft=-1,Lt=ae==null?0:ae.length;++Ft<Lt;){var zn=ae[Ft];xe(lt,zn,Be(zn),ae)}return lt}function yi(ae,xe){for(var Be=-1,lt=ae==null?0:ae.length;++Be<lt&&xe(ae[Be],Be,ae)!==!1;);return ae}function Ih(ae,xe){for(var Be=ae==null?0:ae.length;Be--&&xe(ae[Be],Be,ae)!==!1;);return ae}function uh(ae,xe){for(var Be=-1,lt=ae==null?0:ae.length;++Be<lt;)if(!xe(ae[Be],Be,ae))return!1;return!0}function qi(ae,xe){for(var Be=-1,lt=ae==null?0:ae.length,Ft=0,Lt=[];++Be<lt;){var zn=ae[Be];xe(zn,Be,ae)&&(Lt[Ft++]=zn)}return Lt}function Lr(ae,xe){var Be=ae==null?0:ae.length;return!!Be&&_r(ae,xe,0)>-1}function Bl(ae,xe,Be){for(var lt=-1,Ft=ae==null?0:ae.length;++lt<Ft;)if(Be(xe,ae[lt]))return!0;return!1}function Xn(ae,xe){for(var Be=-1,lt=ae==null?0:ae.length,Ft=Array(lt);++Be<lt;)Ft[Be]=xe(ae[Be],Be,ae);return Ft}function zr(ae,xe){for(var Be=-1,lt=xe.length,Ft=ae.length;++Be<lt;)ae[Ft+Be]=xe[Be];return ae}function Ju(ae,xe,Be,lt){var Ft=-1,Lt=ae==null?0:ae.length;for(lt&&Lt&&(Be=ae[++Ft]);++Ft<Lt;)Be=xe(Be,ae[Ft],Ft,ae);return Be}function mf(ae,xe,Be,lt){var Ft=ae==null?0:ae.length;for(lt&&Ft&&(Be=ae[--Ft]);Ft--;)Be=xe(Be,ae[Ft],Ft,ae);return Be}function Oc(ae,xe){for(var Be=-1,lt=ae==null?0:ae.length;++Be<lt;)if(xe(ae[Be],Be,ae))return!0;return!1}var Uu=Ws("length");function bf(ae){return ae.split("")}function Gf(ae){return ae.match(pe)||[]}function Ch(ae,xe,Be){var lt;return Be(ae,function(Ft,Lt,zn){if(xe(Ft,Lt,zn))return lt=Lt,!1}),lt}function vl(ae,xe,Be,lt){for(var Ft=ae.length,Lt=Be+(lt?1:-1);lt?Lt--:++Lt<Ft;)if(xe(ae[Lt],Lt,ae))return Lt;return-1}function _r(ae,xe,Be){return xe===xe?Wl(ae,xe,Be):vl(ae,Qc,Be)}function Zl(ae,xe,Be,lt){for(var Ft=Be-1,Lt=ae.length;++Ft<Lt;)if(lt(ae[Ft],xe))return Ft;return-1}function Qc(ae){return ae!==ae}function jc(ae,xe){var Be=ae==null?0:ae.length;return Be?kr(ae,xe)/Be:te}function Ws(ae){return function(xe){return xe==null?t:xe[ae]}}function xs(ae){return function(xe){return ae==null?t:ae[xe]}}function Mg(ae,xe,Be,lt,Ft){return Ft(ae,function(Lt,zn,Vt){Be=lt?(lt=!1,Lt):xe(Be,Lt,zn,Vt)}),Be}function gg(ae,xe){var Be=ae.length;for(ae.sort(xe);Be--;)ae[Be]=ae[Be].value;return ae}function kr(ae,xe){for(var Be,lt=-1,Ft=ae.length;++lt<Ft;){var Lt=xe(ae[lt]);Lt!==t&&(Be=Be===t?Lt:Be+Lt)}return Be}function ag(ae,xe){for(var Be=-1,lt=Array(ae);++Be<ae;)lt[Be]=xe(Be);return lt}function yf(ae,xe){return Xn(xe,function(Be){return[Be,ae[Be]]})}function Pu(ae){return ae&&ae.slice(0,xl(ae)+1).replace(fl,"")}function ds(ae){return function(xe){return ae(xe)}}function hs(ae,xe){return Xn(xe,function(Be){return ae[Be]})}function ki(ae,xe){return ae.has(xe)}function Yn(ae,xe){for(var Be=-1,lt=ae.length;++Be<lt&&_r(xe,ae[Be],0)>-1;);return Be}function wl(ae,xe){for(var Be=ae.length;Be--&&_r(xe,ae[Be],0)>-1;);return Be}function Tr(ae,xe){for(var Be=ae.length,lt=0;Be--;)ae[Be]===xe&&++lt;return lt}var Bf=xs(yo),vf=xs(og);function dh(ae){return"\\"+ah[ae]}function hh(ae,xe){return ae==null?t:ae[xe]}function ba(ae){return gh.test(ae)}function qc(ae){return KG.test(ae)}function Sl(ae){for(var xe,Be=[];!(xe=ae.next()).done;)Be.push(xe.value);return Be}function $c(ae){var xe=-1,Be=Array(ae.size);return ae.forEach(function(lt,Ft){Be[++xe]=[Ft,lt]}),Be}function Rl(ae,xe){return function(Be){return ae(xe(Be))}}function Er(ae,xe){for(var Be=-1,lt=ae.length,Ft=0,Lt=[];++Be<lt;){var zn=ae[Be];(zn===xe||zn===c)&&(ae[Be]=c,Lt[Ft++]=Be)}return Lt}function eI(ae){var xe=-1,Be=Array(ae.size);return ae.forEach(function(lt){Be[++xe]=lt}),Be}function Zf(ae){var xe=-1,Be=Array(ae.size);return ae.forEach(function(lt){Be[++xe]=[lt,lt]}),Be}function Wl(ae,xe,Be){for(var lt=Be-1,Ft=ae.length;++lt<Ft;)if(ae[lt]===xe)return lt;return-1}function wf(ae,xe,Be){for(var lt=Be+1;lt--;)if(ae[lt]===xe)return lt;return lt}function vo(ae){return ba(ae)?Zo(ae):Uu(ae)}function On(ae){return ba(ae)?Ah(ae):bf(ae)}function xl(ae){for(var xe=ae.length;xe--&&Tc.test(ae.charAt(xe)););return xe}var Vl=xs(_u);function Zo(ae){for(var xe=Uc.lastIndex=0;Uc.test(ae);)++xe;return xe}function Ah(ae){return ae.match(Uc)||[]}function Hl(ae){return ae.match(MG)||[]}var Sf=function ae(xe){xe=xe==null?Ii:Kg.defaults(Ii.Object(),xe,Kg.pick(Ii,zu));var Be=xe.Array,lt=xe.Date,Ft=xe.Error,Lt=xe.Function,zn=xe.Math,Vt=xe.Object,Yi=xe.RegExp,Fi=xe.String,As=xe.TypeError,Lg=Be.prototype,tI=Lt.prototype,Xl=Vt.prototype,Bi=xe["__core-js_shared__"],Yl=tI.toString,pn=Xl.hasOwnProperty,ph=0,wo=function(){var I=/[^.]+$/.exec(Bi&&Bi.keys&&Bi.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""}(),Ds=Xl.toString,Ga=Yl.call(Vt),Ou=Ii._,Qu=Yi("^"+Yl.call(pn).replace(pl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nI=Pc?xe.Buffer:t,lg=xe.Symbol,iI=xe.Uint8Array,fh=nI?nI.allocUnsafe:t,sI=Rl(Vt.getPrototypeOf,Vt),mh=Vt.create,ju=Xl.propertyIsEnumerable,zg=Lg.splice,bh=lg?lg.isConcatSpreadable:t,_g=lg?lg.iterator:t,So=lg?lg.toStringTag:t,Fl=function(){try{var I=BI(Vt,"defineProperty");return I({},"",{}),I}catch{}}(),rI=xe.clearTimeout!==Ii.clearTimeout&&xe.clearTimeout,Rf=lt&&lt.now!==Ii.Date.now&&lt.now,Wf=xe.setTimeout!==Ii.setTimeout&&xe.setTimeout,oI=zn.ceil,gI=zn.floor,aI=Vt.getOwnPropertySymbols,xf=nI?nI.isBuffer:t,Gh=xe.isFinite,_G=Lg.join,Vf=Rl(Vt.keys,Vt),vi=zn.max,$i=zn.min,Hf=lt.now,Xf=xe.parseInt,yh=zn.random,Yf=Lg.reverse,Nl=BI(xe,"DataView"),lI=BI(xe,"Map"),Bh=BI(xe,"Promise"),Ml=BI(xe,"Set"),ya=BI(xe,"WeakMap"),Ba=BI(Vt,"create"),qu=ya&&new ya,va={},Ff=vI(Nl),Nf=vI(lI),Mf=vI(Bh),Kf=vI(Ml),Ro=vI(ya),cI=lg?lg.prototype:t,cg=cI?cI.valueOf:t,Kl=cI?cI.toString:t;function K(I){if(hi(I)&&!Tt(I)&&!(I instanceof Wt)){if(I instanceof es)return I;if(pn.call(I,"__wrapped__"))return xw(I)}return new es(I)}var Ig=function(){function I(){}return function(A){if(!ii(A))return{};if(mh)return mh(A);I.prototype=A;var Z=new I;return I.prototype=t,Z}}();function II(){}function es(I,A){this.__wrapped__=I,this.__actions__=[],this.__chain__=!!A,this.__index__=0,this.__values__=t}K.templateSettings={escape:$n,evaluate:Hi,interpolate:Nr,variable:"",imports:{_:K}},K.prototype=II.prototype,K.prototype.constructor=K,es.prototype=Ig(II.prototype),es.prototype.constructor=es;function Wt(I){this.__wrapped__=I,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=q,this.__views__=[]}function kG(){var I=new Wt(this.__wrapped__);return I.__actions__=rs(this.__actions__),I.__dir__=this.__dir__,I.__filtered__=this.__filtered__,I.__iteratees__=rs(this.__iteratees__),I.__takeCount__=this.__takeCount__,I.__views__=rs(this.__views__),I}function TG(){if(this.__filtered__){var I=new Wt(this);I.__dir__=-1,I.__filtered__=!0}else I=this.clone(),I.__dir__*=-1;return I}function Js(){var I=this.__wrapped__.value(),A=this.__dir__,Z=Tt(I),H=A<0,N=Z?I.length:0,k=NY(0,N,this.__views__),ee=k.start,ge=k.end,de=ge-ee,Me=H?ge:ee-1,Ke=this.__iteratees__,_e=Ke.length,rt=0,ft=$i(de,this.__takeCount__);if(!Z||!H&&N==de&&ft==de)return Ug(I,this.__actions__);var Ht=[];e:for(;de--&&rt<ft;){Me+=A;for(var qt=-1,Xt=I[Me];++qt<_e;){var rn=Ke[qt],In=rn.iteratee,jr=rn.type,$s=In(Xt);if(jr==ie)Xt=$s;else if(!$s){if(jr==$)continue e;break e}}Ht[rt++]=Xt}return Ht}Wt.prototype=Ig(II.prototype),Wt.prototype.constructor=Wt;function ei(I){var A=-1,Z=I==null?0:I.length;for(this.clear();++A<Z;){var H=I[A];this.set(H[0],H[1])}}function Lf(){this.__data__=Ba?Ba(null):{},this.size=0}function zf(I){var A=this.has(I)&&delete this.__data__[I];return this.size-=A?1:0,A}function _f(I){var A=this.__data__;if(Ba){var Z=A[I];return Z===a?t:Z}return pn.call(A,I)?A[I]:t}function kf(I){var A=this.__data__;return Ba?A[I]!==t:pn.call(A,I)}function Tf(I,A){var Z=this.__data__;return this.size+=this.has(I)?0:1,Z[I]=Ba&&A===t?a:A,this}ei.prototype.clear=Lf,ei.prototype.delete=zf,ei.prototype.get=_f,ei.prototype.has=kf,ei.prototype.set=Tf;function Dr(I){var A=-1,Z=I==null?0:I.length;for(this.clear();++A<Z;){var H=I[A];this.set(H[0],H[1])}}function Ef(){this.__data__=[],this.size=0}function vh(I){var A=this.__data__,Z=Tg(A,I);if(Z<0)return!1;var H=A.length-1;return Z==H?A.pop():zg.call(A,Z,1),--this.size,!0}function Df(I){var A=this.__data__,Z=Tg(A,I);return Z<0?t:A[Z][1]}function Jf(I){return Tg(this.__data__,I)>-1}function $u(I,A){var Z=this.__data__,H=Tg(Z,I);return H<0?(++this.size,Z.push([I,A])):Z[H][1]=A,this}Dr.prototype.clear=Ef,Dr.prototype.delete=vh,Dr.prototype.get=Df,Dr.prototype.has=Jf,Dr.prototype.set=$u;function Cr(I){var A=-1,Z=I==null?0:I.length;for(this.clear();++A<Z;){var H=I[A];this.set(H[0],H[1])}}function Uf(){this.size=0,this.__data__={hash:new ei,map:new(lI||Dr),string:new ei}}function Zh(I){var A=cm(this,I).delete(I);return this.size-=A?1:0,A}function Pf(I){return cm(this,I).get(I)}function Of(I){return cm(this,I).has(I)}function eC(I,A){var Z=cm(this,I),H=Z.size;return Z.set(I,A),this.size+=Z.size==H?0:1,this}Cr.prototype.clear=Uf,Cr.prototype.delete=Zh,Cr.prototype.get=Pf,Cr.prototype.has=Of,Cr.prototype.set=eC;function kg(I){var A=-1,Z=I==null?0:I.length;for(this.__data__=new Cr;++A<Z;)this.add(I[A])}function wh(I){return this.__data__.set(I,a),this}function Qf(I){return this.__data__.has(I)}kg.prototype.add=kg.prototype.push=wh,kg.prototype.has=Qf;function Zi(I){var A=this.__data__=new Dr(I);this.size=A.size}function EG(){this.__data__=new Dr,this.size=0}function DG(I){var A=this.__data__,Z=A.delete(I);return this.size=A.size,Z}function tC(I){return this.__data__.get(I)}function Za(I){return this.__data__.has(I)}function JG(I,A){var Z=this.__data__;if(Z instanceof Dr){var H=Z.__data__;if(!lI||H.length<s-1)return H.push([I,A]),this.size=++Z.size,this;Z=this.__data__=new Cr(H)}return Z.set(I,A),this.size=Z.size,this}Zi.prototype.clear=EG,Zi.prototype.delete=DG,Zi.prototype.get=tC,Zi.prototype.has=Za,Zi.prototype.set=JG;function st(I,A){var Z=Tt(I),H=!Z&&ZI(I),N=!Z&&!H&&Pl(I),k=!Z&&!H&&!N&&fC(I),ee=Z||H||N||k,ge=ee?ag(I.length,Fi):[],de=ge.length;for(var Me in I)(A||pn.call(I,Me))&&!(ee&&(Me=="length"||N&&(Me=="offset"||Me=="parent")||k&&(Me=="buffer"||Me=="byteLength"||Me=="byteOffset")||Va(Me,de)))&&ge.push(Me);return ge}function uI(I){var A=I.length;return A?I[xo(0,A-1)]:t}function Sh(I,A){return Im(rs(I),Eg(A,0,I.length))}function jf(I){return Im(rs(I))}function Rh(I,A,Z){(Z!==t&&!dg(I[A],Z)||Z===t&&!(A in I))&&Wo(I,A,Z)}function Jr(I,A,Z){var H=I[A];(!(pn.call(I,A)&&dg(H,Z))||Z===t&&!(A in I))&&Wo(I,A,Z)}function Tg(I,A){for(var Z=I.length;Z--;)if(dg(I[Z][0],A))return Z;return-1}function Wh(I,A,Z,H){return Ur(I,function(N,k,ee){A(H,N,Z(N),ee)}),H}function xh(I,A){return I&&Ar(A,gs(A),I)}function qf(I,A){return I&&Ar(A,fr(A),I)}function Wo(I,A,Z){A=="__proto__"&&Fl?Fl(I,A,{configurable:!0,enumerable:!0,value:Z,writable:!0}):I[A]=Z}function nC(I,A){for(var Z=-1,H=A.length,N=Be(H),k=I==null;++Z<H;)N[Z]=k?t:cy(I,A[Z]);return N}function Eg(I,A,Z){return I===I&&(Z!==t&&(I=I<=Z?I:Z),A!==t&&(I=I>=A?I:A)),I}function Us(I,A,Z,H,N,k){var ee,ge=A&C,de=A&h,Me=A&p;if(Z&&(ee=N?Z(I,H,N,k):Z(I)),ee!==t)return ee;if(!ii(I))return I;var Ke=Tt(I);if(Ke){if(ee=KY(I),!ge)return rs(I,ee)}else{var _e=Vs(I),rt=_e==ve||_e==be;if(Pl(I))return Eh(I,ge);if(_e==Pe||_e==We||rt&&!N){if(ee=de||rt?{}:Gw(I),!ge)return de?am(I,qf(ee,I)):QG(I,xh(ee,I))}else{if(!Rn[_e])return N?I:{};ee=LY(I,_e,ge)}}k||(k=new Zi);var ft=k.get(I);if(ft)return ft;k.set(I,ee),Qw(I)?I.forEach(function(Xt){ee.add(Us(Xt,A,Z,Xt,I,k))}):Pw(I)&&I.forEach(function(Xt,rn){ee.set(rn,Us(Xt,A,Z,rn,I,k))});var Ht=Me?de?an:di:de?fr:gs,qt=Ke?t:Ht(I);return yi(qt||I,function(Xt,rn){qt&&(rn=Xt,Xt=I[rn]),Jr(ee,rn,Us(Xt,A,Z,rn,I,k))}),ee}function Vh(I){var A=gs(I);return function(Z){return iC(Z,I,A)}}function iC(I,A,Z){var H=Z.length;if(I==null)return!H;for(I=Vt(I);H--;){var N=Z[H],k=A[N],ee=I[N];if(ee===t&&!(N in I)||!k(ee))return!1}return!0}function Hh(I,A,Z){if(typeof I!="function")throw new As(o);return Ph(function(){I.apply(t,Z)},A)}function wa(I,A,Z,H){var N=-1,k=Lr,ee=!0,ge=I.length,de=[],Me=A.length;if(!ge)return de;Z&&(A=Xn(A,ds(Z))),H?(k=Bl,ee=!1):A.length>=s&&(k=ki,ee=!1,A=new kg(A));e:for(;++N<ge;){var Ke=I[N],_e=Z==null?Ke:Z(Ke);if(Ke=H||Ke!==0?Ke:0,ee&&_e===_e){for(var rt=Me;rt--;)if(A[rt]===_e)continue e;de.push(Ke)}else k(A,_e,H)||de.push(Ke)}return de}var Ur=Jh(Ps),$f=Jh(zl,!0);function UG(I,A){var Z=!0;return Ur(I,function(H,N,k){return Z=!!A(H,N,k),Z}),Z}function CI(I,A,Z){for(var H=-1,N=I.length;++H<N;){var k=I[H],ee=A(k);if(ee!=null&&(ge===t?ee===ee&&!Qr(ee):Z(ee,ge)))var ge=ee,de=k}return de}function em(I,A,Z,H){var N=I.length;for(Z=jt(Z),Z<0&&(Z=-Z>N?0:N+Z),H=H===t||H>N?N:jt(H),H<0&&(H+=N),H=Z>H?0:qw(H);Z<H;)I[Z++]=A;return I}function Xh(I,A){var Z=[];return Ur(I,function(H,N,k){A(H,N,k)&&Z.push(H)}),Z}function Ni(I,A,Z,H,N){var k=-1,ee=I.length;for(Z||(Z=_Y),N||(N=[]);++k<ee;){var ge=I[k];A>0&&Z(ge)?A>1?Ni(ge,A-1,Z,H,N):zr(N,ge):H||(N[N.length]=ge)}return N}var Ll=hC(),dI=hC(!0);function Ps(I,A){return I&&Ll(I,A,gs)}function zl(I,A){return I&&dI(I,A,gs)}function Sa(I,A){return qi(A,function(Z){return Ha(I[Z])})}function Pr(I,A){A=Og(A,I);for(var Z=0,H=A.length;I!=null&&Z<H;)I=I[qg(A[Z++])];return Z&&Z==H?I:t}function sC(I,A,Z){var H=A(I);return Tt(I)?H:zr(H,Z(I))}function Ti(I){return I==null?I===t?ye:Xe:So&&So in Vt(I)?FY(I):PY(I)}function hI(I,A){return I>A}function tm(I,A){return I!=null&&pn.call(I,A)}function Yh(I,A){return I!=null&&A in Vt(I)}function PG(I,A,Z){return I>=$i(A,Z)&&I<vi(A,Z)}function _l(I,A,Z){for(var H=Z?Bl:Lr,N=I[0].length,k=I.length,ee=k,ge=Be(k),de=1/0,Me=[];ee--;){var Ke=I[ee];ee&&A&&(Ke=Xn(Ke,ds(A))),de=$i(Ke.length,de),ge[ee]=!Z&&(A||N>=120&&Ke.length>=120)?new kg(ee&&Ke):t}Ke=I[0];var _e=-1,rt=ge[0];e:for(;++_e<N&&Me.length<de;){var ft=Ke[_e],Ht=A?A(ft):ft;if(ft=Z||ft!==0?ft:0,!(rt?ki(rt,Ht):H(Me,Ht,Z))){for(ee=k;--ee;){var qt=ge[ee];if(!(qt?ki(qt,Ht):H(I[ee],Ht,Z)))continue e}rt&&rt.push(Ht),Me.push(ft)}}return Me}function Fh(I,A,Z,H){return Ps(I,function(N,k,ee){A(H,Z(N),k,ee)}),H}function Fn(I,A,Z){A=Og(A,I),I=Zw(I,A);var H=I==null?I:I[qg(Xo(A))];return H==null?t:Ln(H,I,Z)}function Jt(I){return hi(I)&&Ti(I)==We}function ui(I){return hi(I)&&Ti(I)==De}function Ci(I){return hi(I)&&Ti(I)==It}function ti(I,A,Z,H,N){return I===A?!0:I==null||A==null||!hi(I)&&!hi(A)?I!==I&&A!==A:Os(I,A,Z,H,ti,N)}function Os(I,A,Z,H,N,k){var ee=Tt(I),ge=Tt(A),de=ee?me:Vs(I),Me=ge?me:Vs(A);de=de==We?Pe:de,Me=Me==We?Pe:Me;var Ke=de==Pe,_e=Me==Pe,rt=de==Me;if(rt&&Pl(I)){if(!Pl(A))return!1;ee=!0,Ke=!1}if(rt&&!Ke)return k||(k=new Zi),ee||fC(I)?At(I,A,Z,H,N,k):Ut(I,A,de,Z,H,N,k);if(!(Z&m)){var ft=Ke&&pn.call(I,"__wrapped__"),Ht=_e&&pn.call(A,"__wrapped__");if(ft||Ht){var qt=ft?I.value():I,Xt=Ht?A.value():A;return k||(k=new Zi),N(qt,Xt,Z,H,k)}}return rt?(k||(k=new Zi),Kt(I,A,Z,H,N,k)):!1}function kl(I){return hi(I)&&Vs(I)==Ve}function ni(I,A,Z,H){var N=Z.length,k=N,ee=!H;if(I==null)return!k;for(I=Vt(I);N--;){var ge=Z[N];if(ee&&ge[2]?ge[1]!==I[ge[0]]:!(ge[0]in I))return!1}for(;++N<k;){ge=Z[N];var de=ge[0],Me=I[de],Ke=ge[1];if(ee&&ge[2]){if(Me===t&&!(de in I))return!1}else{var _e=new Zi;if(H)var rt=H(Me,Ke,de,I,A,_e);if(!(rt===t?ti(Ke,Me,m|f,H,_e):rt))return!1}}return!0}function Tl(I){if(!ii(I)||TY(I))return!1;var A=Ha(I)?Qu:tn;return A.test(vI(I))}function El(I){return hi(I)&&Ti(I)==Yt}function rC(I){return hi(I)&&Vs(I)==Zt}function Nh(I){return hi(I)&&pm(I.length)&&!!Hn[Ti(I)]}function Dl(I){return typeof I=="function"?I:I==null?mr:typeof I=="object"?Tt(I)?oC(I[0],I[1]):pI(I):lS(I)}function ts(I){if(!Uh(I))return Vf(I);var A=[];for(var Z in Vt(I))pn.call(I,Z)&&Z!="constructor"&&A.push(Z);return A}function Mh(I){if(!ii(I))return UY(I);var A=Uh(I),Z=[];for(var H in I)H=="constructor"&&(A||!pn.call(I,H))||Z.push(H);return Z}function AI(I,A){return I<A}function Ra(I,A){var Z=-1,H=pr(I)?Be(I.length):[];return Ur(I,function(N,k,ee){H[++Z]=A(N,k,ee)}),H}function pI(I){var A=qG(I);return A.length==1&&A[0][2]?Bw(A[0][0],A[0][1]):function(Z){return Z===I||ni(Z,I,A)}}function oC(I,A){return ey(I)&&yw(A)?Bw(qg(I),A):function(Z){var H=cy(Z,I);return H===t&&H===A?Iy(Z,I):ti(A,H,m|f)}}function Or(I,A,Z,H,N){I!==A&&Ll(A,function(k,ee){if(N||(N=new Zi),ii(k))gC(I,A,ee,Z,Or,H,N);else{var ge=H?H(ny(I,ee),k,ee+"",I,A,N):t;ge===t&&(ge=k),Rh(I,ee,ge)}},fr)}function gC(I,A,Z,H,N,k,ee){var ge=ny(I,Z),de=ny(A,Z),Me=ee.get(de);if(Me){Rh(I,Z,Me);return}var Ke=k?k(ge,de,Z+"",I,A,ee):t,_e=Ke===t;if(_e){var rt=Tt(de),ft=!rt&&Pl(de),Ht=!rt&&!ft&&fC(de);Ke=de,rt||ft||Ht?Tt(ge)?Ke=ge:wi(ge)?Ke=rs(ge):ft?(_e=!1,Ke=Eh(de,!0)):Ht?(_e=!1,Ke=gm(de,!0)):Ke=[]:Oh(de)||ZI(de)?(Ke=ge,ZI(ge)?Ke=$w(ge):(!ii(ge)||Ha(ge))&&(Ke=Gw(de))):_e=!1}_e&&(ee.set(de,Ke),N(Ke,de,H,k,ee),ee.delete(de)),Rh(I,Z,Ke)}function ug(I,A){var Z=I.length;if(Z)return A+=A<0?Z:0,Va(A,Z)?I[A]:t}function fI(I,A,Z){A.length?A=Xn(A,function(k){return Tt(k)?function(ee){return Pr(ee,k.length===1?k[0]:k)}:k}):A=[mr];var H=-1;A=Xn(A,ds(xt()));var N=Ra(I,function(k,ee,ge){var de=Xn(A,function(Me){return Me(k)});return{criteria:de,index:++H,value:k}});return gg(N,function(k,ee){return dC(k,ee,Z)})}function mI(I,A){return aC(I,A,function(Z,H){return Iy(I,H)})}function aC(I,A,Z){for(var H=-1,N=A.length,k={};++H<N;){var ee=A[H],ge=Pr(I,ee);Z(ge,ee)&&Wa(k,Og(ee,I),ge)}return k}function lC(I){return function(A){return Pr(A,I)}}function Jl(I,A,Z,H){var N=H?Zl:_r,k=-1,ee=A.length,ge=I;for(I===A&&(A=rs(A)),Z&&(ge=Xn(I,ds(Z)));++k<ee;)for(var de=0,Me=A[k],Ke=Z?Z(Me):Me;(de=N(ge,Ke,de,H))>-1;)ge!==I&&zg.call(ge,de,1),zg.call(I,de,1);return I}function ns(I,A){for(var Z=I?A.length:0,H=Z-1;Z--;){var N=A[Z];if(Z==H||N!==k){var k=N;Va(N)?zg.call(I,N,1):_h(I,N)}}return I}function xo(I,A){return I+gI(yh()*(A-I+1))}function dr(I,A,Z,H){for(var N=-1,k=vi(oI((A-I)/(Z||1)),0),ee=Be(k);k--;)ee[H?k:++N]=I,I+=Z;return ee}function Ul(I,A){var Z="";if(!I||A<1||A>_)return Z;do A%2&&(Z+=I),A=gI(A/2),A&&(I+=I);while(A);return Z}function Rt(I,A){return iy(vw(I,A,mr),I+"")}function nm(I){return uI(mC(I))}function Kh(I,A){var Z=mC(I);return Im(Z,Eg(A,0,Z.length))}function Wa(I,A,Z,H){if(!ii(I))return I;A=Og(A,I);for(var N=-1,k=A.length,ee=k-1,ge=I;ge!=null&&++N<k;){var de=qg(A[N]),Me=Z;if(de==="__proto__"||de==="constructor"||de==="prototype")return I;if(N!=ee){var Ke=ge[de];Me=H?H(Ke,de,ge):t,Me===t&&(Me=ii(Ke)?Ke:Va(A[N+1])?[]:{})}Jr(ge,de,Me),ge=ge[de]}return I}var im=qu?function(I,A){return qu.set(I,A),I}:mr,Dg=Fl?function(I,A){return Fl(I,"toString",{configurable:!0,enumerable:!1,value:Cy(A),writable:!0})}:mr;function sm(I){return Im(mC(I))}function Qs(I,A,Z){var H=-1,N=I.length;A<0&&(A=-A>N?0:N+A),Z=Z>N?N:Z,Z<0&&(Z+=N),N=A>Z?0:Z-A>>>0,A>>>=0;for(var k=Be(N);++H<N;)k[H]=I[H+A];return k}function Lh(I,A){var Z;return Ur(I,function(H,N,k){return Z=A(H,N,k),!Z}),!!Z}function Vo(I,A,Z){var H=0,N=I==null?H:I.length;if(typeof A=="number"&&A===A&&N<=ue){for(;H<N;){var k=H+N>>>1,ee=I[k];ee!==null&&!Qr(ee)&&(Z?ee<=A:ee<A)?H=k+1:N=k}return N}return cC(I,A,mr,Z)}function cC(I,A,Z,H){var N=0,k=I==null?0:I.length;if(k===0)return 0;A=Z(A);for(var ee=A!==A,ge=A===null,de=Qr(A),Me=A===t;N<k;){var Ke=gI((N+k)/2),_e=Z(I[Ke]),rt=_e!==t,ft=_e===null,Ht=_e===_e,qt=Qr(_e);if(ee)var Xt=H||Ht;else Me?Xt=Ht&&(H||rt):ge?Xt=Ht&&rt&&(H||!ft):de?Xt=Ht&&rt&&!ft&&(H||!qt):ft||qt?Xt=!1:Xt=H?_e<=A:_e<A;Xt?N=Ke+1:k=Ke}return $i(k,se)}function zh(I,A){for(var Z=-1,H=I.length,N=0,k=[];++Z<H;){var ee=I[Z],ge=A?A(ee):ee;if(!Z||!dg(ge,de)){var de=ge;k[N++]=ee===0?0:ee}}return k}function IC(I){return typeof I=="number"?I:Qr(I)?te:+I}function is(I){if(typeof I=="string")return I;if(Tt(I))return Xn(I,is)+"";if(Qr(I))return Kl?Kl.call(I):"";var A=I+"";return A=="0"&&1/I==-le?"-0":A}function Jg(I,A,Z){var H=-1,N=Lr,k=I.length,ee=!0,ge=[],de=ge;if(Z)ee=!1,N=Bl;else if(k>=s){var Me=A?null:os(I);if(Me)return eI(Me);ee=!1,N=ki,de=new kg}else de=A?[]:ge;e:for(;++H<k;){var Ke=I[H],_e=A?A(Ke):Ke;if(Ke=Z||Ke!==0?Ke:0,ee&&_e===_e){for(var rt=de.length;rt--;)if(de[rt]===_e)continue e;A&&de.push(_e),ge.push(Ke)}else N(de,_e,Z)||(de!==ge&&de.push(_e),ge.push(Ke))}return ge}function _h(I,A){return A=Og(A,I),I=Zw(I,A),I==null||delete I[qg(Xo(A))]}function kh(I,A,Z,H){return Wa(I,A,Z(Pr(I,A)),H)}function bI(I,A,Z,H){for(var N=I.length,k=H?N:-1;(H?k--:++k<N)&&A(I[k],k,I););return Z?Qs(I,H?0:k,H?k+1:N):Qs(I,H?k+1:0,H?N:k)}function Ug(I,A){var Z=I;return Z instanceof Wt&&(Z=Z.value()),Ju(A,function(H,N){return N.func.apply(N.thisArg,zr([H],N.args))},Z)}function Th(I,A,Z){var H=I.length;if(H<2)return H?Jg(I[0]):[];for(var N=-1,k=Be(H);++N<H;)for(var ee=I[N],ge=-1;++ge<H;)ge!=N&&(k[N]=wa(k[N]||ee,I[ge],A,Z));return Jg(Ni(k,1),A,Z)}function Pg(I,A,Z){for(var H=-1,N=I.length,k=A.length,ee={};++H<N;){var ge=H<k?A[H]:t;Z(ee,I[H],ge)}return ee}function uC(I){return wi(I)?I:[]}function ss(I){return typeof I=="function"?I:mr}function Og(I,A){return Tt(I)?I:ey(I,A)?[I]:Ww(yn(I))}var rm=Rt;function Qg(I,A,Z){var H=I.length;return Z=Z===t?H:Z,!A&&Z>=H?I:Qs(I,A,Z)}var om=rI||function(I){return Ii.clearTimeout(I)};function Eh(I,A){if(A)return I.slice();var Z=I.length,H=fh?fh(Z):new I.constructor(Z);return I.copy(H),H}function CC(I){var A=new I.constructor(I.byteLength);return new iI(A).set(new iI(I)),A}function OG(I,A){var Z=A?CC(I.buffer):I.buffer;return new I.constructor(Z,I.byteOffset,I.byteLength)}function hr(I){var A=new I.constructor(I.source,_t.exec(I));return A.lastIndex=I.lastIndex,A}function Dh(I){return cg?Vt(cg.call(I)):{}}function gm(I,A){var Z=A?CC(I.buffer):I.buffer;return new I.constructor(Z,I.byteOffset,I.length)}function Cg(I,A){if(I!==A){var Z=I!==t,H=I===null,N=I===I,k=Qr(I),ee=A!==t,ge=A===null,de=A===A,Me=Qr(A);if(!ge&&!Me&&!k&&I>A||k&&ee&&de&&!ge&&!Me||H&&ee&&de||!Z&&de||!N)return 1;if(!H&&!k&&!Me&&I<A||Me&&Z&&N&&!H&&!k||ge&&Z&&N||!ee&&N||!de)return-1}return 0}function dC(I,A,Z){for(var H=-1,N=I.criteria,k=A.criteria,ee=N.length,ge=Z.length;++H<ee;){var de=Cg(N[H],k[H]);if(de){if(H>=ge)return de;var Me=Z[H];return de*(Me=="desc"?-1:1)}}return I.index-A.index}function jg(I,A,Z,H){for(var N=-1,k=I.length,ee=Z.length,ge=-1,de=A.length,Me=vi(k-ee,0),Ke=Be(de+Me),_e=!H;++ge<de;)Ke[ge]=A[ge];for(;++N<ee;)(_e||N<k)&&(Ke[Z[N]]=I[N]);for(;Me--;)Ke[ge++]=I[N++];return Ke}function GI(I,A,Z,H){for(var N=-1,k=I.length,ee=-1,ge=Z.length,de=-1,Me=A.length,Ke=vi(k-ge,0),_e=Be(Ke+Me),rt=!H;++N<Ke;)_e[N]=I[N];for(var ft=N;++de<Me;)_e[ft+de]=A[de];for(;++ee<ge;)(rt||N<k)&&(_e[ft+Z[ee]]=I[N++]);return _e}function rs(I,A){var Z=-1,H=I.length;for(A||(A=Be(H));++Z<H;)A[Z]=I[Z];return A}function Ar(I,A,Z,H){var N=!Z;Z||(Z={});for(var k=-1,ee=A.length;++k<ee;){var ge=A[k],de=H?H(Z[ge],I[ge],ge,Z,I):t;de===t&&(de=I[ge]),N?Wo(Z,ge,de):Jr(Z,ge,de)}return Z}function QG(I,A){return Ar(I,$G(I),A)}function am(I,A){return Ar(I,mw(I),A)}function yI(I,A){return function(Z,H){var N=Tt(Z)?Bo:Wh,k=A?A():{};return N(Z,I,xt(H,2),k)}}function xa(I){return Rt(function(A,Z){var H=-1,N=Z.length,k=N>1?Z[N-1]:t,ee=N>2?Z[2]:t;for(k=I.length>3&&typeof k=="function"?(N--,k):t,ee&&qs(Z[0],Z[1],ee)&&(k=N<3?t:k,N=1),A=Vt(A);++H<N;){var ge=Z[H];ge&&I(A,ge,H,k)}return A})}function Jh(I,A){return function(Z,H){if(Z==null)return Z;if(!pr(Z))return I(Z,H);for(var N=Z.length,k=A?N:-1,ee=Vt(Z);(A?k--:++k<N)&&H(ee[k],k,ee)!==!1;);return Z}}function hC(I){return function(A,Z,H){for(var N=-1,k=Vt(A),ee=H(A),ge=ee.length;ge--;){var de=ee[I?ge:++N];if(Z(k[de],de,k)===!1)break}return A}}function jG(I,A,Z){var H=A&b,N=d(I);function k(){var ee=this&&this!==Ii&&this instanceof k?N:I;return ee.apply(H?Z:this,arguments)}return k}function lm(I){return function(A){A=yn(A);var Z=ba(A)?On(A):t,H=Z?Z[0]:A.charAt(0),N=Z?Qg(Z,1).join(""):A.slice(1);return H[I]()+N}}function u(I){return function(A){return Ju(gS(oS(A).replace(NG,"")),I,"")}}function d(I){return function(){var A=arguments;switch(A.length){case 0:return new I;case 1:return new I(A[0]);case 2:return new I(A[0],A[1]);case 3:return new I(A[0],A[1],A[2]);case 4:return new I(A[0],A[1],A[2],A[3]);case 5:return new I(A[0],A[1],A[2],A[3],A[4]);case 6:return new I(A[0],A[1],A[2],A[3],A[4],A[5]);case 7:return new I(A[0],A[1],A[2],A[3],A[4],A[5],A[6])}var Z=Ig(I.prototype),H=I.apply(Z,A);return ii(H)?H:Z}}function B(I,A,Z){var H=d(I);function N(){for(var k=arguments.length,ee=Be(k),ge=k,de=pC(N);ge--;)ee[ge]=arguments[ge];var Me=k<3&&ee[0]!==de&&ee[k-1]!==de?[]:Er(ee,de);if(k-=Me.length,k<Z)return Gn(I,A,F,N.placeholder,t,ee,Me,t,t,Z-k);var Ke=this&&this!==Ii&&this instanceof N?H:I;return Ln(Ke,this,ee)}return N}function S(I){return function(A,Z,H){var N=Vt(A);if(!pr(A)){var k=xt(Z,3);A=gs(A),Z=function(ge){return k(N[ge],ge,N)}}var ee=I(A,Z,H);return ee>-1?N[k?A[ee]:ee]:t}}function x(I){return Pt(function(A){var Z=A.length,H=Z,N=es.prototype.thru;for(I&&A.reverse();H--;){var k=A[H];if(typeof k!="function")throw new As(o);if(N&&!ee&&AC(k)=="wrapper")var ee=new es([],!0)}for(H=ee?H:Z;++H<Z;){k=A[H];var ge=AC(k),de=ge=="wrapper"?Ho(k):t;de&&ty(de[0])&&de[1]==(X|G|W|R)&&!de[4].length&&de[9]==1?ee=ee[AC(de[0])].apply(ee,de[3]):ee=k.length==1&&ty(k)?ee[ge]():ee.thru(k)}return function(){var Me=arguments,Ke=Me[0];if(ee&&Me.length==1&&Tt(Ke))return ee.plant(Ke).value();for(var _e=0,rt=Z?A[_e].apply(this,Me):Ke;++_e<Z;)rt=A[_e].call(this,rt);return rt}})}function F(I,A,Z,H,N,k,ee,ge,de,Me){var Ke=A&X,_e=A&b,rt=A&y,ft=A&(G|w),Ht=A&Y,qt=rt?t:d(I);function Xt(){for(var rn=arguments.length,In=Be(rn),jr=rn;jr--;)In[jr]=arguments[jr];if(ft)var $s=pC(Xt),qr=Tr(In,$s);if(H&&(In=jg(In,H,N,ft)),k&&(In=GI(In,k,ee,ft)),rn-=qr,ft&&rn<Me){var Si=Er(In,$s);return Gn(I,A,F,Xt.placeholder,Z,In,Si,ge,de,Me-rn)}var hg=_e?Z:this,Ya=rt?hg[I]:I;return rn=In.length,ge?In=OY(In,ge):Ht&&rn>1&&In.reverse(),Ke&&de<rn&&(In.length=de),this&&this!==Ii&&this instanceof Xt&&(Ya=qt||d(Ya)),Ya.apply(hg,In)}return Xt}function Q(I,A){return function(Z,H){return Fh(Z,I,A(H),{})}}function ce(I,A){return function(Z,H){var N;if(Z===t&&H===t)return A;if(Z!==t&&(N=Z),H!==t){if(N===t)return H;typeof Z=="string"||typeof H=="string"?(Z=is(Z),H=is(H)):(Z=IC(Z),H=IC(H)),N=I(Z,H)}return N}}function Re(I){return Pt(function(A){return A=Xn(A,ds(xt())),Rt(function(Z){var H=this;return I(A,function(N){return Ln(N,H,Z)})})})}function Je(I,A){A=A===t?" ":is(A);var Z=A.length;if(Z<2)return Z?Ul(A,I):A;var H=Ul(A,oI(I/vo(A)));return ba(A)?Qg(On(H),0,I).join(""):H.slice(0,I)}function ut(I,A,Z,H){var N=A&b,k=d(I);function ee(){for(var ge=-1,de=arguments.length,Me=-1,Ke=H.length,_e=Be(Ke+de),rt=this&&this!==Ii&&this instanceof ee?k:I;++Me<Ke;)_e[Me]=H[Me];for(;de--;)_e[Me++]=arguments[++ge];return Ln(rt,N?Z:this,_e)}return ee}function Mt(I){return function(A,Z,H){return H&&typeof H!="number"&&qs(A,Z,H)&&(Z=H=t),A=Xa(A),Z===t?(Z=A,A=0):Z=Xa(Z),H=H===t?A<Z?1:-1:Xa(H),dr(A,Z,H,I)}}function Bt(I){return function(A,Z){return typeof A=="string"&&typeof Z=="string"||(A=Yo(A),Z=Yo(Z)),I(A,Z)}}function Gn(I,A,Z,H,N,k,ee,ge,de,Me){var Ke=A&G,_e=Ke?ee:t,rt=Ke?t:ee,ft=Ke?k:t,Ht=Ke?t:k;A|=Ke?W:V,A&=~(Ke?V:W),A&v||(A&=~(b|y));var qt=[I,A,N,ft,_e,Ht,rt,ge,de,Me],Xt=Z.apply(t,qt);return ty(I)&&ww(Xt,qt),Xt.placeholder=H,Sw(Xt,I,A)}function ht(I){var A=zn[I];return function(Z,H){if(Z=Yo(Z),H=H==null?0:$i(jt(H),292),H&&Gh(Z)){var N=(yn(Z)+"e").split("e"),k=A(N[0]+"e"+(+N[1]+H));return N=(yn(k)+"e").split("e"),+(N[0]+"e"+(+N[1]-H))}return A(Z)}}var os=Ml&&1/eI(new Ml([,-0]))[1]==le?function(I){return new Ml(I)}:Ay;function js(I){return function(A){var Z=Vs(A);return Z==Ve?$c(A):Z==Zt?Zf(A):yf(A,I(A))}}function fe(I,A,Z,H,N,k,ee,ge){var de=A&y;if(!de&&typeof I!="function")throw new As(o);var Me=H?H.length:0;if(Me||(A&=~(W|V),H=N=t),ee=ee===t?ee:vi(jt(ee),0),ge=ge===t?ge:jt(ge),Me-=N?N.length:0,A&V){var Ke=H,_e=N;H=N=t}var rt=de?t:Ho(I),ft=[I,A,Z,H,N,Ke,_e,k,ee,ge];if(rt&&JY(ft,rt),I=ft[0],A=ft[1],Z=ft[2],H=ft[3],N=ft[4],ge=ft[9]=ft[9]===t?de?0:I.length:vi(ft[9]-Me,0),!ge&&A&(G|w)&&(A&=~(G|w)),!A||A==b)var Ht=jG(I,A,Z);else A==G||A==w?Ht=B(I,A,ge):(A==W||A==(b|W))&&!N.length?Ht=ut(I,A,Z,H):Ht=F.apply(t,ft);var qt=rt?im:ww;return Sw(qt(Ht,ft),I,A)}function Ce(I,A,Z,H){return I===t||dg(I,Xl[Z])&&!pn.call(H,Z)?A:I}function Ze(I,A,Z,H,N,k){return ii(I)&&ii(A)&&(k.set(A,I),Or(I,A,t,Ze,k),k.delete(A)),I}function ot(I){return Oh(I)?t:I}function At(I,A,Z,H,N,k){var ee=Z&m,ge=I.length,de=A.length;if(ge!=de&&!(ee&&de>ge))return!1;var Me=k.get(I),Ke=k.get(A);if(Me&&Ke)return Me==A&&Ke==I;var _e=-1,rt=!0,ft=Z&f?new kg:t;for(k.set(I,A),k.set(A,I);++_e<ge;){var Ht=I[_e],qt=A[_e];if(H)var Xt=ee?H(qt,Ht,_e,A,I,k):H(Ht,qt,_e,I,A,k);if(Xt!==t){if(Xt)continue;rt=!1;break}if(ft){if(!Oc(A,function(rn,In){if(!ki(ft,In)&&(Ht===rn||N(Ht,rn,Z,H,k)))return ft.push(In)})){rt=!1;break}}else if(!(Ht===qt||N(Ht,qt,Z,H,k))){rt=!1;break}}return k.delete(I),k.delete(A),rt}function Ut(I,A,Z,H,N,k,ee){switch(Z){case vt:if(I.byteLength!=A.byteLength||I.byteOffset!=A.byteOffset)return!1;I=I.buffer,A=A.buffer;case De:return!(I.byteLength!=A.byteLength||!k(new iI(I),new iI(A)));case Oe:case It:case qe:return dg(+I,+A);case je:return I.name==A.name&&I.message==A.message;case Yt:case O:return I==A+"";case Ve:var ge=$c;case Zt:var de=H&m;if(ge||(ge=eI),I.size!=A.size&&!de)return!1;var Me=ee.get(I);if(Me)return Me==A;H|=f,ee.set(I,A);var Ke=At(ge(I),ge(A),H,N,k,ee);return ee.delete(I),Ke;case z:if(cg)return cg.call(I)==cg.call(A)}return!1}function Kt(I,A,Z,H,N,k){var ee=Z&m,ge=di(I),de=ge.length,Me=di(A),Ke=Me.length;if(de!=Ke&&!ee)return!1;for(var _e=de;_e--;){var rt=ge[_e];if(!(ee?rt in A:pn.call(A,rt)))return!1}var ft=k.get(I),Ht=k.get(A);if(ft&&Ht)return ft==A&&Ht==I;var qt=!0;k.set(I,A),k.set(A,I);for(var Xt=ee;++_e<de;){rt=ge[_e];var rn=I[rt],In=A[rt];if(H)var jr=ee?H(In,rn,rt,A,I,k):H(rn,In,rt,I,A,k);if(!(jr===t?rn===In||N(rn,In,Z,H,k):jr)){qt=!1;break}Xt||(Xt=rt=="constructor")}if(qt&&!Xt){var $s=I.constructor,qr=A.constructor;$s!=qr&&"constructor"in I&&"constructor"in A&&!(typeof $s=="function"&&$s instanceof $s&&typeof qr=="function"&&qr instanceof qr)&&(qt=!1)}return k.delete(I),k.delete(A),qt}function Pt(I){return iy(vw(I,t,Xw),I+"")}function di(I){return sC(I,gs,$G)}function an(I){return sC(I,fr,mw)}var Ho=qu?function(I){return qu.get(I)}:Ay;function AC(I){for(var A=I.name+"",Z=va[A],H=pn.call(va,A)?Z.length:0;H--;){var N=Z[H],k=N.func;if(k==null||k==I)return N.name}return A}function pC(I){var A=pn.call(K,"placeholder")?K:I;return A.placeholder}function xt(){var I=K.iteratee||dy;return I=I===dy?Dl:I,arguments.length?I(arguments[0],arguments[1]):I}function cm(I,A){var Z=I.__data__;return kY(A)?Z[typeof A=="string"?"string":"hash"]:Z.map}function qG(I){for(var A=gs(I),Z=A.length;Z--;){var H=A[Z],N=I[H];A[Z]=[H,N,yw(N)]}return A}function BI(I,A){var Z=hh(I,A);return Tl(Z)?Z:t}function FY(I){var A=pn.call(I,So),Z=I[So];try{I[So]=t;var H=!0}catch{}var N=Ds.call(I);return H&&(A?I[So]=Z:delete I[So]),N}var $G=aI?function(I){return I==null?[]:(I=Vt(I),qi(aI(I),function(A){return ju.call(I,A)}))}:py,mw=aI?function(I){for(var A=[];I;)zr(A,$G(I)),I=sI(I);return A}:py,Vs=Ti;(Nl&&Vs(new Nl(new ArrayBuffer(1)))!=vt||lI&&Vs(new lI)!=Ve||Bh&&Vs(Bh.resolve())!=ct||Ml&&Vs(new Ml)!=Zt||ya&&Vs(new ya)!=Le)&&(Vs=function(I){var A=Ti(I),Z=A==Pe?I.constructor:t,H=Z?vI(Z):"";if(H)switch(H){case Ff:return vt;case Nf:return Ve;case Mf:return ct;case Kf:return Zt;case Ro:return Le}return A});function NY(I,A,Z){for(var H=-1,N=Z.length;++H<N;){var k=Z[H],ee=k.size;switch(k.type){case"drop":I+=ee;break;case"dropRight":A-=ee;break;case"take":A=$i(A,I+ee);break;case"takeRight":I=vi(I,A-ee);break}}return{start:I,end:A}}function MY(I){var A=I.match(Ge);return A?A[1].split(He):[]}function bw(I,A,Z){A=Og(A,I);for(var H=-1,N=A.length,k=!1;++H<N;){var ee=qg(A[H]);if(!(k=I!=null&&Z(I,ee)))break;I=I[ee]}return k||++H!=N?k:(N=I==null?0:I.length,!!N&&pm(N)&&Va(ee,N)&&(Tt(I)||ZI(I)))}function KY(I){var A=I.length,Z=new I.constructor(A);return A&&typeof I[0]=="string"&&pn.call(I,"index")&&(Z.index=I.index,Z.input=I.input),Z}function Gw(I){return typeof I.constructor=="function"&&!Uh(I)?Ig(sI(I)):{}}function LY(I,A,Z){var H=I.constructor;switch(A){case De:return CC(I);case Oe:case It:return new H(+I);case vt:return OG(I,Z);case nt:case Ye:case dt:case oe:case we:case Ee:case Qe:case wt:case Ot:return gm(I,Z);case Ve:return new H;case qe:case O:return new H(I);case Yt:return hr(I);case Zt:return new H;case z:return Dh(I)}}function zY(I,A){var Z=A.length;if(!Z)return I;var H=Z-1;return A[H]=(Z>1?"& ":"")+A[H],A=A.join(Z>2?", ":" "),I.replace(J,`{
/* [wrapped with `+A+`] */
`)}function _Y(I){return Tt(I)||ZI(I)||!!(bh&&I&&I[bh])}function Va(I,A){var Z=typeof I;return A=A??_,!!A&&(Z=="number"||Z!="symbol"&&Un.test(I))&&I>-1&&I%1==0&&I<A}function qs(I,A,Z){if(!ii(Z))return!1;var H=typeof A;return(H=="number"?pr(Z)&&Va(A,Z.length):H=="string"&&A in Z)?dg(Z[A],I):!1}function ey(I,A){if(Tt(I))return!1;var Z=typeof I;return Z=="number"||Z=="symbol"||Z=="boolean"||I==null||Qr(I)?!0:lr.test(I)||!Bn.test(I)||A!=null&&I in Vt(A)}function kY(I){var A=typeof I;return A=="string"||A=="number"||A=="symbol"||A=="boolean"?I!=="__proto__":I===null}function ty(I){var A=AC(I),Z=K[A];if(typeof Z!="function"||!(A in Wt.prototype))return!1;if(I===Z)return!0;var H=Ho(Z);return!!H&&I===H[0]}function TY(I){return!!wo&&wo in I}var EY=Bi?Ha:fy;function Uh(I){var A=I&&I.constructor,Z=typeof A=="function"&&A.prototype||Xl;return I===Z}function yw(I){return I===I&&!ii(I)}function Bw(I,A){return function(Z){return Z==null?!1:Z[I]===A&&(A!==t||I in Vt(Z))}}function DY(I){var A=hm(I,function(H){return Z.size===l&&Z.clear(),H}),Z=A.cache;return A}function JY(I,A){var Z=I[1],H=A[1],N=Z|H,k=N<(b|y|X),ee=H==X&&Z==G||H==X&&Z==R&&I[7].length<=A[8]||H==(X|R)&&A[7].length<=A[8]&&Z==G;if(!(k||ee))return I;H&b&&(I[2]=A[2],N|=Z&b?0:v);var ge=A[3];if(ge){var de=I[3];I[3]=de?jg(de,ge,A[4]):ge,I[4]=de?Er(I[3],c):A[4]}return ge=A[5],ge&&(de=I[5],I[5]=de?GI(de,ge,A[6]):ge,I[6]=de?Er(I[5],c):A[6]),ge=A[7],ge&&(I[7]=ge),H&X&&(I[8]=I[8]==null?A[8]:$i(I[8],A[8])),I[9]==null&&(I[9]=A[9]),I[0]=A[0],I[1]=N,I}function UY(I){var A=[];if(I!=null)for(var Z in Vt(I))A.push(Z);return A}function PY(I){return Ds.call(I)}function vw(I,A,Z){return A=vi(A===t?I.length-1:A,0),function(){for(var H=arguments,N=-1,k=vi(H.length-A,0),ee=Be(k);++N<k;)ee[N]=H[A+N];N=-1;for(var ge=Be(A+1);++N<A;)ge[N]=H[N];return ge[A]=Z(ee),Ln(I,this,ge)}}function Zw(I,A){return A.length<2?I:Pr(I,Qs(A,0,-1))}function OY(I,A){for(var Z=I.length,H=$i(A.length,Z),N=rs(I);H--;){var k=A[H];I[H]=Va(k,Z)?N[k]:t}return I}function ny(I,A){if(!(A==="constructor"&&typeof I[A]=="function")&&A!="__proto__")return I[A]}var ww=Rw(im),Ph=Wf||function(I,A){return Ii.setTimeout(I,A)},iy=Rw(Dg);function Sw(I,A,Z){var H=A+"";return iy(I,zY(H,QY(MY(H),Z)))}function Rw(I){var A=0,Z=0;return function(){var H=Hf(),N=j-(H-Z);if(Z=H,N>0){if(++A>=re)return arguments[0]}else A=0;return I.apply(t,arguments)}}function Im(I,A){var Z=-1,H=I.length,N=H-1;for(A=A===t?H:A;++Z<A;){var k=xo(Z,N),ee=I[k];I[k]=I[Z],I[Z]=ee}return I.length=A,I}var Ww=DY(function(I){var A=[];return I.charCodeAt(0)===46&&A.push(""),I.replace(ws,function(Z,H,N,k){A.push(N?k.replace(St,"$1"):H||Z)}),A});function qg(I){if(typeof I=="string"||Qr(I))return I;var A=I+"";return A=="0"&&1/I==-le?"-0":A}function vI(I){if(I!=null){try{return Yl.call(I)}catch{}try{return I+""}catch{}}return""}function QY(I,A){return yi(Ae,function(Z){var H="_."+Z[0];A&Z[1]&&!Lr(I,H)&&I.push(H)}),I.sort()}function xw(I){if(I instanceof Wt)return I.clone();var A=new es(I.__wrapped__,I.__chain__);return A.__actions__=rs(I.__actions__),A.__index__=I.__index__,A.__values__=I.__values__,A}function jY(I,A,Z){(Z?qs(I,A,Z):A===t)?A=1:A=vi(jt(A),0);var H=I==null?0:I.length;if(!H||A<1)return[];for(var N=0,k=0,ee=Be(oI(H/A));N<H;)ee[k++]=Qs(I,N,N+=A);return ee}function qY(I){for(var A=-1,Z=I==null?0:I.length,H=0,N=[];++A<Z;){var k=I[A];k&&(N[H++]=k)}return N}function $Y(){var I=arguments.length;if(!I)return[];for(var A=Be(I-1),Z=arguments[0],H=I;H--;)A[H-1]=arguments[H];return zr(Tt(Z)?rs(Z):[Z],Ni(A,1))}var eF=Rt(function(I,A){return wi(I)?wa(I,Ni(A,1,wi,!0)):[]}),tF=Rt(function(I,A){var Z=Xo(A);return wi(Z)&&(Z=t),wi(I)?wa(I,Ni(A,1,wi,!0),xt(Z,2)):[]}),nF=Rt(function(I,A){var Z=Xo(A);return wi(Z)&&(Z=t),wi(I)?wa(I,Ni(A,1,wi,!0),t,Z):[]});function iF(I,A,Z){var H=I==null?0:I.length;return H?(A=Z||A===t?1:jt(A),Qs(I,A<0?0:A,H)):[]}function sF(I,A,Z){var H=I==null?0:I.length;return H?(A=Z||A===t?1:jt(A),A=H-A,Qs(I,0,A<0?0:A)):[]}function rF(I,A){return I&&I.length?bI(I,xt(A,3),!0,!0):[]}function oF(I,A){return I&&I.length?bI(I,xt(A,3),!0):[]}function gF(I,A,Z,H){var N=I==null?0:I.length;return N?(Z&&typeof Z!="number"&&qs(I,A,Z)&&(Z=0,H=N),em(I,A,Z,H)):[]}function Vw(I,A,Z){var H=I==null?0:I.length;if(!H)return-1;var N=Z==null?0:jt(Z);return N<0&&(N=vi(H+N,0)),vl(I,xt(A,3),N)}function Hw(I,A,Z){var H=I==null?0:I.length;if(!H)return-1;var N=H-1;return Z!==t&&(N=jt(Z),N=Z<0?vi(H+N,0):$i(N,H-1)),vl(I,xt(A,3),N,!0)}function Xw(I){var A=I==null?0:I.length;return A?Ni(I,1):[]}function aF(I){var A=I==null?0:I.length;return A?Ni(I,le):[]}function lF(I,A){var Z=I==null?0:I.length;return Z?(A=A===t?1:jt(A),Ni(I,A)):[]}function cF(I){for(var A=-1,Z=I==null?0:I.length,H={};++A<Z;){var N=I[A];H[N[0]]=N[1]}return H}function Yw(I){return I&&I.length?I[0]:t}function IF(I,A,Z){var H=I==null?0:I.length;if(!H)return-1;var N=Z==null?0:jt(Z);return N<0&&(N=vi(H+N,0)),_r(I,A,N)}function uF(I){var A=I==null?0:I.length;return A?Qs(I,0,-1):[]}var CF=Rt(function(I){var A=Xn(I,uC);return A.length&&A[0]===I[0]?_l(A):[]}),dF=Rt(function(I){var A=Xo(I),Z=Xn(I,uC);return A===Xo(Z)?A=t:Z.pop(),Z.length&&Z[0]===I[0]?_l(Z,xt(A,2)):[]}),hF=Rt(function(I){var A=Xo(I),Z=Xn(I,uC);return A=typeof A=="function"?A:t,A&&Z.pop(),Z.length&&Z[0]===I[0]?_l(Z,t,A):[]});function AF(I,A){return I==null?"":_G.call(I,A)}function Xo(I){var A=I==null?0:I.length;return A?I[A-1]:t}function pF(I,A,Z){var H=I==null?0:I.length;if(!H)return-1;var N=H;return Z!==t&&(N=jt(Z),N=N<0?vi(H+N,0):$i(N,H-1)),A===A?wf(I,A,N):vl(I,Qc,N,!0)}function fF(I,A){return I&&I.length?ug(I,jt(A)):t}var mF=Rt(Fw);function Fw(I,A){return I&&I.length&&A&&A.length?Jl(I,A):I}function bF(I,A,Z){return I&&I.length&&A&&A.length?Jl(I,A,xt(Z,2)):I}function GF(I,A,Z){return I&&I.length&&A&&A.length?Jl(I,A,t,Z):I}var yF=Pt(function(I,A){var Z=I==null?0:I.length,H=nC(I,A);return ns(I,Xn(A,function(N){return Va(N,Z)?+N:N}).sort(Cg)),H});function BF(I,A){var Z=[];if(!(I&&I.length))return Z;var H=-1,N=[],k=I.length;for(A=xt(A,3);++H<k;){var ee=I[H];A(ee,H,I)&&(Z.push(ee),N.push(H))}return ns(I,N),Z}function sy(I){return I==null?I:Yf.call(I)}function vF(I,A,Z){var H=I==null?0:I.length;return H?(Z&&typeof Z!="number"&&qs(I,A,Z)?(A=0,Z=H):(A=A==null?0:jt(A),Z=Z===t?H:jt(Z)),Qs(I,A,Z)):[]}function ZF(I,A){return Vo(I,A)}function wF(I,A,Z){return cC(I,A,xt(Z,2))}function SF(I,A){var Z=I==null?0:I.length;if(Z){var H=Vo(I,A);if(H<Z&&dg(I[H],A))return H}return-1}function RF(I,A){return Vo(I,A,!0)}function WF(I,A,Z){return cC(I,A,xt(Z,2),!0)}function xF(I,A){var Z=I==null?0:I.length;if(Z){var H=Vo(I,A,!0)-1;if(dg(I[H],A))return H}return-1}function VF(I){return I&&I.length?zh(I):[]}function HF(I,A){return I&&I.length?zh(I,xt(A,2)):[]}function XF(I){var A=I==null?0:I.length;return A?Qs(I,1,A):[]}function YF(I,A,Z){return I&&I.length?(A=Z||A===t?1:jt(A),Qs(I,0,A<0?0:A)):[]}function FF(I,A,Z){var H=I==null?0:I.length;return H?(A=Z||A===t?1:jt(A),A=H-A,Qs(I,A<0?0:A,H)):[]}function NF(I,A){return I&&I.length?bI(I,xt(A,3),!1,!0):[]}function MF(I,A){return I&&I.length?bI(I,xt(A,3)):[]}var KF=Rt(function(I){return Jg(Ni(I,1,wi,!0))}),LF=Rt(function(I){var A=Xo(I);return wi(A)&&(A=t),Jg(Ni(I,1,wi,!0),xt(A,2))}),zF=Rt(function(I){var A=Xo(I);return A=typeof A=="function"?A:t,Jg(Ni(I,1,wi,!0),t,A)});function _F(I){return I&&I.length?Jg(I):[]}function kF(I,A){return I&&I.length?Jg(I,xt(A,2)):[]}function TF(I,A){return A=typeof A=="function"?A:t,I&&I.length?Jg(I,t,A):[]}function ry(I){if(!(I&&I.length))return[];var A=0;return I=qi(I,function(Z){if(wi(Z))return A=vi(Z.length,A),!0}),ag(A,function(Z){return Xn(I,Ws(Z))})}function Nw(I,A){if(!(I&&I.length))return[];var Z=ry(I);return A==null?Z:Xn(Z,function(H){return Ln(A,t,H)})}var EF=Rt(function(I,A){return wi(I)?wa(I,A):[]}),DF=Rt(function(I){return Th(qi(I,wi))}),JF=Rt(function(I){var A=Xo(I);return wi(A)&&(A=t),Th(qi(I,wi),xt(A,2))}),UF=Rt(function(I){var A=Xo(I);return A=typeof A=="function"?A:t,Th(qi(I,wi),t,A)}),PF=Rt(ry);function OF(I,A){return Pg(I||[],A||[],Jr)}function QF(I,A){return Pg(I||[],A||[],Wa)}var jF=Rt(function(I){var A=I.length,Z=A>1?I[A-1]:t;return Z=typeof Z=="function"?(I.pop(),Z):t,Nw(I,Z)});function Mw(I){var A=K(I);return A.__chain__=!0,A}function qF(I,A){return A(I),I}function um(I,A){return A(I)}var $F=Pt(function(I){var A=I.length,Z=A?I[0]:0,H=this.__wrapped__,N=function(k){return nC(k,I)};return A>1||this.__actions__.length||!(H instanceof Wt)||!Va(Z)?this.thru(N):(H=H.slice(Z,+Z+(A?1:0)),H.__actions__.push({func:um,args:[N],thisArg:t}),new es(H,this.__chain__).thru(function(k){return A&&!k.length&&k.push(t),k}))});function eN(){return Mw(this)}function tN(){return new es(this.value(),this.__chain__)}function nN(){this.__values__===t&&(this.__values__=jw(this.value()));var I=this.__index__>=this.__values__.length,A=I?t:this.__values__[this.__index__++];return{done:I,value:A}}function iN(){return this}function sN(I){for(var A,Z=this;Z instanceof II;){var H=xw(Z);H.__index__=0,H.__values__=t,A?N.__wrapped__=H:A=H;var N=H;Z=Z.__wrapped__}return N.__wrapped__=I,A}function rN(){var I=this.__wrapped__;if(I instanceof Wt){var A=I;return this.__actions__.length&&(A=new Wt(this)),A=A.reverse(),A.__actions__.push({func:um,args:[sy],thisArg:t}),new es(A,this.__chain__)}return this.thru(sy)}function oN(){return Ug(this.__wrapped__,this.__actions__)}var gN=yI(function(I,A,Z){pn.call(I,Z)?++I[Z]:Wo(I,Z,1)});function aN(I,A,Z){var H=Tt(I)?uh:UG;return Z&&qs(I,A,Z)&&(A=t),H(I,xt(A,3))}function lN(I,A){var Z=Tt(I)?qi:Xh;return Z(I,xt(A,3))}var cN=S(Vw),IN=S(Hw);function uN(I,A){return Ni(Cm(I,A),1)}function CN(I,A){return Ni(Cm(I,A),le)}function dN(I,A,Z){return Z=Z===t?1:jt(Z),Ni(Cm(I,A),Z)}function Kw(I,A){var Z=Tt(I)?yi:Ur;return Z(I,xt(A,3))}function Lw(I,A){var Z=Tt(I)?Ih:$f;return Z(I,xt(A,3))}var hN=yI(function(I,A,Z){pn.call(I,Z)?I[Z].push(A):Wo(I,Z,[A])});function AN(I,A,Z,H){I=pr(I)?I:mC(I),Z=Z&&!H?jt(Z):0;var N=I.length;return Z<0&&(Z=vi(N+Z,0)),fm(I)?Z<=N&&I.indexOf(A,Z)>-1:!!N&&_r(I,A,Z)>-1}var pN=Rt(function(I,A,Z){var H=-1,N=typeof A=="function",k=pr(I)?Be(I.length):[];return Ur(I,function(ee){k[++H]=N?Ln(A,ee,Z):Fn(ee,A,Z)}),k}),fN=yI(function(I,A,Z){Wo(I,Z,A)});function Cm(I,A){var Z=Tt(I)?Xn:Ra;return Z(I,xt(A,3))}function mN(I,A,Z,H){return I==null?[]:(Tt(A)||(A=A==null?[]:[A]),Z=H?t:Z,Tt(Z)||(Z=Z==null?[]:[Z]),fI(I,A,Z))}var bN=yI(function(I,A,Z){I[Z?0:1].push(A)},function(){return[[],[]]});function GN(I,A,Z){var H=Tt(I)?Ju:Mg,N=arguments.length<3;return H(I,xt(A,4),Z,N,Ur)}function yN(I,A,Z){var H=Tt(I)?mf:Mg,N=arguments.length<3;return H(I,xt(A,4),Z,N,$f)}function BN(I,A){var Z=Tt(I)?qi:Xh;return Z(I,Am(xt(A,3)))}function vN(I){var A=Tt(I)?uI:nm;return A(I)}function ZN(I,A,Z){(Z?qs(I,A,Z):A===t)?A=1:A=jt(A);var H=Tt(I)?Sh:Kh;return H(I,A)}function wN(I){var A=Tt(I)?jf:sm;return A(I)}function SN(I){if(I==null)return 0;if(pr(I))return fm(I)?vo(I):I.length;var A=Vs(I);return A==Ve||A==Zt?I.size:ts(I).length}function RN(I,A,Z){var H=Tt(I)?Oc:Lh;return Z&&qs(I,A,Z)&&(A=t),H(I,xt(A,3))}var WN=Rt(function(I,A){if(I==null)return[];var Z=A.length;return Z>1&&qs(I,A[0],A[1])?A=[]:Z>2&&qs(A[0],A[1],A[2])&&(A=[A[0]]),fI(I,Ni(A,1),[])}),dm=Rf||function(){return Ii.Date.now()};function xN(I,A){if(typeof A!="function")throw new As(o);return I=jt(I),function(){if(--I<1)return A.apply(this,arguments)}}function zw(I,A,Z){return A=Z?t:A,A=I&&A==null?I.length:A,fe(I,X,t,t,t,t,A)}function _w(I,A){var Z;if(typeof A!="function")throw new As(o);return I=jt(I),function(){return--I>0&&(Z=A.apply(this,arguments)),I<=1&&(A=t),Z}}var oy=Rt(function(I,A,Z){var H=b;if(Z.length){var N=Er(Z,pC(oy));H|=W}return fe(I,H,A,Z,N)}),kw=Rt(function(I,A,Z){var H=b|y;if(Z.length){var N=Er(Z,pC(kw));H|=W}return fe(A,H,I,Z,N)});function Tw(I,A,Z){A=Z?t:A;var H=fe(I,G,t,t,t,t,t,A);return H.placeholder=Tw.placeholder,H}function Ew(I,A,Z){A=Z?t:A;var H=fe(I,w,t,t,t,t,t,A);return H.placeholder=Ew.placeholder,H}function Dw(I,A,Z){var H,N,k,ee,ge,de,Me=0,Ke=!1,_e=!1,rt=!0;if(typeof I!="function")throw new As(o);A=Yo(A)||0,ii(Z)&&(Ke=!!Z.leading,_e="maxWait"in Z,k=_e?vi(Yo(Z.maxWait)||0,A):k,rt="trailing"in Z?!!Z.trailing:rt);function ft(Si){var hg=H,Ya=N;return H=N=t,Me=Si,ee=I.apply(Ya,hg),ee}function Ht(Si){return Me=Si,ge=Ph(rn,A),Ke?ft(Si):ee}function qt(Si){var hg=Si-de,Ya=Si-Me,cS=A-hg;return _e?$i(cS,k-Ya):cS}function Xt(Si){var hg=Si-de,Ya=Si-Me;return de===t||hg>=A||hg<0||_e&&Ya>=k}function rn(){var Si=dm();if(Xt(Si))return In(Si);ge=Ph(rn,qt(Si))}function In(Si){return ge=t,rt&&H?ft(Si):(H=N=t,ee)}function jr(){ge!==t&&om(ge),Me=0,H=de=N=ge=t}function $s(){return ge===t?ee:In(dm())}function qr(){var Si=dm(),hg=Xt(Si);if(H=arguments,N=this,de=Si,hg){if(ge===t)return Ht(de);if(_e)return om(ge),ge=Ph(rn,A),ft(de)}return ge===t&&(ge=Ph(rn,A)),ee}return qr.cancel=jr,qr.flush=$s,qr}var VN=Rt(function(I,A){return Hh(I,1,A)}),HN=Rt(function(I,A,Z){return Hh(I,Yo(A)||0,Z)});function XN(I){return fe(I,Y)}function hm(I,A){if(typeof I!="function"||A!=null&&typeof A!="function")throw new As(o);var Z=function(){var H=arguments,N=A?A.apply(this,H):H[0],k=Z.cache;if(k.has(N))return k.get(N);var ee=I.apply(this,H);return Z.cache=k.set(N,ee)||k,ee};return Z.cache=new(hm.Cache||Cr),Z}hm.Cache=Cr;function Am(I){if(typeof I!="function")throw new As(o);return function(){var A=arguments;switch(A.length){case 0:return!I.call(this);case 1:return!I.call(this,A[0]);case 2:return!I.call(this,A[0],A[1]);case 3:return!I.call(this,A[0],A[1],A[2])}return!I.apply(this,A)}}function YN(I){return _w(2,I)}var FN=rm(function(I,A){A=A.length==1&&Tt(A[0])?Xn(A[0],ds(xt())):Xn(Ni(A,1),ds(xt()));var Z=A.length;return Rt(function(H){for(var N=-1,k=$i(H.length,Z);++N<k;)H[N]=A[N].call(this,H[N]);return Ln(I,this,H)})}),gy=Rt(function(I,A){var Z=Er(A,pC(gy));return fe(I,W,t,A,Z)}),Jw=Rt(function(I,A){var Z=Er(A,pC(Jw));return fe(I,V,t,A,Z)}),NN=Pt(function(I,A){return fe(I,R,t,t,t,A)});function MN(I,A){if(typeof I!="function")throw new As(o);return A=A===t?A:jt(A),Rt(I,A)}function KN(I,A){if(typeof I!="function")throw new As(o);return A=A==null?0:vi(jt(A),0),Rt(function(Z){var H=Z[A],N=Qg(Z,0,A);return H&&zr(N,H),Ln(I,this,N)})}function LN(I,A,Z){var H=!0,N=!0;if(typeof I!="function")throw new As(o);return ii(Z)&&(H="leading"in Z?!!Z.leading:H,N="trailing"in Z?!!Z.trailing:N),Dw(I,A,{leading:H,maxWait:A,trailing:N})}function zN(I){return zw(I,1)}function _N(I,A){return gy(ss(A),I)}function kN(){if(!arguments.length)return[];var I=arguments[0];return Tt(I)?I:[I]}function TN(I){return Us(I,p)}function EN(I,A){return A=typeof A=="function"?A:t,Us(I,p,A)}function DN(I){return Us(I,C|p)}function JN(I,A){return A=typeof A=="function"?A:t,Us(I,C|p,A)}function UN(I,A){return A==null||iC(I,A,gs(A))}function dg(I,A){return I===A||I!==I&&A!==A}var PN=Bt(hI),ON=Bt(function(I,A){return I>=A}),ZI=Jt(function(){return arguments}())?Jt:function(I){return hi(I)&&pn.call(I,"callee")&&!ju.call(I,"callee")},Tt=Be.isArray,QN=ku?ds(ku):ui;function pr(I){return I!=null&&pm(I.length)&&!Ha(I)}function wi(I){return hi(I)&&pr(I)}function jN(I){return I===!0||I===!1||hi(I)&&Ti(I)==Oe}var Pl=xf||fy,qN=Tu?ds(Tu):Ci;function $N(I){return hi(I)&&I.nodeType===1&&!Oh(I)}function eM(I){if(I==null)return!0;if(pr(I)&&(Tt(I)||typeof I=="string"||typeof I.splice=="function"||Pl(I)||fC(I)||ZI(I)))return!I.length;var A=Vs(I);if(A==Ve||A==Zt)return!I.size;if(Uh(I))return!ts(I).length;for(var Z in I)if(pn.call(I,Z))return!1;return!0}function tM(I,A){return ti(I,A)}function nM(I,A,Z){Z=typeof Z=="function"?Z:t;var H=Z?Z(I,A):t;return H===t?ti(I,A,t,Z):!!H}function ay(I){if(!hi(I))return!1;var A=Ti(I);return A==je||A==ke||typeof I.message=="string"&&typeof I.name=="string"&&!Oh(I)}function iM(I){return typeof I=="number"&&Gh(I)}function Ha(I){if(!ii(I))return!1;var A=Ti(I);return A==ve||A==be||A==tt||A==gt}function Uw(I){return typeof I=="number"&&I==jt(I)}function pm(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=_}function ii(I){var A=typeof I;return I!=null&&(A=="object"||A=="function")}function hi(I){return I!=null&&typeof I=="object"}var Pw=ch?ds(ch):kl;function sM(I,A){return I===A||ni(I,A,qG(A))}function rM(I,A,Z){return Z=typeof Z=="function"?Z:t,ni(I,A,qG(A),Z)}function oM(I){return Ow(I)&&I!=+I}function gM(I){if(EY(I))throw new Ft(r);return Tl(I)}function aM(I){return I===null}function lM(I){return I==null}function Ow(I){return typeof I=="number"||hi(I)&&Ti(I)==qe}function Oh(I){if(!hi(I)||Ti(I)!=Pe)return!1;var A=sI(I);if(A===null)return!0;var Z=pn.call(A,"constructor")&&A.constructor;return typeof Z=="function"&&Z instanceof Z&&Yl.call(Z)==Ga}var ly=Eu?ds(Eu):El;function cM(I){return Uw(I)&&I>=-_&&I<=_}var Qw=Du?ds(Du):rC;function fm(I){return typeof I=="string"||!Tt(I)&&hi(I)&&Ti(I)==O}function Qr(I){return typeof I=="symbol"||hi(I)&&Ti(I)==z}var fC=ma?ds(ma):Nh;function IM(I){return I===t}function uM(I){return hi(I)&&Vs(I)==Le}function CM(I){return hi(I)&&Ti(I)==Te}var dM=Bt(AI),hM=Bt(function(I,A){return I<=A});function jw(I){if(!I)return[];if(pr(I))return fm(I)?On(I):rs(I);if(_g&&I[_g])return Sl(I[_g]());var A=Vs(I),Z=A==Ve?$c:A==Zt?eI:mC;return Z(I)}function Xa(I){if(!I)return I===0?I:0;if(I=Yo(I),I===le||I===-le){var A=I<0?-1:1;return A*ne}return I===I?I:0}function jt(I){var A=Xa(I),Z=A%1;return A===A?Z?A-Z:A:0}function qw(I){return I?Eg(jt(I),0,q):0}function Yo(I){if(typeof I=="number")return I;if(Qr(I))return te;if(ii(I)){var A=typeof I.valueOf=="function"?I.valueOf():I;I=ii(A)?A+"":A}if(typeof I!="string")return I===0?I:+I;I=Pu(I);var Z=sn.test(I);return Z||nn.test(I)?LG(I.slice(2),Z?2:8):Qt.test(I)?te:+I}function $w(I){return Ar(I,fr(I))}function AM(I){return I?Eg(jt(I),-_,_):I===0?I:0}function yn(I){return I==null?"":is(I)}var pM=xa(function(I,A){if(Uh(A)||pr(A)){Ar(A,gs(A),I);return}for(var Z in A)pn.call(A,Z)&&Jr(I,Z,A[Z])}),eS=xa(function(I,A){Ar(A,fr(A),I)}),mm=xa(function(I,A,Z,H){Ar(A,fr(A),I,H)}),fM=xa(function(I,A,Z,H){Ar(A,gs(A),I,H)}),mM=Pt(nC);function bM(I,A){var Z=Ig(I);return A==null?Z:xh(Z,A)}var GM=Rt(function(I,A){I=Vt(I);var Z=-1,H=A.length,N=H>2?A[2]:t;for(N&&qs(A[0],A[1],N)&&(H=1);++Z<H;)for(var k=A[Z],ee=fr(k),ge=-1,de=ee.length;++ge<de;){var Me=ee[ge],Ke=I[Me];(Ke===t||dg(Ke,Xl[Me])&&!pn.call(I,Me))&&(I[Me]=k[Me])}return I}),yM=Rt(function(I){return I.push(t,Ze),Ln(tS,t,I)});function BM(I,A){return Ch(I,xt(A,3),Ps)}function vM(I,A){return Ch(I,xt(A,3),zl)}function ZM(I,A){return I==null?I:Ll(I,xt(A,3),fr)}function wM(I,A){return I==null?I:dI(I,xt(A,3),fr)}function SM(I,A){return I&&Ps(I,xt(A,3))}function RM(I,A){return I&&zl(I,xt(A,3))}function WM(I){return I==null?[]:Sa(I,gs(I))}function xM(I){return I==null?[]:Sa(I,fr(I))}function cy(I,A,Z){var H=I==null?t:Pr(I,A);return H===t?Z:H}function VM(I,A){return I!=null&&bw(I,A,tm)}function Iy(I,A){return I!=null&&bw(I,A,Yh)}var HM=Q(function(I,A,Z){A!=null&&typeof A.toString!="function"&&(A=Ds.call(A)),I[A]=Z},Cy(mr)),XM=Q(function(I,A,Z){A!=null&&typeof A.toString!="function"&&(A=Ds.call(A)),pn.call(I,A)?I[A].push(Z):I[A]=[Z]},xt),YM=Rt(Fn);function gs(I){return pr(I)?st(I):ts(I)}function fr(I){return pr(I)?st(I,!0):Mh(I)}function FM(I,A){var Z={};return A=xt(A,3),Ps(I,function(H,N,k){Wo(Z,A(H,N,k),H)}),Z}function NM(I,A){var Z={};return A=xt(A,3),Ps(I,function(H,N,k){Wo(Z,N,A(H,N,k))}),Z}var MM=xa(function(I,A,Z){Or(I,A,Z)}),tS=xa(function(I,A,Z,H){Or(I,A,Z,H)}),KM=Pt(function(I,A){var Z={};if(I==null)return Z;var H=!1;A=Xn(A,function(k){return k=Og(k,I),H||(H=k.length>1),k}),Ar(I,an(I),Z),H&&(Z=Us(Z,C|h|p,ot));for(var N=A.length;N--;)_h(Z,A[N]);return Z});function LM(I,A){return nS(I,Am(xt(A)))}var zM=Pt(function(I,A){return I==null?{}:mI(I,A)});function nS(I,A){if(I==null)return{};var Z=Xn(an(I),function(H){return[H]});return A=xt(A),aC(I,Z,function(H,N){return A(H,N[0])})}function _M(I,A,Z){A=Og(A,I);var H=-1,N=A.length;for(N||(N=1,I=t);++H<N;){var k=I==null?t:I[qg(A[H])];k===t&&(H=N,k=Z),I=Ha(k)?k.call(I):k}return I}function kM(I,A,Z){return I==null?I:Wa(I,A,Z)}function TM(I,A,Z,H){return H=typeof H=="function"?H:t,I==null?I:Wa(I,A,Z,H)}var iS=js(gs),sS=js(fr);function EM(I,A,Z){var H=Tt(I),N=H||Pl(I)||fC(I);if(A=xt(A,4),Z==null){var k=I&&I.constructor;N?Z=H?new k:[]:ii(I)?Z=Ha(k)?Ig(sI(I)):{}:Z={}}return(N?yi:Ps)(I,function(ee,ge,de){return A(Z,ee,ge,de)}),Z}function DM(I,A){return I==null?!0:_h(I,A)}function JM(I,A,Z){return I==null?I:kh(I,A,ss(Z))}function UM(I,A,Z,H){return H=typeof H=="function"?H:t,I==null?I:kh(I,A,ss(Z),H)}function mC(I){return I==null?[]:hs(I,gs(I))}function PM(I){return I==null?[]:hs(I,fr(I))}function OM(I,A,Z){return Z===t&&(Z=A,A=t),Z!==t&&(Z=Yo(Z),Z=Z===Z?Z:0),A!==t&&(A=Yo(A),A=A===A?A:0),Eg(Yo(I),A,Z)}function QM(I,A,Z){return A=Xa(A),Z===t?(Z=A,A=0):Z=Xa(Z),I=Yo(I),PG(I,A,Z)}function jM(I,A,Z){if(Z&&typeof Z!="boolean"&&qs(I,A,Z)&&(A=Z=t),Z===t&&(typeof A=="boolean"?(Z=A,A=t):typeof I=="boolean"&&(Z=I,I=t)),I===t&&A===t?(I=0,A=1):(I=Xa(I),A===t?(A=I,I=0):A=Xa(A)),I>A){var H=I;I=A,A=H}if(Z||I%1||A%1){var N=yh();return $i(I+N*(A-I+ff("1e-"+((N+"").length-1))),A)}return xo(I,A)}var qM=u(function(I,A,Z){return A=A.toLowerCase(),I+(Z?rS(A):A)});function rS(I){return uy(yn(I).toLowerCase())}function oS(I){return I=yn(I),I&&I.replace(Cs,Bf).replace(Xi,"")}function $M(I,A,Z){I=yn(I),A=is(A);var H=I.length;Z=Z===t?H:Eg(jt(Z),0,H);var N=Z;return Z-=A.length,Z>=0&&I.slice(Z,N)==A}function eK(I){return I=yn(I),I&&cn.test(I)?I.replace(at,vf):I}function tK(I){return I=yn(I),I&&nh.test(I)?I.replace(pl,"\\$&"):I}var nK=u(function(I,A,Z){return I+(Z?"-":"")+A.toLowerCase()}),iK=u(function(I,A,Z){return I+(Z?" ":"")+A.toLowerCase()}),sK=lm("toLowerCase");function rK(I,A,Z){I=yn(I),A=jt(A);var H=A?vo(I):0;if(!A||H>=A)return I;var N=(A-H)/2;return Je(gI(N),Z)+I+Je(oI(N),Z)}function oK(I,A,Z){I=yn(I),A=jt(A);var H=A?vo(I):0;return A&&H<A?I+Je(A-H,Z):I}function gK(I,A,Z){I=yn(I),A=jt(A);var H=A?vo(I):0;return A&&H<A?Je(A-H,Z)+I:I}function aK(I,A,Z){return Z||A==null?A=0:A&&(A=+A),Xf(yn(I).replace(fl,""),A||0)}function lK(I,A,Z){return(Z?qs(I,A,Z):A===t)?A=1:A=jt(A),Ul(yn(I),A)}function cK(){var I=arguments,A=yn(I[0]);return I.length<3?A:A.replace(I[1],I[2])}var IK=u(function(I,A,Z){return I+(Z?"_":"")+A.toLowerCase()});function uK(I,A,Z){return Z&&typeof Z!="number"&&qs(I,A,Z)&&(A=Z=t),Z=Z===t?q:Z>>>0,Z?(I=yn(I),I&&(typeof A=="string"||A!=null&&!ly(A))&&(A=is(A),!A&&ba(I))?Qg(On(I),0,Z):I.split(A,Z)):[]}var CK=u(function(I,A,Z){return I+(Z?" ":"")+uy(A)});function dK(I,A,Z){return I=yn(I),Z=Z==null?0:Eg(jt(Z),0,I.length),A=is(A),I.slice(Z,Z+A.length)==A}function hK(I,A,Z){var H=K.templateSettings;Z&&qs(I,A,Z)&&(A=t),I=yn(I),A=mm({},A,H,Ce);var N=mm({},A.imports,H.imports,Ce),k=gs(N),ee=hs(N,k),ge,de,Me=0,Ke=A.interpolate||Ss,_e="__p += '",rt=Yi((A.escape||Ss).source+"|"+Ke.source+"|"+(Ke===Nr?Nt:Ss).source+"|"+(A.evaluate||Ss).source+"|$","g"),ft="//# sourceURL="+(pn.call(A,"sourceURL")?(A.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Go+"]")+`
`;I.replace(rt,function(Xt,rn,In,jr,$s,qr){return In||(In=jr),_e+=I.slice(Me,qr).replace(rg,dh),rn&&(ge=!0,_e+=`' +
__e(`+rn+`) +
'`),$s&&(de=!0,_e+=`';
`+$s+`;
__p += '`),In&&(_e+=`' +
((__t = (`+In+`)) == null ? '' : __t) +
'`),Me=qr+Xt.length,Xt}),_e+=`';
`;var Ht=pn.call(A,"variable")&&A.variable;if(!Ht)_e=`with (obj) {
`+_e+`
}
`;else if(Ne.test(Ht))throw new Ft(g);_e=(de?_e.replace(Vn,""):_e).replace(Ie,"$1").replace(Se,"$1;"),_e="function("+(Ht||"obj")+`) {
`+(Ht?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ge?", __e = _.escape":"")+(de?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+_e+`return __p
}`;var qt=aS(function(){return Lt(k,ft+"return "+_e).apply(t,ee)});if(qt.source=_e,ay(qt))throw qt;return qt}function AK(I){return yn(I).toLowerCase()}function pK(I){return yn(I).toUpperCase()}function fK(I,A,Z){if(I=yn(I),I&&(Z||A===t))return Pu(I);if(!I||!(A=is(A)))return I;var H=On(I),N=On(A),k=Yn(H,N),ee=wl(H,N)+1;return Qg(H,k,ee).join("")}function mK(I,A,Z){if(I=yn(I),I&&(Z||A===t))return I.slice(0,xl(I)+1);if(!I||!(A=is(A)))return I;var H=On(I),N=wl(H,On(A))+1;return Qg(H,0,N).join("")}function bK(I,A,Z){if(I=yn(I),I&&(Z||A===t))return I.replace(fl,"");if(!I||!(A=is(A)))return I;var H=On(I),N=Yn(H,On(A));return Qg(H,N).join("")}function GK(I,A){var Z=M,H=L;if(ii(A)){var N="separator"in A?A.separator:N;Z="length"in A?jt(A.length):Z,H="omission"in A?is(A.omission):H}I=yn(I);var k=I.length;if(ba(I)){var ee=On(I);k=ee.length}if(Z>=k)return I;var ge=Z-vo(H);if(ge<1)return H;var de=ee?Qg(ee,0,ge).join(""):I.slice(0,ge);if(N===t)return de+H;if(ee&&(ge+=de.length-ge),ly(N)){if(I.slice(ge).search(N)){var Me,Ke=de;for(N.global||(N=Yi(N.source,yn(_t.exec(N))+"g")),N.lastIndex=0;Me=N.exec(Ke);)var _e=Me.index;de=de.slice(0,_e===t?ge:_e)}}else if(I.indexOf(is(N),ge)!=ge){var rt=de.lastIndexOf(N);rt>-1&&(de=de.slice(0,rt))}return de+H}function yK(I){return I=yn(I),I&&bt.test(I)?I.replace(ze,Vl):I}var BK=u(function(I,A,Z){return I+(Z?" ":"")+A.toUpperCase()}),uy=lm("toUpperCase");function gS(I,A,Z){return I=yn(I),A=Z?t:A,A===t?qc(I)?Hl(I):Gf(I):I.match(A)||[]}var aS=Rt(function(I,A){try{return Ln(I,t,A)}catch(Z){return ay(Z)?Z:new Ft(Z)}}),vK=Pt(function(I,A){return yi(A,function(Z){Z=qg(Z),Wo(I,Z,oy(I[Z],I))}),I});function ZK(I){var A=I==null?0:I.length,Z=xt();return I=A?Xn(I,function(H){if(typeof H[1]!="function")throw new As(o);return[Z(H[0]),H[1]]}):[],Rt(function(H){for(var N=-1;++N<A;){var k=I[N];if(Ln(k[0],this,H))return Ln(k[1],this,H)}})}function wK(I){return Vh(Us(I,C))}function Cy(I){return function(){return I}}function SK(I,A){return I==null||I!==I?A:I}var RK=x(),WK=x(!0);function mr(I){return I}function dy(I){return Dl(typeof I=="function"?I:Us(I,C))}function xK(I){return pI(Us(I,C))}function VK(I,A){return oC(I,Us(A,C))}var HK=Rt(function(I,A){return function(Z){return Fn(Z,I,A)}}),XK=Rt(function(I,A){return function(Z){return Fn(I,Z,A)}});function hy(I,A,Z){var H=gs(A),N=Sa(A,H);Z==null&&!(ii(A)&&(N.length||!H.length))&&(Z=A,A=I,I=this,N=Sa(A,gs(A)));var k=!(ii(Z)&&"chain"in Z)||!!Z.chain,ee=Ha(I);return yi(N,function(ge){var de=A[ge];I[ge]=de,ee&&(I.prototype[ge]=function(){var Me=this.__chain__;if(k||Me){var Ke=I(this.__wrapped__),_e=Ke.__actions__=rs(this.__actions__);return _e.push({func:de,args:arguments,thisArg:I}),Ke.__chain__=Me,Ke}return de.apply(I,zr([this.value()],arguments))})}),I}function YK(){return Ii._===this&&(Ii._=Ou),this}function Ay(){}function FK(I){return I=jt(I),Rt(function(A){return ug(A,I)})}var NK=Re(Xn),MK=Re(uh),KK=Re(Oc);function lS(I){return ey(I)?Ws(qg(I)):lC(I)}function LK(I){return function(A){return I==null?t:Pr(I,A)}}var zK=Mt(),_K=Mt(!0);function py(){return[]}function fy(){return!1}function kK(){return{}}function TK(){return""}function EK(){return!0}function DK(I,A){if(I=jt(I),I<1||I>_)return[];var Z=q,H=$i(I,q);A=xt(A),I-=q;for(var N=ag(H,A);++Z<I;)A(Z);return N}function JK(I){return Tt(I)?Xn(I,qg):Qr(I)?[I]:rs(Ww(yn(I)))}function UK(I){var A=++ph;return yn(I)+A}var PK=ce(function(I,A){return I+A},0),OK=ht("ceil"),QK=ce(function(I,A){return I/A},1),jK=ht("floor");function qK(I){return I&&I.length?CI(I,mr,hI):t}function $K(I,A){return I&&I.length?CI(I,xt(A,2),hI):t}function eL(I){return jc(I,mr)}function tL(I,A){return jc(I,xt(A,2))}function nL(I){return I&&I.length?CI(I,mr,AI):t}function iL(I,A){return I&&I.length?CI(I,xt(A,2),AI):t}var sL=ce(function(I,A){return I*A},1),rL=ht("round"),oL=ce(function(I,A){return I-A},0);function gL(I){return I&&I.length?kr(I,mr):0}function aL(I,A){return I&&I.length?kr(I,xt(A,2)):0}return K.after=xN,K.ary=zw,K.assign=pM,K.assignIn=eS,K.assignInWith=mm,K.assignWith=fM,K.at=mM,K.before=_w,K.bind=oy,K.bindAll=vK,K.bindKey=kw,K.castArray=kN,K.chain=Mw,K.chunk=jY,K.compact=qY,K.concat=$Y,K.cond=ZK,K.conforms=wK,K.constant=Cy,K.countBy=gN,K.create=bM,K.curry=Tw,K.curryRight=Ew,K.debounce=Dw,K.defaults=GM,K.defaultsDeep=yM,K.defer=VN,K.delay=HN,K.difference=eF,K.differenceBy=tF,K.differenceWith=nF,K.drop=iF,K.dropRight=sF,K.dropRightWhile=rF,K.dropWhile=oF,K.fill=gF,K.filter=lN,K.flatMap=uN,K.flatMapDeep=CN,K.flatMapDepth=dN,K.flatten=Xw,K.flattenDeep=aF,K.flattenDepth=lF,K.flip=XN,K.flow=RK,K.flowRight=WK,K.fromPairs=cF,K.functions=WM,K.functionsIn=xM,K.groupBy=hN,K.initial=uF,K.intersection=CF,K.intersectionBy=dF,K.intersectionWith=hF,K.invert=HM,K.invertBy=XM,K.invokeMap=pN,K.iteratee=dy,K.keyBy=fN,K.keys=gs,K.keysIn=fr,K.map=Cm,K.mapKeys=FM,K.mapValues=NM,K.matches=xK,K.matchesProperty=VK,K.memoize=hm,K.merge=MM,K.mergeWith=tS,K.method=HK,K.methodOf=XK,K.mixin=hy,K.negate=Am,K.nthArg=FK,K.omit=KM,K.omitBy=LM,K.once=YN,K.orderBy=mN,K.over=NK,K.overArgs=FN,K.overEvery=MK,K.overSome=KK,K.partial=gy,K.partialRight=Jw,K.partition=bN,K.pick=zM,K.pickBy=nS,K.property=lS,K.propertyOf=LK,K.pull=mF,K.pullAll=Fw,K.pullAllBy=bF,K.pullAllWith=GF,K.pullAt=yF,K.range=zK,K.rangeRight=_K,K.rearg=NN,K.reject=BN,K.remove=BF,K.rest=MN,K.reverse=sy,K.sampleSize=ZN,K.set=kM,K.setWith=TM,K.shuffle=wN,K.slice=vF,K.sortBy=WN,K.sortedUniq=VF,K.sortedUniqBy=HF,K.split=uK,K.spread=KN,K.tail=XF,K.take=YF,K.takeRight=FF,K.takeRightWhile=NF,K.takeWhile=MF,K.tap=qF,K.throttle=LN,K.thru=um,K.toArray=jw,K.toPairs=iS,K.toPairsIn=sS,K.toPath=JK,K.toPlainObject=$w,K.transform=EM,K.unary=zN,K.union=KF,K.unionBy=LF,K.unionWith=zF,K.uniq=_F,K.uniqBy=kF,K.uniqWith=TF,K.unset=DM,K.unzip=ry,K.unzipWith=Nw,K.update=JM,K.updateWith=UM,K.values=mC,K.valuesIn=PM,K.without=EF,K.words=gS,K.wrap=_N,K.xor=DF,K.xorBy=JF,K.xorWith=UF,K.zip=PF,K.zipObject=OF,K.zipObjectDeep=QF,K.zipWith=jF,K.entries=iS,K.entriesIn=sS,K.extend=eS,K.extendWith=mm,hy(K,K),K.add=PK,K.attempt=aS,K.camelCase=qM,K.capitalize=rS,K.ceil=OK,K.clamp=OM,K.clone=TN,K.cloneDeep=DN,K.cloneDeepWith=JN,K.cloneWith=EN,K.conformsTo=UN,K.deburr=oS,K.defaultTo=SK,K.divide=QK,K.endsWith=$M,K.eq=dg,K.escape=eK,K.escapeRegExp=tK,K.every=aN,K.find=cN,K.findIndex=Vw,K.findKey=BM,K.findLast=IN,K.findLastIndex=Hw,K.findLastKey=vM,K.floor=jK,K.forEach=Kw,K.forEachRight=Lw,K.forIn=ZM,K.forInRight=wM,K.forOwn=SM,K.forOwnRight=RM,K.get=cy,K.gt=PN,K.gte=ON,K.has=VM,K.hasIn=Iy,K.head=Yw,K.identity=mr,K.includes=AN,K.indexOf=IF,K.inRange=QM,K.invoke=YM,K.isArguments=ZI,K.isArray=Tt,K.isArrayBuffer=QN,K.isArrayLike=pr,K.isArrayLikeObject=wi,K.isBoolean=jN,K.isBuffer=Pl,K.isDate=qN,K.isElement=$N,K.isEmpty=eM,K.isEqual=tM,K.isEqualWith=nM,K.isError=ay,K.isFinite=iM,K.isFunction=Ha,K.isInteger=Uw,K.isLength=pm,K.isMap=Pw,K.isMatch=sM,K.isMatchWith=rM,K.isNaN=oM,K.isNative=gM,K.isNil=lM,K.isNull=aM,K.isNumber=Ow,K.isObject=ii,K.isObjectLike=hi,K.isPlainObject=Oh,K.isRegExp=ly,K.isSafeInteger=cM,K.isSet=Qw,K.isString=fm,K.isSymbol=Qr,K.isTypedArray=fC,K.isUndefined=IM,K.isWeakMap=uM,K.isWeakSet=CM,K.join=AF,K.kebabCase=nK,K.last=Xo,K.lastIndexOf=pF,K.lowerCase=iK,K.lowerFirst=sK,K.lt=dM,K.lte=hM,K.max=qK,K.maxBy=$K,K.mean=eL,K.meanBy=tL,K.min=nL,K.minBy=iL,K.stubArray=py,K.stubFalse=fy,K.stubObject=kK,K.stubString=TK,K.stubTrue=EK,K.multiply=sL,K.nth=fF,K.noConflict=YK,K.noop=Ay,K.now=dm,K.pad=rK,K.padEnd=oK,K.padStart=gK,K.parseInt=aK,K.random=jM,K.reduce=GN,K.reduceRight=yN,K.repeat=lK,K.replace=cK,K.result=_M,K.round=rL,K.runInContext=ae,K.sample=vN,K.size=SN,K.snakeCase=IK,K.some=RN,K.sortedIndex=ZF,K.sortedIndexBy=wF,K.sortedIndexOf=SF,K.sortedLastIndex=RF,K.sortedLastIndexBy=WF,K.sortedLastIndexOf=xF,K.startCase=CK,K.startsWith=dK,K.subtract=oL,K.sum=gL,K.sumBy=aL,K.template=hK,K.times=DK,K.toFinite=Xa,K.toInteger=jt,K.toLength=qw,K.toLower=AK,K.toNumber=Yo,K.toSafeInteger=AM,K.toString=yn,K.toUpper=pK,K.trim=fK,K.trimEnd=mK,K.trimStart=bK,K.truncate=GK,K.unescape=yK,K.uniqueId=UK,K.upperCase=BK,K.upperFirst=uy,K.each=Kw,K.eachRight=Lw,K.first=Yw,hy(K,function(){var I={};return Ps(K,function(A,Z){pn.call(K.prototype,Z)||(I[Z]=A)}),I}(),{chain:!1}),K.VERSION=n,yi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(I){K[I].placeholder=K}),yi(["drop","take"],function(I,A){Wt.prototype[I]=function(Z){Z=Z===t?1:vi(jt(Z),0);var H=this.__filtered__&&!A?new Wt(this):this.clone();return H.__filtered__?H.__takeCount__=$i(Z,H.__takeCount__):H.__views__.push({size:$i(Z,q),type:I+(H.__dir__<0?"Right":"")}),H},Wt.prototype[I+"Right"]=function(Z){return this.reverse()[I](Z).reverse()}}),yi(["filter","map","takeWhile"],function(I,A){var Z=A+1,H=Z==$||Z==he;Wt.prototype[I]=function(N){var k=this.clone();return k.__iteratees__.push({iteratee:xt(N,3),type:Z}),k.__filtered__=k.__filtered__||H,k}}),yi(["head","last"],function(I,A){var Z="take"+(A?"Right":"");Wt.prototype[I]=function(){return this[Z](1).value()[0]}}),yi(["initial","tail"],function(I,A){var Z="drop"+(A?"":"Right");Wt.prototype[I]=function(){return this.__filtered__?new Wt(this):this[Z](1)}}),Wt.prototype.compact=function(){return this.filter(mr)},Wt.prototype.find=function(I){return this.filter(I).head()},Wt.prototype.findLast=function(I){return this.reverse().find(I)},Wt.prototype.invokeMap=Rt(function(I,A){return typeof I=="function"?new Wt(this):this.map(function(Z){return Fn(Z,I,A)})}),Wt.prototype.reject=function(I){return this.filter(Am(xt(I)))},Wt.prototype.slice=function(I,A){I=jt(I);var Z=this;return Z.__filtered__&&(I>0||A<0)?new Wt(Z):(I<0?Z=Z.takeRight(-I):I&&(Z=Z.drop(I)),A!==t&&(A=jt(A),Z=A<0?Z.dropRight(-A):Z.take(A-I)),Z)},Wt.prototype.takeRightWhile=function(I){return this.reverse().takeWhile(I).reverse()},Wt.prototype.toArray=function(){return this.take(q)},Ps(Wt.prototype,function(I,A){var Z=/^(?:filter|find|map|reject)|While$/.test(A),H=/^(?:head|last)$/.test(A),N=K[H?"take"+(A=="last"?"Right":""):A],k=H||/^find/.test(A);N&&(K.prototype[A]=function(){var ee=this.__wrapped__,ge=H?[1]:arguments,de=ee instanceof Wt,Me=ge[0],Ke=de||Tt(ee),_e=function(rn){var In=N.apply(K,zr([rn],ge));return H&&rt?In[0]:In};Ke&&Z&&typeof Me=="function"&&Me.length!=1&&(de=Ke=!1);var rt=this.__chain__,ft=!!this.__actions__.length,Ht=k&&!rt,qt=de&&!ft;if(!k&&Ke){ee=qt?ee:new Wt(this);var Xt=I.apply(ee,ge);return Xt.__actions__.push({func:um,args:[_e],thisArg:t}),new es(Xt,rt)}return Ht&&qt?I.apply(this,ge):(Xt=this.thru(_e),Ht?H?Xt.value()[0]:Xt.value():Xt)})}),yi(["pop","push","shift","sort","splice","unshift"],function(I){var A=Lg[I],Z=/^(?:push|sort|unshift)$/.test(I)?"tap":"thru",H=/^(?:pop|shift)$/.test(I);K.prototype[I]=function(){var N=arguments;if(H&&!this.__chain__){var k=this.value();return A.apply(Tt(k)?k:[],N)}return this[Z](function(ee){return A.apply(Tt(ee)?ee:[],N)})}}),Ps(Wt.prototype,function(I,A){var Z=K[A];if(Z){var H=Z.name+"";pn.call(va,H)||(va[H]=[]),va[H].push({name:A,func:Z})}}),va[F(t,y).name]=[{name:"wrapper",func:t}],Wt.prototype.clone=kG,Wt.prototype.reverse=TG,Wt.prototype.value=Js,K.prototype.at=$F,K.prototype.chain=eN,K.prototype.commit=tN,K.prototype.next=nN,K.prototype.plant=sN,K.prototype.reverse=rN,K.prototype.toJSON=K.prototype.valueOf=K.prototype.value=oN,K.prototype.first=K.prototype.head,_g&&(K.prototype[_g]=iN),K},Kg=Sf();zi?((zi.exports=Kg)._=Kg,lh._=Kg):Ii._=Kg}).call(Da)})(Eb,Eb.exports);var m6=Eb.exports,hw={exports:{}},yd=typeof Reflect=="object"?Reflect:null,_3=yd&&typeof yd.apply=="function"?yd.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},rb;yd&&typeof yd.ownKeys=="function"?rb=yd.ownKeys:Object.getOwnPropertySymbols?rb=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:rb=function(e){return Object.getOwnPropertyNames(e)};function b6(i){console&&console.warn&&console.warn(i)}var lY=Number.isNaN||function(e){return e!==e};function xn(){xn.init.call(this)}hw.exports=xn;hw.exports.once=v6;xn.EventEmitter=xn;xn.prototype._events=void 0;xn.prototype._eventsCount=0;xn.prototype._maxListeners=void 0;var k3=10;function HG(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(xn,"defaultMaxListeners",{enumerable:!0,get:function(){return k3},set:function(i){if(typeof i!="number"||i<0||lY(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");k3=i}});xn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};xn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||lY(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function cY(i){return i._maxListeners===void 0?xn.defaultMaxListeners:i._maxListeners}xn.prototype.getMaxListeners=function(){return cY(this)};xn.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=e==="error",r=this._events;if(r!==void 0)s=s&&r.error===void 0;else if(!s)return!1;if(s){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var g=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw g.context=o,g}var a=r[e];if(a===void 0)return!1;if(typeof a=="function")_3(a,this,t);else for(var l=a.length,c=hY(a,l),n=0;n<l;++n)_3(c[n],this,t);return!0};function IY(i,e,t,n){var s,r,o;if(HG(t),r=i._events,r===void 0?(r=i._events=Object.create(null),i._eventsCount=0):(r.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),r=i._events),o=r[e]),o===void 0)o=r[e]=t,++i._eventsCount;else if(typeof o=="function"?o=r[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),s=cY(i),s>0&&o.length>s&&!o.warned){o.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=i,g.type=e,g.count=o.length,b6(g)}return i}xn.prototype.addListener=function(e,t){return IY(this,e,t,!1)};xn.prototype.on=xn.prototype.addListener;xn.prototype.prependListener=function(e,t){return IY(this,e,t,!0)};function G6(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function uY(i,e,t){var n={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},s=G6.bind(n);return s.listener=t,n.wrapFn=s,s}xn.prototype.once=function(e,t){return HG(t),this.on(e,uY(this,e,t)),this};xn.prototype.prependOnceListener=function(e,t){return HG(t),this.prependListener(e,uY(this,e,t)),this};xn.prototype.removeListener=function(e,t){var n,s,r,o,g;if(HG(t),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){g=n[o].listener,r=o;break}if(r<0)return this;r===0?n.shift():y6(n,r),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,g||t)}return this};xn.prototype.off=xn.prototype.removeListener;xn.prototype.removeAllListeners=function(e){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var r=Object.keys(n),o;for(s=0;s<r.length;++s)o=r[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function CY(i,e,t){var n=i._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?B6(s):hY(s,s.length)}xn.prototype.listeners=function(e){return CY(this,e,!0)};xn.prototype.rawListeners=function(e){return CY(this,e,!1)};xn.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):dY.call(i,e)};xn.prototype.listenerCount=dY;function dY(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}xn.prototype.eventNames=function(){return this._eventsCount>0?rb(this._events):[]};function hY(i,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=i[n];return t}function y6(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function B6(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function v6(i,e){return new Promise(function(t,n){function s(o){i.removeListener(e,r),n(o)}function r(){typeof i.removeListener=="function"&&i.removeListener("error",s),t([].slice.call(arguments))}AY(i,e,r,{once:!0}),e!=="error"&&Z6(i,s,{once:!0})})}function Z6(i,e,t){typeof i.on=="function"&&AY(i,"error",e,t)}function AY(i,e,t,n){if(typeof i.on=="function")n.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function s(r){n.once&&i.removeEventListener(e,s),t(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var w6=hw.exports;function S6(i,e){var t=atob(i);if(e){for(var n=new Uint8Array(t.length),s=0,r=t.length;s<r;++s)n[s]=t.charCodeAt(s);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return t}function R6(i,e,t){var n=e===void 0?null:e,s=t===void 0?!1:t,r=S6(i,s),o=r.indexOf(`
`,10)+1,g=r.substring(o)+(n?"//# sourceMappingURL="+n:""),a=new Blob([g],{type:"application/javascript"});return URL.createObjectURL(a)}function W6(i,e,t){var n;return function(r){return n=n||R6(i,e,t),new Worker(n,r)}}var x6=W6("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQGZ1bmN0aW9uCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy51dWlkCiAgICogQHBhcmFtIHtCb2R5UHJvcHN9IG9wdGlvbnMucHJvcHMKICAgKiBAcGFyYW0ge0JvZHlTaGFwZVR5cGV9IG9wdGlvbnMudHlwZQogICAqIEBwYXJhbSB7KG1hdGVyaWFsT3B0aW9uczogTWF0ZXJpYWxPcHRpb25zKSA9PiBNYXRlcmlhbCA9fSBvcHRpb25zLmNyZWF0ZU1hdGVyaWFsCiAgICogQHJldHVybnMge0JvZHl9CiAgICovCiAgY29uc3QgcHJvcHNUb0JvZHkgPSBvcHRpb25zID0+IHsKICAgIGNvbnN0IHsKICAgICAgdXVpZCwKICAgICAgcHJvcHMsCiAgICAgIHR5cGUsCiAgICAgIGNyZWF0ZU1hdGVyaWFsID0gbWF0ZXJpYWxPcHRpb25zID0+IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpCiAgICB9ID0gb3B0aW9uczsKICAgIGNvbnN0IHsKICAgICAgYW5ndWxhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgYW5ndWxhclZlbG9jaXR5ID0gWzAsIDAsIDBdLAogICAgICBhcmdzID0gW10sCiAgICAgIGNvbGxpc2lvblJlc3BvbnNlLAogICAgICBsaW5lYXJGYWN0b3IgPSBbMSwgMSwgMV0sCiAgICAgIG1hc3MsCiAgICAgIG1hdGVyaWFsLAogICAgICBvbkNvbGxpZGUsCiAgICAgIHBvc2l0aW9uID0gWzAsIDAsIDBdLAogICAgICByb3RhdGlvbiA9IFswLCAwLCAwXSwKICAgICAgc2hhcGVzLAogICAgICB0eXBlOiBib2R5VHlwZSwKICAgICAgdmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIC4uLmV4dHJhCiAgICB9ID0gcHJvcHM7CiAgICBjb25zdCBib2R5ID0gbmV3IEJvZHkoewogICAgICAuLi5leHRyYSwKICAgICAgbWFzczogYm9keVR5cGUgPT09ICdTdGF0aWMnID8gMCA6IG1hc3MsCiAgICAgIG1hdGVyaWFsOiBtYXRlcmlhbCA/IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKSA6IHVuZGVmaW5lZCwKICAgICAgdHlwZTogYm9keVR5cGUgPyBCb2R5W2JvZHlUeXBlLnRvVXBwZXJDYXNlKCldIDogdW5kZWZpbmVkCiAgICB9KTsKICAgIGJvZHkudXVpZCA9IHV1aWQ7CiAgICBpZiAoY29sbGlzaW9uUmVzcG9uc2UgIT09IHVuZGVmaW5lZCkgewogICAgICBib2R5LmNvbGxpc2lvblJlc3BvbnNlID0gY29sbGlzaW9uUmVzcG9uc2U7CiAgICB9CiAgICBpZiAodHlwZSA9PT0gJ0NvbXBvdW5kJykgewogICAgICBzaGFwZXMuZm9yRWFjaChfcmVmMyA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBhcmdzLAogICAgICAgICAgcG9zaXRpb24sCiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjM7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHJvdGF0aW9uID8gbmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pIDogdW5kZWZpbmVkKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKHJvdGF0aW9uWzBdLCByb3RhdGlvblsxXSwgcm90YXRpb25bMl0pOwogICAgYm9keS52ZWxvY2l0eS5zZXQodmVsb2NpdHlbMF0sIHZlbG9jaXR5WzFdLCB2ZWxvY2l0eVsyXSk7CiAgICBib2R5LmFuZ3VsYXJWZWxvY2l0eS5zZXQoYW5ndWxhclZlbG9jaXR5WzBdLCBhbmd1bGFyVmVsb2NpdHlbMV0sIGFuZ3VsYXJWZWxvY2l0eVsyXSk7CiAgICBib2R5LmxpbmVhckZhY3Rvci5zZXQobGluZWFyRmFjdG9yWzBdLCBsaW5lYXJGYWN0b3JbMV0sIGxpbmVhckZhY3RvclsyXSk7CiAgICBib2R5LmFuZ3VsYXJGYWN0b3Iuc2V0KGFuZ3VsYXJGYWN0b3JbMF0sIGFuZ3VsYXJGYWN0b3JbMV0sIGFuZ3VsYXJGYWN0b3JbMl0pOwogICAgcmV0dXJuIGJvZHk7CiAgfTsKCiAgY29uc3QgYWRkQm9kaWVzID0gKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHMsCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1dWlkLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IGJvZHkgPSBwcm9wc1RvQm9keSh7CiAgICAgICAgY3JlYXRlTWF0ZXJpYWwsCiAgICAgICAgcHJvcHM6IHByb3BzW2ldLAogICAgICAgIHR5cGUsCiAgICAgICAgdXVpZDogdXVpZFtpXQogICAgICB9KTsKICAgICAgc3RhdGUud29ybGQuYWRkQm9keShib2R5KTsKICAgICAgaWYgKHByb3BzW2ldLm9uQ29sbGlkZSkgYm9keS5hZGRFdmVudExpc3RlbmVyKCdjb2xsaWRlJywgX3JlZjIgPT4gewogICAgICAgIGxldCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgYm9keSwKICAgICAgICAgIHRhcmdldCwKICAgICAgICAgIGNvbnRhY3QKICAgICAgICB9ID0gX3JlZjI7CiAgICAgICAgaWYgKCFib2R5LnV1aWQgfHwgIXRhcmdldC51dWlkKSByZXR1cm47CiAgICAgICAgY29uc3QgewogICAgICAgICAgbmksCiAgICAgICAgICByaSwKICAgICAgICAgIHJqLAogICAgICAgICAgYmksCiAgICAgICAgICBiaiwKICAgICAgICAgIGlkCiAgICAgICAgfSA9IGNvbnRhY3Q7CiAgICAgICAgY29uc3QgY29udGFjdFBvaW50ID0gYmkucG9zaXRpb24udmFkZChyaSk7CiAgICAgICAgY29uc3QgY29udGFjdE5vcm1hbCA9IGJpID09PSBib2R5ID8gbmkgOiBuaS5zY2FsZSgtMSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBib2R5OiBib2R5LnV1aWQsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJzOiB7CiAgICAgICAgICAgIGJvZHlGaWx0ZXJHcm91cDogYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgYm9keUZpbHRlck1hc2s6IGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyR3JvdXA6IHRhcmdldC5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyTWFzazogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAgICAgIH0sCiAgICAgICAgICBjb250YWN0OiB7CiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogdXNlIGlkIGluc3RlYWQgb2YgdXVpZAogICAgICAgICAgICBiaTogYmkudXVpZCwKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJqOiBiai51dWlkLAogICAgICAgICAgICAvLyBOb3JtYWwgb2YgdGhlIGNvbnRhY3QsIHJlbGF0aXZlIHRvIHRoZSBjb2xsaWRpbmcgYm9keQogICAgICAgICAgICBjb250YWN0Tm9ybWFsOiBjb250YWN0Tm9ybWFsLnRvQXJyYXkoKSwKICAgICAgICAgICAgLy8gV29ybGQgcG9zaXRpb24gb2YgdGhlIGNvbnRhY3QKICAgICAgICAgICAgY29udGFjdFBvaW50OiBjb250YWN0UG9pbnQudG9BcnJheSgpLAogICAgICAgICAgICBpZCwKICAgICAgICAgICAgaW1wYWN0VmVsb2NpdHk6IGNvbnRhY3QuZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpLAogICAgICAgICAgICBuaTogbmkudG9BcnJheSgpLAogICAgICAgICAgICByaTogcmkudG9BcnJheSgpLAogICAgICAgICAgICByajogcmoudG9BcnJheSgpCiAgICAgICAgICB9LAogICAgICAgICAgb3A6ICdldmVudCcsCiAgICAgICAgICB0YXJnZXQ6IHRhcmdldC51dWlkLAogICAgICAgICAgdHlwZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9OwoKICBjb25zdCB0cmlwbGV0VG9WZWMzID0gdCA9PiB0ID8gbmV3IFZlYzMoLi4udCkgOiB1bmRlZmluZWQ7CgogIGNvbnN0IGFkZENvbnN0cmFpbnQgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgYW5nbGUsCiAgICAgICAgYXhpc0EsCiAgICAgICAgYXhpc0IsCiAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICBkaXN0YW5jZSwKICAgICAgICBtYXhGb3JjZSwKICAgICAgICBtYXhNdWx0aXBsaWVyLAogICAgICAgIHBpdm90QSwKICAgICAgICBwaXZvdEIsCiAgICAgICAgdHdpc3RBbmdsZSwKICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgfV0sCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgbGV0IGNvbnN0cmFpbnQ7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnUG9pbnRUb1BvaW50JzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IFBvaW50VG9Qb2ludENvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgdHJpcGxldFRvVmVjMyhwaXZvdEEpLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB0cmlwbGV0VG9WZWMzKHBpdm90QiksIG1heEZvcmNlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnQ29uZVR3aXN0JzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IENvbmVUd2lzdENvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgYW5nbGUsCiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpLAogICAgICAgICAgdHdpc3RBbmdsZQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdIaW5nZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBIaW5nZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgYXhpc0E6IHRyaXBsZXRUb1ZlYzMoYXhpc0EpLAogICAgICAgICAgYXhpc0I6IHRyaXBsZXRUb1ZlYzMoYXhpc0IpLAogICAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICAgIG1heEZvcmNlLAogICAgICAgICAgcGl2b3RBOiB0cmlwbGV0VG9WZWMzKHBpdm90QSksCiAgICAgICAgICBwaXZvdEI6IHRyaXBsZXRUb1ZlYzMocGl2b3RCKQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdEaXN0YW5jZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBEaXN0YW5jZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgZGlzdGFuY2UsIG1heEZvcmNlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnTG9jayc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBMb2NrQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBtYXhGb3JjZQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgd2FrZVVwQm9kaWVzCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdHJhaW50LnV1aWQgPSB1dWlkOwogICAgc3RhdGUud29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KTsKICAgIGlmIChtYXhNdWx0aXBsaWVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgY29uc3QgcG9zdFN0ZXBDb25zdHJhaW50ID0gKCkgPT4gewogICAgICAgIC8vIFRoZSBtdWx0aXBsaWVyIGlzIHByb3BvcnRpb25hbCB0byBob3cgbXVjaCBmb3JjZSBpcyBhZGRlZCB0byB0aGUgYm9kaWVzIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICAgIC8vIElmIHRoaXMgZXhjZWVkcyBhIGxpbWl0IHRoZSBjb25zdHJhaW50IGlzIGRpc2FibGVkLgogICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBNYXRoLmFicyhjb25zdHJhaW50LmVxdWF0aW9uc1swXS5tdWx0aXBsaWVyKTsKICAgICAgICBpZiAobXVsdGlwbGllciA+IG1heE11bHRpcGxpZXIpIHsKICAgICAgICAgIGNvbnN0cmFpbnQuZGlzYWJsZSgpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgc3RhdGUuY29uc3RyYWludHNbdXVpZF0gPSBwb3N0U3RlcENvbnN0cmFpbnQ7CiAgICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuY29uc3RyYWludHNbdXVpZF0pOwogICAgfQogIH07CgogIGZ1bmN0aW9uIHRvVXBwZXJjYXNlKHN0cikgewogICAgcmV0dXJuIHN0ci50b1VwcGVyQ2FzZSgpOwogIH0KICBjb25zdCBhZGRSYXkgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiB7CiAgICAgICAgZnJvbSwKICAgICAgICBtb2RlLAogICAgICAgIHRvLAogICAgICAgIC4uLnJheU9wdGlvbnMKICAgICAgfSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBjb25zdCByYXkgPSBuZXcgUmF5KHRyaXBsZXRUb1ZlYzMoZnJvbSksIHRyaXBsZXRUb1ZlYzModG8pKTsKICAgIGNvbnN0IG9wdGlvbnMgPSB7CiAgICAgIG1vZGU6IFJBWV9NT0RFU1t0b1VwcGVyY2FzZShtb2RlKV0sCiAgICAgIHJlc3VsdDogbmV3IFJheWNhc3RSZXN1bHQoKSwKICAgICAgLi4ucmF5T3B0aW9ucwogICAgfTsKICAgIHN0YXRlLnJheXNbdXVpZF0gPSAoKSA9PiB7CiAgICAgIHJheS5pbnRlcnNlY3RXb3JsZChzdGF0ZS53b3JsZCwgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy5yZXN1bHQgfHwgIW9wdGlvbnMucmVzdWx0LmJvZHkpIHJldHVybjsKICAgICAgY29uc3QgewogICAgICAgIGJvZHksCiAgICAgICAgc2hhcGUsCiAgICAgICAgcmF5RnJvbVdvcmxkLAogICAgICAgIHJheVRvV29ybGQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQsCiAgICAgICAgaGl0UG9pbnRXb3JsZCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSBvcHRpb25zLnJlc3VsdDsKICAgICAgY29uc3QgYm9keVVVSUQgPSBib2R5LnV1aWQ7CiAgICAgIGlmICghYm9keVVVSUQpIHJldHVybjsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgYm9keTogYm9keVVVSUQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQ6IGhpdE5vcm1hbFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBoaXRQb2ludFdvcmxkOiBoaXRQb2ludFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICByYXk6IHsKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlckdyb3VwOiByYXkuY29sbGlzaW9uRmlsdGVyR3JvdXAsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJNYXNrOiByYXkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgIGRpcmVjdGlvbjogcmF5LmRpcmVjdGlvbi50b0FycmF5KCksCiAgICAgICAgICBmcm9tLAogICAgICAgICAgdG8sCiAgICAgICAgICB1dWlkCiAgICAgICAgfSwKICAgICAgICByYXlGcm9tV29ybGQ6IHJheUZyb21Xb3JsZC50b0FycmF5KCksCiAgICAgICAgcmF5VG9Xb3JsZDogcmF5VG9Xb3JsZC50b0FycmF5KCksCiAgICAgICAgc2hhcGU6IHNoYXBlID8gewogICAgICAgICAgLi4uc2hhcGUsCiAgICAgICAgICBib2R5OiBib2R5VVVJRAogICAgICAgIH0gOiBudWxsLAogICAgICAgIHR5cGU6ICdyYXloaXQnLAogICAgICAgIC4uLnJlc3QKICAgICAgfSk7CiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnJheXNbdXVpZF0pOwogIH07CgogIGNvbnN0IGFkZFJheWNhc3RWZWhpY2xlID0gKHN0YXRlLCBkYXRhKSA9PiB7CiAgICBjb25zdCBbY2hhc3Npc0JvZHksIHdoZWVscywgd2hlZWxJbmZvcywgaW5kZXhGb3J3YXJkQXhpcywgaW5kZXhSaWdodEF4aXMsIGluZGV4VXBBeGlzXSA9IGRhdGEucHJvcHM7CiAgICBjb25zdCB2ZWhpY2xlID0gbmV3IFJheWNhc3RWZWhpY2xlKHsKICAgICAgY2hhc3Npc0JvZHk6IHN0YXRlLmJvZGllc1tjaGFzc2lzQm9keV0sCiAgICAgIGluZGV4Rm9yd2FyZEF4aXMsCiAgICAgIGluZGV4UmlnaHRBeGlzLAogICAgICBpbmRleFVwQXhpcwogICAgfSk7CiAgICB2ZWhpY2xlLndvcmxkID0gc3RhdGUud29ybGQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdoZWVsSW5mb3MubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgewogICAgICAgIGF4bGVMb2NhbCwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwsCiAgICAgICAgZGlyZWN0aW9uTG9jYWwsCiAgICAgICAgLi4ucmVzdAogICAgICB9ID0gd2hlZWxJbmZvc1tpXTsKICAgICAgdmVoaWNsZS5hZGRXaGVlbCh7CiAgICAgICAgYXhsZUxvY2FsOiB0cmlwbGV0VG9WZWMzKGF4bGVMb2NhbCksCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsOiB0cmlwbGV0VG9WZWMzKGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IHRyaXBsZXRUb1ZlYzMoZGlyZWN0aW9uTG9jYWwpLAogICAgICAgIC4uLnJlc3QKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBwcmVTdGVwID0gKCkgPT4gewogICAgICB2ZWhpY2xlLnVwZGF0ZVZlaGljbGUoc3RhdGUud29ybGQuZHQpOwogICAgfTsKICAgIGNvbnN0IHBvc3RTdGVwID0gKCkgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlaGljbGUud2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZlaGljbGUudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgICAgY29uc3QgdCA9IHZlaGljbGUud2hlZWxJbmZvc1tpXS53b3JsZFRyYW5zZm9ybTsKICAgICAgICBjb25zdCB3aGVlbEJvZHkgPSBzdGF0ZS5ib2RpZXNbd2hlZWxzW2ldXTsKICAgICAgICB3aGVlbEJvZHkucG9zaXRpb24uY29weSh0LnBvc2l0aW9uKTsKICAgICAgICB3aGVlbEJvZHkucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbik7CiAgICAgIH0KICAgIH07CiAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdID0gewogICAgICBwb3N0U3RlcCwKICAgICAgcHJlU3RlcCwKICAgICAgdmVoaWNsZQogICAgfTsKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBwcmVTdGVwKTsKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgcG9zdFN0ZXApOwogIH07CgogIGNvbnN0IGFkZFNwcmluZyA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBkYW1waW5nLAogICAgICAgIGxvY2FsQW5jaG9yQSwKICAgICAgICBsb2NhbEFuY2hvckIsCiAgICAgICAgcmVzdExlbmd0aCwKICAgICAgICBzdGlmZm5lc3MsCiAgICAgICAgd29ybGRBbmNob3JBLAogICAgICAgIHdvcmxkQW5jaG9yQgogICAgICB9XSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBjb25zdCBzcHJpbmcgPSBuZXcgU3ByaW5nKHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgZGFtcGluZywKICAgICAgbG9jYWxBbmNob3JBOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQSksCiAgICAgIGxvY2FsQW5jaG9yQjogdHJpcGxldFRvVmVjMyhsb2NhbEFuY2hvckIpLAogICAgICByZXN0TGVuZ3RoLAogICAgICBzdGlmZm5lc3MsCiAgICAgIHdvcmxkQW5jaG9yQTogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckEpLAogICAgICB3b3JsZEFuY2hvckI6IHRyaXBsZXRUb1ZlYzMod29ybGRBbmNob3JCKQogICAgfSk7CiAgICBzcHJpbmcudXVpZCA9IHV1aWQ7CiAgICBjb25zdCBwb3N0U3RlcFNwcmluZyA9ICgpID0+IHNwcmluZy5hcHBseUZvcmNlKCk7CiAgICBzdGF0ZS5zcHJpbmdzW3V1aWRdID0gcG9zdFN0ZXBTcHJpbmc7CiAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbdXVpZF0gPSBzcHJpbmc7CgogICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnNwcmluZ3NbdXVpZF0pOwogIH07CgogIGZ1bmN0aW9uIGVtaXRCZWdpbkNvbnRhY3QoX3JlZikgewogICAgbGV0IHsKICAgICAgYm9keUEsCiAgICAgIGJvZHlCCiAgICB9ID0gX3JlZjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVCZWdpbicKICAgIH0pOwogIH0KICBmdW5jdGlvbiBlbWl0RW5kQ29udGFjdChfcmVmMikgewogICAgbGV0IHsKICAgICAgYm9keUEsCiAgICAgIGJvZHlCCiAgICB9ID0gX3JlZjI7CiAgICBpZiAoIShib2R5QSAhPSBudWxsICYmIGJvZHlBLnV1aWQpIHx8ICEoYm9keUIgIT0gbnVsbCAmJiBib2R5Qi51dWlkKSkgcmV0dXJuOwogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIGJvZHlBOiBib2R5QS51dWlkLAogICAgICBib2R5QjogYm9keUIudXVpZCwKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlRW5kJwogICAgfSk7CiAgfQogIGNvbnN0IGluaXQgPSAod29ybGQsIF9yZWYzKSA9PiB7CiAgICBsZXQgewogICAgICBhbGxvd1NsZWVwLAogICAgICBheGlzSW5kZXggPSAwLAogICAgICBicm9hZHBoYXNlLAogICAgICBkZWZhdWx0Q29udGFjdE1hdGVyaWFsLAogICAgICBmcmljdGlvbkdyYXZpdHksCiAgICAgIGdyYXZpdHksCiAgICAgIGl0ZXJhdGlvbnMsCiAgICAgIHF1YXROb3JtYWxpemVGYXN0LAogICAgICBxdWF0Tm9ybWFsaXplU2tpcCwKICAgICAgc29sdmVyLAogICAgICB0b2xlcmFuY2UKICAgIH0gPSBfcmVmMzsKICAgIHdvcmxkLmFsbG93U2xlZXAgPSBhbGxvd1NsZWVwOwogICAgd29ybGQuZ3Jhdml0eS5zZXQoLi4uZ3Jhdml0eSk7CiAgICB3b3JsZC5mcmljdGlvbkdyYXZpdHkgPSBmcmljdGlvbkdyYXZpdHkgPyBuZXcgVmVjMyguLi5mcmljdGlvbkdyYXZpdHkpIDogdW5kZWZpbmVkOwogICAgd29ybGQucXVhdE5vcm1hbGl6ZUZhc3QgPSBxdWF0Tm9ybWFsaXplRmFzdDsKICAgIHdvcmxkLnF1YXROb3JtYWxpemVTa2lwID0gcXVhdE5vcm1hbGl6ZVNraXA7CiAgICBpZiAoc29sdmVyID09PSAnU3BsaXQnKSB7CiAgICAgIHdvcmxkLnNvbHZlciA9IG5ldyBTcGxpdFNvbHZlcihuZXcgR1NTb2x2ZXIoKSk7CiAgICB9CiAgICBpZiAod29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgd29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IHRvbGVyYW5jZTsKICAgICAgd29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBpdGVyYXRpb25zOwogICAgfQogICAgd29ybGQuYnJvYWRwaGFzZSA9IGJyb2FkcGhhc2UgPT09ICdTQVAnID8gbmV3IFNBUEJyb2FkcGhhc2Uod29ybGQpIDogbmV3IE5haXZlQnJvYWRwaGFzZSgpOwogICAgaWYgKHdvcmxkLmJyb2FkcGhhc2UgaW5zdGFuY2VvZiBTQVBCcm9hZHBoYXNlKSB7CiAgICAgIHdvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gYXhpc0luZGV4OwogICAgfQogICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0JywgZW1pdEJlZ2luQ29udGFjdCk7CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdlbmRDb250YWN0JywgZW1pdEVuZENvbnRhY3QpOwogICAgT2JqZWN0LmFzc2lnbih3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsLCBkZWZhdWx0Q29udGFjdE1hdGVyaWFsKTsKICB9OwoKICBjb25zdCBpc1FvclYgPSB2ID0+IHYgaW5zdGFuY2VvZiBRdWF0ZXJuaW9uIHx8IHYgaW5zdGFuY2VvZiBWZWMzOwogIGNvbnN0IHN0ZXAgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHBvc2l0aW9ucywKICAgICAgcHJvcHM6IHsKICAgICAgICBtYXhTdWJTdGVwcywKICAgICAgICBzdGVwU2l6ZSwKICAgICAgICB0aW1lU2luY2VMYXN0Q2FsbGVkCiAgICAgIH0sCiAgICAgIHF1YXRlcm5pb25zCiAgICB9ID0gX3JlZjsKICAgIHN0YXRlLndvcmxkLnN0ZXAoc3RlcFNpemUsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhdGUud29ybGQuYm9kaWVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGNvbnN0IHAgPSBzdGF0ZS53b3JsZC5ib2RpZXNbaV0ucG9zaXRpb247CiAgICAgIGNvbnN0IHEgPSBzdGF0ZS53b3JsZC5ib2RpZXNbaV0ucXVhdGVybmlvbjsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMF0gPSBwLng7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDFdID0gcC55OwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAyXSA9IHAuejsKICAgICAgcXVhdGVybmlvbnNbNCAqIGkgKyAwXSA9IHEueDsKICAgICAgcXVhdGVybmlvbnNbNCAqIGkgKyAxXSA9IHEueTsKICAgICAgcXVhdGVybmlvbnNbNCAqIGkgKyAyXSA9IHEuejsKICAgICAgcXVhdGVybmlvbnNbNCAqIGkgKyAzXSA9IHEudzsKICAgIH0KICAgIGNvbnN0IG9ic2VydmF0aW9ucyA9IFtdOwogICAgZm9yIChjb25zdCBpZCBvZiBPYmplY3Qua2V5cyhzdGF0ZS5zdWJzY3JpcHRpb25zKSkgewogICAgICBjb25zdCBbdXVpZCwgdHlwZSwgdGFyZ2V0ID0gJ2JvZGllcyddID0gc3RhdGUuc3Vic2NyaXB0aW9uc1tpZF07CiAgICAgIGNvbnN0IHsKICAgICAgICBib2RpZXMsCiAgICAgICAgdmVoaWNsZXMKICAgICAgfSA9IHN0YXRlOwogICAgICBjb25zdCB2YWx1ZSA9IHRhcmdldCA9PT0gJ3ZlaGljbGVzJyA/CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIHZlaGljbGVzW3V1aWRdLnZlaGljbGVbdHlwZV0gOgogICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICBib2RpZXNbdXVpZF1bdHlwZV07CiAgICAgIGNvbnN0IHNlcmlhbGl6YWJsZVZhbHVlID0gaXNRb3JWKHZhbHVlKSA/IHZhbHVlLnRvQXJyYXkoKSA6IHZhbHVlOwogICAgICBvYnNlcnZhdGlvbnMucHVzaChbTnVtYmVyKGlkKSwgc2VyaWFsaXphYmxlVmFsdWUsCiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIHR5cGVdKTsKICAgIH0KICAgIGNvbnN0IG1lc3NhZ2UgPSB7CiAgICAgIGFjdGl2ZTogc3RhdGUud29ybGQuaGFzQWN0aXZlQm9kaWVzLAogICAgICBvYnNlcnZhdGlvbnMsCiAgICAgIG9wOiAnZnJhbWUnLAogICAgICBwb3NpdGlvbnMsCiAgICAgIHF1YXRlcm5pb25zCiAgICB9OwogICAgaWYgKHN0YXRlLmJvZGllc05lZWRTeW5jaW5nKSB7CiAgICAgIG1lc3NhZ2UuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiB7CiAgICAgICAgaWYgKGJvZHkudXVpZCkgYm9kaWVzLnB1c2goYm9keS51dWlkKTsKICAgICAgICByZXR1cm4gYm9kaWVzOwogICAgICB9LCBbXSk7CiAgICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gZmFsc2U7CiAgICB9CiAgICBzZWxmLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIFtwb3NpdGlvbnMuYnVmZmVyLCBxdWF0ZXJuaW9ucy5idWZmZXJdKTsKICB9OwoKICBjb25zdCBzdGF0ZSA9IHsKICAgIGJvZGllczoge30sCiAgICBib2RpZXNOZWVkU3luY2luZzogZmFsc2UsCiAgICBjb25zdHJhaW50czoge30sCiAgICBtYXRlcmlhbHM6IHt9LAogICAgcmF5czoge30sCiAgICBzcHJpbmdJbnN0YW5jZXM6IHt9LAogICAgc3ByaW5nczoge30sCiAgICBzdWJzY3JpcHRpb25zOiB7fSwKICAgIHZlaGljbGVzOiB7fSwKICAgIHdvcmxkOiBuZXcgV29ybGQoKQogIH07CgogIC8vLyA8cmVmZXJlbmNlIG5vLWRlZmF1bHQtbGliPSJ0cnVlIi8+CiAgY29uc3QgaXNIaW5nZUNvbnN0cmFpbnQgPSBjID0+IGMgaW5zdGFuY2VvZiBIaW5nZUNvbnN0cmFpbnQ7CiAgZnVuY3Rpb24gc3luY0JvZGllcygpIHsKICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gdHJ1ZTsKICAgIHN0YXRlLmJvZGllcyA9IHN0YXRlLndvcmxkLmJvZGllcy5yZWR1Y2UoKGJvZGllcywgYm9keSkgPT4gYm9keS51dWlkID8gewogICAgICAuLi5ib2RpZXMsCiAgICAgIFtib2R5LnV1aWRdOiBib2R5CiAgICB9IDogYm9kaWVzLCB7fSk7CiAgfQogIGNvbnN0IGJyb2FkcGhhc2VzID0gewogICAgTmFpdmVCcm9hZHBoYXNlLAogICAgU0FQQnJvYWRwaGFzZQogIH07CiAgY29uc3QgY3JlYXRlTWF0ZXJpYWwgPSBjcmVhdGVNYXRlcmlhbEZhY3Rvcnkoc3RhdGUubWF0ZXJpYWxzKTsKICBzZWxmLm9ubWVzc2FnZSA9IF9yZWYgPT4gewogICAgbGV0IHsKICAgICAgZGF0YQogICAgfSA9IF9yZWY7CiAgICBzd2l0Y2ggKGRhdGEub3ApIHsKICAgICAgY2FzZSAnaW5pdCc6CiAgICAgICAgewogICAgICAgICAgaW5pdChzdGF0ZS53b3JsZCwgZGF0YS5wcm9wcyk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3N0ZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0ZXAoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhZGRCb2RpZXMnOgogICAgICAgIHsKICAgICAgICAgIGFkZEJvZGllcyhzdGF0ZSwgY3JlYXRlTWF0ZXJpYWwsIGRhdGEpOwogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVCb2RpZXMnOgogICAgICAgIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS51dWlkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUJvZHkoc3RhdGUuYm9kaWVzW2RhdGEudXVpZFtpXV0pOwogICAgICAgICAgICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyhzdGF0ZS5zdWJzY3JpcHRpb25zKS5maW5kKGsgPT4gc3RhdGUuc3Vic2NyaXB0aW9uc1trXVswXSA9PT0gZGF0YS51dWlkW2ldKTsKICAgICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5zdWJzY3JpcHRpb25zW2tleV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGlkLAogICAgICAgICAgICB0YXJnZXQsCiAgICAgICAgICAgIHR5cGUKICAgICAgICAgIH0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUuc3Vic2NyaXB0aW9uc1tpZF0gPSBbZGF0YS51dWlkLCB0eXBlLCB0YXJnZXRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICd1bnN1YnNjcmliZSc6CiAgICAgICAgewogICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNbZGF0YS5wcm9wc107CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFBvc2l0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5wb3NpdGlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFF1YXRlcm5pb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnF1YXRlcm5pb24uc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0sIGRhdGEucHJvcHNbM10pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRSb3RhdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS52ZWxvY2l0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJWZWxvY2l0eSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYW5ndWxhclZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0TGluZWFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRBbmd1bGFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyRmFjdG9yLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0TWFzcyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWFzcyA9IGRhdGEucHJvcHM7CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0udXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0TWF0ZXJpYWwnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLm1hdGVyaWFsID0gZGF0YS5wcm9wcyA/IGNyZWF0ZU1hdGVyaWFsKGRhdGEucHJvcHMpIDogbnVsbDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0TGluZWFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubGluZWFyRGFtcGluZyA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyRGFtcGluZyA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFsbG93U2xlZXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFsbG93U2xlZXAgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRTbGVlcFNwZWVkTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwU3BlZWRMaW1pdCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwVGltZUxpbWl0JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcFRpbWVMaW1pdCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlckdyb3VwJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlck1hc2snOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlck1hc2sgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRDb2xsaXNpb25SZXNwb25zZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uUmVzcG9uc2UgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGaXhlZFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5maXhlZFJvdGF0aW9uID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0RnJpY3Rpb25HcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5mcmljdGlvbkdyYXZpdHkgPSBkYXRhLnByb3BzID8gbmV3IFZlYzMoLi4uZGF0YS5wcm9wcykgOiB1bmRlZmluZWQ7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldElzVHJpZ2dlcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uaXNUcmlnZ2VyID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0R3Jhdml0eSc6CiAgICAgICAgc3RhdGUud29ybGQuZ3Jhdml0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFRvbGVyYW5jZSc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEl0ZXJhdGlvbnMnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QnJvYWRwaGFzZSc6CiAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZSA9IG5ldyAoYnJvYWRwaGFzZXNbYCR7ZGF0YS5wcm9wc31Ccm9hZHBoYXNlYF0gfHwgTmFpdmVCcm9hZHBoYXNlKShzdGF0ZS53b3JsZCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEF4aXNJbmRleCc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLmJyb2FkcGhhc2UgaW5zdGFuY2VvZiBTQVBCcm9hZHBoYXNlKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IGRhdGEucHJvcHMgPT09IHVuZGVmaW5lZCB8fCBkYXRhLnByb3BzID09PSBudWxsID8gMCA6IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhcHBseUZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUZvcmNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5SW1wdWxzZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5TG9jYWxGb3JjZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlMb2NhbEZvcmNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5TG9jYWxJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsSW1wdWxzZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhcHBseVRvcnF1ZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlUb3JxdWUobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRDb25zdHJhaW50JzoKICAgICAgICB7CiAgICAgICAgICBhZGRDb25zdHJhaW50KHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKF9yZWYyID0+IHsKICAgICAgICAgIGxldCB7CiAgICAgICAgICAgIHV1aWQKICAgICAgICAgIH0gPSBfcmVmMjsKICAgICAgICAgIHJldHVybiB1dWlkID09PSBkYXRhLnV1aWQ7CiAgICAgICAgfSkubWFwKGMgPT4gc3RhdGUud29ybGQucmVtb3ZlQ29uc3RyYWludChjKSk7CiAgICAgICAgaWYgKHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF0pIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSk7CiAgICAgICAgICBkZWxldGUgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2VuYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmVuYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmRpc2FibGUoKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2VuYWJsZUNvbnN0cmFpbnRNb3Rvcic6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5lbmFibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnRNb3Rvcic6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5kaXNhYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3RvclNwZWVkJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yU3BlZWQoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRDb25zdHJhaW50TW90b3JNYXhGb3JjZSc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5zZXRNb3Rvck1heEZvcmNlKGRhdGEucHJvcHMpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYWRkU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBhZGRTcHJpbmcoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRTcHJpbmdTdGlmZm5lc3MnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLnN0aWZmbmVzcyA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1Jlc3RMZW5ndGgnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLnJlc3RMZW5ndGggPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRTcHJpbmdEYW1waW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5kYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnNwcmluZ3NbZGF0YS51dWlkXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZFJheSc6CiAgICAgICAgewogICAgICAgICAgYWRkUmF5KHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5JzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5yYXlzW2RhdGEudXVpZF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZFJheWNhc3RWZWhpY2xlJzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXljYXN0VmVoaWNsZShzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZVJheWNhc3RWZWhpY2xlJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS5wcmVTdGVwKTsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS5wb3N0U3RlcCk7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUud29ybGQgPSBudWxsOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF07CiAgICAgICAgICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyhzdGF0ZS5zdWJzY3JpcHRpb25zKS5maW5kKGsgPT4gc3RhdGUuc3Vic2NyaXB0aW9uc1trXVswXSA9PT0gZGF0YS51dWlkKTsKICAgICAgICAgIGlmIChrZXkpIHsKICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVTdGVlcmluZ1ZhbHVlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbdmFsdWUsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYXBwbHlSYXljYXN0VmVoaWNsZUVuZ2luZUZvcmNlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbdmFsdWUsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5hcHBseUVuZ2luZUZvcmNlKHZhbHVlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVCcmFrZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW2JyYWtlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhZGRDb250YWN0TWF0ZXJpYWwnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnRhY3RNYXRlcmlhbChzdGF0ZS53b3JsZCwgY3JlYXRlTWF0ZXJpYWwsIGRhdGEucHJvcHMsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUNvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBkYXRhLnV1aWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICd3YWtlVXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLndha2VVcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzbGVlcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXAoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICB9OwoKfSkoKTsKCg==",null,!1);class V6 extends w6{constructor(t){let{allowSleep:n=!1,axisIndex:s=0,broadphase:r="Naive",defaultContactMaterial:o={contactEquationStiffness:1e6},frictionGravity:g=null,gravity:a=[0,-9.81,0],iterations:l=5,quatNormalizeFast:c=!1,quatNormalizeSkip:C=0,size:h=1e3,solver:p="GS",tolerance:m=.001}=t;super();my(this,"messageQueue",[]);my(this,"worker",null);this.config={allowSleep:n,axisIndex:s,broadphase:r,defaultContactMaterial:o,frictionGravity:g,gravity:a,iterations:l,quatNormalizeFast:c,quatNormalizeSkip:C,size:h,solver:p,tolerance:m},this.buffers={positions:new Float32Array(h*3),quaternions:new Float32Array(h*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(t){this.config.axisIndex=t,this.postMessage({op:"setAxisIndex",props:t})}get broadphase(){return this.config.broadphase}set broadphase(t){this.config.broadphase=t,this.postMessage({op:"setBroadphase",props:t})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(t){this.config.frictionGravity=t,this.postMessage({op:"setFrictionGravity",props:t})}get gravity(){return this.config.gravity}set gravity(t){this.config.gravity=t,this.postMessage({op:"setGravity",props:t})}get iterations(){return this.config.iterations}set iterations(t){this.config.iterations=t,this.postMessage({op:"setIterations",props:t})}get tolerance(){return this.config.tolerance}set tolerance(t){this.config.tolerance=t,this.postMessage({op:"setTolerance",props:t})}addBodies(t){let{props:n,type:s,uuid:r}=t;this.postMessage({op:"addBodies",props:n,type:s,uuid:r})}addConstraint(t){let{props:[n,s,r],type:o,uuid:g}=t;this.postMessage({op:"addConstraint",props:[n,s,r],type:o,uuid:g})}addContactMaterial(t){let{props:n,uuid:s}=t;this.postMessage({op:"addContactMaterial",props:n,uuid:s})}addRay(t){let{props:n,uuid:s}=t;this.postMessage({op:"addRay",props:n,uuid:s})}addRaycastVehicle(t){let{props:[n,s,r,o,g,a],uuid:l}=t;this.postMessage({op:"addRaycastVehicle",props:[n,s,r,o,g,a],uuid:l})}addSpring(t){let{props:[n,s,r],uuid:o}=t;this.postMessage({op:"addSpring",props:[n,s,r],uuid:o})}applyForce(t){let{props:n,uuid:s}=t;this.postMessage({op:"applyForce",props:n,uuid:s})}applyImpulse(t){let{props:n,uuid:s}=t;this.postMessage({op:"applyImpulse",props:n,uuid:s})}applyLocalForce(t){let{props:n,uuid:s}=t;this.postMessage({op:"applyLocalForce",props:n,uuid:s})}applyLocalImpulse(t){let{props:n,uuid:s}=t;this.postMessage({op:"applyLocalImpulse",props:n,uuid:s})}applyRaycastVehicleEngineForce(t){let{props:n,uuid:s}=t;this.postMessage({op:"applyRaycastVehicleEngineForce",props:n,uuid:s})}applyTorque(t){let{props:n,uuid:s}=t;this.postMessage({op:"applyTorque",props:n,uuid:s})}connect(){this.worker=new x6,this.worker.onmessage=t=>{if(t.data.op==="frame"){this.buffers.positions=t.data.positions,this.buffers.quaternions=t.data.quaternions,this.emit(t.data.op,t.data);return}this.emit(t.data.type,t.data)};for(const t of this.messageQueue)this.worker.postMessage(t);this.messageQueue.length=0}disableConstraint(t){let{uuid:n}=t;this.postMessage({op:"disableConstraint",uuid:n})}disableConstraintMotor(t){let{uuid:n}=t;this.postMessage({op:"disableConstraintMotor",uuid:n})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(t){let{uuid:n}=t;this.postMessage({op:"enableConstraint",uuid:n})}enableConstraintMotor(t){let{uuid:n}=t;this.postMessage({op:"enableConstraintMotor",uuid:n})}init(){const{allowSleep:t,axisIndex:n,broadphase:s,defaultContactMaterial:r,frictionGravity:o,gravity:g,iterations:a,quatNormalizeFast:l,quatNormalizeSkip:c,solver:C,tolerance:h}=this.config;this.postMessage({op:"init",props:{allowSleep:t,axisIndex:n,broadphase:s,defaultContactMaterial:r,frictionGravity:o,gravity:g,iterations:a,quatNormalizeFast:l,quatNormalizeSkip:c,solver:C,tolerance:h}})}removeBodies(t){let{uuid:n}=t;this.postMessage({op:"removeBodies",uuid:n})}removeConstraint(t){let{uuid:n}=t;this.postMessage({op:"removeConstraint",uuid:n})}removeContactMaterial(t){let{uuid:n}=t;this.postMessage({op:"removeContactMaterial",uuid:n})}removeRay(t){let{uuid:n}=t;this.postMessage({op:"removeRay",uuid:n})}removeRaycastVehicle(t){let{uuid:n}=t;this.postMessage({op:"removeRaycastVehicle",uuid:n})}removeSpring(t){let{uuid:n}=t;this.postMessage({op:"removeSpring",uuid:n})}setAllowSleep(t){let{props:n,uuid:s}=t;this.postMessage({op:"setAllowSleep",props:n,uuid:s})}setAngularDamping(t){let{props:n,uuid:s}=t;this.postMessage({op:"setAngularDamping",props:n,uuid:s})}setAngularFactor(t){let{props:n,uuid:s}=t;this.postMessage({op:"setAngularFactor",props:n,uuid:s})}setAngularVelocity(t){let{props:n,uuid:s}=t;this.postMessage({op:"setAngularVelocity",props:n,uuid:s})}setCollisionFilterGroup(t){let{props:n,uuid:s}=t;this.postMessage({op:"setCollisionFilterGroup",props:n,uuid:s})}setCollisionFilterMask(t){let{props:n,uuid:s}=t;this.postMessage({op:"setCollisionFilterMask",props:n,uuid:s})}setCollisionResponse(t){let{props:n,uuid:s}=t;this.postMessage({op:"setCollisionResponse",props:n,uuid:s})}setConstraintMotorMaxForce(t){let{props:n,uuid:s}=t;this.postMessage({op:"setConstraintMotorMaxForce",props:n,uuid:s})}setConstraintMotorSpeed(t){let{props:n,uuid:s}=t;this.postMessage({op:"setConstraintMotorSpeed",props:n,uuid:s})}setFixedRotation(t){let{props:n,uuid:s}=t;this.postMessage({op:"setFixedRotation",props:n,uuid:s})}setIsTrigger(t){let{props:n,uuid:s}=t;this.postMessage({op:"setIsTrigger",props:n,uuid:s})}setLinearDamping(t){let{props:n,uuid:s}=t;this.postMessage({op:"setLinearDamping",props:n,uuid:s})}setLinearFactor(t){let{props:n,uuid:s}=t;this.postMessage({op:"setLinearFactor",props:n,uuid:s})}setMass(t){let{props:n,uuid:s}=t;this.postMessage({op:"setMass",props:n,uuid:s})}setMaterial(t){let{props:n,uuid:s}=t;this.postMessage({op:"setMaterial",props:n,uuid:s})}setPosition(t){let{props:n,uuid:s}=t;this.postMessage({op:"setPosition",props:n,uuid:s})}setQuaternion(t){let{props:[n,s,r,o],uuid:g}=t;this.postMessage({op:"setQuaternion",props:[n,s,r,o],uuid:g})}setRaycastVehicleBrake(t){let{props:n,uuid:s}=t;this.postMessage({op:"setRaycastVehicleBrake",props:n,uuid:s})}setRaycastVehicleSteeringValue(t){let{props:n,uuid:s}=t;this.postMessage({op:"setRaycastVehicleSteeringValue",props:n,uuid:s})}setRotation(t){let{props:n,uuid:s}=t;this.postMessage({op:"setRotation",props:n,uuid:s})}setSleepSpeedLimit(t){let{props:n,uuid:s}=t;this.postMessage({op:"setSleepSpeedLimit",props:n,uuid:s})}setSleepTimeLimit(t){let{props:n,uuid:s}=t;this.postMessage({op:"setSleepTimeLimit",props:n,uuid:s})}setSpringDamping(t){let{props:n,uuid:s}=t;this.postMessage({op:"setSpringDamping",props:n,uuid:s})}setSpringRestLength(t){let{props:n,uuid:s}=t;this.postMessage({op:"setSpringRestLength",props:n,uuid:s})}setSpringStiffness(t){let{props:n,uuid:s}=t;this.postMessage({op:"setSpringStiffness",props:n,uuid:s})}setUserData(t){let{props:n,uuid:s}=t;this.postMessage({op:"setUserData",props:n,uuid:s})}setVelocity(t){let{props:n,uuid:s}=t;this.postMessage({op:"setVelocity",props:n,uuid:s})}sleep(t){let{uuid:n}=t;this.postMessage({op:"sleep",uuid:n})}step(t){var n;const{buffers:{positions:s,quaternions:r}}=this;!s.byteLength&&!r.byteLength||(n=this.worker)==null||n.postMessage({op:"step",positions:s,props:t,quaternions:r},[s.buffer,r.buffer])}subscribe(t){let{props:{id:n,target:s,type:r},uuid:o}=t;this.postMessage({op:"subscribe",props:{id:n,target:s,type:r},uuid:o})}terminate(){var t;(t=this.worker)==null||t.terminate(),this.worker=null}unsubscribe(t){let{props:n}=t;this.postMessage({op:"unsubscribe",props:n})}wakeUp(t){let{uuid:n}=t;this.postMessage({op:"wakeUp",uuid:n})}postMessage(t){if(this.worker)return this.worker.postMessage(t);this.messageQueue.push(t)}}class ja{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new U);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new U);const n=this.elements,s=e.x,r=e.y,o=e.z;return t.x=n[0]*s+n[1]*r+n[2]*o,t.y=n[3]*s+n[4]*r+n[5]*o,t.z=n[6]*s+n[7]*r+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new ja);const n=this.elements,s=e.elements,r=t.elements,o=n[0],g=n[1],a=n[2],l=n[3],c=n[4],C=n[5],h=n[6],p=n[7],m=n[8],f=s[0],b=s[1],y=s[2],v=s[3],G=s[4],w=s[5],W=s[6],V=s[7],X=s[8];return r[0]=o*f+g*v+a*W,r[1]=o*b+g*G+a*V,r[2]=o*y+g*w+a*X,r[3]=l*f+c*v+C*W,r[4]=l*b+c*G+C*V,r[5]=l*y+c*w+C*X,r[6]=h*f+p*v+m*W,r[7]=h*b+p*G+m*V,r[8]=h*y+p*w+m*X,t}scale(e,t){t===void 0&&(t=new ja);const n=this.elements,s=t.elements;for(let r=0;r!==3;r++)s[3*r+0]=e.x*n[3*r+0],s[3*r+1]=e.y*n[3*r+1],s[3*r+2]=e.z*n[3*r+2];return t}solve(e,t){t===void 0&&(t=new U);const n=3,s=4,r=[];let o,g;for(o=0;o<n*s;o++)r.push(0);for(o=0;o<3;o++)for(g=0;g<3;g++)r[o+s*g]=this.elements[o+3*g];r[3+4*0]=e.x,r[3+4*1]=e.y,r[3+4*2]=e.z;let a=3;const l=a;let c;const C=4;let h;do{if(o=l-a,r[o+s*o]===0){for(g=o+1;g<l;g++)if(r[o+s*g]!==0){c=C;do h=C-c,r[h+s*o]+=r[h+s*g];while(--c);break}}if(r[o+s*o]!==0)for(g=o+1;g<l;g++){const p=r[o+s*g]/r[o+s*o];c=C;do h=C-c,r[h+s*g]=h<=o?0:r[h+s*g]-r[h+s*o]*p;while(--c)}}while(--a);if(t.z=r[2*s+3]/r[2*s+2],t.y=(r[1*s+3]-r[1*s+2]*t.z)/r[1*s+1],t.x=(r[0*s+3]-r[0*s+2]*t.z-r[0*s+1]*t.y)/r[0*s+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new ja);const t=3,n=6,s=H6;let r,o;for(r=0;r<3;r++)for(o=0;o<3;o++)s[r+n*o]=this.elements[r+3*o];s[3+6*0]=1,s[3+6*1]=0,s[3+6*2]=0,s[4+6*0]=0,s[4+6*1]=1,s[4+6*2]=0,s[5+6*0]=0,s[5+6*1]=0,s[5+6*2]=1;let g=3;const a=g;let l;const c=n;let C;do{if(r=a-g,s[r+n*r]===0){for(o=r+1;o<a;o++)if(s[r+n*o]!==0){l=c;do C=c-l,s[C+n*r]+=s[C+n*o];while(--l);break}}if(s[r+n*r]!==0)for(o=r+1;o<a;o++){const h=s[r+n*o]/s[r+n*r];l=c;do C=c-l,s[C+n*o]=C<=r?0:s[C+n*o]-s[C+n*r]*h;while(--l)}}while(--g);r=2;do{o=r-1;do{const h=s[r+n*o]/s[r+n*r];l=n;do C=n-l,s[C+n*o]=s[C+n*o]-s[C+n*r]*h;while(--l)}while(o--)}while(--r);r=2;do{const h=1/s[r+n*r];l=n;do C=n-l,s[C+n*r]=s[C+n*r]*h;while(--l)}while(r--);r=2;do{o=2;do{if(C=s[t+o+n*r],isNaN(C)||C===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(r,o,C)}while(o--)}while(r--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,s=e.z,r=e.w,o=t+t,g=n+n,a=s+s,l=t*o,c=t*g,C=t*a,h=n*g,p=n*a,m=s*a,f=r*o,b=r*g,y=r*a,v=this.elements;return v[3*0+0]=1-(h+m),v[3*0+1]=c-y,v[3*0+2]=C+b,v[3*1+0]=c+y,v[3*1+1]=1-(l+m),v[3*1+2]=p-f,v[3*2+0]=C-b,v[3*2+1]=p+f,v[3*2+2]=1-(l+h),this}transpose(e){e===void 0&&(e=new ja);const t=this.elements,n=e.elements;let s;return n[0]=t[0],n[4]=t[4],n[8]=t[8],s=t[1],n[1]=t[3],n[3]=s,s=t[2],n[2]=t[6],n[6]=s,s=t[5],n[5]=t[7],n[7]=s,e}}const H6=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class U{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new U);const n=e.x,s=e.y,r=e.z,o=this.x,g=this.y,a=this.z;return t.x=g*r-a*s,t.y=a*n-o*r,t.z=o*s-g*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new U(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new U(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new ja([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,s=Math.sqrt(e*e+t*t+n*n);if(s>0){const r=1/s;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new U);const t=this.x,n=this.y,s=this.z;let r=Math.sqrt(t*t+n*n+s*s);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=s*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,g=e.z;return Math.sqrt((r-t)*(r-t)+(o-n)*(o-n)+(g-s)*(g-s))}distanceSquared(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,g=e.z;return(r-t)*(r-t)+(o-n)*(o-n)+(g-s)*(g-s)}scale(e,t){t===void 0&&(t=new U);const n=this.x,s=this.y,r=this.z;return t.x=e*n,t.y=e*s,t.z=e*r,t}vmul(e,t){return t===void 0&&(t=new U),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new U),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new U),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const s=X6,r=1/n;s.set(this.x*r,this.y*r,this.z*r);const o=Y6;Math.abs(s.x)<.9?(o.set(1,0,0),s.cross(o,e)):(o.set(0,1,0),s.cross(o,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const s=this.x,r=this.y,o=this.z;n.x=s+(e.x-s)*t,n.y=r+(e.y-r)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(T3),T3.almostEquals(e,t)}clone(){return new U(this.x,this.y,this.z)}}U.ZERO=new U(0,0,0);U.UNIT_X=new U(1,0,0);U.UNIT_Y=new U(0,1,0);U.UNIT_Z=new U(0,0,1);const X6=new U,Y6=new U,T3=new U;class ig{constructor(e){e===void 0&&(e={}),this.lowerBound=new U,this.upperBound=new U,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,s){const r=this.lowerBound,o=this.upperBound,g=n;r.copy(e[0]),g&&g.vmult(r,r),o.copy(r);for(let a=1;a<e.length;a++){let l=e[a];g&&(g.vmult(l,E3),l=E3),l.x>o.x&&(o.x=l.x),l.x<r.x&&(r.x=l.x),l.y>o.y&&(o.y=l.y),l.y<r.y&&(r.y=l.y),l.z>o.z&&(o.z=l.z),l.z<r.z&&(r.z=l.z)}return t&&(t.vadd(r,r),t.vadd(o,o)),s&&(r.x-=s,r.y-=s,r.z-=s,o.x+=s,o.y+=s,o.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new ig().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,r=e.upperBound,o=s.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,g=s.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,a=s.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return o&&g&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,r=e.upperBound;return t.x<=s.x&&n.x>=r.x&&t.y<=s.y&&n.y>=r.y&&t.z<=s.z&&n.z>=r.z}getCorners(e,t,n,s,r,o,g,a){const l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),s.set(l.x,c.y,c.z),r.set(c.x,l.y,c.z),o.set(l.x,c.y,l.z),g.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(e,t){const n=D3,s=n[0],r=n[1],o=n[2],g=n[3],a=n[4],l=n[5],c=n[6],C=n[7];this.getCorners(s,r,o,g,a,l,c,C);for(let h=0;h!==8;h++){const p=n[h];e.pointToLocal(p,p)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=D3,s=n[0],r=n[1],o=n[2],g=n[3],a=n[4],l=n[5],c=n[6],C=n[7];this.getCorners(s,r,o,g,a,l,c,C);for(let h=0;h!==8;h++){const p=n[h];e.pointToWorld(p,p)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,s=1/t.x,r=1/t.y,o=1/t.z,g=(this.lowerBound.x-n.x)*s,a=(this.upperBound.x-n.x)*s,l=(this.lowerBound.y-n.y)*r,c=(this.upperBound.y-n.y)*r,C=(this.lowerBound.z-n.z)*o,h=(this.upperBound.z-n.z)*o,p=Math.max(Math.max(Math.min(g,a),Math.min(l,c)),Math.min(C,h)),m=Math.min(Math.min(Math.max(g,a),Math.max(l,c)),Math.max(C,h));return!(m<0||p>m)}}const E3=new U,D3=[new U,new U,new U,new U,new U,new U,new U,new U];class ir{constructor(e,t,n,s){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=n,this.w=s}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new U),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=F6,s=N6;e.tangents(n,s),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new ir);const n=this.x,s=this.y,r=this.z,o=this.w,g=e.x,a=e.y,l=e.z,c=e.w;return t.x=n*c+o*g+s*l-r*a,t.y=s*c+o*a+r*g-n*l,t.z=r*c+o*l+n*a-s*g,t.w=o*c-n*g-s*a-r*l,t}inverse(e){e===void 0&&(e=new ir);const t=this.x,n=this.y,s=this.z,r=this.w;this.conjugate(e);const o=1/(t*t+n*n+s*s+r*r);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new ir),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new U);const n=e.x,s=e.y,r=e.z,o=this.x,g=this.y,a=this.z,l=this.w,c=l*n+g*r-a*s,C=l*s+a*n-o*r,h=l*r+o*s-g*n,p=-o*n-g*s-a*r;return t.x=c*l+p*-o+C*-a-h*-g,t.y=C*l+p*-g+h*-o-c*-a,t.z=h*l+p*-a+c*-g-C*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,s,r;const o=this.x,g=this.y,a=this.z,l=this.w;switch(t){case"YZX":const c=o*g+a*l;if(c>.499&&(n=2*Math.atan2(o,l),s=Math.PI/2,r=0),c<-.499&&(n=-2*Math.atan2(o,l),s=-Math.PI/2,r=0),n===void 0){const C=o*o,h=g*g,p=a*a;n=Math.atan2(2*g*l-2*o*a,1-2*h-2*p),s=Math.asin(2*c),r=Math.atan2(2*o*l-2*g*a,1-2*C-2*p)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=s,e.x=r}setFromEuler(e,t,n,s){s===void 0&&(s="XYZ");const r=Math.cos(e/2),o=Math.cos(t/2),g=Math.cos(n/2),a=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(n/2);return s==="XYZ"?(this.x=a*o*g+r*l*c,this.y=r*l*g-a*o*c,this.z=r*o*c+a*l*g,this.w=r*o*g-a*l*c):s==="YXZ"?(this.x=a*o*g+r*l*c,this.y=r*l*g-a*o*c,this.z=r*o*c-a*l*g,this.w=r*o*g+a*l*c):s==="ZXY"?(this.x=a*o*g-r*l*c,this.y=r*l*g+a*o*c,this.z=r*o*c+a*l*g,this.w=r*o*g-a*l*c):s==="ZYX"?(this.x=a*o*g-r*l*c,this.y=r*l*g+a*o*c,this.z=r*o*c-a*l*g,this.w=r*o*g+a*l*c):s==="YZX"?(this.x=a*o*g+r*l*c,this.y=r*l*g+a*o*c,this.z=r*o*c-a*l*g,this.w=r*o*g-a*l*c):s==="XZY"&&(this.x=a*o*g-r*l*c,this.y=r*l*g-a*o*c,this.z=r*o*c+a*l*g,this.w=r*o*g+a*l*c),this}clone(){return new ir(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new ir);const s=this.x,r=this.y,o=this.z,g=this.w;let a=e.x,l=e.y,c=e.z,C=e.w,h,p,m,f,b;return p=s*a+r*l+o*c+g*C,p<0&&(p=-p,a=-a,l=-l,c=-c,C=-C),1-p>1e-6?(h=Math.acos(p),m=Math.sin(h),f=Math.sin((1-t)*h)/m,b=Math.sin(t*h)/m):(f=1-t,b=t),n.x=f*s+b*a,n.y=f*r+b*l,n.z=f*o+b*c,n.w=f*g+b*C,n}integrate(e,t,n,s){s===void 0&&(s=new ir);const r=e.x*n.x,o=e.y*n.y,g=e.z*n.z,a=this.x,l=this.y,c=this.z,C=this.w,h=t*.5;return s.x+=h*(r*C+o*c-g*l),s.y+=h*(o*C+g*a-r*c),s.z+=h*(g*C+r*l-o*a),s.w+=h*(-r*a-o*l-g*c),s}}const F6=new U,N6=new U,M6={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Gt{constructor(e){e===void 0&&(e={}),this.id=Gt.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Gt.idCounter=0;Gt.types=M6;class yr{constructor(e){e===void 0&&(e={}),this.position=new U,this.quaternion=new ir,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return yr.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return yr.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new U),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,s){return s===void 0&&(s=new U),n.vsub(e,s),t.conjugate(J3),J3.vmult(s,s),s}static pointToWorldFrame(e,t,n,s){return s===void 0&&(s=new U),t.vmult(n,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new U),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,s){return s===void 0&&(s=new U),t.w*=-1,t.vmult(n,s),t.w*=-1,s}}const J3=new ir;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U,new U,new U;new U;new ir;new ig;new ja;new ja;new ja;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new ir;new U;new U;new U;new U;class r1{constructor(){this.rayFromWorld=new U,this.rayToWorld=new U,this.hitNormalWorld=new U,this.hitPointWorld=new U,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,s,r,o,g){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(s),this.shape=r,this.body=o,this.distance=g}}let pY,fY,mY,bY,GY,yY,BY;const Aw={CLOSEST:1,ANY:2,ALL:4};pY=Gt.types.SPHERE;fY=Gt.types.PLANE;mY=Gt.types.BOX;bY=Gt.types.CYLINDER;GY=Gt.types.CONVEXPOLYHEDRON;yY=Gt.types.HEIGHTFIELD;BY=Gt.types.TRIMESH;class Ns{get[pY](){return this._intersectSphere}get[fY](){return this._intersectPlane}get[mY](){return this._intersectBox}get[bY](){return this._intersectConvex}get[GY](){return this._intersectConvex}get[yY](){return this._intersectHeightfield}get[BY](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new U),t===void 0&&(t=new U),this.from=e.clone(),this.to=t.clone(),this.direction=new U,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ns.ANY,this.result=new r1,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Ns.ANY,this.result=t.result||new r1,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(U3),e2.length=0,e.broadphase.aabbQuery(e,U3,e2),this.intersectBodies(e2),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const s=K6,r=L6;for(let o=0,g=e.shapes.length;o<g;o++){const a=e.shapes[o];if(!(n&&!a.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],r),e.quaternion.vmult(e.shapeOffsets[o],s),s.vadd(e.position,s),this.intersectShape(a,r,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,s=e.length;!this.result.shouldStop&&n<s;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,s){const r=this.from;if($6(r,this.direction,n)>e.boundingSphereRadius)return;const g=this[e.type];g&&g.call(this,e,t,n,s,e)}_intersectBox(e,t,n,s,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,s,r)}_intersectPlane(e,t,n,s,r){const o=this.from,g=this.to,a=this.direction,l=new U(0,0,1);t.vmult(l,l);const c=new U;o.vsub(n,c);const C=c.dot(l);g.vsub(n,c);const h=c.dot(l);if(C*h>0||o.distanceTo(g)<C)return;const p=l.dot(a);if(Math.abs(p)<this.precision)return;const m=new U,f=new U,b=new U;o.vsub(n,m);const y=-l.dot(m)/p;a.scale(y,f),o.vadd(f,b),this.reportIntersection(l,b,r,s,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,s=this.to,r=this.from;t.x=Math.min(s.x,r.x),t.y=Math.min(s.y,r.y),t.z=Math.min(s.z,r.z),n.x=Math.max(s.x,r.x),n.y=Math.max(s.y,r.y),n.z=Math.max(s.z,r.z)}_intersectHeightfield(e,t,n,s,r){e.data,e.elementSize;const o=z6;o.from.copy(this.from),o.to.copy(this.to),yr.pointToLocalFrame(n,t,o.from,o.from),yr.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const g=_6;let a,l,c,C;a=l=0,c=C=e.data.length-1;const h=new ig;o.getAABB(h),e.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,g,!0),a=Math.max(a,g[0]),l=Math.max(l,g[1]),e.getIndexOfPosition(h.upperBound.x,h.upperBound.y,g,!0),c=Math.min(c,g[0]+1),C=Math.min(C,g[1]+1);for(let p=a;p<c;p++)for(let m=l;m<C;m++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(p,m,h),!!h.overlapsRay(o)){if(e.getConvexTrianglePillar(p,m,!1),yr.pointToWorldFrame(n,t,e.pillarOffset,R0),this._intersectConvex(e.pillarConvex,t,R0,s,r,P3),this.result.shouldStop)return;e.getConvexTrianglePillar(p,m,!0),yr.pointToWorldFrame(n,t,e.pillarOffset,R0),this._intersectConvex(e.pillarConvex,t,R0,s,r,P3)}}}_intersectSphere(e,t,n,s,r){const o=this.from,g=this.to,a=e.radius,l=(g.x-o.x)**2+(g.y-o.y)**2+(g.z-o.z)**2,c=2*((g.x-o.x)*(o.x-n.x)+(g.y-o.y)*(o.y-n.y)+(g.z-o.z)*(o.z-n.z)),C=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-a**2,h=c**2-4*l*C,p=k6,m=T6;if(!(h<0))if(h===0)o.lerp(g,h,p),p.vsub(n,m),m.normalize(),this.reportIntersection(m,p,r,s,-1);else{const f=(-c-Math.sqrt(h))/(2*l),b=(-c+Math.sqrt(h))/(2*l);if(f>=0&&f<=1&&(o.lerp(g,f,p),p.vsub(n,m),m.normalize(),this.reportIntersection(m,p,r,s,-1)),this.result.shouldStop)return;b>=0&&b<=1&&(o.lerp(g,b,p),p.vsub(n,m),m.normalize(),this.reportIntersection(m,p,r,s,-1))}}_intersectConvex(e,t,n,s,r,o){const g=E6,a=O3,l=o&&o.faceList||null,c=e.faces,C=e.vertices,h=e.faceNormals,p=this.direction,m=this.from,f=this.to,b=m.distanceTo(f),y=l?l.length:c.length,v=this.result;for(let G=0;!v.shouldStop&&G<y;G++){const w=l?l[G]:G,W=c[w],V=h[w],X=t,R=n;a.copy(C[W[0]]),X.vmult(a,a),a.vadd(R,a),a.vsub(m,a),X.vmult(V,g);const Y=p.dot(g);if(Math.abs(Y)<this.precision)continue;const M=g.dot(a)/Y;if(!(M<0)){p.scale(M,br),br.vadd(m,br),bg.copy(C[W[0]]),X.vmult(bg,bg),R.vadd(bg,bg);for(let L=1;!v.shouldStop&&L<W.length-1;L++){ea.copy(C[W[L]]),ta.copy(C[W[L+1]]),X.vmult(ea,ea),X.vmult(ta,ta),R.vadd(ea,ea),R.vadd(ta,ta);const re=br.distanceTo(m);!(Ns.pointInTriangle(br,bg,ea,ta)||Ns.pointInTriangle(br,ea,bg,ta))||re>b||this.reportIntersection(g,br,r,s,w)}}}}_intersectTrimesh(e,t,n,s,r,o){const g=D6,a=j6,l=q6,c=O3,C=J6,h=U6,p=P6,m=Q6,f=O6,b=e.indices;e.vertices;const y=this.from,v=this.to,G=this.direction;l.position.copy(n),l.quaternion.copy(t),yr.vectorToLocalFrame(n,t,G,C),yr.pointToLocalFrame(n,t,y,h),yr.pointToLocalFrame(n,t,v,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,p.vsub(h,C),C.normalize();const w=h.distanceSquared(p);e.tree.rayQuery(this,l,a);for(let W=0,V=a.length;!this.result.shouldStop&&W!==V;W++){const X=a[W];e.getNormal(X,g),e.getVertex(b[X*3],bg),bg.vsub(h,c);const R=C.dot(g),Y=g.dot(c)/R;if(Y<0)continue;C.scale(Y,br),br.vadd(h,br),e.getVertex(b[X*3+1],ea),e.getVertex(b[X*3+2],ta);const M=br.distanceSquared(h);!(Ns.pointInTriangle(br,ea,bg,ta)||Ns.pointInTriangle(br,bg,ea,ta))||M>w||(yr.vectorToWorldFrame(t,g,f),yr.pointToWorldFrame(n,t,br,m),this.reportIntersection(f,m,r,s,X))}a.length=0}reportIntersection(e,t,n,s,r){const o=this.from,g=this.to,a=o.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case Ns.ALL:this.hasHit=!0,l.set(o,g,e,t,n,s,a),l.hasHit=!0,this.callback(l);break;case Ns.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(o,g,e,t,n,s,a));break;case Ns.ANY:this.hasHit=!0,l.hasHit=!0,l.set(o,g,e,t,n,s,a),l.shouldStop=!0;break}}static pointInTriangle(e,t,n,s){s.vsub(t,DI),n.vsub(t,ZA),e.vsub(t,t2);const r=DI.dot(DI),o=DI.dot(ZA),g=DI.dot(t2),a=ZA.dot(ZA),l=ZA.dot(t2);let c,C;return(c=a*g-o*l)>=0&&(C=r*l-o*g)>=0&&c+C<r*a-o*o}}Ns.CLOSEST=Aw.CLOSEST;Ns.ANY=Aw.ANY;Ns.ALL=Aw.ALL;const U3=new ig,e2=[],ZA=new U,t2=new U,K6=new U,L6=new ir,br=new U,bg=new U,ea=new U,ta=new U;new U;new r1;const P3={faceList:[0]},R0=new U,z6=new Ns,_6=[],k6=new U,T6=new U,E6=new U;new U;new U;const O3=new U,D6=new U,J6=new U,U6=new U,P6=new U,O6=new U,Q6=new U;new ig;const j6=[],q6=new yr,DI=new U,W0=new U;function $6(i,e,t){t.vsub(i,DI);const n=DI.dot(e);return e.scale(n,W0),W0.vadd(i,W0),t.distanceTo(W0)}new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Ns;new U;new U;new U;new U(1,0,0),new U(0,1,0),new U(0,0,1);new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new ig;new U;new ig;new U;new U;new U;new U;new U;new U;new U;new ig;new U;new yr;new ig;Gt.types.SPHERE,Gt.types.SPHERE|Gt.types.PLANE,Gt.types.BOX|Gt.types.BOX,Gt.types.SPHERE|Gt.types.BOX,Gt.types.PLANE|Gt.types.BOX,Gt.types.CONVEXPOLYHEDRON,Gt.types.SPHERE|Gt.types.CONVEXPOLYHEDRON,Gt.types.PLANE|Gt.types.CONVEXPOLYHEDRON,Gt.types.BOX|Gt.types.CONVEXPOLYHEDRON,Gt.types.SPHERE|Gt.types.HEIGHTFIELD,Gt.types.BOX|Gt.types.HEIGHTFIELD,Gt.types.CONVEXPOLYHEDRON|Gt.types.HEIGHTFIELD,Gt.types.PARTICLE|Gt.types.SPHERE,Gt.types.PLANE|Gt.types.PARTICLE,Gt.types.BOX|Gt.types.PARTICLE,Gt.types.PARTICLE|Gt.types.CONVEXPOLYHEDRON,Gt.types.CYLINDER,Gt.types.SPHERE|Gt.types.CYLINDER,Gt.types.PLANE|Gt.types.CYLINDER,Gt.types.BOX|Gt.types.CYLINDER,Gt.types.CONVEXPOLYHEDRON|Gt.types.CYLINDER,Gt.types.HEIGHTFIELD|Gt.types.CYLINDER,Gt.types.PARTICLE|Gt.types.CYLINDER,Gt.types.SPHERE|Gt.types.TRIMESH,Gt.types.PLANE|Gt.types.TRIMESH;new U;new U;new U;new U;new U;new ir;new ir;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new ig;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new ir;new U;new U;new U;new U;new U;new U;new U;new U;new U;new ig;new Ns;const wA=globalThis.performance||{};if(!wA.now){let i=Date.now();wA.timing&&wA.timing.navigationStart&&(i=wA.timing.navigationStart),wA.now=()=>Date.now()-i}new U;class qa{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new P);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new P);const n=this.elements,s=e.x,r=e.y,o=e.z;return t.x=n[0]*s+n[1]*r+n[2]*o,t.y=n[3]*s+n[4]*r+n[5]*o,t.z=n[6]*s+n[7]*r+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new qa);const n=this.elements,s=e.elements,r=t.elements,o=n[0],g=n[1],a=n[2],l=n[3],c=n[4],C=n[5],h=n[6],p=n[7],m=n[8],f=s[0],b=s[1],y=s[2],v=s[3],G=s[4],w=s[5],W=s[6],V=s[7],X=s[8];return r[0]=o*f+g*v+a*W,r[1]=o*b+g*G+a*V,r[2]=o*y+g*w+a*X,r[3]=l*f+c*v+C*W,r[4]=l*b+c*G+C*V,r[5]=l*y+c*w+C*X,r[6]=h*f+p*v+m*W,r[7]=h*b+p*G+m*V,r[8]=h*y+p*w+m*X,t}scale(e,t){t===void 0&&(t=new qa);const n=this.elements,s=t.elements;for(let r=0;r!==3;r++)s[3*r+0]=e.x*n[3*r+0],s[3*r+1]=e.y*n[3*r+1],s[3*r+2]=e.z*n[3*r+2];return t}solve(e,t){t===void 0&&(t=new P);const n=3,s=4,r=[];let o,g;for(o=0;o<n*s;o++)r.push(0);for(o=0;o<3;o++)for(g=0;g<3;g++)r[o+s*g]=this.elements[o+3*g];r[3+4*0]=e.x,r[3+4*1]=e.y,r[3+4*2]=e.z;let a=3;const l=a;let c;const C=4;let h;do{if(o=l-a,r[o+s*o]===0){for(g=o+1;g<l;g++)if(r[o+s*g]!==0){c=C;do h=C-c,r[h+s*o]+=r[h+s*g];while(--c);break}}if(r[o+s*o]!==0)for(g=o+1;g<l;g++){const p=r[o+s*g]/r[o+s*o];c=C;do h=C-c,r[h+s*g]=h<=o?0:r[h+s*g]-r[h+s*o]*p;while(--c)}}while(--a);if(t.z=r[2*s+3]/r[2*s+2],t.y=(r[1*s+3]-r[1*s+2]*t.z)/r[1*s+1],t.x=(r[0*s+3]-r[0*s+2]*t.z-r[0*s+1]*t.y)/r[0*s+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new qa);const t=3,n=6,s=ej;let r,o;for(r=0;r<3;r++)for(o=0;o<3;o++)s[r+n*o]=this.elements[r+3*o];s[3+6*0]=1,s[3+6*1]=0,s[3+6*2]=0,s[4+6*0]=0,s[4+6*1]=1,s[4+6*2]=0,s[5+6*0]=0,s[5+6*1]=0,s[5+6*2]=1;let g=3;const a=g;let l;const c=n;let C;do{if(r=a-g,s[r+n*r]===0){for(o=r+1;o<a;o++)if(s[r+n*o]!==0){l=c;do C=c-l,s[C+n*r]+=s[C+n*o];while(--l);break}}if(s[r+n*r]!==0)for(o=r+1;o<a;o++){const h=s[r+n*o]/s[r+n*r];l=c;do C=c-l,s[C+n*o]=C<=r?0:s[C+n*o]-s[C+n*r]*h;while(--l)}}while(--g);r=2;do{o=r-1;do{const h=s[r+n*o]/s[r+n*r];l=n;do C=n-l,s[C+n*o]=s[C+n*o]-s[C+n*r]*h;while(--l)}while(o--)}while(--r);r=2;do{const h=1/s[r+n*r];l=n;do C=n-l,s[C+n*r]=s[C+n*r]*h;while(--l)}while(r--);r=2;do{o=2;do{if(C=s[t+o+n*r],isNaN(C)||C===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(r,o,C)}while(o--)}while(r--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,s=e.z,r=e.w,o=t+t,g=n+n,a=s+s,l=t*o,c=t*g,C=t*a,h=n*g,p=n*a,m=s*a,f=r*o,b=r*g,y=r*a,v=this.elements;return v[3*0+0]=1-(h+m),v[3*0+1]=c-y,v[3*0+2]=C+b,v[3*1+0]=c+y,v[3*1+1]=1-(l+m),v[3*1+2]=p-f,v[3*2+0]=C-b,v[3*2+1]=p+f,v[3*2+2]=1-(l+h),this}transpose(e){e===void 0&&(e=new qa);const t=this.elements,n=e.elements;let s;return n[0]=t[0],n[4]=t[4],n[8]=t[8],s=t[1],n[1]=t[3],n[3]=s,s=t[2],n[2]=t[6],n[6]=s,s=t[5],n[5]=t[7],n[7]=s,e}}const ej=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class P{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new P);const n=e.x,s=e.y,r=e.z,o=this.x,g=this.y,a=this.z;return t.x=g*r-a*s,t.y=a*n-o*r,t.z=o*s-g*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new P(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new P(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new qa([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,s=Math.sqrt(e*e+t*t+n*n);if(s>0){const r=1/s;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new P);const t=this.x,n=this.y,s=this.z;let r=Math.sqrt(t*t+n*n+s*s);return r>0?(r=1/r,e.x=t*r,e.y=n*r,e.z=s*r):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,g=e.z;return Math.sqrt((r-t)*(r-t)+(o-n)*(o-n)+(g-s)*(g-s))}distanceSquared(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,g=e.z;return(r-t)*(r-t)+(o-n)*(o-n)+(g-s)*(g-s)}scale(e,t){t===void 0&&(t=new P);const n=this.x,s=this.y,r=this.z;return t.x=e*n,t.y=e*s,t.z=e*r,t}vmul(e,t){return t===void 0&&(t=new P),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new P),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new P),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const s=tj,r=1/n;s.set(this.x*r,this.y*r,this.z*r);const o=nj;Math.abs(s.x)<.9?(o.set(1,0,0),s.cross(o,e)):(o.set(0,1,0),s.cross(o,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const s=this.x,r=this.y,o=this.z;n.x=s+(e.x-s)*t,n.y=r+(e.y-r)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(Q3),Q3.almostEquals(e,t)}clone(){return new P(this.x,this.y,this.z)}}P.ZERO=new P(0,0,0);P.UNIT_X=new P(1,0,0);P.UNIT_Y=new P(0,1,0);P.UNIT_Z=new P(0,0,1);const tj=new P,nj=new P,Q3=new P;class sg{constructor(e){e===void 0&&(e={}),this.lowerBound=new P,this.upperBound=new P,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,s){const r=this.lowerBound,o=this.upperBound,g=n;r.copy(e[0]),g&&g.vmult(r,r),o.copy(r);for(let a=1;a<e.length;a++){let l=e[a];g&&(g.vmult(l,j3),l=j3),l.x>o.x&&(o.x=l.x),l.x<r.x&&(r.x=l.x),l.y>o.y&&(o.y=l.y),l.y<r.y&&(r.y=l.y),l.z>o.z&&(o.z=l.z),l.z<r.z&&(r.z=l.z)}return t&&(t.vadd(r,r),t.vadd(o,o)),s&&(r.x-=s,r.y-=s,r.z-=s,o.x+=s,o.y+=s,o.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new sg().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,r=e.upperBound,o=s.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,g=s.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,a=s.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return o&&g&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,r=e.upperBound;return t.x<=s.x&&n.x>=r.x&&t.y<=s.y&&n.y>=r.y&&t.z<=s.z&&n.z>=r.z}getCorners(e,t,n,s,r,o,g,a){const l=this.lowerBound,c=this.upperBound;e.copy(l),t.set(c.x,l.y,l.z),n.set(c.x,c.y,l.z),s.set(l.x,c.y,c.z),r.set(c.x,l.y,c.z),o.set(l.x,c.y,l.z),g.set(l.x,l.y,c.z),a.copy(c)}toLocalFrame(e,t){const n=q3,s=n[0],r=n[1],o=n[2],g=n[3],a=n[4],l=n[5],c=n[6],C=n[7];this.getCorners(s,r,o,g,a,l,c,C);for(let h=0;h!==8;h++){const p=n[h];e.pointToLocal(p,p)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=q3,s=n[0],r=n[1],o=n[2],g=n[3],a=n[4],l=n[5],c=n[6],C=n[7];this.getCorners(s,r,o,g,a,l,c,C);for(let h=0;h!==8;h++){const p=n[h];e.pointToWorld(p,p)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,s=1/t.x,r=1/t.y,o=1/t.z,g=(this.lowerBound.x-n.x)*s,a=(this.upperBound.x-n.x)*s,l=(this.lowerBound.y-n.y)*r,c=(this.upperBound.y-n.y)*r,C=(this.lowerBound.z-n.z)*o,h=(this.upperBound.z-n.z)*o,p=Math.max(Math.max(Math.min(g,a),Math.min(l,c)),Math.min(C,h)),m=Math.min(Math.min(Math.max(g,a),Math.max(l,c)),Math.max(C,h));return!(m<0||p>m)}}const j3=new P,q3=[new P,new P,new P,new P,new P,new P,new P,new P];class sr{constructor(e,t,n,s){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=n,this.w=s}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new P),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=ij,s=sj;e.tangents(n,s),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new sr);const n=this.x,s=this.y,r=this.z,o=this.w,g=e.x,a=e.y,l=e.z,c=e.w;return t.x=n*c+o*g+s*l-r*a,t.y=s*c+o*a+r*g-n*l,t.z=r*c+o*l+n*a-s*g,t.w=o*c-n*g-s*a-r*l,t}inverse(e){e===void 0&&(e=new sr);const t=this.x,n=this.y,s=this.z,r=this.w;this.conjugate(e);const o=1/(t*t+n*n+s*s+r*r);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new sr),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new P);const n=e.x,s=e.y,r=e.z,o=this.x,g=this.y,a=this.z,l=this.w,c=l*n+g*r-a*s,C=l*s+a*n-o*r,h=l*r+o*s-g*n,p=-o*n-g*s-a*r;return t.x=c*l+p*-o+C*-a-h*-g,t.y=C*l+p*-g+h*-o-c*-a,t.z=h*l+p*-a+c*-g-C*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,s,r;const o=this.x,g=this.y,a=this.z,l=this.w;switch(t){case"YZX":const c=o*g+a*l;if(c>.499&&(n=2*Math.atan2(o,l),s=Math.PI/2,r=0),c<-.499&&(n=-2*Math.atan2(o,l),s=-Math.PI/2,r=0),n===void 0){const C=o*o,h=g*g,p=a*a;n=Math.atan2(2*g*l-2*o*a,1-2*h-2*p),s=Math.asin(2*c),r=Math.atan2(2*o*l-2*g*a,1-2*C-2*p)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=s,e.x=r}setFromEuler(e,t,n,s){s===void 0&&(s="XYZ");const r=Math.cos(e/2),o=Math.cos(t/2),g=Math.cos(n/2),a=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(n/2);return s==="XYZ"?(this.x=a*o*g+r*l*c,this.y=r*l*g-a*o*c,this.z=r*o*c+a*l*g,this.w=r*o*g-a*l*c):s==="YXZ"?(this.x=a*o*g+r*l*c,this.y=r*l*g-a*o*c,this.z=r*o*c-a*l*g,this.w=r*o*g+a*l*c):s==="ZXY"?(this.x=a*o*g-r*l*c,this.y=r*l*g+a*o*c,this.z=r*o*c+a*l*g,this.w=r*o*g-a*l*c):s==="ZYX"?(this.x=a*o*g-r*l*c,this.y=r*l*g+a*o*c,this.z=r*o*c-a*l*g,this.w=r*o*g+a*l*c):s==="YZX"?(this.x=a*o*g+r*l*c,this.y=r*l*g+a*o*c,this.z=r*o*c-a*l*g,this.w=r*o*g-a*l*c):s==="XZY"&&(this.x=a*o*g-r*l*c,this.y=r*l*g-a*o*c,this.z=r*o*c+a*l*g,this.w=r*o*g+a*l*c),this}clone(){return new sr(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new sr);const s=this.x,r=this.y,o=this.z,g=this.w;let a=e.x,l=e.y,c=e.z,C=e.w,h,p,m,f,b;return p=s*a+r*l+o*c+g*C,p<0&&(p=-p,a=-a,l=-l,c=-c,C=-C),1-p>1e-6?(h=Math.acos(p),m=Math.sin(h),f=Math.sin((1-t)*h)/m,b=Math.sin(t*h)/m):(f=1-t,b=t),n.x=f*s+b*a,n.y=f*r+b*l,n.z=f*o+b*c,n.w=f*g+b*C,n}integrate(e,t,n,s){s===void 0&&(s=new sr);const r=e.x*n.x,o=e.y*n.y,g=e.z*n.z,a=this.x,l=this.y,c=this.z,C=this.w,h=t*.5;return s.x+=h*(r*C+o*c-g*l),s.y+=h*(o*C+g*a-r*c),s.z+=h*(g*C+r*l-o*a),s.w+=h*(-r*a-o*l-g*c),s}}const ij=new P,sj=new P,rj={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class yt{constructor(e){e===void 0&&(e={}),this.id=yt.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}yt.idCounter=0;yt.types=rj;class Br{constructor(e){e===void 0&&(e={}),this.position=new P,this.quaternion=new sr,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Br.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Br.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new P),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,s){return s===void 0&&(s=new P),n.vsub(e,s),t.conjugate($3),$3.vmult(s,s),s}static pointToWorldFrame(e,t,n,s){return s===void 0&&(s=new P),t.vmult(n,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new P),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,s){return s===void 0&&(s=new P),t.w*=-1,t.vmult(n,s),t.w*=-1,s}}const $3=new sr;new P;new P;new P;new P;new P,new P,new P,new P,new P,new P,new P,new P;new P;new sr;new sg;new qa;new qa;new qa;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new sr;new P;new P;new P;new P;class o1{constructor(){this.rayFromWorld=new P,this.rayToWorld=new P,this.hitNormalWorld=new P,this.hitPointWorld=new P,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,s,r,o,g){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(s),this.shape=r,this.body=o,this.distance=g}}let vY,ZY,wY,SY,RY,WY,xY;const pw={CLOSEST:1,ANY:2,ALL:4};vY=yt.types.SPHERE;ZY=yt.types.PLANE;wY=yt.types.BOX;SY=yt.types.CYLINDER;RY=yt.types.CONVEXPOLYHEDRON;WY=yt.types.HEIGHTFIELD;xY=yt.types.TRIMESH;class Ms{get[vY](){return this._intersectSphere}get[ZY](){return this._intersectPlane}get[wY](){return this._intersectBox}get[SY](){return this._intersectConvex}get[RY](){return this._intersectConvex}get[WY](){return this._intersectHeightfield}get[xY](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new P),t===void 0&&(t=new P),this.from=e.clone(),this.to=t.clone(),this.direction=new P,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ms.ANY,this.result=new o1,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Ms.ANY,this.result=t.result||new o1,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(e5),n2.length=0,e.broadphase.aabbQuery(e,e5,n2),this.intersectBodies(n2),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const s=oj,r=gj;for(let o=0,g=e.shapes.length;o<g;o++){const a=e.shapes[o];if(!(n&&!a.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],r),e.quaternion.vmult(e.shapeOffsets[o],s),s.vadd(e.position,s),this.intersectShape(a,r,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,s=e.length;!this.result.shouldStop&&n<s;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,s){const r=this.from;if(Gj(r,this.direction,n)>e.boundingSphereRadius)return;const g=this[e.type];g&&g.call(this,e,t,n,s,e)}_intersectBox(e,t,n,s,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,s,r)}_intersectPlane(e,t,n,s,r){const o=this.from,g=this.to,a=this.direction,l=new P(0,0,1);t.vmult(l,l);const c=new P;o.vsub(n,c);const C=c.dot(l);g.vsub(n,c);const h=c.dot(l);if(C*h>0||o.distanceTo(g)<C)return;const p=l.dot(a);if(Math.abs(p)<this.precision)return;const m=new P,f=new P,b=new P;o.vsub(n,m);const y=-l.dot(m)/p;a.scale(y,f),o.vadd(f,b),this.reportIntersection(l,b,r,s,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,s=this.to,r=this.from;t.x=Math.min(s.x,r.x),t.y=Math.min(s.y,r.y),t.z=Math.min(s.z,r.z),n.x=Math.max(s.x,r.x),n.y=Math.max(s.y,r.y),n.z=Math.max(s.z,r.z)}_intersectHeightfield(e,t,n,s,r){e.data,e.elementSize;const o=aj;o.from.copy(this.from),o.to.copy(this.to),Br.pointToLocalFrame(n,t,o.from,o.from),Br.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const g=lj;let a,l,c,C;a=l=0,c=C=e.data.length-1;const h=new sg;o.getAABB(h),e.getIndexOfPosition(h.lowerBound.x,h.lowerBound.y,g,!0),a=Math.max(a,g[0]),l=Math.max(l,g[1]),e.getIndexOfPosition(h.upperBound.x,h.upperBound.y,g,!0),c=Math.min(c,g[0]+1),C=Math.min(C,g[1]+1);for(let p=a;p<c;p++)for(let m=l;m<C;m++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(p,m,h),!!h.overlapsRay(o)){if(e.getConvexTrianglePillar(p,m,!1),Br.pointToWorldFrame(n,t,e.pillarOffset,x0),this._intersectConvex(e.pillarConvex,t,x0,s,r,t5),this.result.shouldStop)return;e.getConvexTrianglePillar(p,m,!0),Br.pointToWorldFrame(n,t,e.pillarOffset,x0),this._intersectConvex(e.pillarConvex,t,x0,s,r,t5)}}}_intersectSphere(e,t,n,s,r){const o=this.from,g=this.to,a=e.radius,l=(g.x-o.x)**2+(g.y-o.y)**2+(g.z-o.z)**2,c=2*((g.x-o.x)*(o.x-n.x)+(g.y-o.y)*(o.y-n.y)+(g.z-o.z)*(o.z-n.z)),C=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-a**2,h=c**2-4*l*C,p=cj,m=Ij;if(!(h<0))if(h===0)o.lerp(g,h,p),p.vsub(n,m),m.normalize(),this.reportIntersection(m,p,r,s,-1);else{const f=(-c-Math.sqrt(h))/(2*l),b=(-c+Math.sqrt(h))/(2*l);if(f>=0&&f<=1&&(o.lerp(g,f,p),p.vsub(n,m),m.normalize(),this.reportIntersection(m,p,r,s,-1)),this.result.shouldStop)return;b>=0&&b<=1&&(o.lerp(g,b,p),p.vsub(n,m),m.normalize(),this.reportIntersection(m,p,r,s,-1))}}_intersectConvex(e,t,n,s,r,o){const g=uj,a=n5,l=o&&o.faceList||null,c=e.faces,C=e.vertices,h=e.faceNormals,p=this.direction,m=this.from,f=this.to,b=m.distanceTo(f),y=l?l.length:c.length,v=this.result;for(let G=0;!v.shouldStop&&G<y;G++){const w=l?l[G]:G,W=c[w],V=h[w],X=t,R=n;a.copy(C[W[0]]),X.vmult(a,a),a.vadd(R,a),a.vsub(m,a),X.vmult(V,g);const Y=p.dot(g);if(Math.abs(Y)<this.precision)continue;const M=g.dot(a)/Y;if(!(M<0)){p.scale(M,Gr),Gr.vadd(m,Gr),Gg.copy(C[W[0]]),X.vmult(Gg,Gg),R.vadd(Gg,Gg);for(let L=1;!v.shouldStop&&L<W.length-1;L++){na.copy(C[W[L]]),ia.copy(C[W[L+1]]),X.vmult(na,na),X.vmult(ia,ia),R.vadd(na,na),R.vadd(ia,ia);const re=Gr.distanceTo(m);!(Ms.pointInTriangle(Gr,Gg,na,ia)||Ms.pointInTriangle(Gr,na,Gg,ia))||re>b||this.reportIntersection(g,Gr,r,s,w)}}}}_intersectTrimesh(e,t,n,s,r,o){const g=Cj,a=mj,l=bj,c=n5,C=dj,h=hj,p=Aj,m=fj,f=pj,b=e.indices;e.vertices;const y=this.from,v=this.to,G=this.direction;l.position.copy(n),l.quaternion.copy(t),Br.vectorToLocalFrame(n,t,G,C),Br.pointToLocalFrame(n,t,y,h),Br.pointToLocalFrame(n,t,v,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,p.vsub(h,C),C.normalize();const w=h.distanceSquared(p);e.tree.rayQuery(this,l,a);for(let W=0,V=a.length;!this.result.shouldStop&&W!==V;W++){const X=a[W];e.getNormal(X,g),e.getVertex(b[X*3],Gg),Gg.vsub(h,c);const R=C.dot(g),Y=g.dot(c)/R;if(Y<0)continue;C.scale(Y,Gr),Gr.vadd(h,Gr),e.getVertex(b[X*3+1],na),e.getVertex(b[X*3+2],ia);const M=Gr.distanceSquared(h);!(Ms.pointInTriangle(Gr,na,Gg,ia)||Ms.pointInTriangle(Gr,Gg,na,ia))||M>w||(Br.vectorToWorldFrame(t,g,f),Br.pointToWorldFrame(n,t,Gr,m),this.reportIntersection(f,m,r,s,X))}a.length=0}reportIntersection(e,t,n,s,r){const o=this.from,g=this.to,a=o.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=typeof r<"u"?r:-1,this.mode){case Ms.ALL:this.hasHit=!0,l.set(o,g,e,t,n,s,a),l.hasHit=!0,this.callback(l);break;case Ms.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(o,g,e,t,n,s,a));break;case Ms.ANY:this.hasHit=!0,l.hasHit=!0,l.set(o,g,e,t,n,s,a),l.shouldStop=!0;break}}static pointInTriangle(e,t,n,s){s.vsub(t,JI),n.vsub(t,SA),e.vsub(t,i2);const r=JI.dot(JI),o=JI.dot(SA),g=JI.dot(i2),a=SA.dot(SA),l=SA.dot(i2);let c,C;return(c=a*g-o*l)>=0&&(C=r*l-o*g)>=0&&c+C<r*a-o*o}}Ms.CLOSEST=pw.CLOSEST;Ms.ANY=pw.ANY;Ms.ALL=pw.ALL;const e5=new sg,n2=[],SA=new P,i2=new P,oj=new P,gj=new sr,Gr=new P,Gg=new P,na=new P,ia=new P;new P;new o1;const t5={faceList:[0]},x0=new P,aj=new Ms,lj=[],cj=new P,Ij=new P,uj=new P;new P;new P;const n5=new P,Cj=new P,dj=new P,hj=new P,Aj=new P,pj=new P,fj=new P;new sg;const mj=[],bj=new Br,JI=new P,V0=new P;function Gj(i,e,t){t.vsub(i,JI);const n=JI.dot(e);return e.scale(n,V0),V0.vadd(i,V0),t.distanceTo(V0)}new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new Ms;new P;new P;new P;new P(1,0,0),new P(0,1,0),new P(0,0,1);new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new sg;new P;new sg;new P;new P;new P;new P;new P;new P;new P;new sg;new P;new Br;new sg;yt.types.SPHERE,yt.types.SPHERE|yt.types.PLANE,yt.types.BOX|yt.types.BOX,yt.types.SPHERE|yt.types.BOX,yt.types.PLANE|yt.types.BOX,yt.types.CONVEXPOLYHEDRON,yt.types.SPHERE|yt.types.CONVEXPOLYHEDRON,yt.types.PLANE|yt.types.CONVEXPOLYHEDRON,yt.types.BOX|yt.types.CONVEXPOLYHEDRON,yt.types.SPHERE|yt.types.HEIGHTFIELD,yt.types.BOX|yt.types.HEIGHTFIELD,yt.types.CONVEXPOLYHEDRON|yt.types.HEIGHTFIELD,yt.types.PARTICLE|yt.types.SPHERE,yt.types.PLANE|yt.types.PARTICLE,yt.types.BOX|yt.types.PARTICLE,yt.types.PARTICLE|yt.types.CONVEXPOLYHEDRON,yt.types.CYLINDER,yt.types.SPHERE|yt.types.CYLINDER,yt.types.PLANE|yt.types.CYLINDER,yt.types.BOX|yt.types.CYLINDER,yt.types.CONVEXPOLYHEDRON|yt.types.CYLINDER,yt.types.HEIGHTFIELD|yt.types.CYLINDER,yt.types.PARTICLE|yt.types.CYLINDER,yt.types.SPHERE|yt.types.TRIMESH,yt.types.PLANE|yt.types.TRIMESH;new P;new P;new P;new P;new P;new sr;new sr;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new sg;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P,new P,new P,new P,new P,new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new P;new sr;new P;new P;new P;new P;new P;new P;new P;new P;new P;new sg;new Ms;const RA=globalThis.performance||{};if(!RA.now){let i=Date.now();RA.timing&&RA.timing.navigationStart&&(i=RA.timing.navigationStart),RA.now=()=>Date.now()-i}new P;const yj=T.createContext(null),Bj=()=>T.useContext(yj),VY=T.createContext(null),HY=()=>{const i=T.useContext(VY);if(!i)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return i};new E(1,1,1);new E;new mt;const i5=new en;function XY(i){const e=T.useRef(null);return i&&typeof i!="function"?i:e}function s5(i){return i.charAt(0).toUpperCase()+i.slice(1)}function pi(i,e){const t=e===void 0?"":`/${e}`;return typeof i=="function"?null:i&&i.current&&`${i.current.uuid}${t}`}const vj=new Ru,Zj=new jn,wj=i=>e=>i(vj.setFromQuaternion(Zj.fromArray(e)).toArray());let YY=0;function ob(i,e,t,n,s,r){return r===void 0&&(r="bodies"),o=>{const g=YY++;t[g]={[n]:o};const a=pi(i,s);return a&&e.subscribe({props:{id:g,target:r,type:n},uuid:a}),()=>{delete t[g],e.unsubscribe({props:g})}}}function r5(i,e){let{position:t=[0,0,0],rotation:n=[0,0,0],userData:s={}}=e;i.userData=s,i.position.set(...t),i.rotation.set(...n),i.updateMatrix()}function o5(i,e,t){let{onCollide:n,onCollideBegin:s,onCollideEnd:r}=e;i[t]={collide:n,collideBegin:s,collideEnd:r}}function fw(i,e,t,n,s){n===void 0&&(n=null),s===void 0&&(s=[]);const r=XY(n),{events:o,refs:g,scaleOverrides:a,subscriptions:l,worker:c}=HY(),C=Bj();T.useLayoutEffect(()=>{r.current||(r.current=new en);const p=r.current,m=c,f=p instanceof wc?(p.instanceMatrix.setUsage(Hb),p.count):1,b=p instanceof wc?new Array(f).fill(0).map((v,G)=>`${p.uuid}/${G}`):[p.uuid],y=p instanceof wc?b.map((v,G)=>{const w=e(G);return r5(i5,w),p.setMatrixAt(G,i5.matrix),p.instanceMatrix.needsUpdate=!0,g[v]=p,C==null||C.add(v,w,i),o5(o,w,v),{...w,args:t(w.args)}}):b.map((v,G)=>{const w=e(G);return r5(p,w),g[v]=p,C==null||C.add(v,w,i),o5(o,w,v),{...w,args:t(w.args)}});return m.addBodies({props:y.map(v=>{let{onCollide:G,onCollideBegin:w,onCollideEnd:W,...V}=v;return{onCollide:!!G,...V}}),type:i,uuid:b}),()=>{b.forEach(v=>{delete g[v],C==null||C.remove(v),delete o[v]}),m.removeBodies({uuid:b})}},s);const h=T.useMemo(()=>{const p=(G,w)=>{const W=`set${s5(G)}`;return{set:V=>{const X=pi(r,w);X&&c[W]({props:V,uuid:X})},subscribe:ob(r,c,l,G,w)}},m=G=>({copy:W=>{let{w:V,x:X,y:R,z:Y}=W;const M=pi(r,G);M&&c.setQuaternion({props:[X,R,Y,V],uuid:M})},set:(W,V,X,R)=>{const Y=pi(r,G);Y&&c.setQuaternion({props:[W,V,X,R],uuid:Y})},subscribe:ob(r,c,l,"quaternion",G)}),f=G=>({copy:w=>{let{x:W,y:V,z:X}=w;const R=pi(r,G);R&&c.setRotation({props:[W,V,X],uuid:R})},set:(w,W,V)=>{const X=pi(r,G);X&&c.setRotation({props:[w,W,V],uuid:X})},subscribe:w=>{const W=YY++,V="bodies",X="quaternion",R=pi(r,G);return l[W]={[X]:wj(w)},R&&c.subscribe({props:{id:W,target:V,type:X},uuid:R}),()=>{delete l[W],c.unsubscribe({props:W})}}}),b=(G,w)=>{const W=`set${s5(G)}`;return{copy:V=>{let{x:X,y:R,z:Y}=V;const M=pi(r,w);M&&c[W]({props:[X,R,Y],uuid:M})},set:(V,X,R)=>{const Y=pi(r,w);Y&&c[W]({props:[V,X,R],uuid:Y})},subscribe:ob(r,c,l,G,w)}};function y(G){return{allowSleep:p("allowSleep",G),angularDamping:p("angularDamping",G),angularFactor:b("angularFactor",G),angularVelocity:b("angularVelocity",G),applyForce(w,W){const V=pi(r,G);V&&c.applyForce({props:[w,W],uuid:V})},applyImpulse(w,W){const V=pi(r,G);V&&c.applyImpulse({props:[w,W],uuid:V})},applyLocalForce(w,W){const V=pi(r,G);V&&c.applyLocalForce({props:[w,W],uuid:V})},applyLocalImpulse(w,W){const V=pi(r,G);V&&c.applyLocalImpulse({props:[w,W],uuid:V})},applyTorque(w){const W=pi(r,G);W&&c.applyTorque({props:[w],uuid:W})},collisionFilterGroup:p("collisionFilterGroup",G),collisionFilterMask:p("collisionFilterMask",G),collisionResponse:p("collisionResponse",G),fixedRotation:p("fixedRotation",G),isTrigger:p("isTrigger",G),linearDamping:p("linearDamping",G),linearFactor:b("linearFactor",G),mass:p("mass",G),material:p("material",G),position:b("position",G),quaternion:m(G),rotation:f(G),scaleOverride(w){const W=pi(r,G);W&&(a[W]=new E(...w))},sleep(){const w=pi(r,G);w&&c.sleep({uuid:w})},sleepSpeedLimit:p("sleepSpeedLimit",G),sleepTimeLimit:p("sleepTimeLimit",G),userData:p("userData",G),velocity:b("velocity",G),wakeUp(){const w=pi(r,G);w&&c.wakeUp({uuid:w})}}}const v={};return{...y(void 0),at:G=>v[G]||(v[G]=y(G))}},[]);return[r,h]}function Sj(i,e,t){return fw("Plane",i,()=>[],e,t)}function uf(i,e,t){const n=[1,1,1];return fw("Box",i,function(s){return s===void 0&&(s=n),s},e,t)}function H0(i,e,t){return fw("Compound",i,n=>n,e,t)}function Rj(i){return typeof i=="string"}function Wj(i,e,t){e===void 0&&(e=null),t===void 0&&(t=[]);const n=XY(e),{worker:s,subscriptions:r}=HY();T.useLayoutEffect(()=>{n.current||(n.current=new en);const g=s,a=n.current.uuid,{chassisBody:l,indexForwardAxis:c=2,indexRightAxis:C=0,indexUpAxis:h=1,wheelInfos:p,wheels:m}=i(),f=pi(l),b=m.map(y=>pi(y));if(!(!f||!b.every(Rj)))return g.addRaycastVehicle({props:[f,b,p,c,C,h],uuid:a}),()=>{g.removeRaycastVehicle({uuid:a})}},t);const o=T.useMemo(()=>({applyEngineForce(g,a){const l=pi(n);l&&s.applyRaycastVehicleEngineForce({props:[g,a],uuid:l})},setBrake(g,a){const l=pi(n);l&&s.setRaycastVehicleBrake({props:[g,a],uuid:l})},setSteeringValue(g,a){const l=pi(n);l&&s.setRaycastVehicleSteeringValue({props:[g,a],uuid:l})},sliding:{subscribe:ob(n,s,r,"sliding",void 0,"vehicles")}}),t);return[n,o]}const xj=new E,Vj=new E(1,1,1),Hj=new jn,X0=new mt;function g5(i,e,t,n,s){return n===void 0&&(n=Vj),i!==void 0?(X0.compose(xj.fromArray(e,i*3),Hj.fromArray(t,i*4),n),s&&(s.matrixAutoUpdate=!1,s.matrix.copy(X0)),X0):X0.identity()}const Xj=()=>{const i=[];return e=>i.includes(e)?!1:!!i.push(e)};function Yj(i){let{allowSleep:e=!1,axisIndex:t=0,broadphase:n="Naive",children:s,defaultContactMaterial:r={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:g=[0,-9.81,0],isPaused:a=!1,iterations:l=5,maxSubSteps:c=10,quatNormalizeFast:C=!1,quatNormalizeSkip:h=0,shouldInvalidate:p=!0,size:m=1e3,solver:f="GS",stepSize:b=1/60,tolerance:y=.001}=i;const{invalidate:v}=Ui(),[{bodies:G,events:w,refs:W,scaleOverrides:V,subscriptions:X,worker:R}]=T.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new V6({allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:r,frictionGravity:o,gravity:g,iterations:l,quatNormalizeFast:C,quatNormalizeSkip:h,size:m,solver:f,tolerance:y})}));let Y=0;const M=T.useCallback((le,_)=>{a||(Y+=_,R.step({maxSubSteps:c,stepSize:b,timeSinceLastCalled:Y}),Y=0)},[a,c,b]),L=le=>{var _;let{body:ne,contact:{bi:te,bj:q,...se},target:ue,...Ae}=le;const We=(_=w[ue])==null?void 0:_.collide;We&&We({body:W[ne],contact:{bi:W[te],bj:W[q],...se},target:W[ue],...Ae})},re=le=>{var _,ne;let{bodyA:te,bodyB:q}=le;const se=(_=w[te])==null?void 0:_.collideBegin;se&&se({body:W[q],op:"event",target:W[te],type:"collideBegin"});const ue=(ne=w[q])==null?void 0:ne.collideBegin;ue&&ue({body:W[te],op:"event",target:W[q],type:"collideBegin"})},j=le=>{var _,ne;let{bodyA:te,bodyB:q}=le;const se=(_=w[te])==null?void 0:_.collideEnd;se&&se({body:W[q],op:"event",target:W[te],type:"collideEnd"});const ue=(ne=w[q])==null?void 0:ne.collideEnd;ue&&ue({body:W[te],op:"event",target:W[q],type:"collideEnd"})},$=le=>{let{active:_,bodies:ne=[],observations:te,positions:q,quaternions:se}=le;for(let ue=0;ue<ne.length;ue++)G[ne[ue]]=ue;if(te.forEach(ue=>{let[Ae,We,me]=ue;const Oe=(X[Ae]||{})[me];Oe&&Oe(We)}),!!_){for(const ue of Object.values(W).filter(Xj()))if(ue instanceof wc)for(let Ae=0;Ae<ue.count;Ae++){const We=`${ue.uuid}/${Ae}`,me=G[We];me!==void 0&&(ue.setMatrixAt(Ae,g5(me,q,se,V[We])),ue.instanceMatrix.needsUpdate=!0)}else{const Ae=V[ue.uuid]||ue.scale;g5(G[ue.uuid],q,se,Ae,ue)}p&&v()}},ie=le=>{var _;let{body:ne,ray:{uuid:te,...q},...se}=le;const ue=(_=w[te])==null?void 0:_.rayhit;ue&&ue({body:ne?W[ne]:null,ray:{uuid:te,...q},...se})};Aa(M),T.useEffect(()=>(R.connect(),R.init(),R.on("collide",L),R.on("collideBegin",re),R.on("collideEnd",j),R.on("frame",$),R.on("rayhit",ie),()=>{R.terminate(),R.removeAllListeners()}),[]),T.useEffect(()=>{R.axisIndex=t},[t]),T.useEffect(()=>{R.broadphase=n},[n]),T.useEffect(()=>{R.gravity=g},[g]),T.useEffect(()=>{R.iterations=l},[l]),T.useEffect(()=>{R.tolerance=y},[y]);const he=T.useMemo(()=>({bodies:G,events:w,refs:W,scaleOverrides:V,subscriptions:X,worker:R}),[G,w,W,X,R]);return D(VY.Provider,{value:he,children:s})}const Fj=(i,e)=>{const t=[T.useRef(null),T.useRef(null),T.useRef(null),T.useRef(null)],n={radius:e,directionLocal:[0,-1,0],axleLocal:[-1,0,0],suspensionStiffness:50,suspensionRestLength:.5,frictionSlip:5,dampingRelaxation:2.5,dampingCompression:10,maxSuspensionForce:2e5,rollInfluence:.01,maxSuspensionTravel:.25,customSlidingRotationalSpeed:-1e5,useCustomSlidingRotationalSpeed:!0},s=[{...n,chassisConnectionPointLocal:[-.7,.05,-i+.65],isFrontWheel:!1},{...n,chassisConnectionPointLocal:[.7,.05,-i+.65],isFrontWheel:!1},{...n,chassisConnectionPointLocal:[-.7,.05,i-.65],isFrontWheel:!0},{...n,chassisConnectionPointLocal:[.7,.05,i-.65],isFrontWheel:!0}],r=()=>({collisionFilterGroup:0,mass:1,shapes:[{args:[n.radius,n.radius,.3,32],rotation:[0,0,Math.PI/2],type:"Cylinder"}],type:"Kinematic"});return H0(r,t[0]),H0(r,t[1]),H0(r,t[2]),H0(r,t[3]),[t,s]},Y0=({wheelRef:i})=>D("group",{ref:i}),io=gf(kX(i=>({elapsedTime:0,phase:"ready",startLoading:()=>{i(e=>e.phase==="ready"?{phase:"loading"}:e)},countdown:()=>{i(()=>({phase:"countdown"}))},startGame:()=>{i(()=>({phase:"playing",startTime:Date.now(),endTime:0}))},pause:()=>{i(e=>{if(e.phase==="playing"){const t=Date.now()-e.startTime;return{phase:"paused",pauseTime:Date.now(),elapsedTime:t}}return e})},resume:()=>{i(e=>e.phase==="paused"?{phase:"playing",startTime:Date.now()-e.elapsedTime,endTime:e.endTime,elapsedTime:e.elapsedTime}:e)},restart:()=>{i(e=>e.phase==="playing"||e.phase==="ended"||e.phase==="paused"?{phase:"countdown"}:e)},end:()=>{i(e=>e.phase==="playing"?{phase:"ended",endTime:Date.now()}:e)},quit:()=>{i(e=>e.phase==="playing"||e.phase==="ended"||e.phase==="paused"?{phase:"ready"}:e)},startTime:0,endTime:0,pauseTime:0}))),Nj=(i,e,t,n,s,r,o,g)=>{const[a,l]=T.useState({}),[c,C]=EX(),[h,p]=T.useState(!1),m=[[44,.7,-5],[-28,.7,-12],[2,.7,44]],f=[[0,Math.PI,0],[0,Math.PI/2,0],[0,Math.PI/2,0]];var b=0;const{phase:y}=io(v=>v);return Aa((v,G)=>{if(!(!i||!e)&&y==="playing"){const{forward:w,backward:W,leftward:V,rightward:X,brake:R,reset:Y}=C();if(w?(n===0&&o(!1),i.applyEngineForce(-s*.6,0),i.applyEngineForce(-s*.6,1),i.applyEngineForce(-s,2),i.applyEngineForce(-s,3)):W?(t>20?b=s/10:b=s/2,n===0&&o(!0),i.applyEngineForce(b*.6,0),i.applyEngineForce(b*.6,1),i.applyEngineForce(b,2),i.applyEngineForce(b,3)):(i.applyEngineForce(0,0),i.applyEngineForce(0,1),i.applyEngineForce(0,2),i.applyEngineForce(0,3)),R&&!h?(p(!0),i.setBrake(r,0),i.setBrake(r,1),i.setBrake(r/2,2),i.setBrake(r/2,3)):!R&&h&&(p(!1),i.setBrake(0,0),i.setBrake(0,1),i.setBrake(0,2),i.setBrake(0,3)),V)i.setSteeringValue(.4,2),i.setSteeringValue(.4,3);else if(X)i.setSteeringValue(-.4,2),i.setSteeringValue(-.4,3);else for(let M=0;M<4;M++)i.setSteeringValue(0,M);Y&&(e.position.set(...m[g]),e.velocity.set(0,0,0),e.angularVelocity.set(0,0,0),e.rotation.set(...f[g]))}},[a,i,e,g]),a},Mj=T.forwardRef((i,e)=>D(pQ,{makeDefault:!0,ref:e,fov:25,...i})),a5=[[0,40,-40],[0,20,-25]];function Kj({checkpoint:i}){const e=Ui(Ve=>Ve.camera),t=T.useRef(),n=T.useRef(),[s,r]=T.useState(!1),o=T.useRef(),g=T.useRef();var a=0;const[l,c]=EX(),[C,h]=T.useState(0),[p,m]=T.useState(0),[f,b]=T.useState(0),[y,v]=T.useState(0),[G,w]=T.useState(!1),[W,V]=T.useState("N"),[X,R]=T.useState(0),Y=new E,M=new p6;M.setDecoderPath("./draco-gltf/");const re=Yu(zQ,"./static/car.glb",Ve=>{Ve.setDRACOLoader(M)}).scene;re.traverse(Ve=>{if(Ve.isMesh){const qe={roughness:1,metalness:0,emissive:"#fff",emissiveIntensity:1};Ve.name==="Backlights"?(qe.color="#e55556",qe.emissiveIntensity=-.15):(qe.color="#ffffff",qe.emissive="#ffffff",qe.emissiveIntensity=.2),Ve.material=new jo(qe),Ve.castShadow=!0,Ve.receiveShadow=!0}});const j=[44,.7,-5],$=1.7,ie=1,he=1.85,le=.25,_=[$,ie,he*2],[ne,te]=uf(()=>({allowSleep:!1,args:_,mass:400,position:j,rotation:[0,Math.PI,0],userData:{name:"vehicle"}}),T.useRef(null)),[q,se]=Fj(he,le),[ue,Ae]=Wj(()=>({chassisBody:ne,indexForwardAxis:2,wheelInfos:se,wheels:q}),T.useRef(null));T.useEffect(()=>{re.scale.set(1,1,1)},[re]);const{phase:We}=io(Ve=>Ve),me=T.useRef();T.useEffect(()=>{We==="ended"&&Wn.to(me.current,{opacity:0,duration:.5})},[We]);const tt=()=>{const Ve=a===0?1:0;t.current.position.set(...a5[Ve]),a=1-a},Oe=T.useRef(m6.debounce(tt,50));T.useEffect(()=>()=>{Oe.current.cancel()},[]);const It=Ve=>{(Ve.key==="r"||Ve.key==="R")&&s&&(Wn.to(o.current,{opacity:0,duration:1}),setTimeout(()=>{r(!1)},1e3))};T.useEffect(()=>{s&&setTimeout(()=>{Wn.fromTo(g.current,{opacity:0},{opacity:1,yoyo:!0,repeat:-1,duration:1})},500)},[s]),T.useEffect(()=>(document.addEventListener("keydown",It),()=>{document.removeEventListener("keydown",It)}),[s]),T.useEffect(()=>{te.velocity.subscribe(Ve=>{const qe=Math.round(Y.set(...Ve).length()*3.6);h(qe)})},[]);const ke=[3e3,3200,2800,2400,1600,1600,0],je=[10,20,30,40,50,50,0],ve=[1,20,40,65,90,160,180];var be=0;return Aa((Ve,qe)=>{const{changeCamera:Xe}=c();Xe&&Oe.current();for(var Pe=0;Pe<ve.length+1;Pe++)if(C<=ve[Pe]){be=Pe;break}const ct=new E(0,0,0);ct.setFromMatrixPosition(t.current.matrixWorld),ct.y<10&&We==="playing"?r(!0):r(!1);const gt=be>=1&&be<=2?.5:.8,Yt=be>=1&&be<=2?.5:.2,Zt=be===0?ve[be]:ve[be]-ve[be-1],O=be===0?C:C-ve[be-1],z=O/Zt,ye=gt+Yt*z,Le=ke[be]*ye;m(be),b(Le),v(je[be]),V(G?"R":p===0?1:p===6?"5":p.toString()),R(C===1?2.5:G&&C>20||C>=160?100:O/Zt*100);const Te=new E(0,0,0);Te.setFromMatrixPosition(n.current.matrixWorld),new E(0,0,0).setFromMatrixPosition(e.matrixWorld),e.lookAt(Te)}),Nj(Ae,te,C,p,f,y,w,i),$e(Sr,{children:[$e("group",{ref:ue,name:"vehicle",children:[$e("group",{ref:ne,matrixWorldNeedsUpdate:!0,children:[D("primitive",{object:re,position:[0,-.7,-.1]}),D("object3D",{ref:n,position:[0,0,0],children:D(Mj,{ref:t,cameraRef:t,position:[...a5[0]]})})]}),D(Y0,{wheelRef:q[0]}),D(Y0,{wheelRef:q[1]}),D(Y0,{wheelRef:q[2]}),D(Y0,{wheelRef:q[3]})]}),$e(md,{wrapperClass:"vehicle-stats-overlay",className:"vehicle-stats",ref:me,children:[D("p",{className:"vehicle-transmission",children:W}),D("div",{className:"vehicle-gear-stats",children:D("div",{className:"vehicle-speed-bar",style:{width:`${X}%`}})}),D("p",{className:"vehicle-speed",children:C})]}),s?D(md,{wrapperClass:"reset-alert-overlay",className:"reset-alert",ref:o,children:D("div",{ref:g,className:"reset-message",children:"PRESS R TO RESET CAR"})}):null]})}const Lj=[[49.5,.5,2,90,56,1,1],[49.31269836,.5,-27.90215111,95.62499797,3.92,1,1],[48.57052231,.5,-31.63331795,106.8750025,3.92,1,1],[47.11470032,.5,-35.14799881,118.1249935,3.92,1,1],[45.0011673,.5,-38.31112671,129.3749981,3.92,1,1],[42.3111496,.5,-41,140.6250026,3.92,1,1],[39.14802551,.5,-43.11468506,151.8749936,3.92,1,1],[35.63335037,.5,-44.57052231,163.1249981,3.92,1,1],[31.90219116,.5,-45.31270981,174.3750027,3.92,1,1],[0,.5,-45.5,0,60,1,1],[-31.90209389,.5,-45.31279373,5.625000157,3.92,1,1],[-35.63330078,.5,-44.57061768,16.87500004,3.92,1,1],[-39.14795303,.5,-43.11479187,28.1249995,3.92,1,1],[-42.31108856,.5,-41.00125885,39.37499896,3.92,1,1],[-45.00111389,.5,-38.31124115,50.62500013,3.92,1,1],[-47.11465454,.5,-35.14810944,61.87499788,3.92,1,1],[-48.57048798,.5,-31.63343048,73.12500246,3.92,1,1],[-49.31266785,.5,-27.90226173,84.37500021,3.92,1,1],[-49.31267166,.5,-24.09799385,95.62499797,3.92,1,1],[-48.57049942,.5,-20.36681938,106.8750025,3.92,1,1],[-47.1146698,.5,-16.85213089,118.1249935,3.92,1,1],[-45.00113678,.5,-13.6889925,129.3749981,3.92,1,1],[-42.31111145,.5,-10.99896717,140.6250026,3.92,1,1],[-39.14798355,.5,-8.885430336,151.8749936,3.92,1,1],[-35.63330078,.5,-7.429598808,163.1249981,3.92,1,1],[-31.90213394,.5,-6.687418938,174.3750027,3.92,1,1],[-15,.5,-6.5,0,30,1,1],[.829134941,.5,-6.418410301,174.3750027,1.76,1,1],[2.455499887,.5,-6.094900131,163.1249981,1.76,1,1],[5.366380215,.5,-4.539010048,140.6250026,1.76,1,1],[6.538949966,.5,-3.366430044,129.3749981,1.76,1,1],[7.460229874,.5,-1.98763001,118.1249935,1.76,1,1],[3.987560034,.5,-5.460299969,151.8749936,1.76,1,1],[8.418330193,.5,1.170819998,95.62499797,1.76,1,1],[8.418330193,.5,2.829090118,-95.62499797,1.76,1,1],[8.094820023,.5,4.455500126,-106.8750025,1.76,1,1],[8.094820023,.5,-.455588013,106.8750025,1.76,1,1],[7.460229874,.5,5.987539768,-118.1249935,1.76,1,1],[6.538939953,.5,7.36634016,-129.3749981,1.76,1,1],[3.987570047,.5,9.460189819,-151.8749936,1.76,1,1],[2.455529928,.5,10.0948,-163.1249981,1.76,1,1],[.82912302,.5,10.41829967,-174.3750027,1.76,1,1],[5.366370201,.5,8.538909912,-140.6250026,1.76,1,1],[-1.902143717,.5,10.68730545,5.625000157,3.92,1,1],[-5.633311272,.5,11.42948151,16.87500004,3.92,1,1],[-9.147992134,.5,12.88531303,28.1249995,3.92,1,1],[-12.31112099,.5,14.99885178,39.37499896,3.92,1,1],[-15.0011425,.5,17.68887711,50.62500013,3.92,1,1],[-17.11467743,.5,20.85200882,61.87499788,3.92,1,1],[-18.57050323,.5,24.36669159,73.12500246,3.92,1,1],[-19.31267929,.5,28.09786034,84.37500021,3.92,1,1],[-19.31267929,.5,31.90212822,95.62499797,3.92,1,1],[-18.57050514,.5,35.63328934,106.8750025,3.92,1,1],[-17.11467552,.5,39.14796829,118.1249935,3.92,1,1],[-15.00113869,.5,42.31110382,129.3749981,3.92,1,1],[-12.31111622,.5,45.00112152,140.6250026,3.92,1,1],[-9.147985458,.5,47.11465454,151.8749936,3.92,1,1],[-5.633303165,.5,48.57048798,163.1249981,3.92,1,1],[-1.902136087,.5,49.31266022,174.3750027,3.92,1,1],[15,.5,49.5,0,30,1,1],[31.90213013,.5,49.31266022,5.625000157,3.92,1,1],[35.63329315,.5,48.57048416,16.87500004,3.92,1,1],[39.14796829,.5,47.11465836,28.1249995,3.92,1,1],[42.31109619,.5,45.00112534,39.37499896,3.92,1,1],[45.00111771,.5,42.31111145,50.62500013,3.92,1,1],[47.11465836,.5,39.14798355,61.87499788,3.92,1,1],[48.57048798,.5,35.6333046,73.12500246,3.92,1,1],[49.3126564,.5,31.90214348,84.37500021,3.92,1,1],[38.5,.5,2,90,56,1,1],[38.41839981,.5,-26.82920074,95.62499797,1.76,1,1],[38.09489822,.5,-28.45560074,106.8750025,1.76,1,1],[37.46030045,.5,-29.98760033,118.1249935,1.76,1,1],[36.53900146,.5,-31.36639977,129.3749981,1.76,1,1],[35.36640167,.5,-32.53900146,140.6250026,1.76,1,1],[33.98759842,.5,-33.46030045,151.8749936,1.76,1,1],[32.45560074,.5,-34.09489822,163.1249981,1.76,1,1],[30.82920074,.5,-34.41839981,174.3750027,1.76,1,1],[0,.5,-34.5,0,60,1,1],[-30.82909966,.5,-34.41839981,5.625000157,1.76,1,1],[-32.45550156,.5,-34.09489822,16.87500004,1.76,1,1],[-33.98749924,.5,-33.46030045,28.1249995,1.76,1,1],[-35.36629868,.5,-32.53900146,39.37499896,1.76,1,1],[-36.53889847,.5,-31.36639977,50.62500013,1.76,1,1],[-37.46020126,.5,-29.98760033,61.87499788,1.76,1,1],[-38.09479904,.5,-28.45560074,73.12500246,1.76,1,1],[-38.41830063,.5,-26.82920074,84.37500021,1.76,1,1],[-38.41830063,.5,-25.17090034,95.62499797,1.76,1,1],[-38.09479904,.5,-23.54450035,106.8750025,1.76,1,1],[-37.46020126,.5,-22.01250076,118.1249935,1.76,1,1],[-36.53889847,.5,-20.63369942,129.3749981,1.76,1,1],[-35.36629868,.5,-19.46109962,140.6250026,1.76,1,1],[-33.98749924,.5,-18.53980064,151.8749936,1.76,1,1],[-32.45550156,.5,-17.90519905,163.1249981,1.76,1,1],[-30.82909966,.5,-17.58169937,174.3750027,1.76,1,1],[-15,.5,-17.5,0,30,1,1],[1.902170181,.5,-17.31269264,174.3750027,3.92,1,1],[5.633336067,.5,-16.57051468,163.1249981,3.92,1,1],[9.148018837,.5,-15.1146841,151.8749936,3.92,1,1],[12.31115246,.5,-13.00114727,140.6250026,3.92,1,1],[15.00117588,.5,-10.31112194,129.3749981,3.92,1,1],[17.11471558,.5,-7.14799118,118.1249935,3.92,1,1],[18.5705452,.5,-3.633307457,106.8750025,3.92,1,1],[19.31271935,.5,.097862244,95.62499797,3.92,1,1],[19.31271744,.5,3.902129173,84.37500021,3.92,1,1],[18.57053947,.5,7.63329792,73.12500246,3.92,1,1],[17.11470795,.5,11.14797878,61.87499788,3.92,1,1],[15.00117016,.5,14.31110764,50.62500013,3.92,1,1],[12.31114674,.5,17.00112915,39.37499896,3.92,1,1],[9.148013115,.5,19.11466789,28.1249995,3.92,1,1],[5.633331299,.5,20.57049942,16.87500004,3.92,1,1],[1.902164459,.5,21.31267166,5.625000157,3.92,1,1],[-.829113007,.5,38.41839981,174.3750027,1.76,1,1],[-2.455519915,.5,38.09489822,163.1249981,1.76,1,1],[-5.366360188,.5,36.53900146,140.6250026,1.76,1,1],[-6.538929939,.5,35.36640167,129.3749981,1.76,1,1],[-7.460209846,.5,33.98759842,118.1249935,1.76,1,1],[-3.987560034,.5,37.46030045,151.8749936,1.76,1,1],[-8.418310165,.5,30.82920074,95.62499797,1.76,1,1],[-8.418310165,.5,29.17090034,-95.62499797,1.76,1,1],[-8.094799995,.5,27.54450035,-106.8750025,1.76,1,1],[-8.094799995,.5,32.45560074,106.8750025,1.76,1,1],[-7.460209846,.5,26.01250076,-118.1249935,1.76,1,1],[-6.538919926,.5,24.63369942,-129.3749981,1.76,1,1],[-3.98755002,.5,22.53980064,-151.8749936,1.76,1,1],[-2.455509901,.5,21.90519905,-163.1249981,1.76,1,1],[-.829102993,.5,21.58169937,-174.3750027,1.76,1,1],[-5.366350174,.5,23.46109962,-140.6250026,1.76,1,1],[15,.5,38.5,0,30,1,1],[38.41633224,.5,30.82708931,-95.62499797,1.76,1,1],[38.09281921,.5,32.45350266,-106.8750025,1.76,1,1],[37.45822906,.5,33.9855423,-118.1249935,1.76,1,1],[36.53694153,.5,35.36434174,-129.3749981,1.76,1,1],[33.98557281,.5,37.45819092,-151.8749936,1.76,1,1],[32.45352936,.5,38.09280014,-163.1249981,1.76,1,1],[30.82712173,.5,38.41630173,-174.3750027,1.76,1,1],[35.36437225,.5,36.53691101,-140.6250026,1.76,1,1],[37,2.25,-9,0,2,4.5,2],[51,2.25,-9,0,2,4.5,2],[44,4,-9,0,12,1,2],[6,2.25,37,-90,2,4.5,2],[6,2.25,51,-90,2,4.5,2],[6,4,44,0,2,1,12],[-24,2.25,-5,-90,2,4.5,2],[-24,4,-12,0,2,1,12],[-24,2.25,-19,-90,2,4.5,2]],zj=new Oi({color:"#fff",transparent:!0,opacity:0}),_j=new hl(1,1,1);function kj(){const i=Lj;return D(Sr,{children:D(sb,{range:i.length,material:zj,geometry:_j,children:D("group",{position:[0,0,0],children:i.map((e,t)=>D(Tj,{position:e.slice(0,3),rotation:[0,e[3]*Math.PI/180,0],size:e.slice(4)},t))})})})}function Tj({position:i,size:e,rotation:t}){const[n,s]=uf(()=>({mass:0,position:i,rotation:t,args:e,restitution:.5,friction:.5}));return D(If,{ref:n})}const Ej=[[50.4836,30.5998,-168.75],[49.1927,34.5075,-157.5],[47.1642,38.0883,-146.25],[44.476,41.2046,-135],[41.2316,43.7366,-123.75],[37.5556,45.587,-112.5],[33.5892,46.6846,-101.25],[-34.5997,46.4836,-78.75],[-38.5075,45.1926,-67.5],[-42.0883,43.1641,-56.25],[-45.2046,40.476,-45],[-47.7365,37.2316,-33.75],[-49.5869,33.5555,-22.5],[-50.6846,29.5891,-11.25],[-50.9873,25.4848,0],[-50.4835,21.4003,11.25],[-49.1926,17.4925,22.5],[-47.1641,13.9117,33.75],[-44.476,10.7954,45],[-41.2315,8.26345,56.25],[-37.5555,6.41309,67.5],[-33.5891,5.31544,78.75],[-4.5997,-9.5164,-78.75],[-8.5075,-10.8074,-67.5],[-12.0883,-12.8359,-56.25],[-15.2046,-15.524,-45],[-17.7365,-18.7684,-33.75],[-19.5869,-22.4445,-22.5],[-20.6846,-26.4109,-11.25],[-20.9873,-30.5152,0],[-20.4835,-34.5997,11.25],[-19.1926,-38.5075,22.5],[-17.1641,-42.0883,33.75],[-14.476,-45.2046,45],[-11.2315,-47.7365,56.25],[-7.5555,-49.5869,67.5],[-3.5891,-50.6846,78.75],[34.5997,-50.4837,-258.75],[38.5075,-49.1928,-247.5],[42.0884,-47.1642,-236.25],[45.2046,-44.4761,-225],[47.7366,-41.2317,-213.75],[49.587,-37.5556,-202.5],[50.6847,-33.5892,-191.25]],Dj=[[4.59976,18.4836,-101.25],[8.50752,17.1926,-112.5],[12.0883,15.1641,-123.75],[15.2046,12.476,-135],[17.7366,9.23164,-146.25],[19.5869,5.55557,-157.5],[20.6846,1.58916,-168.75],[20.9874,-2.51516,-180],[20.4836,-6.59969,-191.25],[19.1926,-10.5075,-202.5],[17.1641,-14.0883,-213.75],[14.476,-17.2046,-225],[11.2316,-19.7365,-236.25],[7.55554,-21.5869,-247.5],[3.58914,-22.6845,-258.75]];function Jj({position:i,rotation:e,color:t,args:n,onCollide:s,cubeInstanceRefs:r,index:o}){const[g]=uf(()=>({mass:1,args:n,position:i,rotation:e,onCollide:s,restitution:.9,friction:.1,userData:{name:"cube"}})),a=T.useRef(),l=T.useRef(n);return T.useEffect(()=>(r.current[o]=a.current,()=>{r.current[o]=null}),[r,o,l]),D(Sr,{children:D(If,{ref:c=>{g.current=c,a.current=c},color:t,index:o})})}function Uj({position:i,rotation:e,index:t}){const[n]=uf(()=>({mass:0,args:[1.5,2,1],position:i,rotation:e,userData:{name:"waypoint"}})),s=T.useRef();return D(Sr,{children:D(If,{index:t,ref:r=>{n.current=r,s.current=r}})})}function Pj({position:i,rotation:e,index:t,color:n,refs:s}){const r=T.useRef(),o=T.useRef(!0);return T.useEffect(()=>{const g=()=>{if(r.current){const a=r.current.color,l=o.current?t*(1/7):1;Wn.to(a,{r:1,g:0,b:.05,duration:.5,delay:l,onComplete:()=>{Wn.to(a,{r:.8,g:.5,b:.5,duration:.5,onComplete:g})}}),o.current=!1}};g()},[t]),D(Sr,{children:D(If,{index:t,position:i,rotation:e,color:n,ref:g=>{r.current=g,s.current=g}})})}const s2=new jo({color:"#fff",roughness:1,metalness:-.3});function Oj({cubesData:i,cubesCount:e,perfomanceMode:t}){var G;const[{nodes:n},{nodes:s},{nodes:r},{nodes:o},{nodes:g}]=VG([t?"./static/cube-min.glb":"./static/cube.glb","./static/waypoint-right.glb","./static/waypoint-left.glb","./static/arrow-right.glb","./static/arrow-left.glb"]),a=Dj,l=Ej,c=["#fff","#deadae"],C=[1,1,1],h=T.useRef([]),p=T.useRef([]),m=T.useRef([]),f=T.useRef(!1),{phase:b}=io(w=>w);T.useEffect(()=>{b==="playing"?f.current=!0:f.current=!1},[b]);const y=(w,W)=>{if(!f.current)return;const V=h.current[W].color;v(V,{r:1,g:0,b:.03},{r:1,g:1,b:1})},v=(w,W,V)=>{Wn.to(w,{r:W.r,g:W.g,b:W.b,duration:1,ease:"power4",onComplete:()=>{Wn.to(w,{r:V.r,g:V.g,b:V.b,duration:1})}})};return $e(Sr,{children:[D(sb,{range:e,material:s2,geometry:(G=n==null?void 0:n.Cube)==null?void 0:G.geometry,receiveShadow:!0,castShadow:!0,children:D("group",{position:[0,0,0],children:i.map((w,W)=>D(Jj,{position:[w[0],.5,-w[1]],rotation:[0,w[2],0],args:C,color:c[0],onCollide:V=>y(V,W),cubeInstanceRefs:h,index:W},W))})}),[a,l].map((w,W)=>{var V,X;return D(sb,{range:w.length,material:s2,geometry:W===0?(V=s==null?void 0:s.Waypoint)==null?void 0:V.geometry:(X=r==null?void 0:r.Waypoint)==null?void 0:X.geometry,castShadow:!0,children:D("group",{position:[0,0,0],children:w.map((R,Y)=>D(Uj,{position:[R[0],1,-R[1]],rotation:[0,R[2]*Math.PI/180,0],index:Y},Y))})},W)}),[a,l].map((w,W)=>{var V,X;return D(sb,{range:w.length,material:s2,geometry:W===0?(V=o==null?void 0:o.Arrow)==null?void 0:V.geometry:(X=g==null?void 0:g.Arrow)==null?void 0:X.geometry,children:D("group",{position:[0,0,0],children:w.map((R,Y)=>D(Pj,{position:[R[0],1,-R[1]],rotation:[0,R[2]*Math.PI/180,0],index:Y,color:c[1],refs:W===0?p:m},Y))})},W)})]})}const Qj=[[47.552845,30.3327713,-14.33749939],[47.28595352,31.7053566,-.387419829],[46.04193497,30.62670898,-23.478012],[45.94612423,32.13833432,-37.467422],[46.59966278,33.24951172,-104.4396986],[46.19932556,34.71741486,-59.02207567],[45.22707748,33.53546906,4.813944221],[44.86068344,34.73524233,-7.443591384],[45.30545807,35.91072845,-104.1547499],[43.51182175,37.74043274,-28.77366428],[43.3576622,35.09567642,-77.08819924],[43.70190048,33.82048035,17.99719842],[44.13137054,32.65291595,-62.47004396],[44.90654755,31.54138756,39.47804261],[43.22895813,36.38273239,-87.51982421],[44.5332222,36.98863983,-34.76989076],[26.55964324,35.683734238,-202.7456005],[25.38532424,36.353623423,-207.7073423],[24.04142344,37.043134232,-201.5222322],[22.55431343,37.388888888,-180.3923423],[21.01343458,37.277143264,-165.5134329],[19.6233349,36.984452309,-165.8183421],[18.33119201,36.548332343,-158.8063423],[17.15233291,35.831745213,-139.6764323],[19.73710823,35.60037613,-181.9208591],[21.05125237,35.80164337,-236.760284],[22.37723732,35.75428772,-273.9505001],[23.71506119,35.65957642,-273.9505001],[-39.03858185,38.55609131,-230.4123335],[-40.53070068,37.31309891,-173.1773837],[-41.85919952,35.82129288,-222.12812],[-43.08353806,34.02416229,-131.8018872],[-45.25360107,27.00664902,-199.7481446],[-44.01181793,32.19551849,-145.5341738],[-45.07620239,28.73627281,-144.6860828],[-44.67705917,30.59894371,-228.8795025],[-45.07620239,25.27702522,-247.7046513],[-44.54401016,23.37000465,-26.18120963],[-44.01181793,21.55168343,-231.2362456],[-43.30223083,19.68901253,-105.9730419],[-42.1746788,18.03538132,-173.5381543],[-40.95152664,16.43406868,-219.3615246],[-39.58530807,14.93876934,-171.9081843],[-38.01324463,13.82136059,-215.3815734],[-36.5631485,12.65915394,-198.6950797],[-34.85599136,11.29275608,-243.4313844],[-33.11207962,10.26070595,-232.0463334],[-31.48155403,9.183934212,-173.5381543],[-37.50702286,39.76505661,-199.4000099],[-29.75225258,8.137011528,-222.7524676],[-35.9528389,40.89678192,-150.4725235],[-34.50557709,41.94372559,-225.984199],[-32.88271332,8.121629715,-189.3666396],[-34.40750504,8.679071426,-222.7524676],[-35.4732132,9.816558838,-280.2532894],[-36.91657257,9.081756592,-222.7524676],[-36.78596497,10.69222355,-184.8694381],[-38.26461029,9.848534584,-274.8224967],[-37.96628952,11.57483482,-222.7524676],[-39.64583588,10.892519,-188.2781123],[-39.30467606,12.59830952,-293.9132579],[-41.17305374,11.89879227,-192.6641456],[-40.59057999,13.56929779,-161.8243935],[-42.4275856,13.04443932,-267.0442227],[-41.98145676,14.77647209,-270.4065882],[-43.84470367,14.61901474,-157.1262069],[-42.87371445,16.06237602,-267.7860632],[-44.86817551,16.16734695,-174.5374929],[-43.87094498,17.68943596,-219.8450064],[-46.0228653,18.03059387,-280.8912564],[-44.78944778,19.18528366,-286.3341522],[-45.47176361,20.83858871,-178.2472828],[-46.75766754,19.68389893,-193.633568],[-46.18032455,22.59686279,-260.7952826],[-47.46622849,21.25847435,-151.6508131],[-46.46899796,24.72254181,-176.4743706],[-47.57120132,23.4891243,-191.8052903],[-47.93860245,27.79296303,-271.1585374],[-47.96093369,25.61540604,-240.5208769],[-46.72758484,26.47621727,-190.3596671],[-46.33778381,28.18660736,-193.4979615],[-47.41374207,29.34129715,-191.6378414],[-45.9263916,29.85149193,-259.0589119],[-46.75767136,31.17830276,-189.5542102],[-45.44552612,31.91310501,-209.1596399],[-46.49524307,33.0940361,-186.3756314],[-44.71072388,33.30397797,-281.4200497],[-45.64464951,34.63695526,-260.1898819],[-44.05465317,35.16722488,-172.9048865],[-44.44829559,36.79428482,-186.6096337],[-42.92620468,36.55809784,-202.9054405],[-42.0864296,37.87024307,-270.5504866],[-43.50354767,38.2376442,-212.206478],[-42.1867485,39.22410583,-272.3870698],[-40.72179794,38.86747742,-262.7035828],[-39.40965271,39.89843423,-260.1804836],[-40.92633057,40.25066757,-194.8477161],[-39.37258911,41.39377594,-175.0192398],[-38.03187561,41.32349014,-222.7524676],[-36.72903442,41.962677,-257.7185556],[-35.70778275,43.16357803,-281.7986334],[-33.75270844,43.57886505,-181.0515126],[9.279047012,-14.72224998,-410.4123249],[10.77116489,-13.47925758,-353.1773887],[12.09966373,-11.98745155,-402.128125],[13.32400227,-10.19032097,-311.8018786],[15.49406433,-3.17280817,-379.748136],[14.25228119,-8.36167717,-325.5341651],[15.31666565,-4.902431965,-324.6860742],[14.91752243,-6.765102863,-408.8794938],[15.31666565,-1.443184376,-427.7046427],[14.78447247,.463836193,-206.1812129],[14.25228024,2.282157421,-411.2362369],[13.23652458,3.926137209,-285.9730264],[12.59009266,5.885935783,-353.5381593],[11.5200243,7.290426731,-399.3615159],[10.46872044,8.532044411,-351.9081756],[6.527028561,-17.44405174,-343.3427359],[8.792840958,11.69478321,-402.752459],[9.392053604,10.16394424,-402.752459],[11.43462849,11.68166161,-373.9396885],[11.20281601,10.1551981,-402.752459],[12.97421455,10.43949604,-442.7556202],[12.22191811,9.057369232,-365.6382492],[14.08516502,9.214826584,-444.3333119],[13.1141758,7.771464825,-376.0983561],[15.10863686,7.666493893,-356.277393],[14.1770134,6.581787109,-481.0450323],[16.26332664,5.803246975,-411.9358122],[15.13925552,4.976593971,-447.9325484],[15.95479393,1.750772357,-402.752459],[17.4094429,2.367593527,-428.5202492],[16.44188118,.097962499,-402.752459],[17.80160904,.877389789,-427.1539655],[16.80437851,-1.679683924,-402.752459],[18.05423355,-.762659073,-157.4973321],[18.0208683,-4.264968395,-459.8310658],[18.13786697,-2.55134201,-429.6692783],[17.00279236,-3.410238028,-307.9860158],[16.73644447,-4.985553265,-464.2336418],[17.74912262,-5.971498966,-402.752459],[16.34794998,-6.665101051,-425.6109711],[17.24070358,-7.913969517,-339.9570658],[15.802001,-8.311285019,-434.6390332],[16.49313736,-9.629320145,-366.8248443],[14.88790894,-9.765437126,-402.752459],[15.78066254,-10.98291016,-363.5202895],[14.29511738,-11.33338356,-373.9470651],[14.74149227,-12.76006126,-422.3321798],[13.16666889,-12.72425652,-430.8087177],[12.27222157,-13.83593464,-426.454117],[13.71330166,-14.1516161,-386.2372801],[12.24014664,-15.57817459,-385.4574091],[10.96226311,-15.03363609,-365.475882],[9.650117874,-16.21456718,-463.7919198],[10.8383379,-16.75765228,-345.2082791],[8.616146088,-17.74190712,-340.1582558],[7.877774715,-16.1520195,-369.0891067],[7.130800247,-18.89134407,-422.9007247],[5.21506691,-19.15377235,-402.752459],[15.62037563,3.358280182,-562.7874795],[16.88878441,3.905007839,-414.2049104],[8.421066284,13.44431114,-402.752459],[9.930034637,12.63515472,-424.8944023],[10.15309906,11.24865341,-413.5140777],[-9.141060829,-17.5157814,-230.4123335],[-10.63317776,-18.7587738,-173.1773973],[-11.9616785,-20.25057983,-222.1281474],[-13.18601704,-22.04771042,-131.8018872],[-15.35608006,-29.06522369,-199.7481583],[-14.11429596,-23.87635422,-145.5341738],[-15.17868137,-27.33559799,-144.6860828],[-14.7795372,-25.47292709,-228.8795161],[-15.17868137,-30.79484558,-247.7046786],[-14.64648914,-32.70186615,-26.18122158],[-14.11429691,-34.52018738,-231.2362729],[-13.09854126,-36.16416931,-105.9730351],[-12.45210934,-38.12396622,-173.5381679],[-11.38204193,-39.52845764,-219.3615383],[-10.33073711,-40.77007675,-171.9081843],[-6.389042377,-14.7939806,-163.3427446],[-8.654858589,-43.93281555,-222.7524813],[-9.254071236,-42.40197754,-222.7524813],[-11.29664612,-43.91969299,-193.9397108],[-11.06483364,-42.39323044,-222.7524813],[-12.83623219,-42.67752838,-262.7556288],[-12.08393574,-41.29540253,-185.6382715],[-13.94718266,-41.45285797,-264.3333206],[-12.97619343,-40.0094986,-196.0983784],[-14.97065449,-39.90452576,-176.2774016],[-14.03903103,-38.81981659,-301.045041],[-16.12534332,-38.04127884,-231.9358482],[-15.0012722,-37.21462631,-267.9325571],[-15.81680965,-33.98880386,-222.7524813],[-17.27145767,-34.60562515,-248.5202579],[-16.30389595,-32.33599472,-222.7524813],[-17.66362381,-33.1154213,-247.1540015],[-16.66639328,-30.55834579,-222.7524813],[-17.91624832,-31.47537231,22.50266098],[-17.88288307,-27.97306442,-279.8310744],[-17.99988174,-29.68669128,-249.6693142],[-16.86480713,-28.82779312,-127.9860244],[-16.59845924,-27.25247955,-284.2336778],[-17.61113739,-26.2665329,-222.7524813],[-16.20996475,-25.57292938,-245.6109798],[-17.10271835,-24.32406235,-159.9570744],[-15.66401577,-23.92674637,-254.6390692],[-16.35515022,-22.60871124,-186.8248666],[-14.74992371,-22.47259521,-222.7524813],[-15.64267635,-21.25511932,-183.5203118],[-14.15713215,-20.90464783,-193.9470874],[-14.60350704,-19.47797012,-242.3322158],[-13.02868271,-19.51377487,-250.8087537],[-12.13423538,-18.40209579,-246.454153],[-13.57531548,-18.08641434,-206.2373024],[-12.10216045,-16.6598587,-205.4574314],[-10.82427692,-17.20439529,-185.4759043],[-9.512131691,-16.0234642,-283.7919285],[-10.70035076,-15.48037815,-165.2082878],[-8.478159904,-14.49612522,-160.1582645],[-7.739788532,-16.08601379,-189.089129],[-6.992813587,-13.34668827,-242.9007607],[-5.07708025,-13.08425999,-222.7524813],[-15.48239231,-35.59630966,-382.7874882],[-16.75079918,-36.1430397,-234.2049463],[-8.283083916,-45.68234253,-222.7524813],[-9.792052269,-44.87318802,-244.894411],[-10.01511669,-43.48668671,-233.5141137],[32.62306595,-39.44682312,-487.0589865],[33.89599228,-40.0691452,-453.0887948],[35.37824249,-39.95034027,-439.6753688],[36.77563095,-39.45814133,-421.908107],[37.91277695,-38.48505402,-411.2769449],[38.9311142,-37.3818512,-391.6143875],[39.7231636,-36.05235672,-386.4945051],[40.26062012,-34.69456863,-378.0252344],[40.65664291,-33.22363281,-371.7850916],[40.89236832,-31.80927086,-365.8952556],[41.03380585,-30.37133598,-365.8952556],[41.03380585,-28.98054695,-356.0617229],[40.8291423,-27.62511635,335.049342],[39.9926796,-26.40719414,-317.9662062],[34.51657867,-38.75423431,-445.9411931],[36.1535759,-38.00121689,-505.5108792],[37.39768982,-36.90443039,-393.2679763],[38.42899704,-35.49661636,-478.5296102],[39.06742477,-33.90873337,-482.9346998],[39.52578354,-32.36995697,-433.9908756],[39.72222137,-30.88029289,-467.6161154],[39.73859024,-29.47247696,-413.2576178],[39.64036942,-28.19562149,0],[33.47847366,-47.79722214,-400.2355616],[34.41534805,-46.65668106,-400.2355616],[35.44047928,-45.72659683,-413.8297964],[36.67267227,-44.95265961,-423.4437248],[37.99764633,-44.31449509,-427.5602798],[39.31243896,-43.60165405,-418.7657282],[40.52313614,-42.74172592,-410.9502433],[41.67725754,-41.68944168,-410.6223942],[42.7012558,-40.64846802,-400.3933936],[43.6460495,-39.42080307,-395.6660284],[44.42677689,-38.14787674,-389.5251693],[45.06040955,-36.82403183,-380.4002824],[45.63747406,-35.47755814,-379.4123639],[46.02217865,-33.97833252,-370.23901],[46.25979233,-32.53002548,-365.4668661],[46.38991165,-31.01382828,-364.4954493],[46.57660675,-29.53723335,-374.8715448],[47.88913727,-27.08755875,-412.9644387],[46.97262955,-28.26430702,-388.7037161],[35.91520691,-47.21626282,-435.1523629],[37.17569351,-46.54509354,-404.1203819],[38.63261795,-45.80844498,-460.3638206],[40.02406311,-45.03905869,-421.9303461],[41.26817703,-44.07323074,-378.8577252],[42.59414291,-42.92733383,-416.1212429],[43.87099838,-41.61773682,-449.1201817],[44.91867447,-40.16081238,-398.3213601],[45.76990891,-38.86758423,-445.7034479],[46.4901886,-37.55799103,-392.3743963],[47.09587479,-35.94282532,-417.9068456],[47.43691635,-34.44224548,-454.6853652],[47.73703384,-32.98259354,-489.919743],[47.90073395,-31.50929832,-471.0505531],[48.03715134,-30.13149452,-494.6817509],[48.29634094,-28.74004936,-459.768392],[16.89318848,43.32038116,-261.1298799],[-.259138107,43.11941528,-131.5781575],[-24.86724854,41.77295303,-176.5197777],[-11.60358715,43.58163452,-248.3747475],[-17.48180008,36.7990799,-166.336717],[7.387563705,41.67247391,-67.27311495],[-6.388557434,36.83927155,-262.9358366],[-13.95487785,13.67408466,-154.0542747],[-1.945233345,12.80591679,-288.1834669],[-18.51275635,8.53742981,-258.9234009],[-24.37288284,14.32521057,-202.7456005],[-5.90696907,8.433249474,-170.8673591],[8.886599541,-40.63555527,-178.5309133],[13.57470226,-47.19889832,-143.1614753],[23.99270821,-42.71915436,-251.166601],[45.66216278,-16.98668098,-240.430254],[41.18241882,-6.672855377,-177.0768206],[46.28724289,.828108788,-232.4381403],[40.6615181,17.28855896,-202.7456005],[46.49560165,24.37280273,-108.9527598]];function jj({checkpoint:i,setCheckpoint:e}){const t=io(R=>R.end),[n]=T.useState(()=>new Audio("./static/checkpoint.mp3")),[s]=T.useState(()=>new Audio("./static/lap.mp3")),[r]=T.useState(()=>new Audio("./static/finish.mp3")),o=[[-24,2,-12],[6,2,44],[44,2,-9]],g=[[2,4,10],[2,4,10],[10,4,2]],a=T.useRef(),l=T.useRef();var c=1;const[C,h]=T.useState(!1),p=[];for(let R=0;R<o.length;R++){const[Y]=uf(()=>({isTrigger:!0,args:g[R],position:o[R],onCollide:v(R)}));p.push(Y)}var m=i;const f=()=>{n.volume=.05,n.play()},b=()=>{s.volume=.4,s.play()},y=()=>{r.volume=.05,r.play()},v=T.useCallback(R=>Y=>{const{body:M}=Y;M.userData.name==="vehicle"&&R===m&&!C&&(m<2&&f(),m>1&&c<3?(b(),c++):m>1&&c===3&&(h(!0),y(),t()),e(R!==2?R+1:0),R!==2?m=R+1:m=0)},[i,e]),{phase:G,startTime:w,endTime:W,pauseTime:V}=io(R=>R);T.useEffect(()=>{const R=q8(()=>{a.current&&(a.current.textContent="Lap "+c+"/3")});return()=>{R()}},[]),Aa(()=>{let R=0;G==="playing"?R=Date.now()-w:G==="ended"?R=W-w:G==="paused"&&(R=V-w);const Y=Math.floor(R/6e4%60),M=Math.floor(R/1e3%60),L=R%1e3,re=`${j(Y)}:${j(M)}:${j(L,3)}`;l.current&&(l.current.textContent=re);function j($,ie=2){return String($).padStart(ie,"0")}});const X=T.useRef();return T.useEffect(()=>{G==="ended"&&Wn.to(X.current,{opacity:0,duration:.5})},[G]),$e(Sr,{children:[D("group",{children:p.map((R,Y)=>D("mesh",{ref:R,visible:!1},Y))}),$e(md,{wrapperClass:"circuit-stats-overlay",className:"circuit-stats",ref:X,children:[D("div",{ref:a,className:"circuit-lap"}),D("div",{ref:l,className:"circuit-time"})]})]})}function qj(i){const[e]=Sj(()=>({type:"Static",rotation:[-Math.PI/2,0,0],restitution:.9,friction:.1,...i}));return D("mesh",{ref:e,rotation:[-Math.PI/2,0,0],visible:!1,children:D("planeGeometry",{args:[200,200]})})}function $j({perfomanceMode:i}){const{scene:e}=Ui(),t=T.useRef(),n=T.useRef(),s=Qj,[r,o]=T.useState(0),[g,a]=T.useState(!1),[l,c]=T.useState(!1),C=i,h=200,p=new co(-h,h,h,-h,2,400);T.useEffect(()=>{t.current&&(t.current.shadowCameraVisible=!0,t.current.shadow.camera=p)},[t,p,e]);const{phase:m}=io(f=>f);return T.useEffect(()=>{m==="playing"?(a(!1),c(!1)):a(m==="paused"),m==="ended"&&c(!0)},[m]),T.useEffect(()=>{l&&setTimeout(()=>{a(!0)},1e3)},[l,m]),$e(Sr,{children:[D("directionalLight",{ref:t,castShadow:!0,position:[-100,100,-100],intensity:2,"shadow-camera":p,"shadow-bias":.01,"shadow-mapSize-width":4096,"shadow-mapSize-height":4096,color:"#fff",radius:C>0?6:2,blurSamples:C>0?12:4}),D("pointLight",{position:[100,100,100],intensity:.2,color:"#7f84d8"}),D("pointLight",{position:[-100,100,-100],intensity:.2,color:"#454362"}),D(fQ,{target:[0,0,0],camera:n.current,enableRotate:!1,enableZoom:!1}),D("ambientLight",{intensity:.8,color:"#dfdfe6"}),D(WQ,{files:"static/adamsbridge.hdr"}),$e(Yj,{gravity:[0,-9.81,0],broadphase:"SAP",allowSleep:!0,isPaused:g,children:[D(kj,{}),D(T.Suspense,{children:D(Oj,{cubesData:s,cubesCount:s.length,perfomanceMode:C===0})}),D(qj,{}),D(Kj,{checkpoint:r}),D(jj,{checkpoint:r,setCheckpoint:o})]}),D(LQ,{})]})}const eq=({children:i})=>D(U7,{map:[{name:"forward",keys:["ArrowUp","KeyW","KeyZ"]},{name:"backward",keys:["ArrowDown","KeyS","KeyQ"]},{name:"leftward",keys:["ArrowLeft","KeyA"]},{name:"rightward",keys:["ArrowRight","KeyD"]},{name:"brake",keys:["Space"]},{name:"changeCamera",keys:["KeyC"]},{name:"reset",keys:["KeyR"]}],children:i}),tq=()=>{const[i]=T.useState(()=>new Audio("./static/click.mp3")),e=T.useRef(null),t=T.useRef(null),n=eY(),[s,r]=T.useState(!1),[o,g]=T.useState(!1),[a,l]=T.useState(!1),[c,C]=T.useState(!1),h=io(f=>f.startLoading),p=()=>{C(f=>!f)},m=f=>{f.key==="Enter"&&!s&&o&&!c&&a&&(p(),h(),i.volume=.05,i.play())};return T.useEffect(()=>{n.isMobile?(r(!0),t.current.classList.add("mobile")):r(!1)},[c]),T.useEffect(()=>{n.fps==null&&n.tier<2&&!n.isMobile?g(!1):g(!0)},[o]),T.useEffect(()=>(document.addEventListener("keydown",m),()=>{document.removeEventListener("keydown",m)}),[a]),T.useEffect(()=>{const f=new Image;f.src="static/cover.webp",f.onload=()=>{if(Wn.to(e.current,{opacity:1,duration:2}),setTimeout(()=>{l(!0)},2500),!s){const b=t.current,y=Wn.fromTo(b,{opacity:0},{opacity:1,yoyo:!0,repeat:-1,duration:1,delay:2.5});return()=>{y.kill()}}}},[s]),$e("div",{className:"main-screen",children:[D("img",{className:"main-cover",ref:e,src:"static/cover.webp",alt:"Circuit Rush Main Screen Cover"}),D("div",{className:"menu",children:D("div",{ref:t,className:"start-info",children:o?s?"MOBILE DEVICES CURRENTLY NOT SUPPORTED":"PRESS ENTER TO START":"ENABLE GPU ACCELERATION IN YOUR BROWSER SETTINGS"})})]})};function nq({keyboardType:i}){const e=T.useRef(null),t=T.useRef(null),n=T.useRef(1),[s,r]=T.useState(!1),o="movement-key-azerty",g="movement-key-qwerty",[a,l]=T.useState(1),[c,C]=T.useState(null),[h,p]=T.useState(null),m={1:{className:"movement",keyClassName:"movement-key",text:"Movement",onComplete:()=>l(2)},2:{className:"brake",keyClassName:"brake-key",text:"Brake",onComplete:()=>l(3)},3:{className:"camera",keyClassName:"camera-key",text:"Change camera",onComplete:()=>l(4)},4:{className:"reset",keyClassName:"reset-key",text:"Reset car",onComplete:()=>l(5)},5:{className:"pause",keyClassName:"pause-key",text:"Pause",onComplete:()=>l(6)},6:{className:"escape",keyClassName:"escape-key",text:"Quit game",onComplete:()=>l(1)}};T.useEffect(()=>{if(i){const G=e.current.querySelectorAll(`.${g}`);C("z"),p("q"),G.forEach(w=>{w.style.opacity=0})}else{const G=e.current.querySelectorAll(`.${o}`);C("w"),p("a"),G.forEach(w=>{w.style.opacity=0})}},[i]),T.useEffect(()=>{n.current=a;const{className:G,keyClassName:w,text:W}=m[a],V=e.current.querySelectorAll(`.${G}`),X=a===1?e.current.querySelectorAll(`.${i?o:g}, .${w}`):e.current.querySelectorAll(`.${w}`);r(!1),V.forEach(R=>{Wn.to(R,{fill:"#e55556",duration:1,delay:1,onComplete:()=>{r(!0),Wn.delayedCall(3,()=>{f(a,!1)})}})}),X.forEach(R=>{Wn.to(R,{fill:"#fff",duration:1,delay:1,onComplete:()=>{Wn.delayedCall(3,()=>{b(a)})}})}),Wn.delayedCall(1,()=>{t.current&&(t.current.innerHTML=W)}),Wn.fromTo(t.current,{y:"-10%",opacity:0},{y:"0%",opacity:1,duration:1,delay:1,onComplete:()=>{Wn.delayedCall(3,()=>{y()})}})},[a]);const f=(G,w)=>{if(G===n.current&&e.current&&!w){const{className:W,onComplete:V}=m[a];V(),e.current.querySelectorAll(`.${W}`).forEach(R=>{Wn.to(R,{fill:"#f7f7f7",duration:1})})}else if(e.current){const{className:W}=m[G];e.current.querySelectorAll(`.${W}`).forEach(X=>{Wn.to(X,{fill:"#f7f7f7",duration:1})})}},b=G=>{if(a===n.current&&e.current){const{keyClassName:w}=m[G];(G===1?e.current.querySelectorAll(`.${i?o:g}, .${w}`):e.current.querySelectorAll(`.${w}`)).forEach(V=>{Wn.to(V,{fill:"#aaaaaa",duration:1})})}},y=()=>{a===n.current&&e.current&&Wn.to(t.current,{y:"-10%",opacity:0,duration:1})},v=G=>{l(w=>(b(w),f(w,!0),G))};return T.useEffect(()=>{if(!s)return;const G=w=>{const W=w.key.toLowerCase();a!==1&&(W===c||W===h||W==="s"||W==="d"||W==="arrowdown"||W==="arrowleft"||W==="arrowright"||W==="arrowup")?v(1):a!==2&&W===" "?v(2):a!==3&&W==="c"?v(3):a!==4&&W==="r"?v(4):a!==5&&W==="p"?v(5):a!==6&&W==="escape"&&v(6)};return window.addEventListener("keydown",G),()=>{window.removeEventListener("keydown",G)}},[s]),$e(Sr,{children:[$e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2519.5 817.5",ref:e,children:[$e("g",{id:"keyboard",children:[D("rect",{className:"cls-1",width:"2519.5",height:"817.5",rx:"12",ry:"12"}),$e("g",{children:[D("rect",{className:"cls-2",x:"168",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m320,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"330",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m482,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"492",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m644,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"654",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m806,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"816",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m968,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"978",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1130,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1140",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1292,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1302",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1454,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1464",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1616,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1626",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1778,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1788",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1940,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1950",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2102,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2111.5",y:"5.75",width:"240",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2345.5,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-228c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h228m0-4h-228c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h228c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2355.5",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2507.5,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"6",y:"167.75",width:"239.5",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m239.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4H12c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h227.5m0-4H12c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h227.5c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"6",y:"329.75",width:"281.5",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m281.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4H12c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h269.5m0-4H12c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h269.5c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"6",y:"491.75",width:"362.5",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m362.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4H12c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h350.5m0-4H12c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h350.5c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"249.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m401.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"573.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m725.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"897.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1049.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1059.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1211.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1221.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1373.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1383.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1535.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1545.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1697.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1869.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2021.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2031.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2183.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2193.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2345.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2355.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2507.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2355.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2507.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2355.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2507.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1869.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2021.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1707.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1859.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"372.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m524.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"534.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m686.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"534.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m686.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"6",y:"653.75",width:"200.5",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m200.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4H12c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h188.5m0-4H12c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h188.5c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"210.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m362.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"372.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m524.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"858.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1010.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1020.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1172.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1182.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1334.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1506.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1658.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1344.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1496.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1668.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1820.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1830.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1982.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1992.5",y:"491.75",width:"197",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2183.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-185c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h185m0-4h-185c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h185c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"777.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m929.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"939.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1091.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1263.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1415.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1425.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1577.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1587.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1739.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1749.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1901.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1911.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2063.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"2073.5",y:"329.75",width:"278",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2345.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-266c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h266m0-4h-266c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h266c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]}),$e("g",{children:[D("rect",{className:"cls-2",x:"1101.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1253.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})]}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 escape",x:"6",y:"5.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m158,7.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4H12c-2.21,0-4-1.79-4-4V11.75c0-2.21,1.79-4,4-4h146m0-4H12c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8V11.75c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"411.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m563.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 reset",x:"735.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m887.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 pause",x:"1707.5",y:"167.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1859.5,169.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"2355.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2507.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"2193.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2345.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"2193.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2345.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"2031.5",y:"653.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m2183.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"291.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m443.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 brake",x:"696.5",y:"653.75",width:"1007",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m1697.5,655.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-995c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h995m0-4h-995c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h995c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 camera",x:"696.5",y:"491.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m848.5,493.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"453.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m605.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:$e("g",{children:[D("rect",{className:"cls-6 movement",x:"615.5",y:"329.75",width:"158",height:"158",rx:"6",ry:"6"}),D("path",{className:"cls-7",d:"m767.5,331.75c2.21,0,4,1.79,4,4v146c0,2.21-1.79,4-4,4h-146c-2.21,0-4-1.79-4-4v-146c0-2.21,1.79-4,4-4h146m0-4h-146c-4.42,0-8,3.58-8,8v146c0,4.42,3.58,8,8,8h146c4.42,0,8-3.58,8-8v-146c0-4.42-3.58-8-8-8h0Z"})]})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key-qwerty",d:"m471.53,221.55h7.63l3.53,38.74h.14l3.74-38.74h8.64l3.74,38.74h.14l3.53-38.74h6.84l-5.11,50.4h-9.86l-3.6-33.98h-.14l-3.6,33.98h-10.51l-5.11-50.4Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-3 movement-key-azerty",d:"m478.91,264.89l14.69-36.14h-13.97v-7.2h22.46v7.06l-14.69,36.14h14.69v7.2h-23.18v-7.06Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key-azerty",d:"m374.78,431.83c-1.49.58-3.24.86-5.26.86-3.89,0-6.86-1.1-8.93-3.31-2.06-2.21-3.1-5.33-3.1-9.36v-26.5c0-4.03,1.03-7.15,3.1-9.36,2.06-2.21,5.04-3.31,8.93-3.31s6.86,1.1,8.93,3.31c2.06,2.21,3.1,5.33,3.1,9.36v26.5c0,3.36-.74,6.12-2.23,8.28.29.48.65.79,1.08.94.43.14,1.06.22,1.87.22h1.22v7.2h-2.09c-3.6,0-5.81-1.61-6.62-4.82Zm-1.15-11.3v-27.5c0-3.31-1.37-4.97-4.1-4.97s-4.1,1.66-4.1,4.97v27.5c0,3.31,1.37,4.97,4.1,4.97s4.1-1.66,4.1-4.97Z"})}),D("g",{children:D("path",{"data-name":"escape-key",className:"cls-4 escape-key",d:"m47.06,59.55h21.6v7.2h-13.68v13.32h10.87v7.2h-10.87v15.48h13.68v7.2h-21.6v-50.4Z"})}),D("g",{children:D("path",{"data-name":"escape-key",className:"cls-4 escape-key",d:"m74.92,107.39c-1.97-2.18-2.95-5.32-2.95-9.4v-2.88h7.49v3.46c0,3.26,1.37,4.9,4.1,4.9,1.34,0,2.36-.4,3.06-1.19.7-.79,1.04-2.08,1.04-3.85,0-2.11-.48-3.97-1.44-5.58-.96-1.61-2.74-3.54-5.33-5.8-3.27-2.88-5.54-5.48-6.84-7.81-1.3-2.33-1.94-4.96-1.94-7.88,0-3.98,1.01-7.07,3.02-9.25,2.02-2.18,4.94-3.28,8.78-3.28s6.66,1.09,8.6,3.28c1.94,2.19,2.92,5.32,2.92,9.4v2.09h-7.49v-2.59c0-1.73-.34-2.99-1.01-3.78-.67-.79-1.66-1.19-2.95-1.19-2.64,0-3.96,1.61-3.96,4.82,0,1.82.49,3.53,1.48,5.11.98,1.58,2.77,3.5,5.36,5.76,3.31,2.88,5.59,5.5,6.84,7.85,1.25,2.35,1.87,5.11,1.87,8.28,0,4.13-1.02,7.3-3.06,9.5-2.04,2.21-5,3.31-8.89,3.31s-6.74-1.09-8.71-3.28Z"})}),D("g",{children:D("path",{"data-name":"escape-key",className:"cls-4 escape-key",d:"m102.6,107.43c-1.99-2.16-2.99-5.21-2.99-9.14v-27.07c0-3.94,1-6.98,2.99-9.14,1.99-2.16,4.88-3.24,8.68-3.24s6.68,1.08,8.68,3.24c1.99,2.16,2.99,5.21,2.99,9.14v5.33h-7.49v-5.83c0-3.12-1.32-4.68-3.96-4.68s-3.96,1.56-3.96,4.68v28.15c0,3.07,1.32,4.61,3.96,4.61s3.96-1.54,3.96-4.61v-7.7h7.49v7.13c0,3.94-1,6.98-2.99,9.14-1.99,2.16-4.88,3.24-8.68,3.24s-6.68-1.08-8.68-3.24Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key-qwerty",d:"m365.14,383.55h10.73l8.21,50.4h-7.92l-1.44-10.01v.14h-9l-1.44,9.86h-7.34l8.21-50.4Zm8.64,33.7l-3.53-24.91h-.14l-3.46,24.91h7.13Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key",d:"m523.64,431.39c-1.97-2.18-2.95-5.32-2.95-9.4v-2.88h7.49v3.46c0,3.26,1.37,4.9,4.1,4.9,1.34,0,2.36-.4,3.06-1.19.7-.79,1.04-2.08,1.04-3.85,0-2.11-.48-3.97-1.44-5.58-.96-1.61-2.74-3.54-5.33-5.8-3.26-2.88-5.54-5.48-6.84-7.81s-1.94-4.96-1.94-7.88c0-3.98,1.01-7.07,3.02-9.25,2.02-2.18,4.94-3.28,8.78-3.28s6.66,1.09,8.6,3.28c1.94,2.19,2.92,5.32,2.92,9.4v2.09h-7.49v-2.59c0-1.73-.34-2.99-1.01-3.78-.67-.79-1.66-1.19-2.95-1.19-2.64,0-3.96,1.61-3.96,4.82,0,1.83.49,3.53,1.48,5.11.98,1.58,2.77,3.5,5.36,5.76,3.31,2.88,5.59,5.5,6.84,7.85,1.25,2.35,1.87,5.11,1.87,8.28,0,4.13-1.02,7.3-3.06,9.5-2.04,2.21-5,3.31-8.89,3.31s-6.75-1.09-8.71-3.28Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key",d:"m682.55,383.55h12.1c3.94,0,6.89,1.06,8.86,3.17,1.97,2.11,2.95,5.21,2.95,9.29v25.49c0,4.08-.98,7.18-2.95,9.29-1.97,2.11-4.92,3.17-8.86,3.17h-12.1v-50.4Zm11.95,43.2c1.3,0,2.29-.38,2.99-1.15.7-.77,1.04-2.02,1.04-3.74v-26.21c0-1.73-.35-2.98-1.04-3.74-.7-.77-1.69-1.15-2.99-1.15h-4.03v36h4.03Z"})}),D("g",{children:D("path",{"data-name":"reset-key",className:"cls-4 reset-key",d:"m802.3,221.55h11.74c4.08,0,7.06.95,8.93,2.84,1.87,1.9,2.81,4.81,2.81,8.75v3.1c0,5.23-1.73,8.54-5.18,9.94v.14c1.92.58,3.28,1.75,4.07,3.53.79,1.78,1.19,4.15,1.19,7.13v8.86c0,1.44.05,2.6.14,3.49.1.89.33,1.76.72,2.63h-8.06c-.29-.82-.48-1.58-.58-2.3-.1-.72-.14-2.02-.14-3.89v-9.22c0-2.3-.37-3.91-1.12-4.82-.74-.91-2.03-1.37-3.85-1.37h-2.74v21.6h-7.92v-50.4Zm10.8,21.6c1.58,0,2.77-.41,3.56-1.22.79-.82,1.19-2.18,1.19-4.1v-3.89c0-1.82-.32-3.14-.97-3.96-.65-.82-1.67-1.22-3.06-1.22h-3.6v14.4h2.88Z"})}),D("g",{children:D("path",{"data-name":"camera-key",className:"cls-4 camera-key",d:"m766.82,593.43c-1.99-2.16-2.99-5.21-2.99-9.14v-27.07c0-3.94,1-6.98,2.99-9.14,1.99-2.16,4.88-3.24,8.68-3.24s6.68,1.08,8.68,3.24c1.99,2.16,2.99,5.21,2.99,9.14v5.33h-7.49v-5.83c0-3.12-1.32-4.68-3.96-4.68s-3.96,1.56-3.96,4.68v28.15c0,3.07,1.32,4.61,3.96,4.61s3.96-1.54,3.96-4.61v-7.7h7.49v7.13c0,3.94-1,6.98-2.99,9.14-1.99,2.16-4.88,3.24-8.68,3.24s-6.68-1.08-8.68-3.24Z"})}),D("g",{children:D("path",{"data-name":"pause-key",className:"cls-4 pause-key",d:"m1774.76,221.55h11.66c3.94,0,6.89,1.06,8.86,3.17,1.97,2.11,2.95,5.21,2.95,9.29v4.97c0,4.08-.98,7.18-2.95,9.29-1.97,2.11-4.92,3.17-8.86,3.17h-3.74v20.52h-7.92v-50.4Zm11.66,22.68c1.3,0,2.27-.36,2.92-1.08.65-.72.97-1.94.97-3.67v-5.98c0-1.73-.32-2.95-.97-3.67-.65-.72-1.62-1.08-2.92-1.08h-3.74v15.48h3.74Z"})}),D("g",{children:D("path",{"data-name":"brake-key",className:"cls-4 brake-key",d:"m1137.29,755.39c-1.97-2.18-2.95-5.32-2.95-9.4v-2.88h7.49v3.46c0,3.26,1.37,4.9,4.1,4.9,1.34,0,2.36-.4,3.06-1.19.7-.79,1.04-2.08,1.04-3.85,0-2.11-.48-3.97-1.44-5.58-.96-1.61-2.74-3.54-5.33-5.8-3.27-2.88-5.54-5.48-6.84-7.81-1.3-2.33-1.94-4.96-1.94-7.88,0-3.98,1.01-7.07,3.02-9.25,2.02-2.18,4.94-3.28,8.78-3.28s6.66,1.09,8.6,3.28c1.94,2.18,2.92,5.32,2.92,9.4v2.09h-7.49v-2.59c0-1.73-.34-2.99-1.01-3.78-.67-.79-1.66-1.19-2.95-1.19-2.64,0-3.96,1.61-3.96,4.82,0,1.82.49,3.53,1.48,5.11.98,1.58,2.77,3.5,5.36,5.76,3.31,2.88,5.59,5.5,6.84,7.85,1.25,2.35,1.87,5.11,1.87,8.28,0,4.13-1.02,7.3-3.06,9.5-2.04,2.21-5,3.31-8.89,3.31s-6.74-1.09-8.71-3.28Z"})}),D("g",{children:D("path",{"data-name":"brake-key",className:"cls-4 brake-key",d:"m1162.49,707.55h11.66c3.94,0,6.89,1.06,8.86,3.17,1.97,2.11,2.95,5.21,2.95,9.29v4.97c0,4.08-.98,7.18-2.95,9.29-1.97,2.11-4.92,3.17-8.86,3.17h-3.74v20.52h-7.92v-50.4Zm11.66,22.68c1.3,0,2.27-.36,2.92-1.08.65-.72.97-1.94.97-3.67v-5.98c0-1.73-.32-2.95-.97-3.67-.65-.72-1.62-1.08-2.92-1.08h-3.74v15.48h3.74Z"})}),D("g",{children:D("path",{"data-name":"brake-key",className:"cls-4 brake-key",d:"m1193.88,707.55h10.73l8.21,50.4h-7.92l-1.44-10.01v.14h-9l-1.44,9.86h-7.34l8.21-50.4Zm8.64,33.7l-3.53-24.91h-.14l-3.46,24.91h7.13Z"})}),D("g",{children:D("path",{"data-name":"brake-key",className:"cls-4 brake-key",d:"m1218.97,755.43c-1.99-2.16-2.99-5.21-2.99-9.14v-27.07c0-3.94,1-6.98,2.99-9.14,1.99-2.16,4.88-3.24,8.68-3.24s6.68,1.08,8.68,3.24c1.99,2.16,2.99,5.21,2.99,9.14v5.33h-7.49v-5.83c0-3.12-1.32-4.68-3.96-4.68s-3.96,1.56-3.96,4.68v28.15c0,3.07,1.32,4.61,3.96,4.61s3.96-1.54,3.96-4.61v-7.7h7.49v7.13c0,3.94-1,6.98-2.99,9.14-1.99,2.16-4.88,3.24-8.68,3.24s-6.68-1.08-8.68-3.24Z"})}),D("g",{children:D("path",{"data-name":"brake-key",className:"cls-4 brake-key",d:"m1244.06,707.55h21.6v7.2h-13.68v13.32h10.87v7.2h-10.87v15.48h13.68v7.2h-21.6v-50.4Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key",d:"m2290.5,564.75l-4.35,4.2-10.65-10.65v36.45h-6v-36.45l-10.65,10.65-4.35-4.2,18-18,18,18Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key",d:"m2254.5,738.75l4.35-4.2,10.65,10.65v-36.45s6,0,6,0v36.45s10.65-10.65,10.65-10.65l4.35,4.2-18,18-18-18Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key",d:"m2104.5,714.75l4.2,4.35-10.65,10.65h36.45s0,6,0,6h-36.45s10.65,10.65,10.65,10.65l-4.2,4.35-18-18,18-18Z"})}),D("g",{children:D("path",{"data-name":"movement-key",className:"cls-4 movement-key",d:"m2440.5,750.75l-4.2-4.35,10.65-10.65h-36.45s0-6,0-6h36.45s-10.65-10.65-10.65-10.65l4.2-4.35,18,18-18,18Z"})})]}),D("p",{ref:t,className:"keyboard-info"})]})}const iq=document.getElementById("root"),sq=nZ(iq);function rq(){const[i]=T.useState(()=>new Audio("./static/countdown.mp3")),[e]=T.useState(()=>new Audio("./static/countdown-start.mp3")),[t]=T.useState(()=>new Audio("./static/click.mp3")),[n,s]=T.useState(!1),r=eY(),[o,g]=T.useState(0),[a,l]=T.useState(.5),[c,C]=T.useState(.5),[h,p]=T.useState(.8),[m,f]=T.useState(!1),b=T.useRef(null),y=T.useRef(null),v=T.useRef(null),[G,w]=T.useState(!1),[W,V]=T.useState(!1),[X,R]=T.useState(!1),[Y,M]=T.useState(!1),[L,re]=T.useState(!1),[j,$]=T.useState(!1),ie=T.useRef(null),he=T.useRef(null),le=T.useRef(null),[_,ne]=T.useState(!1),[te,q]=T.useState(!1),se=io(Xe=>Xe.countdown),ue=io(Xe=>Xe.startGame),Ae=io(Xe=>Xe.pause),We=io(Xe=>Xe.resume),me=io(Xe=>Xe.restart);T.useEffect(()=>{console.log(`Welcome to Circuit Rush! 🚗
Hope you have fun with this game :)

Repository: %chttps://github.com/iaruso/circuit-rush%c`,"color: #e55556; text-decoration: underline; cursor: pointer")},[]),T.useEffect(()=>{navigator.language.startsWith("fr")?f(!0):f(!1)},[m]),T.useEffect(()=>{r.fps>60?g(2):r.fps>30?g(1):g(0),o==2?(l(1),C(.8),p(2)):o==1?(l(.8),C(.6),p(1.2)):(l(.5),C(.5),p(.8))},[o]);const{phase:tt,startTime:Oe,endTime:It}=io(Xe=>Xe),ke=()=>{setTimeout(()=>{window.location.reload()},500)},je=Xe=>{(!n||!W)&&Xe.preventDefault()},ve=Xe=>{Xe.key==="Enter"&&G&&!Y&&(t.volume=.05,t.play(),M(!0),setTimeout(()=>{V(!0),ne(!0),se()},200)),(Xe.key==="p"||Xe.key==="P")&&tt==="playing"&&(re(!0),R(!0)),Xe.key==="Escape"&&(tt==="playing"||tt==="paused"||tt==="ended")&&ke()},be=()=>{Wn.to(le.current,{opacity:0,duration:.8}),setTimeout(()=>{R(!1),re(!1)},500)},Ve=()=>{tt==="ended"&&(ne(!1),$(!1),setTimeout(()=>{ne(!0)},2e3)),tt==="paused"&&setTimeout(()=>{ne(!0)},2e3),re(!1),q(!0),setTimeout(()=>{q(!1),R(!1),me()},1e3)};T.useEffect(()=>{X?Ae():We()},[X]),T.useEffect(()=>{tt==="loading"&&setTimeout(()=>{s(!0)},200)},[tt]),T.useEffect(()=>{function Xe(Pe,ct=2){return String(Pe).padStart(ct,"0")}if(tt==="ended"){$(!0);let Pe=0;Pe=It-Oe;const ct=Math.floor(Pe/6e4%60),gt=Math.floor(Pe/1e3%60),Yt=Pe%1e3,Zt=`${Xe(ct)}:${Xe(gt)}:${Xe(Yt,3)}`;let O=localStorage.getItem("currentRecordTime"),z=0;setTimeout(()=>{if(Wn.to(ie.current,{opacity:1,duration:1.5}),!O)O="",localStorage.setItem("currentRecordTime",Pe),setTimeout(()=>{he.current.innerHTML=Zt},200);else if(O>Pe){localStorage.setItem("currentRecordTime",Pe),z=O-Pe;const ye=Math.floor(z/6e4%60),Le=Math.floor(z/1e3%60),Te=z%1e3,De=`${Xe(ye)}:${Xe(Le)}:${Xe(Te,3)}`;setTimeout(()=>{he.current.innerHTML=Zt+'<br><span class="better-time">(-'+De+")</span>"},200)}else if(O<Pe){z=Pe-O;const ye=Math.floor(z/6e4%60),Le=Math.floor(z/1e3%60),Te=z%1e3,De=`${Xe(ye)}:${Xe(Le)}:${Xe(Te,3)}`;setTimeout(()=>{he.current.innerHTML=Zt+'<br><span class="worse-time">(+'+De+")</span>"},200)}else setTimeout(()=>{he.current.innerHTML=Zt},200)},200)}},[tt]),T.useEffect(()=>{let Xe;const Pe=async()=>{for(let gt=3;gt>=1;gt--)v.current.textContent=gt,Wn.fromTo(v.current,{opacity:1},{opacity:0,duration:.6,delay:.4}),i.volume=.1,i.play(),await ct(1e3);v.current.textContent="GO",Wn.fromTo(v.current,{opacity:1},{opacity:0,duration:.6,delay:.4}),e.volume=.1,e.play(),setTimeout(()=>{ne(!1)},1e3),setTimeout(()=>{ue()},200)},ct=gt=>new Promise(Yt=>setTimeout(Yt,gt));return _&&(Xe=setTimeout(Pe,500)),()=>{clearTimeout(Xe)}},[_]),T.useEffect(()=>(document.addEventListener("keydown",ve),()=>{document.removeEventListener("keydown",ve)}),[n,W,G,tt]),T.useEffect(()=>{if(b.current){const Xe=b.current,Pe=Wn.fromTo(Xe,{opacity:0},{opacity:1,duration:1.5});return()=>{Pe.kill(),clearTimeout(timeout)}}},[n,b]),T.useEffect(()=>{if(G){const Xe=y.current,Pe=Wn.fromTo(Xe,{opacity:0},{opacity:1,yoyo:!0,repeat:-1,duration:1});return()=>{Pe.kill()}}},[G]);function qe(){const{progress:Xe}=J7();return y.current.textContent=Xe.toFixed(0)+"%",Xe>99.9&&setTimeout(()=>{w(!0),y.current.textContent="PRESS ENTER TO PLAY"},2e3),D(Sr,{})}return D(Sr,{children:n?$e(Sr,{children:[W?null:$e("div",{className:"loading-screen",children:[D("div",{className:"keyboard-controls",ref:b,children:D(nq,{keyboardType:m})}),D("div",{ref:y,className:"loading-info"})]}),D(eq,{children:$e(BP,{onKeyDown:je,dpr:a,shadows:o>0?"soft":"basic",children:[D(T.Suspense,{fallback:D(qe,{}),children:te?null:$e(Sr,{children:[D("color",{attach:"background",args:["#F9F9F9"]}),D(KQ,{onIncline:()=>l(c),onDecline:()=>l(h),children:D($j,{perfomanceMode:o})})]})}),_?D(md,{wrapperClass:"countdown-overlay",className:"countdown-stats",children:D("p",{ref:v,className:"countdown-value"})}):null,L?$e(md,{wrapperClass:"pause-overlay",className:"pause-stats",ref:le,children:[D("button",{onClick:be,children:"RESUME"}),D("button",{onClick:Ve,children:"RESTART"}),D("button",{onClick:ke,children:"QUIT"})]}):null,j?$e(md,{wrapperClass:"finish-overlay",className:"finish-stats",ref:ie,children:[D("div",{className:"finish-time",ref:he}),D("button",{onClick:Ve,children:"RESTART"}),D("button",{onClick:ke,children:"QUIT"})]}):null]})})]}):D(tq,{})})}sq.render(D(rq,{}));
